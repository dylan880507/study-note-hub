
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>EF_Core · Study Note</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Dylan">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Identify_Server_4.html" />
    
    
    <link rel="prev" href="c_sharp.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    NetCore
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="ABP.html">
            
                <a href="ABP.html">
            
                    
                    ABP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="AOP.html">
            
                <a href="AOP.html">
            
                    
                    AOP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="c_sharp.html">
            
                <a href="c_sharp.html">
            
                    
                    c_sharp
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4" data-path="EF_Core.html">
            
                <a href="EF_Core.html">
            
                    
                    EF_Core
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="Identify_Server_4.html">
            
                <a href="Identify_Server_4.html">
            
                    
                    Identify_Server_4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="JWT.html">
            
                <a href="JWT.html">
            
                    
                    JWT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="MemoryCache_and_分布式Cache_Redis.html">
            
                <a href="MemoryCache_and_分布式Cache_Redis.html">
            
                    
                    MemoryCacheand分布式Cache_Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="MySQL.html">
            
                <a href="MySQL.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="Net_Core_API.html">
            
                <a href="Net_Core_API.html">
            
                    
                    Net_Core_API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="Net_Core_MVC.html">
            
                <a href="Net_Core_MVC.html">
            
                    
                    Net_Core_MVC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="Net_Index.html">
            
                <a href="Net_Index.html">
            
                    
                    Net_Index
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="note.html">
            
                <a href="note.html">
            
                    
                    note
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="Polly.html">
            
                <a href="Polly.html">
            
                    
                    Polly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="大神的博客.html">
            
                <a href="大神的博客.html">
            
                    
                    大神的博客
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    os
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../os/centos.html">
            
                <a href="../os/centos.html">
            
                    
                    centos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../os/gitbook.html">
            
                <a href="../os/gitbook.html">
            
                    
                    gitbook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../os/nginx.html">
            
                <a href="../os/nginx.html">
            
                    
                    nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../os/ubuntu.html">
            
                <a href="../os/ubuntu.html">
            
                    
                    ubuntu
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    python
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../python/note_command.html">
            
                <a href="../python/note_command.html">
            
                    
                    note_command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../python/note_logic.html">
            
                <a href="../python/note_logic.html">
            
                    
                    note_logic
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    webend
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../webend/@vue_cli.html">
            
                <a href="../webend/@vue_cli.html">
            
                    
                    @vue_cli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../webend/cdn.html">
            
                <a href="../webend/cdn.html">
            
                    
                    cdn
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../webend/chat_gpt.html">
            
                <a href="../webend/chat_gpt.html">
            
                    
                    chat_gpt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../webend/chrome_plugins.html">
            
                <a href="../webend/chrome_plugins.html">
            
                    
                    chrome_plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../webend/git.html">
            
                <a href="../webend/git.html">
            
                    
                    git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../webend/node&npm.html">
            
                <a href="../webend/node&npm.html">
            
                    
                    node&npm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../webend/note_奇技淫巧.html">
            
                <a href="../webend/note_奇技淫巧.html">
            
                    
                    note_奇技淫巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../webend/note_布局和样式.html">
            
                <a href="../webend/note_布局和样式.html">
            
                    
                    note_布局和样式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../webend/note_打包.html">
            
                <a href="../webend/note_打包.html">
            
                    
                    note_打包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../webend/note_逻辑.html">
            
                <a href="../webend/note_逻辑.html">
            
                    
                    note_逻辑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../webend/package.json.html">
            
                <a href="../webend/package.json.html">
            
                    
                    package.json
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../webend/react.html">
            
                <a href="../webend/react.html">
            
                    
                    react
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../webend/third_party_plugins.html">
            
                <a href="../webend/third_party_plugins.html">
            
                    
                    third_party_plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../webend/typescript.html">
            
                <a href="../webend/typescript.html">
            
                    
                    typescript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../webend/uni_app.html">
            
                <a href="../webend/uni_app.html">
            
                    
                    uni_app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../webend/vite.html">
            
                <a href="../webend/vite.html">
            
                    
                    vite
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="../webend/vscode.html">
            
                <a href="../webend/vscode.html">
            
                    
                    vscode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18" data-path="../webend/Vue2X.html">
            
                <a href="../webend/Vue2X.html">
            
                    
                    Vue2X
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.19" data-path="../webend/Vue3X.html">
            
                <a href="../webend/Vue3X.html">
            
                    
                    Vue3X
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20" data-path="../webend/webpack.html">
            
                <a href="../webend/webpack.html">
            
                    
                    webpack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >EF_Core</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><ul><li><span class="title-icon "></span><a href="#1&#x76F8;&#x5173;&#x6587;&#x7AE0;"><b></b>1&gt;&#x76F8;&#x5173;&#x6587;&#x7AE0;</a></li><ul><li><span class="title-icon "></span><a href="#1-1ef-core"><b></b>1-1&gt;EF Core</a></li><li><span class="title-icon "></span><a href="#1-2mysql"><b></b>1-2&gt;MySQL</a></li><li><span class="title-icon "></span><a href="#1-3fluent-api"><b></b>1-3&gt;Fluent API</a></li><li><span class="title-icon "></span><a href="#1-4mapster"><b></b>1-4&gt;Mapster</a></li><li><span class="title-icon "></span><a href="#1-5automapper"><b></b>1-5&gt;AutoMapper</a></li><li><span class="title-icon "></span><a href="#1-6unitofwork"><b></b>1-6&gt;UnitofWork</a></li><li><span class="title-icon "></span><a href="#1-7dapper"><b></b>1-7&gt;Dapper</a></li></ul><li><span class="title-icon "></span><a href="#2dbcontext"><b></b>2&gt;DbContext</a></li><ul><li><span class="title-icon "></span><a href="#2-1dbcontext-&#x751F;&#x5B58;&#x671F;"><b></b>2-1&gt;DbContext &#x751F;&#x5B58;&#x671F;</a></li><li><span class="title-icon "></span><a href="#2-2&#x4F9D;&#x8D56;&#x6CE8;&#x5165;dbcontext"><b></b>2-2&gt;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;DbContext</a></li><li><span class="title-icon "></span><a href="#2-3&#x4F7F;&#x7528;new&#x5B9E;&#x4F8B;&#x5316;dbcontext"><b></b>2-3&gt;&#x4F7F;&#x7528;new&#x5B9E;&#x4F8B;&#x5316;DbContext</a></li><li><span class="title-icon "></span><a href="#2-4&#x4F7F;&#x7528;dbcontext&#x5DE5;&#x5382;"><b></b>2-4&gt;&#x4F7F;&#x7528;DbContext&#x5DE5;&#x5382;</a></li><li><span class="title-icon "></span><a href="#2-5dbcontextoptions"><b></b>2-5&gt;DbContextOptions</a></li><li><span class="title-icon "></span><a href="#2-6&#x907F;&#x514D;-dbcontext-&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x95EE;&#x9898;"><b></b>2-6&gt;&#x907F;&#x514D; DbContext &#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x95EE;&#x9898;</a></li></ul><li><span class="title-icon "></span><a href="#3&#x5B9E;&#x4F53;&#x914D;&#x7F6E;"><b></b>3&gt;&#x5B9E;&#x4F53;&#x914D;&#x7F6E;</a></li><ul><li><span class="title-icon "></span><a href="#3-1&#x5728;dbcontextonmodelcreating&#x5185;&#x914D;&#x7F6E;&#x5B9E;&#x4F53;"><b></b>3-1&gt;&#x5728;DbContext.OnModelCreating&#x5185;&#x914D;&#x7F6E;&#x5B9E;&#x4F53;</a></li><li><span class="title-icon "></span><a href="#3-2&#x901A;&#x8FC7;&#x7279;&#x6027;&#x914D;&#x7F6E;"><b></b>3-2&gt;&#x901A;&#x8FC7;&#x7279;&#x6027;&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#3-3&#x901A;&#x8FC7;fluent-api&#x914D;&#x7F6E;"><b></b>3-3&gt;&#x901A;&#x8FC7;Fluent API&#x914D;&#x7F6E;</a></li></ul><li><span class="title-icon "></span><a href="#4&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;"><b></b>4&gt;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;</a></li><ul><li><span class="title-icon "></span><a href="#4-1code-first&#x4F7F;&#x7528;migration-db-first&#x4F7F;&#x7528;&#x65B9;&#x5411;&#x5DE5;&#x7A0B;"><b></b>4-1&gt;Code first&#x4F7F;&#x7528;Migration, DB First&#x4F7F;&#x7528;&#x65B9;&#x5411;&#x5DE5;&#x7A0B;.</a></li><li><span class="title-icon "></span><a href="#4-2&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><b></b>4-2&gt;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li><li><span class="title-icon "></span><a href="#4-3&#x6307;&#x4EE4;&#x5217;&#x8868;"><b></b>4-3&gt;&#x6307;&#x4EE4;&#x5217;&#x8868;</a></li><li><span class="title-icon "></span><a href="#4-4&#x7BA1;&#x7406;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;"><b></b>4-4&gt;&#x7BA1;&#x7406;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;</a></li><li><span class="title-icon "></span><a href="#4-5&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><b></b>4-5&gt;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li><li><span class="title-icon "></span><a href="#4-6&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x52A8;&#x6001;&#x7F16;&#x7A0B;"><b></b>4-6&gt;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x52A8;&#x6001;&#x7F16;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#4-7&#x52A8;&#x6001;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;"><b></b>4-7&gt;&#x52A8;&#x6001;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;</a></li><li><span class="title-icon "></span><a href="#4-8&#x81EA;&#x5B9A;&#x4E49;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;"><b></b>4-8&gt;&#x81EA;&#x5B9A;&#x4E49;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;</a></li></ul><li><span class="title-icon "></span><a href="#5&#x5E76;&#x53D1;"><b></b>5&gt;&#x5E76;&#x53D1;</a></li><li><span class="title-icon "></span><a href="#6&#x53CD;&#x5411;&#x5DE5;&#x7A0B;-&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;"><b></b>6&gt;&#x53CD;&#x5411;&#x5DE5;&#x7A0B; (&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;)</a></li><li><span class="title-icon "></span><a href="#7&#x67E5;&#x8BE2;"><b></b>7&gt;&#x67E5;&#x8BE2;</a></li><ul><li><span class="title-icon "></span><a href="#7-1&#x8DDF;&#x8E2A;&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;"><b></b>7-1&gt;&#x8DDF;&#x8E2A;/&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;</a></li><li><span class="title-icon "></span><a href="#7-2&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;"><b></b>7-2&gt;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#7-3&#x62C6;&#x5206;&#x67E5;&#x8BE2;&#x5408;&#x5E76;&#x67E5;&#x8BE2;"><b></b>7-3&gt;&#x62C6;&#x5206;&#x67E5;&#x8BE2;/&#x5408;&#x5E76;&#x67E5;&#x8BE2;</a></li><li><span class="title-icon "></span><a href="#7-4&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;cross-join-inner-join-left-join"><b></b>7-4&gt;&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;(cross join, inner join, left join)</a></li><li><span class="title-icon "></span><a href="#7-5&#x5206;&#x7EC4;&#x67E5;&#x8BE2;group-by"><b></b>7-5&gt;&#x5206;&#x7EC4;&#x67E5;&#x8BE2;(group by)</a></li><li><span class="title-icon "></span><a href="#7-6&#x539F;&#x751F;sql&#x67E5;&#x8BE2;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x53CA;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;"><b></b>7-6&gt;&#x539F;&#x751F;SQL&#x67E5;&#x8BE2;(&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x53CA;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;)</a></li><li><span class="title-icon "></span><a href="#7-7&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6620;&#x5C04;"><b></b>7-7&gt;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6620;&#x5C04;</a></li><li><span class="title-icon "></span><a href="#7-8&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;hasqueryfilter"><b></b>7-8&gt;&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;(HasQueryFilter)</a></li><li><span class="title-icon "></span><a href="#7-9&#x751F;&#x6210;&#x7684;sql&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;"><b></b>7-9&gt;&#x751F;&#x6210;&#x7684;SQL&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;</a></li><li><span class="title-icon "></span><a href="#7-10null&#x5224;&#x65AD;"><b></b>7-10&gt;null&#x5224;&#x65AD;</a></li><li><span class="title-icon "></span><a href="#7-11&#x67E5;&#x8BE2;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;"><b></b>7-11&gt;&#x67E5;&#x8BE2;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</a></li><li><span class="title-icon "></span><a href="#7-12linq&#x7528;&#x6CD5;&#x5927;&#x5168;"><b></b>7-12&gt;LINQ&#x7528;&#x6CD5;&#x5927;&#x5168;</a></li><li><span class="title-icon "></span><a href="#7-13effunctions"><b></b>7-13&gt;EF.Functions</a></li></ul><li><span class="title-icon "></span><a href="#8&#x65B0;&#x589E;&#x4FEE;&#x6539;"><b></b>8&gt;&#x65B0;&#x589E;/&#x4FEE;&#x6539;</a></li><li><span class="title-icon "></span><a href="#9&#x5220;&#x9664;"><b></b>9&gt;&#x5220;&#x9664;</a></li><li><span class="title-icon "></span><a href="#10&#x4E8B;&#x52A1;"><b></b>10&gt;&#x4E8B;&#x52A1;</a></li><ul><li><span class="title-icon "></span><a href="#&#x663E;&#x5F0F;&#x63A7;&#x5236;&#x4E8B;&#x52A1;"><b></b>*&#x663E;&#x5F0F;&#x63A7;&#x5236;&#x4E8B;&#x52A1;</a></li><li><span class="title-icon "></span><a href="#&#x4FDD;&#x5B58;&#x70B9;"><b></b>*&#x4FDD;&#x5B58;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x8DE8;&#x591A;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E8B;&#x52A1;&#xFF08;&#x4EC5;&#x9650;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF09;"><b></b>*&#x8DE8;&#x591A;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E8B;&#x52A1;&#xFF08;&#x4EC5;&#x9650;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF09;</a></li><li><span class="title-icon "></span><a href="#&#x591A;&#x79CD;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6280;&#x672F;&#x5171;&#x4EAB;&#x4E8B;&#x52A1;"><b></b>*&#x591A;&#x79CD;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6280;&#x672F;&#x5171;&#x4EAB;&#x4E8B;&#x52A1;</a></li><li><span class="title-icon "></span><a href="#&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"><b></b>*&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;</a></li><li><span class="title-icon "></span><a href="#&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;isolationlevel"><b></b>*&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;(IsolationLevel)</a></li></ul><li><span class="title-icon "></span><a href="#11&#x8BBE;&#x7F6E;sql-server-identity&#x5217;&#x4E2D;&#x7684;&#x663E;&#x5F0F;&#x503C;"><b></b>11&gt;&#x8BBE;&#x7F6E;SQL Server IDENTITY&#x5217;&#x4E2D;&#x7684;&#x663E;&#x5F0F;&#x503C;</a></li><li><span class="title-icon "></span><a href="#12&#x96C6;&#x6210;dapper-&#x7528;&#x4E8E;&#x590D;&#x6742;&#x67E5;&#x8BE2;"><b></b>12&gt;&#x96C6;&#x6210;Dapper, &#x7528;&#x4E8E;&#x590D;&#x6742;&#x67E5;&#x8BE2;</a></li><li><span class="title-icon "></span><a href="#13&#x96EA;&#x82B1;id"><b></b>13&gt;&#x96EA;&#x82B1;ID</a></li><ul><li><span class="title-icon "></span><a href="#13-1&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;"><b></b>13-1&gt;&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;</a></li><li><span class="title-icon "></span><a href="#13-2net-core&#x4E2D;&#x4F7F;&#x7528;"><b></b>13-2&gt;Net Core&#x4E2D;&#x4F7F;&#x7528;</a></li></ul><li><span class="title-icon "></span><a href="#14&#x4E3B;&#x952E;&#x7684;&#x8BBE;&#x8BA1;"><b></b>14&gt;&#x4E3B;&#x952E;&#x7684;&#x8BBE;&#x8BA1;</a></li><li><span class="title-icon "></span><a href="#15&#x8BFB;&#x5199;&#x5206;&#x79BB;"><b></b>15&gt;&#x8BFB;&#x5199;&#x5206;&#x79BB;</a></li><ul><li><span class="title-icon "></span><a href="#15-1sql&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x4E3B;&#x4ECE;&#x590D;&#x5236;---&#x5B9E;&#x9645;&#x914D;&#x7684;&#x8FC7;&#x7A0B;-&#x4F7F;&#x7528;&#x4E86;2&#x53F0;&#x670D;&#x52A1;&#x5668;-1&#x53F0;&#x4F5C;&#x4E3A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5668;-2&#x53F0;&#x4F5C;&#x4E3A;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;-&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;&#x4E00;&#x76F4;&#x914D;&#x7F6E;&#x5931;&#x8D25;-&#x540E;&#x9762;&#x6539;&#x6210;&#x4E86;&#x53D1;&#x9001;&#x8BA2;&#x9605;-&#x5E76;&#x5173;&#x95ED;&#x4E86;&#x53D1;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9632;&#x706B;&#x5899;-&#x624D;&#x914D;&#x7F6E;&#x6210;&#x529F;-&#x53E6;-sql-server&#x7684;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;-&#x6700;&#x5C0F;&#x9891;&#x7387;&#x53EA;&#x80FD;&#x662F;10s-&#x56E0;&#x6B64;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x4E0D;&#x4F1A;&#x91C7;&#x7528;sql-server&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x5DE5;&#x5177;"><b></b>15-1&gt;SQL&#x8BFB;&#x5199;&#x5206;&#x79BB;(&#x4E3B;&#x4ECE;&#x590D;&#x5236;) - &#x5B9E;&#x9645;&#x914D;&#x7684;&#x8FC7;&#x7A0B;, &#x4F7F;&#x7528;&#x4E86;2&#x53F0;&#x670D;&#x52A1;&#x5668;, 1&#x53F0;&#x4F5C;&#x4E3A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5668;, 2&#x53F0;&#x4F5C;&#x4E3A;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;, &#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;&#x4E00;&#x76F4;&#x914D;&#x7F6E;&#x5931;&#x8D25;, &#x540E;&#x9762;&#x6539;&#x6210;&#x4E86;&#x53D1;&#x9001;&#x8BA2;&#x9605;, &#x5E76;&#x5173;&#x95ED;&#x4E86;&#x53D1;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9632;&#x706B;&#x5899;, &#x624D;&#x914D;&#x7F6E;&#x6210;&#x529F;. &#x53E6;, SQL Server&#x7684;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;, &#x6700;&#x5C0F;&#x9891;&#x7387;&#x53EA;&#x80FD;&#x662F;10S, &#x56E0;&#x6B64;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x4E0D;&#x4F1A;&#x91C7;&#x7528;SQL Server&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x5DE5;&#x5177;.</a></li><li><span class="title-icon "></span><a href="#15-2mysql&#x8BFB;&#x5199;&#x5206;&#x79BB;"><b></b>15-2&gt;MySQL&#x8BFB;&#x5199;&#x5206;&#x79BB;</a></li><li><span class="title-icon "></span><a href="#15-3ef-core&#x5B9E;&#x73B0;"><b></b>15-3&gt;EF Core&#x5B9E;&#x73B0;</a></li></ul><li><span class="title-icon "></span><a href="#16ef&#x65E5;&#x5FD7;"><b></b>16&gt;EF&#x65E5;&#x5FD7;</a></li><ul><li><span class="title-icon "></span><a href="#16-1&#x4F7F;&#x7528;net-core&#x7684;&#x65E5;&#x5FD7;&#x6846;&#x67B6;&#x6CE8;&#x5165;log4net"><b></b>16-1&gt;&#x4F7F;&#x7528;net core&#x7684;&#x65E5;&#x5FD7;&#x6846;&#x67B6;(&#x6CE8;&#x5165;log4net)</a></li><li><span class="title-icon "></span><a href="#16-2&#x4F7F;&#x7528;ef&#x81EA;&#x5E26;&#x7684;&#x7B80;&#x5355;&#x65E5;&#x5FD7;&#x6A21;&#x5F0F;"><b></b>16-2&gt;&#x4F7F;&#x7528;EF&#x81EA;&#x5E26;&#x7684;&#x7B80;&#x5355;&#x65E5;&#x5FD7;&#x6A21;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#16-3&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;sql&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;"><b></b>16-3&gt;&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;SQL&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</a></li></ul><li><span class="title-icon "></span><a href="#17&#x6279;&#x91CF;&#x5904;&#x7406;"><b></b>17&gt;&#x6279;&#x91CF;&#x5904;&#x7406;</a></li><ul><li><span class="title-icon "></span><a href="#17-1&#x4F7F;&#x7528;zack-ef&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;"><b></b>17-1&gt;&#x4F7F;&#x7528;Zack EF&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;</a></li><li><span class="title-icon "></span><a href="#17-2&#x4F7F;&#x7528;&#x6B65;&#x9AA4;"><b></b>17-2&gt;&#x4F7F;&#x7528;&#x6B65;&#x9AA4;</a></li><li><span class="title-icon "></span><a href="#17-3&#x6279;&#x91CF;&#x65B0;&#x589E;"><b></b>17-3&gt;&#x6279;&#x91CF;&#x65B0;&#x589E;</a></li><li><span class="title-icon "></span><a href="#17-4&#x6279;&#x91CF;&#x66F4;&#x65B0;"><b></b>17-4&gt;&#x6279;&#x91CF;&#x66F4;&#x65B0;</a></li><li><span class="title-icon "></span><a href="#17-5&#x6279;&#x91CF;&#x5220;&#x9664;"><b></b>17-5&gt;&#x6279;&#x91CF;&#x5220;&#x9664;</a></li></ul><li><span class="title-icon "></span><a href="#18&#x8868;&#x8FBE;&#x5F0F;&#x6811;"><b></b>18&gt;&#x8868;&#x8FBE;&#x5F0F;&#x6811;</a></li><ul><li><span class="title-icon "></span><a href="#18-1&#x4F7F;&#x7528;&#x573A;&#x666F;"><b></b>18-1&gt;&#x4F7F;&#x7528;&#x573A;&#x666F;</a></li><li><span class="title-icon "></span><a href="#18-2vs&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x5B89;&#x88C5;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;vs2019-&#x5DE5;&#x5177;&#x7248;&#x672C;171150-&#x4E0D;&#x652F;&#x6301;net-core-31&#x4EE5;&#x4E0A;&#x6846;&#x67B6;"><b></b>18-2&gt;VS&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x5B89;&#x88C5;(&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;vs2019, &#x5DE5;&#x5177;&#x7248;&#x672C;:1.7.115.0, &#x4E0D;&#x652F;&#x6301;Net Core 3.1&#x4EE5;&#x4E0A;&#x6846;&#x67B6;)</a></li><li><span class="title-icon "></span><a href="#18-3&#x64CD;&#x4F5C;&#x8FD0;&#x7B97;&#x7B26;"><b></b>18-3&gt;&#x64CD;&#x4F5C;&#x8FD0;&#x7B97;&#x7B26;</a></li><li><span class="title-icon "></span><a href="#18-4&#x8303;&#x4F8B;"><b></b>18-4&gt;&#x8303;&#x4F8B;</a></li><li><span class="title-icon "></span><a href="#18-5&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x62D3;&#x5C55;&#x65B9;&#x6CD5;"><b></b>18-5&gt;&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x62D3;&#x5C55;&#x65B9;&#x6CD5;</a></li></ul><li><span class="title-icon "></span><a href="#19mapster"><b></b>19&gt;Mapster</a></li><ul><li><span class="title-icon "></span><a href="#19-1&#x62D3;&#x5C55;&#x63D2;&#x4EF6;"><b></b>19-1&gt;&#x62D3;&#x5C55;&#x63D2;&#x4EF6;</a></li><li><span class="title-icon "></span><a href="#19-2&#x57FA;&#x672C;&#x7528;&#x6CD5;"><b></b>19-2&gt;&#x57FA;&#x672C;&#x7528;&#x6CD5;</a></li><li><span class="title-icon "></span><a href="#19-3&#x914D;&#x7F6E;"><b></b>19-3&gt;&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#19-4&#x6620;&#x5C04;&#x5668;mapper"><b></b>19-4&gt;&#x6620;&#x5C04;&#x5668;(Mapper)</a></li><li><span class="title-icon "></span><a href="#19-5&#x6784;&#x5EFA;&#x5668;builder---&#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;"><b></b>19-5&gt;&#x6784;&#x5EFA;&#x5668;(Builder) - &#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;</a></li><li><span class="title-icon "></span><a href="#19-6scan-apply"><b></b>19-6&gt;Scan, Apply</a></li><li><span class="title-icon "></span><a href="#19-7compile&#x914D;&#x7F6E;&#x7F16;&#x8BD1;"><b></b>19-7&gt;Compile(&#x914D;&#x7F6E;&#x7F16;&#x8BD1;)</a></li><li><span class="title-icon "></span><a href="#19-8&#x5C5E;&#x6027;&#x6210;&#x5458;&#x6620;&#x5C04;&#x4F8B;&#x5B50;"><b></b>19-8&gt;&#x5C5E;&#x6027;&#x6210;&#x5458;&#x6620;&#x5C04;&#x4F8B;&#x5B50;</a></li><li><span class="title-icon "></span><a href="#19-9&#x5C5E;&#x6027;&#x547D;&#x540D;&#x7EA6;&#x5B9A;"><b></b>19-9&gt;&#x5C5E;&#x6027;&#x547D;&#x540D;&#x7EA6;&#x5B9A;</a></li><li><span class="title-icon "></span><a href="#19-10&#x6620;&#x5C04;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;"><b></b>19-10&gt;&#x6620;&#x5C04;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;</a></li><li><span class="title-icon "></span><a href="#19-11&#x6784;&#x9020;&#x51FD;&#x6570;&#x6620;&#x5C04;"><b></b>19-11&gt;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6620;&#x5C04;</a></li><li><span class="title-icon "></span><a href="#19-12&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;"><b></b>19-12&gt;&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;&amp;&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;</a></li><li><span class="title-icon "></span><a href="#19-13&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;"><b></b>19-13&gt;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;</a></li><li><span class="title-icon "></span><a href="#19-14&#x5F02;&#x6B65;&#x652F;&#x6301;"><b></b>19-14&gt;&#x5F02;&#x6B65;&#x652F;&#x6301;</a></li><li><span class="title-icon "></span><a href="#19-15&#x4E0E;ef-core&#x96C6;&#x6210;"><b></b>19-15&gt;&#x4E0E;EF Core&#x96C6;&#x6210;</a></li><li><span class="title-icon "></span><a href="#19-16&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><b></b>19-16&gt;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a></li><li><span class="title-icon "></span><a href="#19-17&#x5C01;&#x88C5;"><b></b>19-17&gt;&#x5C01;&#x88C5;</a></li></ul><li><span class="title-icon "></span><a href="#20&#x4ED3;&#x50A8;&#x5C01;&#x88C5;"><b></b>20&gt;&#x4ED3;&#x50A8;&#x5C01;&#x88C5;</a></li><li><span class="title-icon "></span><a href="#21&#x5206;&#x8868;&#x5206;&#x5E93;&#x7EC4;&#x4EF6;---shardingcore"><b></b>21&gt;&#x5206;&#x8868;&#x5206;&#x5E93;&#x7EC4;&#x4EF6; - ShardingCore</a></li><ul><li><span class="title-icon "></span><a href="#21-1&#x5206;&#x8868;"><b></b>21-1&gt;&#x5206;&#x8868;</a></li><li><span class="title-icon "></span><a href="#21-2&#x5206;&#x5E93;"><b></b>21-2&gt;&#x5206;&#x5E93;</a></li><li><span class="title-icon "></span><a href="#21-3&#x5206;&#x8868;&#x5206;&#x5E93;"><b></b>21-3&gt;&#x5206;&#x8868;&#x5206;&#x5E93;</a></li><li><span class="title-icon "></span><a href="#21-4&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x53C2;&#x8003;21-1"><b></b>21-4&gt;&#x8BFB;&#x5199;&#x5206;&#x79BB;(&#x53C2;&#x8003;21-1&gt;)</a></li></ul><li><span class="title-icon "></span><a href="#22ef&#x76D1;&#x542C;&#x5668;"><b></b>22&gt;EF&#x76D1;&#x542C;&#x5668;</a></li><li><span class="title-icon "></span><a href="#23&#x6027;&#x80FD;&#x4E13;&#x9898;"><b></b>23&gt;&#x6027;&#x80FD;&#x4E13;&#x9898;</a></li><ul><li><span class="title-icon "></span><a href="#23-1&#x6027;&#x80FD;&#x8BCA;&#x65AD;"><b></b>23-1&gt;&#x6027;&#x80FD;&#x8BCA;&#x65AD;</a></li><li><span class="title-icon "></span><a href="#23-2&#x9AD8;&#x6548;&#x67E5;&#x8BE2;"><b></b>23-2&gt;&#x9AD8;&#x6548;&#x67E5;&#x8BE2;</a></li><li><span class="title-icon "></span><a href="#23-3&#x9AD8;&#x6548;&#x66F4;&#x65B0;"><b></b>23-3&gt;&#x9AD8;&#x6548;&#x66F4;&#x65B0;</a></li></ul><li><span class="title-icon "></span><a href="#24&#x5176;&#x4ED6;&#x77E5;&#x8BC6;&#x6CE8;&#x610F;&#x70B9;"><b></b>24&gt;&#x5176;&#x4ED6;&#x77E5;&#x8BC6;/&#x6CE8;&#x610F;&#x70B9;</a></li><ul><li><span class="title-icon "></span><a href="#sql-server&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;-&#x8D85;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;"><b></b>*SQL Server&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570; (&#x8D85;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;)</a></li><li><span class="title-icon "></span><a href="#guid&#x4E3B;&#x952E;&#x6CE8;&#x610F;&#x70B9;"><b></b>*GUID&#x4E3B;&#x952E;&#x6CE8;&#x610F;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x5982;&#x4F55;&#x9009;&#x62E9;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x548C;&#x5355;&#x5411;&#x5BFC;&#x822A;"><b></b>*&#x5982;&#x4F55;&#x9009;&#x62E9;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x548C;&#x5355;&#x5411;&#x5BFC;&#x822A;</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;1n&#x7684;&#x5957;&#x8DEF;"><b></b>*&#x914D;&#x7F6E;1:N&#x7684;&#x5957;&#x8DEF;</a></li><li><span class="title-icon "></span><a href="#iqueryable&#x77E5;&#x8BC6;&#x70B9;"><b></b>*IQueryable&#x77E5;&#x8BC6;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x53EF;&#x4EE5;&#x901A;&#x8FC7;iqueryabletoquerystring&#x83B7;&#x53D6;sql"><b></b>*&#x53EF;&#x4EE5;&#x901A;&#x8FC7;IQueryable.ToQueryString()&#x83B7;&#x53D6;SQL</a></li><li><span class="title-icon "></span><a href="#&#x4E0D;&#x8981;&#x5728;onmodelcreating&#x914D;&#x7F6E;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;-&#x5C06;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;"><b></b>*&#x4E0D;&#x8981;&#x5728;OnModelCreating&#x914D;&#x7F6E;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;, &#x5C06;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</a></li><li><span class="title-icon "></span><a href="#nn&#x7684;&#x4E24;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;"><b></b>*N:N&#x7684;&#x4E24;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;1n"><b></b>*&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;(1:N)</a></li><li><span class="title-icon "></span><a href="#11-1n&#x81EA;&#x5F15;&#x7528;-nn-&#x7684;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;-&#x6700;&#x7A33;&#x59A5;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F53;&#x90FD;&#x52A0;&#x5230;dbcontextxxxadd-&#x4E0D;&#x8FC7;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7AEF;-&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5173;&#x8054;&#x5230;&#x4E00;&#x8D77;&#x540E;-&#x518D;add&#x5230;&#x4E00;&#x7AEF;-ef&#x4E5F;&#x4F1A;&#x5C06;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5176;&#x4ED6;&#x5B9E;&#x4F53;&#x4E00;&#x8D77;insert&#x5230;data-base"><b></b>*1:1, 1:N(&#x81EA;&#x5F15;&#x7528;), N:N &#x7684;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;, &#x6700;&#x7A33;&#x59A5;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F53;&#x90FD;&#x52A0;&#x5230;DbContext.XXX.Add(), &#x4E0D;&#x8FC7;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7AEF;, &#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5173;&#x8054;&#x5230;&#x4E00;&#x8D77;&#x540E;, &#x518D;Add&#x5230;&#x4E00;&#x7AEF;, EF&#x4E5F;&#x4F1A;&#x5C06;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5176;&#x4ED6;&#x5B9E;&#x4F53;&#x4E00;&#x8D77;insert&#x5230;data base.</a></li><li><span class="title-icon "></span><a href="#&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;"><b></b>*&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;</a></li><li><span class="title-icon "></span><a href="#&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x67E5;&#x8BE2;-&#x76F4;&#x63A5;&#x5220;&#x9664;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x6CD5;"><b></b>*&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x67E5;&#x8BE2;, &#x76F4;&#x63A5;&#x5220;&#x9664;/&#x4FEE;&#x6539;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x6CD5;</a></li><li><span class="title-icon "></span><a href="#iqueryable&#x53EF;&#x4EE5;&#x53E0;&#x52A0;&#x590D;&#x7528;"><b></b>*IQueryable&#x53EF;&#x4EE5;&#x53E0;&#x52A0;&#x590D;&#x7528;</a></li><li><span class="title-icon "></span><a href="#iqueryable&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;datareader&#x8BFB;&#x53D6;&#x6570;&#x636E;"><b></b>*IQueryable&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;DataReader&#x8BFB;&#x53D6;&#x6570;&#x636E;</a></li><li><span class="title-icon "></span><a href="#&#x4F55;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;"><b></b>*&#x4F55;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;</a></li><li><span class="title-icon "></span><a href="#&#x52A8;&#x6001;&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;add&#x6216;&#x8005;update"><b></b>*&#x52A8;&#x6001;&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;Add&#x6216;&#x8005;Update</a></li><li><span class="title-icon "></span><a href="#&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x503C;"><b></b>*&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x503C;</a></li></ul></ul></ul></div><ul>
<li>&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x5BF9;&#x8C61;&#x7684;&#x7C92;&#x5EA6;&#x4E0A;&#x53EF;&#x7C97;&#x7565;&#x7684;&#x5206;&#x4E3A;server&#x3001;database&#x3001;schema&#x3001;table&#x3001;colmun&#x3002;&#x8FD9;&#x91CC;server&#x76F8;&#x5F53;&#x4E8E;instance&#xFF08;&#x5B9E;&#x4F8B;&#xFF09;&#xFF0C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x53EF;&#x4EE5;&#x88C5;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x6709;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x6709;&#x591A;&#x4E2A;schema(&#x6A21;&#x5F0F;&#xFF09;&#xFF0C;schema&#x76F8;&#x5F53;&#x4E8E;&#x628A;&#x76F8;&#x4F3C;&#x7684;&#x8868;&#x505A;&#x4E2A;&#x5F52;&#x7C7B;&#x3002;</li>
</ul>
<p>--&#x67E5;&#x8BE2;&#x5F53;&#x524D;&#x5E93;&#x4E2D;&#x7684;&#x67B6;&#x6784;</p>
<p>SELECT * FROM sys.schemas AS s</p>
<p>--&#x82E5;schema&#x4E0D;&#x5B58;&#x5728;, &#x5219;&#x521B;&#x5EFA;schema</p>
<p>IF SCHEMA_ID(&apos;xxx&apos;) IS NULL EXEC sp_executesql N&apos;CREATE SCHEMA xxx&apos;</p>
<h2 id="1&#x76F8;&#x5173;&#x6587;&#x7AE0;"><a name="1&#x76F8;&#x5173;&#x6587;&#x7AE0;" class="anchor-navigation-ex-anchor" href="#1&#x76F8;&#x5173;&#x6587;&#x7AE0;"><i class="fa fa-link" aria-hidden="true"></i></a>1&gt;&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2>
<h3 id="1-1ef-core"><a name="1-1ef-core" class="anchor-navigation-ex-anchor" href="#1-1ef-core"><i class="fa fa-link" aria-hidden="true"></i></a>1-1&gt;EF Core</h3>
<p>*EF Core &#x76F8;&#x5173;&#x7684;&#x5343;&#x500D;&#x6027;&#x80FD;&#x4E4B;&#x5DEE;&#xFF1A; AutoMapper ProjectTo VS Mapster ProjectToType </p>
<p><a href="https://www.cnblogs.com/dudu/p/10449485.html" target="_blank">https://www.cnblogs.com/dudu/p/10449485.html</a></p>
<p>*&#x597D;&#x5927;&#x4E00;&#x4E2A;&#x5751;&#xFF1A; EF Core &#x5F02;&#x6B65;&#x8BFB;&#x53D6;&#x5927;&#x5B57;&#x7B26;&#x4E32;&#x5B57;&#x6BB5;&#x6BD4;&#x540C;&#x6B65;&#x6162;100&#x591A;&#x500D;
<a href="https://www.cnblogs.com/dudu/p/10423126.html" target="_blank">https://www.cnblogs.com/dudu/p/10423126.html</a></p>
<p>*EF Core&#x5B98;&#x7F51;&#x6559;&#x7A0B;
<a href="https://docs.microsoft.com/zh-cn/ef/core/" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/</a></p>
<p>*Entity Framework Core 3.1 &#x6781;&#x7B80;&#x5165;&#x95E8;&#x6559;&#x7A0B;&#xFF08;&#x5B8C;&#x7ED3;&#xFF09;</p>
<p><a href="https://www.bilibili.com/video/BV1xa4y1v7rR" target="_blank">https://www.bilibili.com/video/BV1xa4y1v7rR</a></p>
<p>*ASP.NET MVC+EF&#x5B9E;&#x73B0;&#x5982;&#x4F55;&#x9A7E;&#x9A6D;&#x8D85;&#x590D;&#x6742;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x800C;&#x4E0D;&#x5931;&#x6F02;&#x4EAE;&#x7684;&#x4EE3;&#x7801;</p>
<p><a href="https://www.bilibili.com/video/BV12v411b7yF" target="_blank">https://www.bilibili.com/video/BV12v411b7yF</a></p>
<p>*EF Core&#x4E2D;&#x5982;&#x4F55;&#x4F7F;&#x7528;LEFT JOIN</p>
<p><a href="https://www.cnblogs.com/OpenCoder/p/12324249.html" target="_blank">https://www.cnblogs.com/OpenCoder/p/12324249.html</a></p>
<p>*EF Core 3.1 &#x7CFB;&#x5217;</p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10328029.html" target="_blank">asp.net core &#x7CFB;&#x5217; 19 EFCore&#x4ECB;&#x7ECD;</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10333073.html" target="_blank">asp.net core &#x7CFB;&#x5217; 20 EF&#x57FA;&#x4E8E;&#x6570;&#x636E;&#x6A21;&#x578B;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10336962.html" target="_blank">asp.net core &#x7CFB;&#x5217; 21 EF&#x73B0;&#x6709;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x53CD;&#x5411;&#x5DE5;&#x7A0B;</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10364918.html" target="_blank">asp.net core &#x7CFB;&#x5217; 22 EF(&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;,&#x8FDE;&#x63A5;&#x590D;&#x539F;,DbContext)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10373374.html" target="_blank">asp.net core&#x7CFB;&#x5217; 23 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x6982;&#x8FF0;, &#x7C7B;&#x578B;&#x548C;&#x5C5E;&#x6027;&#x7684;&#x5305;&#x542B;&#x4E0E;&#x6392;&#x9664;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10374981.html" target="_blank">asp.net core&#x7CFB;&#x5217; 24 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x4E3B;&#x952E;,&#x751F;&#x6210;&#x503C;,&#x6700;&#x5927;&#x957F;&#x5EA6;,&#x5E76;&#x53D1;&#x6807;&#x8BB0;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10383576.html" target="_blank">asp.net core&#x7CFB;&#x5217; 25 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x9690;&#x85CF;&#x5C5E;&#x6027;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10393861.html" target="_blank">asp.net core&#x7CFB;&#x5217; 26 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x5B9E;&#x4F53;&#x5173;&#x7CFB;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10399692.html" target="_blank">asp.net core&#x7CFB;&#x5217; 27 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x7D22;&#x5F15;,&#x5907;&#x7528;&#x952E;,&#x7EE7;&#x627F;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10405099.html" target="_blank">asp.net core&#x7CFB;&#x5217; 28 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x5B57;&#x6BB5;,&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x62E5;&#x6709;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10411284.html" target="_blank">asp.net core&#x7CFB;&#x5217; 29 EF&#x6A21;&#x578B;&#x914D;&#x7F6E;(&#x67E5;&#x8BE2;&#x7C7B;&#x578B;,&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x5EFA;&#x6A21;)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10417484.html" target="_blank">asp.net core&#x7CFB;&#x5217; 30 EF&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;--&#x5FC5;&#x5907;&#x77E5;&#x8BC6; &#x8FC1;&#x79FB;</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10425437.html" target="_blank">asp.net core&#x7CFB;&#x5217; 31 EF&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;--&#x5FC5;&#x5907;&#x77E5;&#x8BC6; &#x53CD;&#x5411;&#x5DE5;&#x7A0B;</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10435921.html" target="_blank">asp.net core&#x7CFB;&#x5217; 32 EF&#x67E5;&#x8BE2;&#x6570;&#x636E; &#x5FC5;&#x5907;&#x77E5;&#x8BC6;(1)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10444143.html" target="_blank">asp.net core&#x7CFB;&#x5217; 33 EF&#x67E5;&#x8BE2;&#x6570;&#x636E; (2)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10448663.html" target="_blank">asp.net core&#x7CFB;&#x5217; 34 EF&#x4FDD;&#x5B58;&#x6570;&#x636E;(1)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/p/10455037.html" target="_blank">asp.net core&#x7CFB;&#x5217; 35 EF&#x4FDD;&#x5B58;&#x6570;&#x636E;(2) -- EF&#x7CFB;&#x5217;&#x7ED3;&#x675F;</a></p>
<p>*NetCore3.1webApi + EFCore + DI &#x6846;&#x67B6;&#x5C01;&#x88C5;</p>
<p><a href="https://www.cnblogs.com/ouyangkai/p/12850893.html" target="_blank">https://www.cnblogs.com/ouyangkai/p/12850893.html</a></p>
<p>*&#x5229;&#x7528;EFCore &#x5C01;&#x88C5;Repository&#xFF08;&#x53EF;&#x6269;&#x5C55;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x7684;sql&#x64CD;&#x4F5C;&#xFF09;</p>
<p><a href="https://www.cnblogs.com/lxshwyan/p/10794412.html" target="_blank">https://www.cnblogs.com/lxshwyan/p/10794412.html</a></p>
<p>*IOC+EF+Core&#x9879;&#x76EE;&#x642D;&#x5EFA;EF&#x5C01;&#x88C5;(1~3)</p>
<p><a href="https://www.cnblogs.com/shuaimeng/p/11338620.html" target="_blank">https://www.cnblogs.com/shuaimeng/p/11338620.html</a></p>
<p><a href="https://www.cnblogs.com/shuaimeng/p/11338760.html" target="_blank">https://www.cnblogs.com/shuaimeng/p/11338760.html</a></p>
<p><a href="https://www.cnblogs.com/shuaimeng/p/11338802.html" target="_blank">https://www.cnblogs.com/shuaimeng/p/11338802.html</a></p>
<p><a href="https://blog.csdn.net/u011511086/article/details/112509821" target="_blank">EF Core&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x751F;&#x6210;&#x7684;sql&#x8BED;&#x53E5;</a></p>
<p>*&#x5E76;&#x53D1;&#x4EE4;&#x724C;&#x8BB2;&#x89E3;(ChangeTracker, Timestamp, rowversion)</p>
<p><a href="https://www.cnblogs.com/rajesh/p/11093193.html" target="_blank">https://www.cnblogs.com/rajesh/p/11093193.html</a></p>
<p>*EF Core&#x4E50;&#x89C2;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#xFF1A;RowVersion</p>
<p><a href="https://haokan.baidu.com/v?pd=wisenatural&amp;vid=16607248529233004348" target="_blank">https://haokan.baidu.com/v?pd=wisenatural&amp;vid=16607248529233004348</a></p>
<p>*EF Core&#x7CFB;&#x5217;</p>
<p><a href="https://www.cnblogs.com/yaopengfei/p/10666076.html" target="_blank">https://www.cnblogs.com/yaopengfei/p/10666076.html</a></p>
<p>*EFCore &#x590D;&#x6742;SQL&#x67E5;&#x8BE2;&#x8E29;&#x5751;&#x8BB0;&#x5F55;</p>
<p><a href="https://blog.csdn.net/weixin_38138153/article/details/115282786" target="_blank">https://blog.csdn.net/weixin_38138153/article/details/115282786</a></p>
<p>*&#x5BF9;&#x4E8E;&#x7ECF;&#x5E38;&#x63A5;&#x89E6;&#x7684;&#x5206;&#x9875;&#x4F60;&#x786E;&#x5B9A;&#x4F60;&#x771F;&#x7684;&#x4F1A;&#x5417;</p>
<p><a href="https://www.cnblogs.com/xuejiaming/p/14187680.html" target="_blank">https://www.cnblogs.com/xuejiaming/p/14187680.html</a></p>
<p>*Wei.Repository EFCore3.0+Dapper &#x5C01;&#x88C5;Repository</p>
<p><a href="https://github.com/a34546/Wei.Repository" target="_blank">https://github.com/a34546/Wei.Repository</a></p>
<h3 id="1-2mysql"><a name="1-2mysql" class="anchor-navigation-ex-anchor" href="#1-2mysql"><i class="fa fa-link" aria-hidden="true"></i></a>1-2&gt;MySQL</h3>
<p>*MySQL&#x7CFB;&#x5217;</p>
<p><a href="https://www.cnblogs.com/MrHSR/category/1209857.html" target="_blank">mysql &#x57FA;&#x7840;&#x7BC7;&#x7CFB;&#x5217;(23)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/category/1255732.html" target="_blank">mysql &#x8FDB;&#x9636;&#x7BC7;&#x7CFB;&#x5217;(55)</a></p>
<p><a href="https://www.cnblogs.com/MrHSR/category/1323212.html" target="_blank">mysql &#x67B6;&#x6784;&#x7BC7;&#x7CFB;&#x5217;(3)</a></p>
<p><a href="https://www.cnblogs.com/fallTakeMan/p/14038888.html" target="_blank">Docker &#x642D;&#x5EFA; MySQL8.0 &#x4E3B;&#x4ECE;&#x590D;&#x5236;&#x73AF;&#x5883;</a></p>
<h3 id="1-3fluent-api"><a name="1-3fluent-api" class="anchor-navigation-ex-anchor" href="#1-3fluent-api"><i class="fa fa-link" aria-hidden="true"></i></a>1-3&gt;Fluent API</h3>
<p>*FluentAPI&#x8BE6;&#x7EC6;&#x7528;&#x6CD5;
<a href="https://www.cnblogs.com/wangshaod/p/10025836.html" target="_blank">https://www.cnblogs.com/wangshaod/p/10025836.html</a></p>
<p>*&#x5B98;&#x7F51;</p>
<p><a href="https://www.learnentityframeworkcore.com/configuration/fluent-api" target="_blank">https://www.learnentityframeworkcore.com/configuration/fluent-api</a></p>
<h3 id="1-4mapster"><a name="1-4mapster" class="anchor-navigation-ex-anchor" href="#1-4mapster"><i class="fa fa-link" aria-hidden="true"></i></a>1-4&gt;Mapster</h3>
<p>&#x5B98;&#x65B9;&#x6587;&#x6863;</p>
<p><a href="https://github.com/MapsterMapper/Mapster/wiki" target="_blank">https://github.com/MapsterMapper/Mapster/wiki</a></p>
<p>[&#x975E;&#x4E13;&#x4E1A;&#x7FFB;&#x8BD1;] &#x9AD8;&#x6027;&#x80FD;&#x5BF9;&#x8C61;&#x6620;&#x5C04;&#x6846;&#x67B6; - Mapster
<a href="https://www.cnblogs.com/staneee/p/14912794.html" target="_blank">https://www.cnblogs.com/staneee/p/14912794.html</a></p>
<p>Mapster (C# &#x5BF9;&#x8C61;&#x6620;&#x5C04;&#x5668;)</p>
<p><a href="https://www.cnblogs.com/fanfan-90/p/12164927.html" target="_blank">https://www.cnblogs.com/fanfan-90/p/12164927.html</a></p>
<p>&#x8BF4;&#x8BF4; abp vnext &#x4E0E; Mapster</p>
<p><a href="https://www.cnblogs.com/jidanfan/p/14506944.html" target="_blank">https://www.cnblogs.com/jidanfan/p/14506944.html</a></p>
<h3 id="1-5automapper"><a name="1-5automapper" class="anchor-navigation-ex-anchor" href="#1-5automapper"><i class="fa fa-link" aria-hidden="true"></i></a>1-5&gt;AutoMapper</h3>
<p>automapper
<a href="https://www.cnblogs.com/keatkeat/p/10041574.html" target="_blank">https://www.cnblogs.com/keatkeat/p/10041574.html</a></p>
<h3 id="1-6unitofwork"><a name="1-6unitofwork" class="anchor-navigation-ex-anchor" href="#1-6unitofwork"><i class="fa fa-link" aria-hidden="true"></i></a>1-6&gt;UnitofWork</h3>
<h3 id="1-7dapper"><a name="1-7dapper" class="anchor-navigation-ex-anchor" href="#1-7dapper"><i class="fa fa-link" aria-hidden="true"></i></a>1-7&gt;Dapper</h3>
<p>*&#x7528;&#x4E86;Dapper&#x4E4B;&#x540E;&#x901A;&#x7BC7;&#x8FD8;&#x662F;SqlConnection&#xFF0C;&#x771F;&#x7684;&#x770B;&#x4E0D;&#x4E0B;&#x53BB;&#x4E86;</p>
<p><a href="https://blog.csdn.net/huangxinchen520/article/details/107812338" target="_blank">https://blog.csdn.net/huangxinchen520/article/details/107812338</a></p>
<p>*DotNet Core&#x4E2D;&#x4F7F;&#x7528;dapper</p>
<p><a href="https://www.cnblogs.com/taotaozhuanyong/p/11757738.html" target="_blank">https://www.cnblogs.com/taotaozhuanyong/p/11757738.html</a></p>
<p>*Net Core&#x4E2D;&#x4F7F;&#x7528;Dapper&#x5C01;&#x88C5;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x5E93;</p>
<p><a href="https://blog.csdn.net/qazlj/article/details/87283155" target="_blank">https://blog.csdn.net/qazlj/article/details/87283155</a></p>
<p>*NetCore Dapper&#x5C01;&#x88C5;</p>
<p><a href="https://www.cnblogs.com/xtxk110/p/14901387.html" target="_blank">https://www.cnblogs.com/xtxk110/p/14901387.html</a></p>
<p>*C#&#x7684;dapper&#x4F7F;&#x7528;</p>
<p><a href="https://www.cnblogs.com/flywong/p/9666963.html" target="_blank">https://www.cnblogs.com/flywong/p/9666963.html</a></p>
<p>*.net core &#x4E2D;&#x7B80;&#x5355;&#x5C01;&#x88C5;Dapper.Extensions</p>
<p><a href="https://www.cnblogs.com/nontracey/p/9988759.html" target="_blank">https://www.cnblogs.com/nontracey/p/9988759.html</a></p>
<p>*.Net Core&#x4E2D;&#x4F7F;&#x7528;Dapper&#x6784;&#x5EFA;&#x6CDB;&#x578B;&#x4ED3;&#x50A8;</p>
<p><a href="https://www.cnblogs.com/zhangnever/p/11926045.html" target="_blank">https://www.cnblogs.com/zhangnever/p/11926045.html</a></p>
<p>*.NET Core&#x5B9E;&#x6218;&#x9879;&#x76EE;&#x4E4B;CMS &#x7B2C;&#x5341;&#x4E8C;&#x7AE0; &#x5F00;&#x53D1;&#x7BC7;-Dapper&#x5C01;&#x88C5;GURD&#x53CA;&#x4ED3;&#x50A8;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x5668;&#x5B9E;&#x73B0;</p>
<p><a href="https://blog.csdn.net/qq_36178899/article/details/85111256" target="_blank">https://blog.csdn.net/qq_36178899/article/details/85111256</a></p>
<p>*.NetCore&#x4E2D;&#x4F7F;&#x7528;Dapper</p>
<p><a href="https://blog.51cto.com/u_15127634/3273203" target="_blank">https://blog.51cto.com/u_15127634/3273203</a></p>
<p>*Dapper &#x5B98;&#x7F51;</p>
<p><a href="https://github.com/DapperLib/Dapper" target="_blank">https://github.com/DapperLib/Dapper</a></p>
<hr>
<h2 id="2dbcontext"><a name="2dbcontext" class="anchor-navigation-ex-anchor" href="#2dbcontext"><i class="fa fa-link" aria-hidden="true"></i></a>2&gt;DbContext</h2>
<p>&#x5B89;&#x88C5;&#x5305;: Microsoft.EntityFrameworkCore.SqlServer</p>
<h3 id="2-1dbcontext-&#x751F;&#x5B58;&#x671F;"><a name="2-1dbcontext-&#x751F;&#x5B58;&#x671F;" class="anchor-navigation-ex-anchor" href="#2-1dbcontext-&#x751F;&#x5B58;&#x671F;"><i class="fa fa-link" aria-hidden="true"></i></a>2-1&gt;DbContext &#x751F;&#x5B58;&#x671F;</h3>
<p>*DbContext&#x7684;&#x751F;&#x5B58;&#x671F;&#x4ECE;&#x521B;&#x5EFA;&#x5B9E;&#x4F8B;&#x65F6;&#x5F00;&#x59CB;&#xFF0C;&#x5E76;&#x5728;&#x91CA;&#x653E;&#x5B9E;&#x4F8B;&#x65F6;&#x7ED3;&#x675F;&#x3002;</p>
<p>*&#x4F7F;&#x7528;&#x540E;&#x91CA;&#x653E;DbContext&#x975E;&#x5E38;&#x91CD;&#x8981;</p>
<p>*DbContext &#x4E0D;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;.</p>
<h3 id="2-2&#x4F9D;&#x8D56;&#x6CE8;&#x5165;dbcontext"><a name="2-2&#x4F9D;&#x8D56;&#x6CE8;&#x5165;dbcontext" class="anchor-navigation-ex-anchor" href="#2-2&#x4F9D;&#x8D56;&#x6CE8;&#x5165;dbcontext"><i class="fa fa-link" aria-hidden="true"></i></a>2-2&gt;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;DbContext</h3>
<pre class="language-"><code class="lang-C#">public void ConfigureServices(IServiceCollection services) 
{
    services.AddControllers();
    services.AddDbContext<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span>
    (
        options =&gt; options.UseSqlServer(&quot;name=ConnectionStrings:DefaultConnection&quot;)
    );
}

public class ApplicationDbContext : DbContext
{
    public ApplicationDbContext(DbContextOptions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span> options)
        : base(options)
    {
    }
    //&#x6216;&#x8005;&#x5728;&#x8FD9;&#x91CC;&#x914D;&#x7F6E;&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer(_connectionString);
    }
}

public class MyController
{
    private readonly ApplicationDbContext _context;

    public MyController(ApplicationDbContext context)
    {
        _context = context;
    }
}
</code></pre>
<h3 id="2-3&#x4F7F;&#x7528;new&#x5B9E;&#x4F8B;&#x5316;dbcontext"><a name="2-3&#x4F7F;&#x7528;new&#x5B9E;&#x4F8B;&#x5316;dbcontext" class="anchor-navigation-ex-anchor" href="#2-3&#x4F7F;&#x7528;new&#x5B9E;&#x4F8B;&#x5316;dbcontext"><i class="fa fa-link" aria-hidden="true"></i></a>2-3&gt;&#x4F7F;&#x7528;new&#x5B9E;&#x4F8B;&#x5316;DbContext</h3>
<pre class="language-"><code class="lang-c#">public class ApplicationDbContext : DbContext
{
    private readonly string _connectionString;

    public ApplicationDbContext(string connectionString)
    {
        _connectionString = connectionString;
    }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer(_connectionString);
    }
}
//&#x6216;
public class ApplicationDbContext : DbContext
{
    public ApplicationDbContext(DbContextOptions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span> options)
        : base(options)
    {
    }
}
var contextOptions = new DbContextOptionsBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span>()
    .UseSqlServer(@&quot;Server=(localdb)\mssqllocaldb;Database=Test&quot;)
    .Options;
using var context = new ApplicationDbContext(contextOptions)
{
    //TODO...
}
</code></pre>
<h3 id="2-4&#x4F7F;&#x7528;dbcontext&#x5DE5;&#x5382;"><a name="2-4&#x4F7F;&#x7528;dbcontext&#x5DE5;&#x5382;" class="anchor-navigation-ex-anchor" href="#2-4&#x4F7F;&#x7528;dbcontext&#x5DE5;&#x5382;"><i class="fa fa-link" aria-hidden="true"></i></a>2-4&gt;&#x4F7F;&#x7528;DbContext&#x5DE5;&#x5382;</h3>
<pre class="language-"><code class="lang-C#">public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContextFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span>(
        options =&gt;
            options.UseSqlServer(@&quot;Server=(localdb)\mssqllocaldb;Database=Test&quot;));
}

public class ApplicationDbContext : DbContext
{
    public ApplicationDbContext(DbContextOptions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span> options)
        : base(options)
    {
    }
}

private readonly IDbContextFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span> _contextFactory;

public MyController(IDbContextFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationDbContext</span><span class="token punctuation">&gt;</span></span> contextFactory)
{
    _contextFactory = contextFactory;
}

public void DoSomething()
{
    using (var context = _contextFactory.CreateDbContext())
    {
        //TODO...
    }
}
</code></pre>
<h3 id="2-5dbcontextoptions"><a name="2-5dbcontextoptions" class="anchor-navigation-ex-anchor" href="#2-5dbcontextoptions"><i class="fa fa-link" aria-hidden="true"></i></a>2-5&gt;DbContextOptions</h3>
<p>&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x83B7;&#x53D6;&#x6B64;&#x751F;&#x6210;&#x5668;:</p>
<ul>
<li>&#x5728; AddDbContext &#x548C;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x4E2D;</li>
<li>&#x5728; OnConfiguring &#x4E2D;</li>
<li>&#x4F7F;&#x7528; new &#x663E;&#x5F0F;&#x6784;&#x9020;</li>
</ul>
<p>3-1&gt;UseQueryTrackingBehavior(&#x8BBE;&#x7F6E;&#x67E5;&#x8BE2;&#x7684;&#x9ED8;&#x8BA4;&#x8DDF;&#x8E2A;&#x884C;&#x4E3A;)</p>
<p>*&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;
TrackAll: &#x5DF2;&#x8FFD;&#x8E2A;&#x7684;&#x5B9E;&#x4F8B;&#x4F1A;&#x88AB;&#x6807;&#x8BC6;&#x89E3;&#x6790;, &#x5982;&#x679C;&#x662F;&#x76F8;&#x540C;&#x7684;&#x5B9E;&#x4F53;, &#x5219;&#x6BCF;&#x6B21;&#x8FD4;&#x56DE;&#x76F8;&#x540C;&#x5B9E;&#x4F8B;.</p>
<p>*&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;
NoTracking: &#x4E0D;&#x4F1A;&#x6807;&#x8BC6;&#x89E3;&#x6790;, &#x5373;&#x4F7F;&#x662F;&#x76F8;&#x540C;&#x7684;&#x5B9E;&#x4F53;, &#x4E5F;&#x4F1A;&#x8FD4;&#x56DE;&#x65B0;&#x5B9E;&#x4F8B;.</p>
<pre class="language-"><code class="lang-C#">var blogs = context.Blogs
    .AsNoTrackingWithIdentityResolution()
    .ToList();
</code></pre>
<p>*&#x6807;&#x8BC6;&#x89E3;&#x6790;</p>
<p>NoTrackingWithIdentityResolution:&#x540E;&#x53F0;&#x4F7F;&#x7528;&#x72EC;&#x7ACB;&#x7684;&#x66F4;&#x6539;&#x8FFD;&#x8E2A;&#x5668;, &#x6BCF;&#x4E2A;&#x5B9E;&#x4F8B;&#x5177;&#x4F53;&#x5316;&#x4E00;&#x6B21;, &#x5EFA;&#x8BAE;&#x4F7F;&#x7528;AsNoTrackingWithIdentityResolution&#x4EE3;&#x66FF;AsNoTracking, &#x6027;&#x80FD;&#x4F18;&#x5316;.</p>
<p>*&#x81EA;&#x5B9A;&#x4E49;&#x6295;&#x5F71;: &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;, &#x90A3;&#x4E48;&#x67E5;&#x8BE2;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x53EA;&#x8981;&#x5305;&#x542B;&#x4E86;&#x5B9E;&#x4F53;&#x7C7B;&#x884C;, &#x5C31;&#x4F1A;&#x8DDF;&#x8E2A;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;, &#x975E;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;&#x4E0D;&#x8DDF;&#x8E2A;.</p>
<h3 id="2-6&#x907F;&#x514D;-dbcontext-&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x95EE;&#x9898;"><a name="2-6&#x907F;&#x514D;-dbcontext-&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#2-6&#x907F;&#x514D;-dbcontext-&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>2-6&gt;&#x907F;&#x514D; DbContext &#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x95EE;&#x9898;</h3>
<p>&#x4E0D;&#x652F;&#x6301;&#x5728;&#x540C;&#x4E00; DbContext &#x5B9E;&#x4F8B;&#x4E0A;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x5E76;&#x884C;&#x64CD;&#x4F5C;.</p>
<hr>
<h2 id="3&#x5B9E;&#x4F53;&#x914D;&#x7F6E;"><a name="3&#x5B9E;&#x4F53;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#3&#x5B9E;&#x4F53;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>3&gt;&#x5B9E;&#x4F53;&#x914D;&#x7F6E;</h2>
<h3 id="3-1&#x5728;dbcontextonmodelcreating&#x5185;&#x914D;&#x7F6E;&#x5B9E;&#x4F53;"><a name="3-1&#x5728;dbcontextonmodelcreating&#x5185;&#x914D;&#x7F6E;&#x5B9E;&#x4F53;" class="anchor-navigation-ex-anchor" href="#3-1&#x5728;dbcontextonmodelcreating&#x5185;&#x914D;&#x7F6E;&#x5B9E;&#x4F53;"><i class="fa fa-link" aria-hidden="true"></i></a>3-1&gt;&#x5728;DbContext.OnModelCreating&#x5185;&#x914D;&#x7F6E;&#x5B9E;&#x4F53;</h3>
<h3 id="3-2&#x901A;&#x8FC7;&#x7279;&#x6027;&#x914D;&#x7F6E;"><a name="3-2&#x901A;&#x8FC7;&#x7279;&#x6027;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#3-2&#x901A;&#x8FC7;&#x7279;&#x6027;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>3-2&gt;&#x901A;&#x8FC7;&#x7279;&#x6027;&#x914D;&#x7F6E;</h3>
<p>*&#x6392;&#x9664;&#x8868;&#x6620;&#x5C04;: [NotMapped]</p>
<p>*&#x8868;&#x540D;&#x79F0;: [Table(&quot;blogs&quot;)]</p>
<p>*&#x8868;&#x67B6;&#x6784;: [Table(&quot;blogs&quot;, Schema = &quot;blogging&quot;)]</p>
<p>*&#x8868;&#x6CE8;&#x91CA;: [Comment(&quot;Blogs managed on the website&quot;)]</p>
<p>*&#x6392;&#x9664;&#x5C5E;&#x6027;&#x6620;&#x5C04;: [NotMapped]</p>
<p>*&#x5217;&#x540D;: [Column(&quot;blog_id&quot;)], &#x5B9E;&#x4F53;&#x5C5E;&#x6027;&#x4F1A;&#x81EA;&#x52A8;&#x6620;&#x5C04;&#x5230;&#x4E0E;&#x5C5E;&#x6027;&#x540C;&#x540D;&#x7684;&#x5217;.</p>
<p>*&#x5217;&#x6570;&#x636E;&#x7C7B;&#x578B;: [Column(TypeName = &quot;varchar(200)&quot;)]</p>
<p>*&#x6700;&#x5927;&#x957F;&#x5EA6;: [MaxLength(500)]</p>
<p>*&#x5FC5;&#x586B;: [Required]</p>
<p>*&#x5217;&#x6CE8;&#x91CA;: [Comment(&quot;The URL of the blog&quot;)]</p>
<p>*&#x4E3B;&#x952E;: [Key], &#x5C06;Id&#x6216;[class name]Id&#x7684;&#x5C5E;&#x6027;&#x81EA;&#x52A8;&#x6620;&#x5C04;&#x4E3A;&#x4E3B;&#x952E;, &#x8054;&#x5408;&#x4E3B;&#x952E;&#x53EA;&#x80FD;&#x901A;&#x8FC7;Fluent API&#x6765;&#x8BBE;&#x7F6E;.</p>
<p>*&#x6307;&#x5B9A;&#x503C;&#x751F;&#x6210;&#x7684;&#x65F6;&#x673A;: [DatabaseGenerated(DatabaseGeneratedOption.Identity)], [DatabaseGenerated(DatabaseGeneratedOption.Computed)], [DatabaseGenerated(DatabaseGeneratedOption.None)]</p>
<p>*&#x5E76;&#x53D1;&#x6807;&#x8BB0;: &#x4E0B;&#x9762;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x91C7;&#x7528;&#x4E50;&#x89C2;&#x9501;&#x673A;&#x5236;, &#x5728;&#x6027;&#x80FD;&#x548C;&#x6B7B;&#x9501;&#x60C5;&#x51B5;&#x4E0A;&#x90FD;&#x4F18;&#x4E8E;&#x60B2;&#x89C2;&#x9501;.</p>
<p>ConcurrencyCheck: &#x5BF9;&#x67D0;&#x4E2A;&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x5E76;&#x53D1;&#x68C0;&#x6D4B;. </p>
<p>Timestamp: &#x5BF9;&#x6240;&#x6709;&#x5217;&#x8FDB;&#x884C;&#x5E76;&#x53D1;&#x68C0;&#x6D4B;</p>
<p>[Timestamp]
public byte[] Timestamp { get; set; }</p>
<p>*&#x7D22;&#x5F15;</p>
<pre class="language-"><code class="lang-C#">[Index(nameof(Url))]
public class Blog
{
    //TODO...
}
</code></pre>
<p>*&#x590D;&#x5408;&#x7D22;&#x5F15;: [Index(nameof(FirstName), nameof(LastName))]</p>
<p>*&#x552F;&#x4E00;&#x7D22;&#x5F15;: [Index(nameof(Url), IsUnique = true)]</p>
<p>*&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x540D;&#x79F0;: [Index(nameof(Url), Name = &quot;Index_Url&quot;)]</p>
<p>*&#x652F;&#x6301;&#x5B57;&#x6BB5;:</p>
<pre class="language-"><code class="lang-C#">public class Blog
{
    private string _validatedUrl;

    public int BlogId { get; set; }

    [BackingField(nameof(_validatedUrl))]
    public string Url
    {
        get { return _validatedUrl; }
    }

    public void SetUrl(string url)
    {
        // put your validation code here

        _validatedUrl = url;
    }
}
</code></pre>
<p>*&#x65E0;&#x952E;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;:</p>
<pre class="language-"><code class="lang-C#">[Keyless]
public class BlogPostsCount
{
    public string BlogName { get; set; }
    public int PostCount { get; set; }
}
</code></pre>
<h3 id="3-3&#x901A;&#x8FC7;fluent-api&#x914D;&#x7F6E;"><a name="3-3&#x901A;&#x8FC7;fluent-api&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#3-3&#x901A;&#x8FC7;fluent-api&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>3-3&gt;&#x901A;&#x8FC7;Fluent API&#x914D;&#x7F6E;</h3>
<p>*&#x4ECE;&#x6A21;&#x578B;&#x4E2D;&#x6392;&#x9664;&#x7C7B;&#x578B;: modelBuilder.Ignore<blogmetadata>();</blogmetadata></p>
<p>*&#x4ECE;&#x8FC1;&#x79FB;&#x4E2D;&#x6392;&#x9664;: </p>
<p>modelBuilder
    .Entity<identityuser>()
    .ToTable(&quot;AspNetUsers&quot;, t =&gt; t.ExcludeFromMigrations());</identityuser></p>
<p>*&#x8868;&#x540D;&#x79F0;:</p>
<p>modelBuilder
    .Entity<blog>()
    .ToTable(&quot;blogs&quot;);</blog></p>
<p>*&#x8868;&#x67B6;&#x6784;: </p>
<p>modelBuilder
    .Entity<blog>()
    .ToTable(&quot;blogs&quot;, schema: &quot;blogging&quot;);</blog></p>
<p>*&#x4E5F;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E0A;&#x9650;&#x6587;&#x7684;&#x9ED8;&#x8BA4;&#x67B6;&#x6784;</p>
<p>modelBuilder.HasDefaultSchema(&quot;blogging&quot;);</p>
<p>*&#x89C6;&#x56FE;&#x6620;&#x5C04;: &#x89C6;&#x56FE;&#x4E0D;&#x4F1A;&#x5728; add-migration &#x81EA;&#x52A8;&#x521B;&#x5EFA;, &#x9700;&#x8981;&#x624B;&#x52A8;&#x521B;&#x5EFA;</p>
<p>modelBuilder
    .Entity<blog>()
    .ToView(&quot;blogsView&quot;, schema: &quot;blogging&quot;);</blog></p>
<p>*&#x8868;&#x503C;&#x51FD;&#x6570;&#x6620;&#x5C04;: &#x82E5;&#x8981;&#x5C06;&#x5B9E;&#x4F53;&#x6620;&#x5C04;&#x5230;&#x8868;&#x503C;&#x51FD;&#x6570;, &#x8BE5;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x65E0;&#x53C2;&#x6570;&#x7684;.</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dbo<span class="token punctuation">.</span>BlogsWithMultiplePosts<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">TABLE</span>
<span class="token keyword">AS</span>
<span class="token keyword">RETURN</span>
<span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>Url<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>BlogId<span class="token punctuation">)</span> <span class="token keyword">AS</span> PostCount
    <span class="token keyword">FROM</span> Blogs <span class="token keyword">AS</span> b
    <span class="token keyword">JOIN</span> Posts <span class="token keyword">AS</span> p <span class="token keyword">ON</span> b<span class="token punctuation">.</span>BlogId <span class="token operator">=</span> p<span class="token punctuation">.</span>BlogId
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> b<span class="token punctuation">.</span>BlogId<span class="token punctuation">,</span> b<span class="token punctuation">.</span>Url
    <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>BlogId<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
</code></pre>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlogWithMultiplePosts</span><span class="token punctuation">&gt;</span></span>().HasNoKey().ToFunction(&quot;BlogsWithMultiplePosts&quot;);
</code></pre>
<pre class="language-"><code class="lang-C#">var query = from b in context.Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlogWithMultiplePosts</span><span class="token punctuation">&gt;</span></span>()
            where b.PostCount &gt; 3
            select new { b.Url, b.PostCount };
</code></pre>
<p>*&#x8868;&#x6CE8;&#x91CA;:</p>
<p>modelBuilder
    .Entity<blog>()
    .HasComment(&quot;Blogs managed on the website&quot;);</blog></p>
<p>*&#x6392;&#x9664;&#x5C5E;&#x6027;&#x6620;&#x5C04;:</p>
<p>modelBuilder.Entity<blog>()
    .Ignore(b =&gt; b.LoadedFromDatabase);</blog></p>
<p>*&#x5217;&#x540D;: </p>
<p>modelBuilder.Entity<blog>()
    .Property(b =&gt; b.BlogId)
    .HasColumnName(&quot;blog_id&quot;);</blog></p>
<p>*&#x5217;&#x6570;&#x636E;&#x7C7B;&#x578B;:</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>(
    eb =&gt;
    {
        eb.Property(b =&gt; b.Url).HasColumnType(&quot;varchar(200)&quot;);
        eb.Property(b =&gt; b.Rating).HasColumnType(&quot;decimal(5, 2)&quot;);
    });
</code></pre>
<p>*&#x6700;&#x5927;&#x957F;&#x5EA6;:</p>
<p>modelBuilder.Entity<blog>()
    .Property(b =&gt; b.Url)
    .HasMaxLength(500);</blog></p>
<p>*&#x7CBE;&#x5EA6;&#x548C;&#x5C0F;&#x6570;&#x4F4D;&#x6570;: &#x4E00;&#x822C;&#x662F;decimal&#x548C;DateTime.</p>
<p>modelBuilder.Entity<blog>()
    .Property(b =&gt; b.Score)
    .HasPrecision(14, 2);</blog></p>
<p>modelBuilder.Entity<blog>()
    .Property(b =&gt; b.LastUpdated)
    .HasPrecision(3);</blog></p>
<p>*&#x5FC5;&#x586B;:</p>
<p>modelBuilder.Entity<blog>()
    .Property(b =&gt; b.Url)
    .IsRequired();</blog></p>
<p>*&#x5217;&#x6392;&#x5E8F;&#x6BD4;&#x8F83;&#x89C4;&#x5219;: (&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x8868;&#x793A;&#x5217;&#x7684;&#x503C;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;)</p>
<p>modelBuilder.Entity<customer>()
    .Property(c =&gt; c.Name)
    .UseCollation(&quot;SQL_Latin1_General_CP1_CI_AS&quot;); </customer></p>
<p>*&#x5217;&#x6CE8;&#x91CA;: </p>
<p>modelBuilder.Entity<blog>()
    .Property(b =&gt; b.Url)
    .HasComment(&quot;The URL of the blog&quot;);</blog></p>
<p>*&#x4E3B;&#x952E;: &#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5355;&#x4E2A;&#x4E3B;&#x952E;&#x53CA;&#x8054;&#x5408;&#x4E3B;&#x952E;, &#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x4E3B;&#x952E;&#x7684;&#x540D;&#x79F0;, </p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span>()
    .HasKey(c =&gt; c.LicensePlate);

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span>()
    .HasKey(c =&gt; new { c.State, c.LicensePlate });

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .HasKey(b =&gt; b.BlogId)
    .HasName(&quot;PrimaryKey_BlogId&quot;);
</code></pre>
<p>*&#x9ED8;&#x8BA4;&#x503C;(&#x5982;&#x679C;&#x63D2;&#x5165;&#x7684;&#x884C;&#x6CA1;&#x6709;&#x8BE5;&#x5217;&#x7684;&#x503C;&#xFF0C;&#x5C06;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x503C;): </p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.Rating)
    .HasDefaultValue(3);

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.Created)
    .HasDefaultValueSql(&quot;getdate()&quot;);
</code></pre>
<p>*&#x8BA1;&#x7B97;&#x5217;(&#x901A;&#x5E38;&#x5177;&#x6709;&#x5F15;&#x7528;&#x5176;&#x4ED6;&#x5217;&#x7684;&#x8868;&#x8FBE;&#x5F0F;):</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span>()
    .Property(p =&gt; p.DisplayName)
    .HasComputedColumnSql(&quot;[LastName] + &apos;, &apos; + [FirstName]&quot;);
</code></pre>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;stored&#x6765;&#x6301;&#x4E45;&#x5316;&#x8BA1;&#x7B97;&#x5217;&#x7684;&#x503C;, &#x5373;&#x5C06;&#x8BA1;&#x7B97;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x5B58;&#x5230;&#x5217;.</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span>()
    .Property(p =&gt; p.DisplayName)
    .HasComputedColumnSql(&quot;[LastName] + &apos;, &apos; + [FirstName]&quot;, stored: true);
</code></pre>
<p>*&#x6307;&#x5B9A;&#x503C;&#x751F;&#x6210;&#x7684;&#x65F6;&#x673A;:</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.Inserted)
    .ValueGeneratedOnAdd();

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.LastUpdated)
    .ValueGeneratedOnAddOrUpdate();

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.BlogId)
    .ValueGeneratedNever();
</code></pre>
<p>*&#x65E5;&#x671F;/&#x65F6;&#x95F4;&#x503C;&#x751F;&#x6210;:</p>
<p>AddTime&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x503C;&#x7684;&#x65B9;&#x5F0F;</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.Created)
    .HasDefaultValueSql(&quot;getdate()&quot;);
</code></pre>
<p>UpdateTime&#x9700;&#x8981;&#x81EA;&#x884C;&#x5B9E;&#x73B0;(&#x5982;&#x4E0B;&#x9762;&#x4F8B;&#x5B50;&#x7684;&#x89E6;&#x53D1;&#x5668;):</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Blogs_UPDATE<span class="token punctuation">]</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Blogs<span class="token punctuation">]</span>
    <span class="token keyword">AFTER</span> <span class="token keyword">UPDATE</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SET</span> NOCOUNT <span class="token keyword">ON</span><span class="token punctuation">;</span>

    <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> TRIGGER_NESTLEVEL<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">RETURN</span><span class="token punctuation">;</span>

    <span class="token keyword">DECLARE</span> <span class="token variable">@Id</span> <span class="token keyword">INT</span>

    <span class="token keyword">SELECT</span> <span class="token variable">@Id</span> <span class="token operator">=</span> INSERTED<span class="token punctuation">.</span>BlogId
    <span class="token keyword">FROM</span> INSERTED

    <span class="token keyword">UPDATE</span> dbo<span class="token punctuation">.</span>Blogs
    <span class="token keyword">SET</span> LastUpdated <span class="token operator">=</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">WHERE</span> BlogId <span class="token operator">=</span> <span class="token variable">@Id</span>
<span class="token keyword">END</span>
</code></pre>
<p>*&#x5E76;&#x53D1;&#x6807;&#x8BB0;:</p>
<pre class="language-"><code class="lang-C#">//&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5B57;&#x6BB5;&#x4E3A;&#x5E76;&#x53D1;&#x5B57;&#x6BB5;
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span>()
    .Property(p =&gt; p.LastName)
    .IsConcurrencyToken();

//&#x6307;&#x5B9A;&#x6574;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x5E76;&#x53D1;&#x5B57;&#x6BB5;, &#x5B9E;&#x4F53;&#x4EFB;&#x4F55;&#x5B57;&#x6BB5;&#x6709;&#x66F4;&#x6539;, &#x5E76;&#x53D1;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x6539;&#x53D8;
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(p =&gt; p.Timestamp)
    .IsRowVersion();
</code></pre>
<p>*&#x914D;&#x7F6E;1&#x5BF9;N: &#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x6700;&#x7EC8;&#x53EA;&#x4FDD;&#x7559; public List<post> Posts { get; set; }, &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x8DB3;&#x4EE5;&#x8BF4;&#x660E;Blog&#x4E0E;Post&#x7684;1&#x5BF9;&#x591A;&#x5173;&#x7CFB;.</post></p>
<pre class="language-"><code class="lang-C#">public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }

    public List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span> Posts { get; set; }
}

public class Post
{
    public int PostId { get; set; }
    public string Title { get; set; }
    public string Content { get; set; }

    public int BlogId { get; set; }
    public Blog Blog { get; set; }
}
</code></pre>
<p>HasOne/WithOne&#x7528;&#x4E8E;&#x5F15;&#x7528;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, HasMany/WithMany&#x7528;&#x4E8E;&#x96C6;&#x5408;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x914D;&#x7F6E;&#x7684;&#x5957;&#x8DEF;: &#x628A;&#x5173;&#x7CFB;&#x914D;&#x7F6E;&#x5728;&#x591A;&#x7684;&#x4E00;&#x7AEF;.</p>
<p>&#x4E0B;&#x9762;&#x662F;1&#x5BF9;N&#x7684;&#x4F8B;&#x5B50;:</p>
<pre class="language-"><code class="lang-C#">public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }

    public List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span> Posts { get; set; }
}

public class Post
{
    public int PostId { get; set; }
    public string Title { get; set; }
    public string Content { get; set; }
    public Blog Blog { get; set; }
}

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>()
            .HasOne(p =&gt; p.Blog)
            .WithMany(b =&gt; b.Posts);
</code></pre>
<p>&#x6216;&#x8005;</p>
<pre class="language-"><code class="lang-C#">public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }

    public List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span> Posts { get; set; }
}

public class Post
{
    public int PostId { get; set; }
    public string Title { get; set; }
    public string Content { get; set; }
}

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
            .HasMany(b =&gt; b.Posts)
            .WithOne();
</code></pre>
<p>*&#x914D;&#x7F6E;&#x5BFC;&#x822A;&#x5C5E;&#x6027;: &#x5BF9;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x597D;&#x7684;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x7528;Navigation&#x8FDB;&#x884C;&#x7EC6;&#x8282;&#x914D;&#x7F6E;.</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .HasMany(b =&gt; b.Posts)
    .WithOne();

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Navigation(b =&gt; b.Posts)
    .UsePropertyAccessMode(PropertyAccessMode.Property);
</code></pre>
<p>*&#x6307;&#x5B9A;&#x5916;&#x952E;:</p>
<pre class="language-"><code class="lang-C#">//&#x5355;&#x4E2A;&#x5916;&#x952E;
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>()
            .HasOne(p =&gt; p.Blog)
            .WithMany(b =&gt; b.Posts)
            .HasForeignKey(p =&gt; p.BlogForeignKey);

//&#x8054;&#x5408;&#x5916;&#x952E;
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RecordOfSale</span><span class="token punctuation">&gt;</span></span>()
            .HasOne(s =&gt; s.Car)
            .WithMany(c =&gt; c.SaleHistory)
            .HasForeignKey(s =&gt; new { s.CarState, s.CarLicensePlate });
</code></pre>
<p>*&#x6307;&#x5B9A;&#x5916;&#x952E;&#x540D;&#x79F0;:</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>()
        .HasOne(p =&gt; p.Blog)
        .WithMany(b =&gt; b.Posts)
        .HasForeignKey(p =&gt; p.BlogId)
        .HasConstraintName(&quot;ForeignKey_Post_Blog&quot;);
</code></pre>
<p>*&#x6CA1;&#x6709;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x8BBE;&#x7F6E;1&#x5BF9;&#x591A;&#x5173;&#x7CFB;(&#x4E00;&#x822C;&#x4E5F;&#x6CA1;&#x4EBA;&#x4F1A;&#x8FD9;&#x4E48;&#x5E72;&#x5427;-_-||):</p>
<pre class="language-"><code class="lang-C#">public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }
}

public class Post
{
    public int PostId { get; set; }
    public string Title { get; set; }
    public string Content { get; set; }

    public int BlogId { get; set; }
}

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>()
            .HasOne<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
            .WithMany()
            .HasForeignKey(p =&gt; p.BlogId);
</code></pre>
<p>*&#x6307;&#x5B9A;&#x5916;&#x952E;&#x662F;&#x5426;&#x5FC5;&#x586B;:</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>()
        .HasOne(p =&gt; p.Blog)
        .WithMany(b =&gt; b.Posts)
        .IsRequired();
</code></pre>
<p>*&#x7EA7;&#x8054;&#x5220;&#x9664;:</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>()
        .HasOne(p =&gt; p.Blog)
        .WithMany(b =&gt; b.Posts)
        .OnDelete(DeleteBehavior.Cascade);
</code></pre>
<p>*&#x914D;&#x7F6E;1&#x5BF9;1: &#x5728;&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x4E2D;&#xFF0C;&#x5177;&#x6709;&#x5F15;&#x7528;&#x5BFC;&#x822A;&#x7684;&#x5B9E;&#x4F53;&#x662F;&#x4F9D;&#x8D56;&#x5B9E;&#x4F53;&#xFF0C;&#x5177;&#x6709;&#x96C6;&#x5408;&#x5BFC;&#x822A;&#x7684;&#x5B9E;&#x4F53;&#x662F;&#x4E3B;&#x4F53;. &#x5728;1&#x5BF9;1&#x7684;&#x5173;&#x7CFB;&#x4E2D;, &#x9700;&#x8981;&#x663E;&#x793A;&#x6307;&#x5B9A;&#x4E3B;&#x4ECE;&#x5173;&#x7CFB;.</p>
<pre class="language-"><code class="lang-C#">public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }

    public BlogImage BlogImage { get; set; }
}

public class BlogImage
{
    public int BlogImageId { get; set; }
    public byte[] Image { get; set; }
    public string Caption { get; set; }

    public int BlogForeignKey { get; set; }
    public Blog Blog { get; set; }
}

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
            .HasOne(b =&gt; b.BlogImage)
            .WithOne(i =&gt; i.Blog)
            .HasForeignKey<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlogImage</span><span class="token punctuation">&gt;</span></span>(b =&gt; b.BlogForeignKey);
</code></pre>
<p>*&#x914D;&#x7F6E;N&#x5BF9;N: &#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x9700;&#x8981;&#x4E24;&#x4FA7;&#x7684;&#x96C6;&#x5408;&#x5BFC;&#x822A;&#x5C5E;&#x6027;.</p>
<pre class="language-"><code class="lang-C#">public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
    public bool Gender { get; set; }
}
public class Role
{
    public int Id { get; set; }
    public string RoleName { get; set; }
}
public class UserRoleRelation
{
    public int Id { get; set; }
    public int UserId { get; set; }
    public int RoleId { get; set; }

    public virtual User User { get; set; }
    public virtual Role Role { get; set; }
}

modelBuilder
    .Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserRoleRelation</span><span class="token punctuation">&gt;</span></span>().
    .ToTable(&quot;UserRoleRelation&quot;)
    .HasKey(r =&gt; r.Id)
    .Property(r =&gt; r.UserId).IsRequired()
    .Property(r =&gt; r.RoleId).IsRequired()
    .HasOne(r =&gt; r.User).WithMany().HasForeignKey(r =&gt; r.UserId).IsRequired().OnDelete(DeleteBehavior.ClientCascade))
    .HasOne(r =&gt; r.Role).WithMany().HasForeignKey(r =&gt; r.RoleId).IsRequired().OnDelete(DeleteBehavior.ClientCascade));
</code></pre>
<p>*&#x7D22;&#x5F15;: </p>
<p>modelBuilder.Entity<blog>()
    .HasIndex(b =&gt; b.Url);</blog></p>
<p>*&#x590D;&#x5408;&#x7D22;&#x5F15;:</p>
<p>modelBuilder.Entity<person>()
    .HasIndex(p =&gt; new { p.FirstName, p.LastName });</person></p>
<p>*&#x552F;&#x4E00;&#x7D22;&#x5F15;:</p>
<p>modelBuilder.Entity<blog>()
    .HasIndex(b =&gt; b.Url)
    .IsUnique();</blog></p>
<p>*&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x540D;&#x79F0;:</p>
<p>modelBuilder.Entity<blog>()
    .HasIndex(b =&gt; b.Url)
    .HasDatabaseName(&quot;Index_Url&quot;);</blog></p>
<p>*&#x6761;&#x4EF6;&#x7EA6;&#x675F;:</p>
<p>modelBuilder.Entity<product>()
    .HasCheckConstraint(&quot;CK_Prices&quot;, &quot;[Price] &gt; [DiscountedPrice]&quot;, c =&gt; c.HasName(&quot;CK_Product_Prices&quot;));</product></p>
<p>*&#x7EE7;&#x627F;: &#x6CA1;&#x7528;&#x5230;, &#x9700;&#x8981;&#x4E86;&#x89E3;&#x53EF;&#x53C2;&#x8003;:<a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/inheritance" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/inheritance</a></p>
<p>*&#x5E8F;&#x5217;: &#x6CA1;&#x7528;&#x5230;, &#x9700;&#x8981;&#x4E86;&#x89E3;&#x53EF;&#x53C2;&#x8003;:<a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/sequences" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/sequences</a></p>
<p>*&#x652F;&#x6301;&#x5B57;&#x6BB5;:</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
    .Property(b =&gt; b.Url)
    .HasField(&quot;_validatedUrl&quot;);
</code></pre>
<p>*&#x503C;&#x8F6C;&#x6362;</p>
<p>Expression<func<tmodel, tprovider="">&gt; convertToProviderExpression</func<tmodel,></p>
<p>Expression<func<tprovider, tmodel="">&gt; convertFromProviderExpression</func<tprovider,></p>
<p>&#x4E00;&#x4E2A;&#x662F;&#x5199;&#x5E93;&#x65F6;&#x8981;&#x628A;&#x5B9E;&#x4F53;&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#x8F6C;&#x4E3A;&#x8868;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;, &#x4E00;&#x4E2A;&#x662F;&#x8BFB;&#x5E93;&#x65F6;, &#x628A;&#x8868;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#x56DE;&#x8F6C;&#x4E3A;&#x5B9E;&#x4F53;&#x6A21;&#x578B;&#x4E2D;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x578B;.</p>
<pre class="language-"><code class="lang-C#">var converter = new ValueConverter&lt;List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UpgradeWayModel</span><span class="token punctuation">&gt;</span></span>, string&gt;
(
    v =&gt; JsonHelper.ToJson(v),
    v =&gt; JsonHelper.ToObject&lt;List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UpgradeWayModel</span><span class="token punctuation">&gt;</span></span>&gt;(v)
);

modelBuilder
    .Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Test</span><span class="token punctuation">&gt;</span></span>()
    .Property(e =&gt; e.TestName)
    .HasConversion(converter);
</code></pre>
<p>*&#x5185;&#x7F6E;&#x7684;&#x8F6C;&#x6362;&#x5668;: <a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/value-conversions?tabs=fluent-api" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/value-conversions?tabs=fluent-api</a></p>
<p>*&#x503C;&#x6BD4;&#x8F83;&#x5668;: <a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/value-comparers?tabs=ef5" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/value-comparers?tabs=ef5</a></p>
<p>*&#x79CD;&#x5B50;&#x6570;&#x636E;: <a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/data-seeding" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/data-seeding</a></p>
<p>*&#x5B9E;&#x4F53;&#x7C7B;&#x578B;&#x6784;&#x9020;&#x51FD;&#x6570;: &#x53EF;&#x4EE5;&#x6CE8;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x6240;&#x6709;&#x670D;&#x52A1;</p>
<p>*&#x8868;&#x62C6;&#x5206;(&#x8868;&#x5171;&#x4EAB;): &#x591A;&#x4E2A;&#x5B9E;&#x4F53;&#x5171;&#x540C;&#x6620;&#x5C04;&#x540C;&#x4E00;&#x5F20;&#x8868;&#x7684;&#x4E0D;&#x540C;&#x5B57;&#x6BB5;, &#x7EC4;&#x6210;&#x4E00;&#x5F20;&#x603B;&#x7684;&#x8868;. &#x5C06;&#x4E3B;&#x952E;&#x6620;&#x5C04;&#x5230;&#x76F8;&#x540C;&#x7684;&#x5217;, &#x5E76;&#x4E14;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;&#x7684;&#x4E3B;&#x952E;&#x4E0E;&#x53E6;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;&#x7684;&#x4E3B;&#x952E;&#x4E4B;&#x95F4;&#x914D;&#x7F6E;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;&#x5173;&#x7CFB;.</p>
<pre class="language-"><code class="lang-C#">public class Order
{
    public int Id { get; set; }
    public OrderStatus? Status { get; set; }
    public DetailedOrder DetailedOrder { get; set; }
}
public class DetailedOrder
{
    public int Id { get; set; }
    public OrderStatus? Status { get; set; }
    public string BillingAddress { get; set; }
    public string ShippingAddress { get; set; }
    public byte[] Version { get; set; }
}

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DetailedOrder</span><span class="token punctuation">&gt;</span></span>(
    dob =&gt;
    {
        dob.ToTable(&quot;Orders&quot;);
        dob.Property(o =&gt; o.Status).HasColumnName(&quot;Status&quot;);
    });

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span>(
    ob =&gt;
    {
        ob.ToTable(&quot;Orders&quot;);
        ob.Property(o =&gt; o.Status).HasColumnName(&quot;Status&quot;);
        ob.HasOne(o =&gt; o.DetailedOrder).WithOne().HasForeignKey<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DetailedOrder</span><span class="token punctuation">&gt;</span></span>(o =&gt; o.Id);
    });
</code></pre>
<p>*&#x4ECE;&#x5C5E;&#x5C5E;&#x6027;: <a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/owned-entities" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/owned-entities</a></p>
<p>*&#x65E0;&#x952E;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;:</p>
<p>modelBuilder.Entity<blogpostscount>()
    .HasNoKey();</blogpostscount></p>
<p>*&#x5728;&#x5177;&#x6709;&#x76F8;&#x540C; DbContext &#x7C7B;&#x578B;&#x7684;&#x591A;&#x4E2A;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x4EA4;&#x66FF;: <a href="https://www.jianshu.com/p/d401c0bb3046" target="_blank">https://www.jianshu.com/p/d401c0bb3046</a></p>
<p>*&#x7A7A;&#x95F4;&#x6570;&#x636E;: <a href="https://docs.microsoft.com/zh-cn/ef/core/modeling/spatial" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/modeling/spatial</a></p>
<p>*&#x6307;&#x5B9A;&#x57FA;&#x7C7B;&#x578B;: HasBaseType.</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RssBlog</span><span class="token punctuation">&gt;</span></span>().HasBaseType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>();
</code></pre>
<p>*&#x9690;&#x85CF;&#x5C5E;&#x6027;: &#x4E5F;&#x53EB;&#x5F71;&#x5B50;&#x5C5E;&#x6027;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x4E0D;&#x662F;&#x5728;.net&#x5B9E;&#x4F53;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x800C;&#x662F;&#x5728;EFCore&#x6A21;&#x578B;&#x4E2D;&#x4E3A;&#x8BE5;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x548C;&#x72B6;&#x6001;&#x5B8C;&#x5168;&#x5728;&#x53D8;&#x66F4;&#x8DDF;&#x8E2A;&#x5668;&#x4E2D;&#x7EF4;&#x62A4;&#x3002;</p>
<pre class="language-"><code class="lang-C#">//&#x914D;&#x7F6E;&#x9690;&#x85CF;&#x5C5E;&#x6027;, &#x53EA;&#x80FD;&#x901A;&#x8FC7; Fluent API &#x6765;&#x521B;&#x5EFA;
public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }
}
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>().Property<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DateTime</span><span class="token punctuation">&gt;</span></span>(&quot;LastUpdated&quot;);

//&#x8BBE;&#x7F6E;&#x9690;&#x85CF;&#x5C5E;&#x6027;&#x503C;, &#x901A;&#x8FC7;ChangeTracker API&#x53EF;&#x4EE5;&#x4E3A;&#x9690;&#x85CF;&#x5C5E;&#x6027;LastUpdated&#x8BBE;&#x7F6E;&#x65F6;&#x95F4;&#x503C;, &#x63D0;&#x4EA4;&#x5230;&#x6570;&#x636E;&#x5E93;&#x8868;&#x4E2D;&#x3002;
BloggingContext.Entry(blog).Property(&quot;LastUpdated&quot;).CurrentValue = DateTime.Now;
BloggingContext.Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>(blog);
await BloggingContext.SaveChangesAsync();

//&#x8BFB;&#x53D6;blog&#x8868;&#x6570;&#x636E;
var blogs = context.Blogs.OrderBy(b =&gt; EF.Property<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DateTime</span><span class="token punctuation">&gt;</span></span>(b, &quot;LastUpdated&quot;));
</code></pre>
<hr>
<h2 id="4&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;"><a name="4&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;" class="anchor-navigation-ex-anchor" href="#4&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>4&gt;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x67B6;&#x6784;</h2>
<h3 id="4-1code-first&#x4F7F;&#x7528;migration-db-first&#x4F7F;&#x7528;&#x65B9;&#x5411;&#x5DE5;&#x7A0B;"><a name="4-1code-first&#x4F7F;&#x7528;migration-db-first&#x4F7F;&#x7528;&#x65B9;&#x5411;&#x5DE5;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#4-1code-first&#x4F7F;&#x7528;migration-db-first&#x4F7F;&#x7528;&#x65B9;&#x5411;&#x5DE5;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>4-1&gt;Code first&#x4F7F;&#x7528;Migration, DB First&#x4F7F;&#x7528;&#x65B9;&#x5411;&#x5DE5;&#x7A0B;.</h3>
<h3 id="4-2&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a name="4-2&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="anchor-navigation-ex-anchor" href="#4-2&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>4-2&gt;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h3>
<p>*&#x9ED8;&#x8BA4;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x9700;&#x8981;&#x80FD;&#x751F;&#x6210;exe, &#x5728;dbcontext&#x7684;&#x9879;&#x76EE;&#x53CA;exe&#x9879;&#x76EE;&#x5B89;&#x88C5;nuget&#x5305; Microsoft.EntityFrameworkCore.Tools</p>
<p>*&#x4E4B;&#x524D;&#x547D;&#x4EE4;&#x524D;, &#x8BB0;&#x5F97;&#x5728;Startup.ConfigureServices&#x914D;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;: services.AddDbContext<calcdbcontext>();</calcdbcontext></p>
<h3 id="4-3&#x6307;&#x4EE4;&#x5217;&#x8868;"><a name="4-3&#x6307;&#x4EE4;&#x5217;&#x8868;" class="anchor-navigation-ex-anchor" href="#4-3&#x6307;&#x4EE4;&#x5217;&#x8868;"><i class="fa fa-link" aria-hidden="true"></i></a>4-3&gt;&#x6307;&#x4EE4;&#x5217;&#x8868;</h3>
<pre class="language-"><code class="lang-powershell"><span class="token function">Add-Migration</span>               Adds a new migration<span class="token punctuation">.</span>
Script-Migration            Generates a SQL script <span class="token keyword">from</span> migrations<span class="token punctuation">.</span>
<span class="token function">Update-Database</span>             Updates the database to a specified migration<span class="token punctuation">.</span>
<span class="token function">Remove-Migration</span>            Removes the last migration<span class="token punctuation">.</span>

Drop-Database               Drops the database<span class="token punctuation">.</span>
<span class="token function">Get-DbContext</span>               Lists and gets information about available DbContext types<span class="token punctuation">.</span>
<span class="token function">Get-Migration</span>               Lists available migrations<span class="token punctuation">.</span>
Scaffold-DbContext          Scaffolds a DbContext and entity types <span class="token keyword">for</span> a database<span class="token punctuation">.</span>
Script-DbContext            Generates a SQL script <span class="token keyword">from</span> the DbContext<span class="token punctuation">.</span> Bypasses any migrations<span class="token punctuation">.</span>
</code></pre>
<h3 id="4-4&#x7BA1;&#x7406;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;"><a name="4-4&#x7BA1;&#x7406;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#4-4&#x7BA1;&#x7406;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>4-4&gt;&#x7BA1;&#x7406;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;</h3>
<pre class="language-"><code class="lang-powershell"><span class="token operator">/</span><span class="token operator">/</span>&#x751F;&#x6210;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;
<span class="token function">Add-Migration</span> InitCALCDb
<span class="token function">Add-Migration</span> InitCALCDb <span class="token operator">-</span>OutputDir DbMigration
<span class="token function">Add-Migration</span> InitCALCDb <span class="token operator">-</span>Context CALCDbContext <span class="token operator">-</span>OutputDir DbMigration

<span class="token operator">/</span><span class="token operator">/</span>&#x5220;&#x9664;&#x8FC1;&#x79FB;<span class="token punctuation">(</span>&#x82E5;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x5DF2;&#x7528;&#x4E8E;&#x6267;&#x884C;<span class="token function">update-database</span><span class="token punctuation">,</span> &#x5219;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;<span class="token function">Remove-Migration</span><span class="token punctuation">,</span> &#x53EA;&#x80FD;&#x4ECE;&#x6700;&#x65B0;&#x7684;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x5F80;&#x56DE;&#x5220;&#x9664;<span class="token punctuation">)</span>
<span class="token function">Remove-Migration</span>
<span class="token function">Remove-Migration</span> <span class="token operator">-</span>Context CALCDbContext <span class="token operator">/</span><span class="token operator">/</span>&#x5220;&#x9664;&#x6700;&#x65B0;&#x751F;&#x6210;&#x7684;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;

<span class="token operator">/</span><span class="token operator">/</span>&#x751F;&#x6210;&#x6570;&#x636E;&#x5E93;&#x811A;&#x672C;
Script-Migration
Script-Migration <span class="token operator">-</span>Context CALCDbContext
Script-Migration <span class="token operator">-</span>Context CALCDbContext <span class="token operator">-</span>Output CALCDbScript<span class="token punctuation">.</span>sql <span class="token operator">/</span><span class="token operator">/</span>&#x811A;&#x672C;&#x751F;&#x6210;&#x5230;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;
Script-Migration <span class="token operator">-</span>Context CALCDbContext <span class="token operator">-</span>Output F:\100_StudyPro\NetCoreDemos\Dylan<span class="token punctuation">.</span>Repository\DbMigrationScript\CALCDbScript<span class="token punctuation">.</span>sql <span class="token operator">/</span><span class="token operator">/</span>&#x811A;&#x672C;&#x751F;&#x6210;&#x5230;&#x6307;&#x5B9A;&#x7269;&#x7406;&#x8DEF;&#x5F84;&#x4E0B;
Script-Migration UpdateCALCDb1 AddIsDeleteInAuthor <span class="token operator">-</span>Context CalcDbContext <span class="token operator">/</span><span class="token operator">/</span>&#x751F;&#x6210;UpdateCALCDb1&#x7248;&#x672C;&#x5230;AddIsDeleteInAuthor&#x7248;&#x672C;&#x4E4B;&#x95F4;&#x7684;SQL

<span class="token operator">/</span><span class="token operator">/</span>&#x66F4;&#x65B0;&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x6784;
<span class="token function">Update-Database</span> <span class="token operator">/</span><span class="token operator">/</span>&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x7248;&#x672C;
<span class="token function">Update-Database</span> <span class="token operator">-</span>Context CALCDbContext <span class="token operator">/</span><span class="token operator">/</span>&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x7248;&#x672C;
<span class="token function">update-database</span> AddIsDeleteInAuthor <span class="token operator">-</span>Context CALCDbContext <span class="token operator">/</span><span class="token operator">/</span>&#x964D;&#x7EA7;<span class="token operator">/</span>&#x5347;&#x7EA7;&#x5230;&#x6307;&#x5B9A;&#x7248;&#x672C;
<span class="token function">Update-Database</span> <span class="token operator">-</span>Context CALCDbContext <span class="token operator">-</span>Migration:0 <span class="token operator">/</span><span class="token operator">/</span>&#x5220;&#x9664;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6240;&#x6709;&#x8868;<span class="token punctuation">(</span>&#x9664;&#x4E86;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8868;<span class="token punctuation">)</span>
</code></pre>
<h3 id="4-5&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a name="4-5&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="anchor-navigation-ex-anchor" href="#4-5&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>4-5&gt;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h3>
<p>*&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x4E0D;&#x4E00;&#x5B9A;&#x90FD;&#x662F;&#x5BF9;&#x7684;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4FEE;&#x6539;Add-Migration&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;, &#x6BD4;&#x5982;&#x4FEE;&#x6539;&#x5B57;&#x6BB5;&#x540D;. &#x82E5;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x5217;A, &#x82E5;&#x5BF9;&#x5B9E;&#x4F53;&#x505A;&#x4E86;&#x91CD;&#x547D;&#x540D;&#x64CD;&#x4F5C;, &#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x811A;&#x672C;&#x4F1A;&#x6267;&#x884C;drop column &amp; add column&#x64CD;&#x4F5C;, &#x8FD9;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x4F1A;&#x5BFC;&#x81F4;&#x5217;&#x7684;&#x503C;&#x4E22;&#x5931;, &#x56E0;&#x6B64;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5E72;&#x9884;.</p>
<pre class="language-"><code class="lang-C#">migrationBuilder.DropColumn(
    name: &quot;Name&quot;,
    table: &quot;Customers&quot;);

migrationBuilder.AddColumn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(
    name: &quot;FullName&quot;,
    table: &quot;Customers&quot;,
    nullable: true);

//&#x5E94;&#x8BE5;&#x6539;&#x6210;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;
migrationBuilder.RenameColumn(
    name: &quot;Name&quot;,
    table: &quot;Customers&quot;,
    newName: &quot;FullName&quot;);
</code></pre>
<p>*&#x5F80;&#x751F;&#x6210;&#x7684;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x91CC;&#x6DFB;&#x52A0;&#x539F;&#x59CB;sql&#x8BED;&#x53E5;</p>
<pre class="language-"><code class="lang-C#">migrationBuilder.AddColumn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(
    name: &quot;FullName&quot;,
    table: &quot;Customer&quot;,
    nullable: true);

migrationBuilder.Sql(
@&quot;
    UPDATE Customer
    SET FullName = FirstName + &apos; &apos; + LastName;
&quot;);

migrationBuilder.DropColumn(
    name: &quot;FirstName&quot;,
    table: &quot;Customer&quot;);

migrationBuilder.DropColumn(
    name: &quot;LastName&quot;,
    table: &quot;Customer&quot;);
</code></pre>
<h3 id="4-6&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x52A8;&#x6001;&#x7F16;&#x7A0B;"><a name="4-6&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x52A8;&#x6001;&#x7F16;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#4-6&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x52A8;&#x6001;&#x7F16;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>4-6&gt;&#x8FC1;&#x79FB;&#x6587;&#x4EF6;&#x52A8;&#x6001;&#x7F16;&#x7A0B;</h3>
<p><a href="https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/migrations/operations" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/migrations/operations</a></p>
<h3 id="4-7&#x52A8;&#x6001;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;"><a name="4-7&#x52A8;&#x6001;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;" class="anchor-navigation-ex-anchor" href="#4-7&#x52A8;&#x6001;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;"><i class="fa fa-link" aria-hidden="true"></i></a>4-7&gt;&#x52A8;&#x6001;&#x6307;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;</h3>
<pre class="language-"><code class="lang-C#">public static IHostBuilder CreateHostBuilder(string[] args)
    =&gt; Host.CreateDefaultBuilder(args)
        .ConfigureServices(
            (hostContext, services) =&gt;
            {
                services.AddHostedService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Worker</span><span class="token punctuation">&gt;</span></span>();

                // Set the active provider via configuration
                var configuration = hostContext.Configuration;
                var provider = configuration.GetValue(&quot;Provider&quot;, &quot;SqlServer&quot;);

                services.AddDbContext<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlogContext</span><span class="token punctuation">&gt;</span></span>(
                    options =&gt; _ = provider switch
                    {
                        &quot;Sqlite&quot; =&gt; options.UseSqlite(
                            configuration.GetConnectionString(&quot;SqliteConnection&quot;),
                            x =&gt; x.MigrationsAssembly(&quot;SqliteMigrations&quot;)),

                        &quot;SqlServer&quot; =&gt; options.UseSqlServer(
                            configuration.GetConnectionString(&quot;SqlServerConnection&quot;),
                            x =&gt; x.MigrationsAssembly(&quot;SqlServerMigrations&quot;)),

                        _ =&gt; throw new Exception($&quot;Unsupported provider: {provider}&quot;)
                    });
            });

Add-Migration MyMigration -Args &quot;--provider SqlServer&quot;
Add-Migration MyMigration -Args &quot;--provider Sqlite&quot;
</code></pre>
<h3 id="4-8&#x81EA;&#x5B9A;&#x4E49;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;"><a name="4-8&#x81EA;&#x5B9A;&#x4E49;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;" class="anchor-navigation-ex-anchor" href="#4-8&#x81EA;&#x5B9A;&#x4E49;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;"><i class="fa fa-link" aria-hidden="true"></i></a>4-8&gt;&#x81EA;&#x5B9A;&#x4E49;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;</h3>
<p><a href="https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/migrations/history-table" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/migrations/history-table</a></p>
<pre class="language-"><code class="lang-C#">optionsBuilder.UseSqlServer(connectionString: connStr, sqlServerOptionsAction =&gt;
{
    sqlServerOptionsAction.EnableRetryOnFailure(3, TimeSpan.FromMilliseconds(100), null); //&#x8BBE;&#x7F6E;&#x91CD;&#x8FDE;
    if (!string.IsNullOrEmpty(Schema))
    {
        sqlServerOptionsAction.MigrationsHistoryTable(tableName: &quot;__T_DBMigrationsHistory&quot;, schema: Schema);
    }
});
</code></pre>
<hr>
<h2 id="5&#x5E76;&#x53D1;"><a name="5&#x5E76;&#x53D1;" class="anchor-navigation-ex-anchor" href="#5&#x5E76;&#x53D1;"><i class="fa fa-link" aria-hidden="true"></i></a>5&gt;&#x5E76;&#x53D1;</h2>
<p>&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E0B;&#x5E2E;&#x52A9;&#x89E3;&#x51B3;&#x5E76;&#x53D1;&#x51B2;&#x7A81;&#x7684;&#x4E09;&#x7EC4;&#x503C;&#xFF1A;</p>
<ul>
<li>Current values &#x5F53;&#x524D;&#x503C;&#xFF1A; &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C1D;&#x8BD5;&#x5199;&#x5165;&#x6570;&#x636E;&#x5E93;&#x7684;&#x503C;</li>
<li>Original values &#x539F;&#x59CB;&#x503C;&#xFF1A; &#x88AB; EF Core &#x4ECE;&#x6570;&#x636E;&#x5E93;&#x68C0;&#x7D22;&#x51FA;&#x6765;&#x7684;&#x503C;&#xFF0C;&#x4F4D;&#x4E8E;&#x4EFB;&#x4F55;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#x7684;&#x503C;</li>
<li>Database values &#x6570;&#x636E;&#x5E93;&#x503C;&#xFF1A; &#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x9645;&#x5B58;&#x50A8;&#x7684;&#x503C;</li>
</ul>
<p>&#x5F53;<code>SaveChanges</code>&#x65F6;, &#x5982;&#x679C;&#x6355;&#x83B7;&#x4E86;<code>DbUpdateConcurrencyException</code>, &#x8BF4;&#x660E;&#x53D1;&#x751F;&#x4E86;&#x5E76;&#x53D1;&#x51B2;&#x7A81;, &#x4F7F;&#x7528;<code>DbUpdateConcurrencyException.Entries</code>&#x4E3A;&#x53D7;&#x5F71;&#x54CD;&#x7684;&#x5B9E;&#x4F53;&#x51C6;&#x5907;&#x4E00;&#x7EC4;&#x65B0;&#x503C;, &#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x503C;&#x7684;&#x5E76;&#x53D1;&#x4EE4;&#x724C;&#x6765;&#x5237;&#x65B0;<code>Original values</code>, &#x7136;&#x540E;&#x91CD;&#x8BD5;&#x76F4;&#x5230;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x51B2;&#x7A81;&#x4EA7;&#x751F;.</p>
<pre class="language-"><code class="lang-C#">[HttpPut]
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span> Update([FromBody]Person current)
{
    Person original = null;

    try
    {
        original = await _db.People.FindAsync(current.Id);
        original.FirstName = current.FirstName;
        original.LastName = current.LastName;
        await _db.SaveChangesAsync();
    }
    catch (DbUpdateConcurrencyException e)
    {
        foreach (var entry in e.Entries)
        {
            var currentValues = entry.CurrentValues;
            var databaseValues = await entry.GetDatabaseValuesAsync();

            if (entry.Entity is Person person)
            {
                // &#x66F4;&#x65B0;&#x4EC0;&#x4E48;&#x503C;&#x53D6;&#x51B3;&#x4E8E;&#x5B9E;&#x9645;&#x9700;&#x8981;
                person.FirstName = currentValues[nameof(Person.FirstName)]?.ToString();
                person.LastName = currentValues[nameof(Person.LastName)]?.ToString();
                // &#x8FD9;&#x6B65;&#x64CD;&#x4F5C;&#x662F;&#x4E3A;&#x4E86;&#x5237;&#x65B0;&#x5F53;&#x524D; Tracker &#x7684;&#x503C;&#xFF0C; &#x4E3A;&#x4E86;&#x901A;&#x8FC7;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x5E76;&#x53D1;&#x68C0;&#x67E5;
                entry.OriginalValues.SetValues(databaseValues);
            }
        }

        await _db.SaveChangesAsync();
    }

    return original;
}
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x5B98;&#x65B9;&#x5904;&#x7406;&#x65B9;&#x5F0F;
using var context = new PersonContext();
// Fetch a person from database and change phone number
var person = context.People.Single(p =&gt; p.PersonId == 1);
person.PhoneNumber = &quot;555-555-5555&quot;;

// Change the person&apos;s name in the database to simulate a concurrency conflict
context.Database.ExecuteSqlRaw(
    &quot;UPDATE dbo.People SET FirstName = &apos;Jane&apos; WHERE PersonId = 1&quot;);

var saved = false;
while (!saved)
{
    try
    {
        // Attempt to save changes to the database
        context.SaveChanges();
        saved = true;
    }
    catch (DbUpdateConcurrencyException ex)
    {
        foreach (var entry in ex.Entries)
        {
            if (entry.Entity is Person)
            {
                var proposedValues = entry.CurrentValues;
                var databaseValues = entry.GetDatabaseValues();

                foreach (var property in proposedValues.Properties)
                {
                    var proposedValue = proposedValues[property];
                    var databaseValue = databaseValues[property];

                    // TODO: decide which value should be written to database
                    // proposedValues[property] = <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">to</span> <span class="token attr-name">be</span> <span class="token attr-name">saved</span><span class="token punctuation">&gt;</span></span>;
                }

                // Refresh original values to bypass next concurrency check
                entry.OriginalValues.SetValues(databaseValues);
            }
            else
            {
                throw new NotSupportedException(
                    &quot;Don&apos;t know how to handle concurrency conflicts for &quot;
                    + entry.Metadata.Name);
            }
        }
    }
}
</code></pre>
<p>*&#x901A;&#x5E38;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#xFF1A;</p>
<p> *Reload&#x4E00;&#x4E0B;&#xFF0C;&#x653E;&#x5F03;&#x5F53;&#x524D;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x91CD;&#x65B0;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x52A0;&#x8F7D;&#x5F53;&#x524D;&#x5B9E;&#x4F53;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x503C;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x3002;</p>
<p> *&#x76F4;&#x63A5;&#x63D0;&#x793A;&#x7528;&#x6237;&#xFF0C;&#x4FE1;&#x606F;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x8BF7;&#x91CD;&#x65B0;&#x64CD;&#x4F5C;&#x4E00;&#x904D;(&#x53EF;&#x4EE5;&#x66F4;&#x53CB;&#x597D;&#x7684;&#x63D0;&#x793A;&#x4E00;&#x4E0B;)</p>
<pre class="language-"><code class="lang-C#">{
    //&#x4FDD;&#x8BC1;T_Concurrency02&#x6709;&#x4E00;&#x6761;id=01&#x7684;&#x8BB0;&#x5F55;&#xFF08;age=10&#xFF09;
    ypfContext db1 = new ypfContext();
    ypfContext db2 = new ypfContext();

    try
    {
        var data1 = db1.T_Concurrency02.Where(u =&gt; u.id == &quot;01&quot;).FirstOrDefault();
        var data2 = db2.T_Concurrency02.Where(u =&gt; u.id == &quot;01&quot;).FirstOrDefault();

        data1.age = data1.age - 2;
        int result1 = db1.SaveChanges();

        data2.age = data2.age - 4;
        int result2 = db2.SaveChanges();  //&#x53D1;&#x73B0;age&#x7684;&#x503C;&#x548C;&#x539F;&#x5148;&#x67E5;&#x51FA;&#x6765;&#x7684;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x4F1A;&#x629B;&#x5F02;&#x5E38;&#x8FDB;&#x5165;cache
    }
    catch (DbUpdateConcurrencyException ex)
    {
        var entityEntry = ex.Entries.Single();
        var original = entityEntry.OriginalValues.ToObject() as T_Concurrency02; //&#x6570;&#x636E;&#x5E93;&#x539F;&#x59CB;&#x503C;  10
        var database = entityEntry.GetDatabaseValues().ToObject() as T_Concurrency02; //&#x6570;&#x636E;&#x5E93;&#x73B0;&#x5728;&#x503C; 8
        var current = entityEntry.CurrentValues.ToObject() as T_Concurrency02; //&#x5F53;&#x524D;&#x5185;&#x5B58;&#x503C; 6
        entityEntry.Reload(); //&#x653E;&#x5F03;&#x5F53;&#x524D;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x91CD;&#x65B0;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x52A0;&#x8F7D;&#x5F53;&#x524D;&#x5B9E;&#x4F53;

        current.age = database.age - 4;  //&#x5E94;&#x8BE5;&#x62FF;&#x7740;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x9645;&#x7684;&#x503C;&#x53BB;&#x5904;&#x7406;&#xFF0C;&#x5373;8-4=4
        entityEntry.CurrentValues.SetValues(current);
        int result3 = db2.SaveChanges();
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">try
{
    var firstPeople1 = EFDbContext.Peoples.FirstOrDefault();

    var peopleId = firstPeople1.Id;

    firstPeople1.Name = &quot;people1&quot;;
    await EFDbContext.SaveChangesAsync(cancellationToken);

    return Json(new
    {
        peopleId
    });
}
catch (DbUpdateConcurrencyException ex)
{
    try
    {
        //&#x5C06;&#x6E90;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x4E3A;db&#x6570;&#x636E;, &#x7136;&#x540E;&#x73B0;&#x6709;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x4E3A;&#x6700;&#x65B0;&#x6570;&#x636E;
        long id = default;
        foreach (var entry in ex.Entries)
        {
            var dbProValues = await entry.GetDatabaseValuesAsync(cancellationToken);
            var curProValues = entry.CurrentValues;

            id = long.Parse(curProValues[&quot;Id&quot;].ToString());

            //&#x82E5;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x5F53;&#x524D;&#x503C;, &#x53EF;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;
            var curPeople = curProValues.ToObject() as People;
            if (curPeople == default)
            {
                throw ex;
            }
            curPeople.Name = &quot;&#x5E76;&#x53D1;people&quot;;
            entry.CurrentValues.SetValues(curPeople);


            //&#x5C06;&#x539F;&#x59CB;&#x503C;&#x7528;&#x6570;&#x636E;&#x5E93;&#x503C;&#x66F4;&#x65B0;, &#x4FDD;&#x8BC1;&#x5E76;&#x53D1;&#x4EE4;&#x724C;&#x4E3A;&#x6700;&#x65B0;
            entry.OriginalValues.SetValues(dbProValues);
        }

        await EFDbContext.SaveChangesAsync(cancellationToken);
        return Json(new
        {
            id
        });
    }
    catch
    {
        throw ex;
    }
}
catch (Exception ex)
{
    var errorMsg = ex.GetInnerExceptionMsg();
    return Json(new
    {
        errorMsg
    });
}
</code></pre>
<hr>
<h2 id="6&#x53CD;&#x5411;&#x5DE5;&#x7A0B;-&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;"><a name="6&#x53CD;&#x5411;&#x5DE5;&#x7A0B;-&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#6&#x53CD;&#x5411;&#x5DE5;&#x7A0B;-&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>6&gt;&#x53CD;&#x5411;&#x5DE5;&#x7A0B; (&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;)</h2>
<p><a href="https://www.cnblogs.com/MrHSR/p/10425437.html" target="_blank">https://www.cnblogs.com/MrHSR/p/10425437.html</a></p>
<p><strong>&#x5BF9;&#x4E8E;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x8001;&#x9879;&#x76EE;, &#x9700;&#x8981;&#x5347;&#x7EA7;&#x5230;EF Core, &#x7528;Code first(EF Core&#x53EA;&#x5269;&#x4E0B;Code First&#x6A21;&#x5F0F;)&#x4F5C;&#x4E3A;ORM, &#x6211;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x597D;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x4EE5;DB Context, &#x7136;&#x540E;&#x5728;&#x65E7;&#x9879;&#x76EE;&#x7684;&#x5E93;&#x91CC;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x8FC1;&#x79FB;&#x5386;&#x53F2;&#x8868;, &#x5F80;&#x8868;&#x91CC;&#x63D2;&#x5165;Init&#x8BB0;&#x5F55;, &#x7B49;&#x4EE5;&#x540E;&#x6709;&#x52A0;&#x65B0;&#x7684;&#x8868;&#x6216;&#x8005;&#x5BF9;&#x65E7;&#x5E93;&#x6709;&#x65B0;&#x7684;&#x66F4;&#x6539;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;Migration&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5E93;&#x7EF4;&#x62A4;.</strong></p>
<hr>
<h2 id="7&#x67E5;&#x8BE2;"><a name="7&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#7&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>7&gt;&#x67E5;&#x8BE2;</h2>
<h3 id="7-1&#x8DDF;&#x8E2A;&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;"><a name="7-1&#x8DDF;&#x8E2A;&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#7-1&#x8DDF;&#x8E2A;&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>7-1&gt;&#x8DDF;&#x8E2A;/&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;</h3>
<p>&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;: &#x4ECE;&#x5B9E;&#x4F53;&#x67E5;&#x8BE2;&#x51FA;&#x6765;, &#x4E00;&#x76F4;&#x5230;&#x6267;&#x884C;<code>SaveChanges()</code>, &#x7CFB;&#x7EDF;&#x4F1A;&#x76D1;&#x89C6;&#x5B9E;&#x4F53;&#x7684;&#x6240;&#x6709;&#x6539;&#x53D8;.</p>
<p>&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;: &#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x7684;&#x5B9E;&#x4F53;, &#x7CFB;&#x7EDF;&#x4E0D;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;, &#x53EF;&#x7528;&#x4E8E;&#x975E;&#x4FDD;&#x5B58;&#x7684;&#x67E5;&#x8BE2;, &#x5982;&#x5217;&#x8868;&#x67E5;&#x8BE2;.</p>
<pre class="language-"><code class="lang-C#">//&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;
var resultList = await EFDbContext.Authors.AsTracking().Where(a =&gt; a.Name.Contains(&quot;_1&quot;)).ToListAsync();
//&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;
var resultList = await EFDbContext.Authors.AsNoTracking().Where(a =&gt; a.Name.Contains(&quot;_1&quot;)).ToListAsync();
//&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;(&#x5E26;&#x6807;&#x8BC6;&#x89E3;&#x6790;, &#x6027;&#x80FD;&#x66F4;&#x597D;)
var resultList = await EFDbContext.Authors.AsNoTrackingWithIdentityResolution().Where(a =&gt; a.Name.Contains(&quot;_1&quot;)).ToListAsync();
</code></pre>
<h3 id="7-2&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;"><a name="7-2&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#7-2&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>7-2&gt;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;</h3>
<h4 id="7-2-1&#x9884;&#x52A0;&#x8F7D;"><a name="7-2-1&#x9884;&#x52A0;&#x8F7D;" class="anchor-navigation-ex-anchor" href="#7-2-1&#x9884;&#x52A0;&#x8F7D;"><i class="fa fa-link" aria-hidden="true"></i></a>7-2-1&gt;&#x9884;&#x52A0;&#x8F7D;</h4>
<pre class="language-"><code class="lang-C#">//1&gt;&#x4E0D;&#x9884;&#x52A0;&#x8F7D;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x7684;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x503C;&#x4E3A;&#x7A7A;
var resultList =
    await EFDbContext.Authors
    .Take(3)
    .ToListAsync();

//2&gt;&#x9884;&#x52A0;&#x8F7D;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x53EF;&#x4EE5;&#x67E5;&#x8BE2;&#x521D;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7684;&#x503C;
var resultList =
    await EFDbContext.Authors
    .Include(a =&gt; a.Blog)
    .Take(3)
    .ToListAsync();

//3&gt;&#x591A;&#x7EA7;&#x52A0;&#x8F7D;
/*
    SELECT [t0].[Id], [t0].[AddIP], [t0].[AddTime], [t0].[AddUserId], [t0].[Address], [t0].[BirthDate], [t0].[Code], [t0].[CompanyName], [t0].[Email], [t0].[Hometown], [t0].[LastUpdateIP], [t0].[LastUpdateTime], [t0].[LastUpdateUserId], [t0].[Name], [t0].[Tel], [t0].[Title], [t0].[Token], [t1].[Id], [t1].[AddIP], [t1].[AddTime], [t1].[AddUserId], [t1].[AuthorId], [t1].[LastUpdateIP], [t1].[LastUpdateTime], [t1].[LastUpdateUserId], [t1].[OpenDate], [t1].[Token], [t1].[Url], [t2].[Id], [t2].[AddIP], [t2].[AddTime], [t2].[AddUserId], [t2].[BlogId], [t2].[Content], [t2].[IsDelete], [t2].[LastUpdateIP], [t2].[LastUpdateTime], [t2].[LastUpdateUserId], [t2].[PostStatus], [t2].[ReleaseTime], [t2].[Title], [t2].[Token]
    FROM (
        SELECT TOP(3) [t].[Id], [t].[AddIP], [t].[AddTime], [t].[AddUserId], [t].[Address], [t].[BirthDate], [t].[Code], [t].[CompanyName], [t].[Email], [t].[Hometown], [t].[LastUpdateIP], [t].[LastUpdateTime], [t].[LastUpdateUserId], [t].[Name], [t].[Tel], [t].[Title], [t].[Token]
        FROM [CALC].[T_Author] AS [t]
    ) AS [t0]
    LEFT JOIN [CALC].[T_Blog] AS [t1] ON [t0].[Id] = [t1].[AuthorId]
    LEFT JOIN [CALC].[T_Post] AS [t2] ON [t1].[Id] = [t2].[BlogId]
    ORDER BY [t0].[Id], [t1].[Id], [t2].[Id]
*/
var resultList =
    await EFDbContext.Authors
    .Include(a =&gt; a.Blog)
    .ThenInclude(b=&gt;b.Posts)
    .Take(3)
    .ToListAsync();
//=&gt;&#x7B49;&#x540C;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x5199;&#x6CD5;
resultList =
    await EFDbContext.Authors
    .Include(a =&gt; a.Blog.Posts)
    .Take(3)
    .ToListAsync();

//4&gt;&#x9884;&#x52A0;&#x8F7D;&#x7684;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x6267;&#x884C;where, OrderBy, OrderByDescending, ThenBy, ThenByDescending, Skip &#x548C; Take.
var resultList =
    EFDbContext.Authors
    .Include(a =&gt; a.Blog.Posts.Where(p =&gt; p.PostStatus == EnumPostStatus.Draft).OrderByDescending(p =&gt; p.Content))
    .Take(3);
</code></pre>
<h4 id="7-2-2&#x663E;&#x5F0F;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x5B9E;&#x4F53;&#x7684;&#x5C5E;&#x6027;&#x5BFC;&#x822A;"><a name="7-2-2&#x663E;&#x5F0F;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x5B9E;&#x4F53;&#x7684;&#x5C5E;&#x6027;&#x5BFC;&#x822A;" class="anchor-navigation-ex-anchor" href="#7-2-2&#x663E;&#x5F0F;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x5B9E;&#x4F53;&#x7684;&#x5C5E;&#x6027;&#x5BFC;&#x822A;"><i class="fa fa-link" aria-hidden="true"></i></a>7-2-2&gt;&#x663E;&#x5F0F;&#x52A0;&#x8F7D;(&#x52A0;&#x8F7D;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x5B9E;&#x4F53;&#x7684;&#x5C5E;&#x6027;&#x5BFC;&#x822A;)</h4>
<pre class="language-"><code class="lang-C#">//1&gt;&#x663E;&#x793A;&#x52A0;&#x8F7D;&#x5BFC;&#x822A;&#x5C5E;&#x6027;
var resultList = EFDbContext.Authors.OrderByDescending(a =&gt; a.Name).ThenBy(a =&gt; a.Tel).Take(1).ToList();
if (resultList.Any())
{
    await EFDbContext.Entry(resultList[0])
        .Reference(a =&gt; a.Blog)
        .LoadAsync();

    await EFDbContext.Entry(resultList[0].Blog)
        .Collection(b =&gt; b.Posts)
        .LoadAsync();
}
</code></pre>
<h3 id="7-3&#x62C6;&#x5206;&#x67E5;&#x8BE2;&#x5408;&#x5E76;&#x67E5;&#x8BE2;"><a name="7-3&#x62C6;&#x5206;&#x67E5;&#x8BE2;&#x5408;&#x5E76;&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#7-3&#x62C6;&#x5206;&#x67E5;&#x8BE2;&#x5408;&#x5E76;&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>7-3&gt;&#x62C6;&#x5206;&#x67E5;&#x8BE2;/&#x5408;&#x5E76;&#x67E5;&#x8BE2;</h3>
<p>*EF&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x62C6;&#x5206;&#x67E5;&#x8BE2;, &#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x914D;&#x7F6E;</p>
<pre class="language-"><code class="lang-C#">protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
    optionsBuilder
        .UseSqlServer(
            @&quot;Server=(localdb)\mssqllocaldb;Database=EFQuerying;Trusted_Connection=True&quot;,
            o =&gt; o.UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery));
}
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x4F7F;&#x7528;&#x62C6;&#x5206;&#x67E5;&#x8BE2;
using (var context = new BloggingContext())
{
    var blogs = context.Blogs
        .Include(blog =&gt; blog.Posts)
        .AsSplitQuery()
        .ToList();
}

//&#x4F7F;&#x7528;&#x5408;&#x5E76;&#x67E5;&#x8BE2;
using (var context = new SplitQueriesBloggingContext())
{
    var blogs = context.Blogs
        .Include(blog =&gt; blog.Posts)
        .AsSingleQuery()
        .ToList();
}
</code></pre>
<h3 id="7-4&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;cross-join-inner-join-left-join"><a name="7-4&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;cross-join-inner-join-left-join" class="anchor-navigation-ex-anchor" href="#7-4&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;cross-join-inner-join-left-join"><i class="fa fa-link" aria-hidden="true"></i></a>7-4&gt;&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;(cross join, inner join, left join)</h3>
<pre class="language-"><code class="lang-C#">//1&gt;&#x7B1B;&#x5361;&#x5C14;&#x79EF;&#x67E5;&#x8BE2;(cross join)
/*
    SELECT [t].[Id] AS [AuthorId], [t].[Name], [t0].[Url], [t0].[OpenDate]
    FROM [CALC].[T_Author] AS [t]
    CROSS JOIN [CALC].[T_Blog] AS [t0]
    WHERE [t].[Id] = [t0].[AuthorId]
    ORDER BY [t].[Name], [t0].[Url] DESC
*/
var resultList =
                (from ab in
                (from author in EFDbContext.Authors
                 from blog in EFDbContext.Blogs
                 where author.Id == blog.AuthorId
                 select new
                 {
                     AuthorId = author.Id,
                     author.Name,
                     blog.Url,
                     blog.OpenDate
                 })//.ToList();
                 orderby ab.Name, ab.Url descending
                 select ab).ToList();

//2&gt;&#x5185;&#x8FDE;&#x63A5;(inner join)
/*
    SELECT [t].[Id] AS [AuthorId], [t].[Name], [t0].[Url], [t0].[OpenDate]
    FROM [CALC].[T_Author] AS [t]
    INNER JOIN [CALC].[T_Blog] AS [t0] ON [t].[Id] = [t0].[AuthorId]
    ORDER BY [t].[Name], [t0].[Url] DESC
*/
var resultList = await
                (from ab in
                (from author in EFDbContext.Authors
                 join blog in EFDbContext.Blogs on author.Id equals blog.AuthorId
                 select new
                 {
                     AuthorId = author.Id,
                     author.Name,
                     blog.Url,
                     blog.OpenDate
                 })
                 orderby ab.Name, ab.Url descending
                 select ab).ToListAsync();

//3&gt;&#x5148;&#x5185;&#x8FDE;&#x63A5;(inner join), &#x518D;&#x5DE6;&#x5916;&#x8FDE;&#x63A5;(left join)
/*
    SELECT [t].[Id] AS [AuthorId], [t].[Name] AS [AuthorName], [t0].[Url] AS [BlogUrl], [t0].[OpenDate] AS [BlogOpenDate], [t1].[Title], [t1].[PostStatus], [t1].[ReleaseTime]
    FROM [CALC].[T_Author] AS [t]
    INNER JOIN [CALC].[T_Blog] AS [t0] ON [t].[Id] = [t0].[AuthorId]
    LEFT JOIN [CALC].[T_Post] AS [t1] ON [t0].[Id] = [t1].[BlogId]
    ORDER BY [t].[Name], [t1].[Title] DESC
 */
var resultList =
    await
    (from author in EFDbContext.Authors
     join blog in EFDbContext.Blogs on author.Id equals blog.AuthorId
     join post in EFDbContext.Posts on blog.Id equals post.BlogId into rPosts
     from rPost in rPosts.DefaultIfEmpty()
     orderby author.Name, rPost.Title descending
     select new
     {
         AuthorId = author.Id,
         AuthorName = author.Name,
         BlogUrl = blog.Url,
         BlogOpenDate = blog.OpenDate,
         Title = rPost.Title,
         PostStatus = rPost.PostStatus,
         ReleaseTime = rPost.ReleaseTime
     }).ToListAsync();

//4&gt;on&#x6761;&#x4EF6;&#x4E0D;&#x6B62;&#x4E00;&#x4E2A;, &#x7528;&#x533F;&#x540D;&#x5BF9;&#x8C61;
var query = from photo in context.Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PersonPhoto</span><span class="token punctuation">&gt;</span></span>()
            join person in context.Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span>()
            on new { Id = (int?)photo.PersonPhotoId, photo.Caption }
            equals new { Id = person.PhotoId, Caption = &quot;SN&quot; }
            select new { person, photo };

//5&gt;left join &#x53E6;&#x4E00;&#x79CD;&#x5199;&#x6CD5;
var query2 = from b in context.Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>()
             from p in context.Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>().Where(p =&gt; b.BlogId == p.BlogId).DefaultIfEmpty()
             select new { b, p };
</code></pre>
<h3 id="7-5&#x5206;&#x7EC4;&#x67E5;&#x8BE2;group-by"><a name="7-5&#x5206;&#x7EC4;&#x67E5;&#x8BE2;group-by" class="anchor-navigation-ex-anchor" href="#7-5&#x5206;&#x7EC4;&#x67E5;&#x8BE2;group-by"><i class="fa fa-link" aria-hidden="true"></i></a>7-5&gt;&#x5206;&#x7EC4;&#x67E5;&#x8BE2;(group by)</h3>
<pre class="language-"><code class="lang-C#">//1&gt;EF&#x7684;Goup by&#x540E;&#x7684;&#x7ED3;&#x679C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x805A;&#x5408;&#x64CD;&#x4F5C;(Average, Count, LongCount, Max, Min, Sum), &#x65E0;&#x6CD5;&#x67E5;&#x8BE2;&#x5206;&#x7EC4;&#x7684;&#x660E;&#x7EC6;(&#x62A5;&#x9519;), &#x53EF;&#x4EE5;&#x4F7F;&#x7528;AsEnumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x64CD;&#x4F5C;
var resultList =
    await
        (from author in EFDbContext.Authors
         group author by author.Code into g
         select new
         {
             GroupKey = g.Key,
             Count = g.Count()
         }).ToListAsync();

//2&gt;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#x64CD;&#x4F5C;
var resultList =
        (from author in EFDbContext.Authors.AsEnumerable()
         group author by author.Code / 100 into g
         select new
         {
             GroupKey = g.Key,
             List = g.ToList()
         }).ToList();
</code></pre>
<h3 id="7-6&#x539F;&#x751F;sql&#x67E5;&#x8BE2;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x53CA;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;"><a name="7-6&#x539F;&#x751F;sql&#x67E5;&#x8BE2;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x53CA;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;" class="anchor-navigation-ex-anchor" href="#7-6&#x539F;&#x751F;sql&#x67E5;&#x8BE2;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x53CA;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;"><i class="fa fa-link" aria-hidden="true"></i></a>7-6&gt;&#x539F;&#x751F;SQL&#x67E5;&#x8BE2;(&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x53CA;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;)</h3>
<p>*&#x4F7F;&#x7528;&#x539F;&#x751F;<code>SQL</code>&#x67E5;&#x8BE2;&#x65F6;&#x9700;&#x6CE8;&#x610F;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x9650;&#x5236;:</p>
<ul>
<li><p>SQL &#x67E5;&#x8BE2;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x5B9E;&#x4F53;&#x7C7B;&#x578B;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p>&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;&#x5217;&#x540D;&#x5FC5;&#x987B;&#x4E0E;&#x5C5E;&#x6027;&#x6620;&#x5C04;&#x5230;&#x7684;&#x5217;&#x540D;&#x79F0;&#x5339;&#x914D;&#x3002;</p>
</li>
<li>SQL &#x67E5;&#x8BE2;&#x4E0D;&#x80FD;&#x5305;&#x542B;&#x5173;&#x8054;&#x6570;&#x636E;&#x3002;</li>
</ul>
<pre class="language-"><code class="lang-C#">//&#x6267;&#x884C;&#x666E;&#x901A;&#x67E5;&#x8BE2;, &#x4F7F;&#x7528;&#x5360;&#x4F4D;&#x7B26;&#x5B9E;&#x73B0;&#x53C2;&#x6570;&#x5316;&#x67E5;&#x8BE2;
var queryParam1 = &quot;Name_8%&quot;;
var schema = EFDbContext.Schema;
var resultList =
   await EFDbContext.Authors.FromSqlRaw(@&quot;select top 10 T_Author.*
from CALC.T_Author as T_Author
inner join CALC.T_Blog as T_Blog
on T_Author.Id = T_Blog.AuthorId
where exists
(
    select T_Post.Id
    from CALC.T_Post as T_Post
    where T_Post.BlogId = T_Blog.Id
    and exists
    (
        select T_PostCollects.Id
        from CALC.T_PostCollects as T_PostCollects
        where T_PostCollects.PostId = T_Post.Id
    )
    and exists
    (
        select T_PostComments.Id
        from CALC.T_PostComments as T_PostComments
        where T_PostComments.PostId = T_Post.Id
    )
)
and T_Author.Name like {0}&quot;, queryParam1)
   .AsNoTrackingWithIdentityResolution()
   .Include(a =&gt; a.Blog.Posts)
   .ToListAsync();

//&#x4F7F;&#x7528;@&#x53C2;&#x6570;&#x540D;&#x5B9E;&#x73B0;&#x53C2;&#x6570;&#x5316;&#x67E5;&#x8BE2;
var queryParam1 = new SqlParameter(parameterName: &quot;@AuthorName&quot;, value: &quot;Name_8%&quot;);
var schema = EFDbContext.Schema;
var resultList = await EFDbContext.Authors.FromSqlRaw(@&quot;select top 10 T_Author.*
from CALC.T_Author as T_Author
inner join CALC.T_Blog as T_Blog
on T_Author.Id = T_Blog.AuthorId
where exists
(
    select T_Post.Id
    from CALC.T_Post as T_Post
    where T_Post.BlogId = T_Blog.Id
    and exists
    (
        select T_PostCollects.Id
        from CALC.T_PostCollects as T_PostCollects
        where T_PostCollects.PostId = T_Post.Id
    )
    and exists
    (
        select T_PostComments.Id
        from CALC.T_PostComments as T_PostComments
        where T_PostComments.PostId = T_Post.Id
    )
)
and T_Author.Name like @AuthorName&quot;, queryParam1)
                   .AsNoTrackingWithIdentityResolution()
                   .Include(a =&gt; a.Blog.Posts)
                   .ToListAsync();

//&#x6267;&#x884C;&#x666E;&#x901A;&#x67E5;&#x8BE2;, &#x4F7F;&#x7528;&#x6A21;&#x677F;&#x63D2;&#x503C;&#x5B9E;&#x73B0;&#x53C2;&#x6570;&#x5316;&#x67E5;&#x8BE2;, &#x4E5F;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x8FD4;&#x56DE;&#x8868;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;
var user = &quot;johndoe&quot;;
var blogs = context.Blogs
    .FromSqlInterpolated($&quot;EXECUTE dbo.GetMostPopularBlogsForUser {user}&quot;)
    .ToList();

//&#x6267;&#x884C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;
var user = &quot;johndoe&quot;;
var blogs = context.Blogs
    .FromSqlRaw(&quot;EXECUTE dbo.GetMostPopularBlogsForUser {0}&quot;, user)
    .ToList();

//&#x6DF7;&#x5408;LINQ&#x5199;&#x6CD5;(&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;LINQ&#x7EC4;&#x5408;&#x67E5;&#x8BE2;, &#x82E5;&#x9700;&#x8981;, &#x53EF;&#x5728;FromSqlInterpolated&#x540E;&#x4F7F;&#x7528;AsEnumerable/AsAsyncEnumerable, &#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x4F7F;&#x7528;)
var searchTerm = &quot;Lorem ipsum&quot;;
var blogs = context.Blogs
    .FromSqlInterpolated($&quot;SELECT * FROM dbo.SearchBlogs({searchTerm})&quot;)
    .Where(b =&gt; b.Rating &gt; 3)
    .OrderByDescending(b =&gt; b.Rating)
    .AsNoTracking()
    .ToList();

//&#x6267;&#x884C;&#x539F;&#x751F;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;
//&#x4F7F;&#x7528;&#x539F;&#x751F;sql&#x6267;&#x884C;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;
var paramArr = new SqlParameter[]
{
    new SqlParameter(parameterName:&quot;@AuthorName&quot;,value:&quot;Name_8%&quot;),
};
var sql = string.Format(@&quot;delete
from CALC.T_PostComments
where exists
(
    select T_Author.Id
    from CALC.T_Author as T_Author
    inner join CALC.T_Blog as T_Blog
    on T_Blog.AuthorId = T_Author.Id
    inner join CALC.T_Post as T_Post
    on T_Post.BlogId = T_Blog.Id
    where T_Author.Name like @AuthorName
    and T_PostComments.PostId = T_Post.Id
)&quot;);
var removeCount = await EFDbContext.Database.ExecuteSqlRawAsync(sql, paramArr, cancellationToken);
//&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6A21;&#x677F;&#x5185;&#x67E5;&#x503C;&#x65B9;&#x5F0F; EFDbContext.Database.ExecuteSqlInterpolatedAsync
</code></pre>
<h3 id="7-7&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6620;&#x5C04;"><a name="7-7&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6620;&#x5C04;" class="anchor-navigation-ex-anchor" href="#7-7&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6620;&#x5C04;"><i class="fa fa-link" aria-hidden="true"></i></a>7-7&gt;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6620;&#x5C04;</h3>
<h4 id="7-7-1&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6807;&#x91CF;&#x51FD;&#x6570;"><a name="7-7-1&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6807;&#x91CF;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#7-7-1&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6807;&#x91CF;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>7-7-1&gt;&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6807;&#x91CF;&#x51FD;&#x6570;</h4>
<pre class="language-"><code class="lang-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dbo<span class="token punctuation">.</span>CommentedPostCountForBlog<span class="token punctuation">(</span><span class="token variable">@id</span> <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">int</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">RETURN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token keyword">FROM</span> <span class="token punctuation">[</span>Posts<span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span>
        <span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>BlogId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">@id</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>
            <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
            <span class="token keyword">FROM</span> <span class="token punctuation">[</span>Comments<span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span>
            <span class="token keyword">WHERE</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PostId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PostId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre>
<pre class="language-"><code class="lang-C#">public int ActivePostCountForBlog(int blogId)
    =&gt; throw new NotSupportedException();

modelBuilder.HasDbFunction(typeof(BloggingContext).GetMethod(nameof(ActivePostCountForBlog), new[] { typeof(int) }))
    .HasName(&quot;CommentedPostCountForBlog&quot;);

//&#x8C03;&#x7528;&#x51FD;&#x6570;
/*
    SELECT [b].[BlogId], [b].[Rating], [b].[Url]
    FROM [Blogs] AS [b]
    WHERE [dbo].[CommentedPostCountForBlog]([b].[BlogId]) &gt; 1
*/
var query1 = from b in context.Blogs
             where context.ActivePostCountForBlog(b.BlogId) &gt; 1
             select b;
</code></pre>
<h4 id="7-7-2&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8868;&#x503C;&#x51FD;&#x6570;"><a name="7-7-2&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8868;&#x503C;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#7-7-2&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8868;&#x503C;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>7-7-2&gt;&#x6620;&#x5C04;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8868;&#x503C;&#x51FD;&#x6570;</h4>
<pre class="language-"><code class="lang-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dbo<span class="token punctuation">.</span>PostsWithPopularComments<span class="token punctuation">(</span><span class="token variable">@likeThreshold</span> <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">TABLE</span>
<span class="token keyword">AS</span>
<span class="token keyword">RETURN</span>
<span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PostId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>BlogId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Content<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Rating<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Title<span class="token punctuation">]</span>
    <span class="token keyword">FROM</span> <span class="token punctuation">[</span>Posts<span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span>
    <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token keyword">FROM</span> <span class="token punctuation">[</span>Comments<span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span>
        <span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PostId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PostId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Likes<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token variable">@likeThreshold</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token punctuation">)</span>
</code></pre>
<pre class="language-"><code class="lang-C#">public IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span> PostsWithPopularComments(int likeThreshold)
    =&gt; FromExpression(() =&gt; PostsWithPopularComments(likeThreshold));

modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>().ToTable(&quot;Posts&quot;);
modelBuilder.HasDbFunction(typeof(BloggingContext).GetMethod(nameof(PostsWithPopularComments), new[] { typeof(int) }));

//&#x8C03;&#x7528;
/*
    SELECT [p].[PostId], [p].[BlogId], [p].[Content], [p].[Rating], [p].[Title]
    FROM [dbo].[PostsWithPopularComments](@likeThreshold) AS [p]
    ORDER BY [p].[Rating]
*/
var likeThreshold = 3;
var query5 = from p in context.PostsWithPopularComments(likeThreshold)
             orderby p.Rating
             select p;
</code></pre>
<h4 id="7-7-3&#x5176;&#x4ED6;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x590D;&#x6742;&#x7684;&#x529F;&#x80FD;"><a name="7-7-3&#x5176;&#x4ED6;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x590D;&#x6742;&#x7684;&#x529F;&#x80FD;" class="anchor-navigation-ex-anchor" href="#7-7-3&#x5176;&#x4ED6;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x590D;&#x6742;&#x7684;&#x529F;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>7-7-3&gt;&#x5176;&#x4ED6;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x590D;&#x6742;&#x7684;&#x529F;&#x80FD;</h4>
<p><a href="https://docs.microsoft.com/zh-cn/ef/core/querying/user-defined-function-mapping" target="_blank">https://docs.microsoft.com/zh-cn/ef/core/querying/user-defined-function-mapping</a></p>
<h3 id="7-8&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;hasqueryfilter"><a name="7-8&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;hasqueryfilter" class="anchor-navigation-ex-anchor" href="#7-8&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;hasqueryfilter"><i class="fa fa-link" aria-hidden="true"></i></a>7-8&gt;&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;(HasQueryFilter)</h3>
<p>*&#x5E38;&#x7528;&#x4E8E;&#x4E0B;&#x9762;&#x4E24;&#x79CD;&#x573A;&#x666F;</p>
<ul>
<li><p>&#x5047;&#x5220;&#x9664;: <code>IsDeleted=0</code></p>
</li>
<li><p>&#x591A;&#x79DF;&#x6237;(&#x540C;&#x4E00;&#x5F20;&#x8868;, &#x4F7F;&#x7528;&#x79DF;&#x6237;Id&#x7684;&#x6A21;&#x5F0F;): <code>TenantId=@TenantId</code></p>
<p><strong>&#x591A;&#x79DF;&#x6237;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;(&#x5047;&#x60F3;, &#x672A;&#x9A8C;&#x8BC1;):</strong></p>
</li>
</ul>
<pre class="language-"><code class="lang-C#">public class Blog
{
    public int BlogId { get; set; }
    public string Name { get; set; }
    public string Url { get; set; }

    public List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span> Posts { get; set; }
}

//&#x914D;&#x7F6E;&#x5168;&#x5C40;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>().HasQueryFilter(b =&gt; EF.Property<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(b, &quot;TenantId&quot;) == _tenantId);

//&#x5B9E;&#x4F53;&#x4FDD;&#x5B58;&#x65F6;, &#x5229;&#x7528;AOP&#x62E6;&#x622A;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;, &#x5199;&#x5165;&#x5F71;&#x5B50;&#x5C5E;&#x6027;TenantId&#x7684;&#x503C;
EFDbContext.Entry(blog).Property(&quot;TenantId&quot;).CurrentValue = systemConfigOption.Value?.TenantId;
</code></pre>
<p>*&#x4E3A;&#x6307;&#x5B9A;&#x8868;&#x6CE8;&#x518C;&#x67E5;&#x8BE2;&#x7B5B;&#x9009;&#x5668;</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>().HasQueryFilter(b =&gt; EF.Property<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(b, &quot;_tenantId&quot;) == _tenantId);
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>().HasQueryFilter(p =&gt; !p.IsDeleted);
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x67E5;&#x8BE2;&#x8FC7;&#x6EE4;(IsDeleted=0)
/*
SELECT [t0].[Id], [t0].[AddIP], [t0].[AddTime], [t0].[AddUserId], 
    [t0].[Address], [t0].[BirthDate], [t0].[Code], [t0].[CompanyName], 
    [t0].[Email], [t0].[Hometown], [t0].[IsDeleted], 
    [t0].[LastUpdateIP], [t0].[LastUpdateTime], [t0].[LastUpdateUserId], [t0].[Name], [t0].[Tel], [t0].[Title],
    [t0].[Token], [t1].[Id], [t1].[AddIP], [t1].[AddTime], [t1].[AddUserId], [t1].[AuthorId], [t1].[LastUpdateIP], 
    [t1].[LastUpdateTime], [t1].[LastUpdateUserId], [t1].[OpenDate], [t1].[Token], [t1].[Url], [t2].[Id], 
    [t2].[AddIP], [t2].[AddTime], [t2].[AddUserId], [t2].[BlogId], [t2].[Content], [t2].[IsDelete], 
    [t2].[LastUpdateIP], [t2].[LastUpdateTime], [t2].[LastUpdateUserId], [t2].[PostStatus],
    [t2].[ReleaseTime], [t2].[Title], [t2].[Token]
FROM (
    SELECT TOP(10) [t].[Id], [t].[AddIP], [t].[AddTime], 
    [t].[AddUserId], [t].[Address], [t].[BirthDate], [t].[Code], 
    [t].[CompanyName], [t].[Email], [t].[Hometown], [t].[IsDeleted],
    [t].[LastUpdateIP], [t].[LastUpdateTime],
    [t].[LastUpdateUserId],
    [t].[Name], [t].[Tel], [t].[Title], [t].[Token]
    FROM [CALC].[T_Author] AS [t]
    WHERE [t].[IsDeleted] &lt;&gt; CAST(1 AS bit)
    ORDER BY [t].[Name] DESC, [t].[Id]
) AS [t0]
LEFT JOIN [CALC].[T_Blog] AS [t1] ON [t0].[Id] = [t1].[AuthorId]
LEFT JOIN [CALC].[T_Post] AS [t2] ON [t1].[Id] = [t2].[BlogId]
ORDER BY [t0].[Name] DESC, [t0].[Id], [t1].[Id], [t2].[Id]
*/
var resultList =
    await EFDbContext.Authors
        .Include(a =&gt; a.Blog.Posts)
        .AsNoTrackingWithIdentityResolution()
        .OrderByDescending(a =&gt; a.Name)
        .ThenBy(a =&gt; a.Code)
        .Take(10)
        .ToListAsync(cancellationToken);
</code></pre>
<p>*&#x67E5;&#x8BE2;&#x8FC7;&#x6EE4;&#x5668;&#x8FDB;&#x9636;&#x7528;&#x6CD5;, &#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x5728;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x4E0A;</p>
<pre class="language-"><code class="lang-C#">modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>().HasQueryFilter(b =&gt; b.Posts.Count &gt; 0);
//&#x82E5;&#x914D;&#x7F6E;&#x4E86;&#x6B63;&#x53CD;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x4E14;&#x5BF9;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x503C;&#x505A;&#x4E86;&#x5168;&#x5C40;&#x8FC7;&#x6EE4;, &#x90A3;&#x4E48;&#x6B63;&#x53CD;&#x5411;&#x7684;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x90FD;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x4E0A;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;, &#x907F;&#x514D;LINQ&#x67E5;&#x8BE2;&#x6CA1;&#x6709;&#x4F7F;&#x7528;Include, &#x5BFC;&#x81F4;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x4E0D;&#x6B63;&#x786E;.
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span>().HasQueryFilter(b =&gt; b.Url.Contains(&quot;fish&quot;));
modelBuilder.Entity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>().HasQueryFilter(p =&gt; p.Blog.Url.Contains(&quot;fish&quot;));
</code></pre>
<p><strong>*&#x5728;&#x67E5;&#x8BE2;&#x4E2D;&#x7981;&#x7528;&#x7B5B;&#x9009;&#x5668;</strong></p>
<pre class="language-"><code class="lang-C#">blogs = db.Blogs
    .Include(b =&gt; b.Posts)
    .IgnoreQueryFilters()
    .ToList();
</code></pre>
<h3 id="7-9&#x751F;&#x6210;&#x7684;sql&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;"><a name="7-9&#x751F;&#x6210;&#x7684;sql&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;" class="anchor-navigation-ex-anchor" href="#7-9&#x751F;&#x6210;&#x7684;sql&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;"><i class="fa fa-link" aria-hidden="true"></i></a>7-9&gt;&#x751F;&#x6210;&#x7684;SQL&#x6DFB;&#x52A0;&#x6CE8;&#x91CA;</h3>
<p>*&#x65B9;&#x4FBF;&#x5728;&#x4F17;&#x591A;&#x7684;sql&#x4E2D;&#x5B9A;&#x4F4D;&#x76EE;&#x6807;sql(Tag&#x652F;&#x6301;&#x591A;&#x884C;&#x6587;&#x672C;)</p>
<pre class="language-"><code class="lang-C#">private IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> TaskLimitCount<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> resultSource, int count = 10) =&gt; resultSource?.Take(count).TagWith(&quot;Tag in TaskLimitCount.&quot;);

private IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Author</span><span class="token punctuation">&gt;</span></span> GetAuthors(int code = 0) =&gt;
     EFDbContext.Authors.Where(a =&gt; a.Code &gt;= code).OrderByDescending(a =&gt; a.Name).TagWith(&quot;Tag in GetAuthors.&quot;);

/*
-- Tag in GetAuthors.

-- Tag in TaskLimitCount.

SELECT TOP(@__p_1) 
[t].[Id], [t].[AddIP], [t].[AddTime], [t].[AddUserId], 
[t].[Address], [t].[BirthDate], [t].[Code], 
[t].[CompanyName], [t].[Email], [t].[Hometown], 
[t].[IsDeleted], [t].[LastUpdateIP], 
[t].[LastUpdateTime], [t].[LastUpdateUserId], 
[t].[Name], [t].[Tel], 
[t].[Title], [t].[Token]
FROM [CALC].[T_Author] AS [t]
WHERE ([t].[IsDeleted] &lt;&gt; CAST(1 AS bit)) AND ([t].[Code] &gt;= @__p_0)
ORDER BY [t].[Name] DESC
*/
var resultList = await TaskLimitCount(GetAuthors(800), 15).ToListAsync();
</code></pre>
<h3 id="7-10null&#x5224;&#x65AD;"><a name="7-10null&#x5224;&#x65AD;" class="anchor-navigation-ex-anchor" href="#7-10null&#x5224;&#x65AD;"><i class="fa fa-link" aria-hidden="true"></i></a>7-10&gt;null&#x5224;&#x65AD;</h3>
<p>*&#x5C3D;&#x91CF;&#x7528;<code>==</code>&#x6765;&#x66FF;&#x6362;<code>!=</code></p>
<p>*&#x5BF9;&#x4E8E;&#x53EF;&#x7A7A;&#x5217;&#x7684;&#x5224;&#x65AD;, &#x5C3D;&#x91CF;&#x5148;&#x5BF9;&#x8BE5;&#x5217;&#x8FDB;&#x884C;null&#x5224;&#x65AD;(entity.column1 != null)</p>
<pre class="language-"><code class="lang-C#">var query2 = context.Entities.Where(
    e =&gt; e.String1 != null &amp;&amp; e.String2 != null &amp;&amp; (e.String1 != e.String2 || e.String1.Length == e.String2.Length));
</code></pre>
<h3 id="7-11&#x67E5;&#x8BE2;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;"><a name="7-11&#x67E5;&#x8BE2;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;" class="anchor-navigation-ex-anchor" href="#7-11&#x67E5;&#x8BE2;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>7-11&gt;&#x67E5;&#x8BE2;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</h3>
<ol>
<li>LINQ &#x67E5;&#x8BE2;&#x7531; Entity Framework Core &#x5904;&#x7406;&#xFF0C;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x5DF2;&#x51C6;&#x5907;&#x597D;&#x7531;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5904;&#x7406;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;<ul>
<li>&#x7ED3;&#x679C;&#x4F1A;&#x88AB;&#x7F13;&#x5B58;&#xFF0C;&#x4EE5;&#x4FBF;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x65F6;&#x65E0;&#x9700;&#x8FDB;&#x884C;&#x6B64;&#x5904;&#x7406;</li>
</ul>
</li>
<li>&#x7ED3;&#x679C;&#x4F1A;&#x4F20;&#x9012;&#x5230;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;<ul>
<li>&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x786E;&#x5B9A;&#x53EF;&#x4EE5;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8BC4;&#x4F30;&#x67E5;&#x8BE2;&#x7684;&#x54EA;&#x4E9B;&#x90E8;&#x5206;</li>
<li>&#x67E5;&#x8BE2;&#x7684;&#x8FD9;&#x4E9B;&#x90E8;&#x5206;&#x4F1A;&#x8F6C;&#x6362;&#x4E3A;&#x7279;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x8A00;&#xFF08;&#x4F8B;&#x5982;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x7684; SQL&#xFF09;</li>
<li>&#x67E5;&#x8BE2;&#x4F1A;&#x53D1;&#x9001;&#x5230;&#x6570;&#x636E;&#x5E93;&#x5E76;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;&#xFF08;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B9E;&#x4F53;&#x5B9E;&#x4F8B;&#x4E2D;&#x7684;&#xFF09;</li>
</ul>
</li>
<li>&#x5BF9;&#x4E8E;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x9879;<ul>
<li>&#x5982;&#x679C;&#x8BE5;&#x67E5;&#x8BE2;&#x662F;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;&#xFF0C;EF &#x4F1A;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x662F;&#x5426;&#x8868;&#x793A;&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F8B;&#x5185;&#x66F4;&#x6539;&#x8DDF;&#x8E2A;&#x5668;&#x4E2D;&#x7684;&#x73B0;&#x6709;&#x5B9E;&#x4F53;<ul>
<li>&#x5982;&#x679C;&#x662F;&#xFF0C;&#x5219;&#x4F1A;&#x8FD4;&#x56DE;&#x73B0;&#x6709;&#x5B9E;&#x4F53;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x4F1A;&#x521B;&#x5EFA;&#x65B0;&#x5B9E;&#x4F53;&#x3001;&#x8BBE;&#x7F6E;&#x66F4;&#x6539;&#x8DDF;&#x8E2A;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x65B0;&#x5B9E;&#x4F53;</li>
</ul>
</li>
<li>&#x5982;&#x679C;&#x8BE5;&#x67E5;&#x8BE2;&#x662F;&#x975E;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;&#xFF0C;&#x5C06;&#x59CB;&#x7EC8;&#x521B;&#x5EFA;&#x5E76;&#x8FD4;&#x56DE;&#x65B0;&#x5B9E;&#x4F53;</li>
</ul>
</li>
</ol>
<h3 id="7-12linq&#x7528;&#x6CD5;&#x5927;&#x5168;"><a name="7-12linq&#x7528;&#x6CD5;&#x5927;&#x5168;" class="anchor-navigation-ex-anchor" href="#7-12linq&#x7528;&#x6CD5;&#x5927;&#x5168;"><i class="fa fa-link" aria-hidden="true"></i></a>7-12&gt;LINQ&#x7528;&#x6CD5;&#x5927;&#x5168;</h3>
<h4 id="firstfirstordefault-&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;-&#x5176;&#x5B9E;&#x8D28;&#x5C31;&#x662F;&#x5728;sql&#x8BED;&#x53E5;&#x4E2D;&#x52A0;top-1"><a name="firstfirstordefault-&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;-&#x5176;&#x5B9E;&#x8D28;&#x5C31;&#x662F;&#x5728;sql&#x8BED;&#x53E5;&#x4E2D;&#x52A0;top-1" class="anchor-navigation-ex-anchor" href="#firstfirstordefault-&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;-&#x5176;&#x5B9E;&#x8D28;&#x5C31;&#x662F;&#x5728;sql&#x8BED;&#x53E5;&#x4E2D;&#x52A0;top-1"><i class="fa fa-link" aria-hidden="true"></i></a><code>First/FirstOrDefault</code>: &#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;, &#x5176;&#x5B9E;&#x8D28;&#x5C31;&#x662F;&#x5728;SQL&#x8BED;&#x53E5;&#x4E2D;&#x52A0;TOP (1).</h4>
<h4 id="lastlastordefault-&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;-&#x9700;&#x8981;&#x7ED3;&#x5408;linq&#x7684;orderby&#x4F7F;&#x7528;-&#x5426;&#x5219;&#x62A5;&#x9519;"><a name="lastlastordefault-&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;-&#x9700;&#x8981;&#x7ED3;&#x5408;linq&#x7684;orderby&#x4F7F;&#x7528;-&#x5426;&#x5219;&#x62A5;&#x9519;" class="anchor-navigation-ex-anchor" href="#lastlastordefault-&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;-&#x9700;&#x8981;&#x7ED3;&#x5408;linq&#x7684;orderby&#x4F7F;&#x7528;-&#x5426;&#x5219;&#x62A5;&#x9519;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Last/LastOrDefault</code>: &#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;, &#x9700;&#x8981;&#x7ED3;&#x5408;LINQ&#x7684;OrderBy&#x4F7F;&#x7528;, &#x5426;&#x5219;&#x62A5;&#x9519;.</h4>
<h4 id="single-&#x8FD4;&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;-&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6216;&#x8FD4;&#x56DE;&#x591A;&#x6761;&#x8BB0;&#x5F55;-&#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;"><a name="single-&#x8FD4;&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;-&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6216;&#x8FD4;&#x56DE;&#x591A;&#x6761;&#x8BB0;&#x5F55;-&#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;" class="anchor-navigation-ex-anchor" href="#single-&#x8FD4;&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;-&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6216;&#x8FD4;&#x56DE;&#x591A;&#x6761;&#x8BB0;&#x5F55;-&#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Single</code>: &#x8FD4;&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;, &#x5982;&#x679C;&#x6CA1;&#x6709;&#x6216;&#x8FD4;&#x56DE;&#x591A;&#x6761;&#x8BB0;&#x5F55;, &#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;.</h4>
<h4 id="singleordefault-&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;-&#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;-&#x5219;&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x503C;-&#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x5143;&#x7D20;-&#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;"><a name="singleordefault-&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;-&#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;-&#x5219;&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x503C;-&#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x5143;&#x7D20;-&#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;" class="anchor-navigation-ex-anchor" href="#singleordefault-&#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;-&#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;-&#x5219;&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x503C;-&#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x5143;&#x7D20;-&#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;"><i class="fa fa-link" aria-hidden="true"></i></a><code>SingleOrDefault</code>: &#x56DE;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x8BB0;&#x5F55;, &#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;, &#x5219;&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x503C;, &#x5982;&#x679C;&#x8BE5;&#x5E8F;&#x5217;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x5143;&#x7D20;, &#x5219;&#x5F15;&#x53D1;&#x5F02;&#x5E38;.</h4>
<h4 id="elementat-&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x7D22;&#x5F15;&#x8D85;&#x8FC7;&#x96C6;&#x5408;&#x957F;&#x5EA6;&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;"><a name="elementat-&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x7D22;&#x5F15;&#x8D85;&#x8FC7;&#x96C6;&#x5408;&#x957F;&#x5EA6;&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;" class="anchor-navigation-ex-anchor" href="#elementat-&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x7D22;&#x5F15;&#x8D85;&#x8FC7;&#x96C6;&#x5408;&#x957F;&#x5EA6;&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;"><i class="fa fa-link" aria-hidden="true"></i></a><code>ElementAt</code>: &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x7D22;&#x5F15;&#x8D85;&#x8FC7;&#x96C6;&#x5408;&#x957F;&#x5EA6;&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</h4>
<p><code>ElementAtOrDefault</code>: &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x7D22;&#x5F15;&#x8D85;&#x8FC7;&#x96C6;&#x5408;&#x957F;&#x5EA6;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x5143;&#x7D20;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x4E0D;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</p>
<pre class="language-"><code class="lang-C#">//&#x8D85;&#x51FA;&#x7D22;&#x5F15;&#x62A5;&#x9519;
var d2 = pList.ElementAt(3);
//&#x8D85;&#x51FA;&#x7D22;&#x5F15;&#xFF0C;&#x4E0D;&#x62A5;&#x9519;&#xFF0C;&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3A;null
var d3 = pList.ElementAtOrDefault(3);
</code></pre>
<h4 id="distinct-&#x53BB;&#x91CD;"><a name="distinct-&#x53BB;&#x91CD;" class="anchor-navigation-ex-anchor" href="#distinct-&#x53BB;&#x91CD;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Distinct</code>: &#x53BB;&#x91CD;.</h4>
<h4 id="countlongcount-&#x6C42;&#x4E2A;&#x6570;"><a name="countlongcount-&#x6C42;&#x4E2A;&#x6570;" class="anchor-navigation-ex-anchor" href="#countlongcount-&#x6C42;&#x4E2A;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Count</code>/<code>LongCount</code>: &#x6C42;&#x4E2A;&#x6570;.</h4>
<pre class="language-"><code class="lang-C#">var count= db.Customers.Count();
var count=db.Customers.Count(c=&gt;c.age&gt;20);
//&#x7B49;&#x4EF7;&#x4E8E;
var count=db.Customers.Where.(c=&gt;c.age&gt;20).Count();
</code></pre>
<h4 id="sum-&#x6C42;&#x548C;"><a name="sum-&#x6C42;&#x548C;" class="anchor-navigation-ex-anchor" href="#sum-&#x6C42;&#x548C;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Sum</code>: &#x6C42;&#x548C;.</h4>
<pre class="language-"><code class="lang-C#">var q=db.Product.Select(o=&gt;o.Freight).Sum();
var q=db.Product.Sum(o=&gt;o.Freight);
</code></pre>
<h4 id="min-&#x6700;&#x5C0F;&#x503C;"><a name="min-&#x6700;&#x5C0F;&#x503C;" class="anchor-navigation-ex-anchor" href="#min-&#x6700;&#x5C0F;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Min</code>: &#x6700;&#x5C0F;&#x503C;.</h4>
<pre class="language-"><code class="lang-C#">var q=db.Products.Select(p=&gt;p.unitPrice).Min();
var q=db.Products.Min(p=&gt;p.unitPrice);
</code></pre>
<h4 id="max-&#x6700;&#x5927;&#x503C;"><a name="max-&#x6700;&#x5927;&#x503C;" class="anchor-navigation-ex-anchor" href="#max-&#x6700;&#x5927;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Max</code>: &#x6700;&#x5927;&#x503C;.</h4>
<pre class="language-"><code class="lang-C#">var q=db.Products.Select(p=&gt;p.unitPrice).Max();
var q=db.Products.Max(p=&gt;p.unitPrice);
</code></pre>
<h4 id="average-&#x6C42;&#x5E73;&#x5747;"><a name="average-&#x6C42;&#x5E73;&#x5747;" class="anchor-navigation-ex-anchor" href="#average-&#x6C42;&#x5E73;&#x5747;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Average</code>: &#x6C42;&#x5E73;&#x5747;.</h4>
<pre class="language-"><code class="lang-C#">var q=db.Products.Select(p=&gt;p.unitPrice).Average();
var q=db.Products.Average(p=&gt;p.unitPrice);
</code></pre>
<h4 id="orderby-&#x6392;&#x5E8F;"><a name="orderby-&#x6392;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#orderby-&#x6392;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a><code>orderby</code>: &#x6392;&#x5E8F;.</h4>
<pre class="language-"><code class="lang-C#">//&#x5355;&#x5B57;&#x6BB5;&#x6392;&#x5E8F;
var q = from p in db.Products
        orderby p.unitPirce
        select p;

//&#x591A;&#x5B57;&#x6BB5;&#x6392;&#x5E8F;
var q = from c in db.Customers
        orderby c.City descending, c.Name
        select c;

//&#x591A;&#x5B57;&#x6BB5;&#x6392;&#x5E8F;
var resultList = await EFDbContext.Authors
                .OrderByDescending(a =&gt; a.Name)
                .ThenBy(a =&gt; a.AddTime)
                .Take(5)
                .ToListAsync();
</code></pre>
<h4 id="take-&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;top-n"><a name="take-&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;top-n" class="anchor-navigation-ex-anchor" href="#take-&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;top-n"><i class="fa fa-link" aria-hidden="true"></i></a><code>Take</code>: &#x83B7;&#x53D6;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;(top N)</h4>
<h4 id="takewhile-&#x76F4;&#x5230;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x5C31;&#x505C;&#x6B62;&#x83B7;&#x53D6;-ef&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;-&#x9700;&#x8981;&#x4F7F;&#x7528;asenumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;"><a name="takewhile-&#x76F4;&#x5230;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x5C31;&#x505C;&#x6B62;&#x83B7;&#x53D6;-ef&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;-&#x9700;&#x8981;&#x4F7F;&#x7528;asenumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;" class="anchor-navigation-ex-anchor" href="#takewhile-&#x76F4;&#x5230;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x5C31;&#x505C;&#x6B62;&#x83B7;&#x53D6;-ef&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;-&#x9700;&#x8981;&#x4F7F;&#x7528;asenumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a><code>TakeWhile</code>: &#x76F4;&#x5230;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x5C31;&#x505C;&#x6B62;&#x83B7;&#x53D6;. <strong>EF&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;, &#x9700;&#x8981;&#x4F7F;&#x7528;AsEnumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;.</strong></h4>
<pre class="language-"><code class="lang-c#">var resultList = EFDbContext.Authors.AsEnumerable()
                .TakeWhile(a =&gt; a.Code &lt; 10)
                .ToList();
</code></pre>
<h4 id="skip-&#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;-&#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;"><a name="skip-&#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;-&#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#skip-&#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;-&#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Skip</code>: &#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;, &#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;.</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT 
        [t].[Id], [t].[AddIP], [t].[AddTime], [t].[AddUserId], [t].[Address], [t].[BirthDate], 
        [t].[Code], [t].[CompanyName], [t].[Email], [t].[Hometown], [t].[IsDeleted], [t].[LastUpdateIP], 
        [t].[LastUpdateTime], [t].[LastUpdateUserId], [t].[Name], [t].[Tel], [t].[Title], [t].[Token]
    FROM [CALC].[T_Author] AS [t]
    WHERE [t].[IsDeleted] &lt;&gt; CAST(1 AS bit)
    ORDER BY (SELECT 1)
    OFFSET 100 ROWS
*/
var resultList = await EFDbContext.Authors
                .Skip(100)
                .ToListAsync();
</code></pre>
<h4 id="skipwhile-&#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;-&#x76F4;&#x5230;&#x7B26;&#x5408;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x4E3A;&#x6B62;-&#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;-ef&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;-&#x9700;&#x8981;&#x4F7F;&#x7528;asenumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;"><a name="skipwhile-&#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;-&#x76F4;&#x5230;&#x7B26;&#x5408;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x4E3A;&#x6B62;-&#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;-ef&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;-&#x9700;&#x8981;&#x4F7F;&#x7528;asenumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;" class="anchor-navigation-ex-anchor" href="#skipwhile-&#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;-&#x76F4;&#x5230;&#x7B26;&#x5408;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x4E3A;&#x6B62;-&#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;-ef&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;-&#x9700;&#x8981;&#x4F7F;&#x7528;asenumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a><code>SkipWhile</code>: &#x8DF3;&#x8FC7;&#x96C6;&#x5408;&#x7684;&#x524D;n&#x4E2A;&#x5143;&#x7D20;, &#x76F4;&#x5230;&#x7B26;&#x5408;&#x6307;&#x5B9A;&#x6761;&#x4EF6;&#x4E3A;&#x6B62;, &#x6C42;&#x5269;&#x4E0B;&#x7684;&#x5143;&#x7D20;. <strong>EF&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;, &#x9700;&#x8981;&#x4F7F;&#x7528;AsEnumerable&#x5C06;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x8BA1;&#x7B97;.</strong></h4>
<h4 id="any-&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5143;&#x7D20;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;"><a name="any-&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5143;&#x7D20;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#any-&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5143;&#x7D20;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Any</code>: &#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5143;&#x7D20;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;.</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT CASE
        WHEN EXISTS (
            SELECT 1
            FROM [CALC].[T_Author] AS [t]
            WHERE ([t].[IsDeleted] &lt;&gt; CAST(1 AS bit)) AND ([t].[Code] &gt; CAST(800 AS bigint))) THEN CAST(1 AS bit)
        ELSE CAST(0 AS bit)
    END
*/
var resultList = await EFDbContext.Authors
                .AnyAsync(a =&gt; a.Code &gt; 800);
</code></pre>
<h4 id="all-&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x6240;&#x6709;&#x5143;&#x7D20;&#x662F;&#x5426;&#x90FD;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;"><a name="all-&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x6240;&#x6709;&#x5143;&#x7D20;&#x662F;&#x5426;&#x90FD;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#all-&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x6240;&#x6709;&#x5143;&#x7D20;&#x662F;&#x5426;&#x90FD;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a><code>All</code>: &#x7528;&#x4E8E;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x6240;&#x6709;&#x5143;&#x7D20;&#x662F;&#x5426;&#x90FD;&#x6EE1;&#x8DB3;&#x67D0;&#x4E00;&#x6761;&#x4EF6;.</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT CASE
        WHEN NOT EXISTS (
            SELECT 1
            FROM [CALC].[T_Author] AS [t]
            WHERE ([t].[IsDeleted] &lt;&gt; CAST(1 AS bit)) AND ([t].[Code] &lt;= CAST(800 AS bigint))) THEN CAST(1 AS bit)
        ELSE CAST(0 AS bit)
    END
*/
var resultList = await EFDbContext.Authors
                .AllAsync(a =&gt; a.Code &gt; 800);
</code></pre>
<h4 id="contains-&#x7528;&#x4E8E;&#x67E5;&#x770B;&#x5305;&#x542B;&#x5173;&#x7CFB;&#x3001;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x7B49;"><a name="contains-&#x7528;&#x4E8E;&#x67E5;&#x770B;&#x5305;&#x542B;&#x5173;&#x7CFB;&#x3001;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x7B49;" class="anchor-navigation-ex-anchor" href="#contains-&#x7528;&#x4E8E;&#x67E5;&#x770B;&#x5305;&#x542B;&#x5173;&#x7CFB;&#x3001;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x7B49;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Contains</code>: &#x7528;&#x4E8E;&#x67E5;&#x770B;&#x5305;&#x542B;&#x5173;&#x7CFB;&#x3001;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x7B49;.</h4>
<pre class="language-"><code class="lang-C#">var resultList = await EFDbContext.Authors
   .Where(a =&gt; a.Name.Contains(&quot;Name_80&quot;)).ToListAsync();
//&#x7B49;&#x540C;&#x4E8E;
var resultList = await EFDbContext.Authors
  .Where(a =&gt; EF.Functions.Like(a.Name, &quot;%Name_80%&quot;)).ToListAsync();
</code></pre>
<h4 id="concat-&#x8FDE;&#x63A5;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;-&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x9879;-&#x591A;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x5B57;&#x6BB5;&#x7684;&#x7C7B;&#x578B;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x7C7B;&#x4F3C;sql&#x7684;union-all"><a name="concat-&#x8FDE;&#x63A5;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;-&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x9879;-&#x591A;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x5B57;&#x6BB5;&#x7684;&#x7C7B;&#x578B;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x7C7B;&#x4F3C;sql&#x7684;union-all" class="anchor-navigation-ex-anchor" href="#concat-&#x8FDE;&#x63A5;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;-&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x9879;-&#x591A;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x5B57;&#x6BB5;&#x7684;&#x7C7B;&#x578B;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x7C7B;&#x4F3C;sql&#x7684;union-all"><i class="fa fa-link" aria-hidden="true"></i></a><code>Concat</code>: &#x8FDE;&#x63A5;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;, &#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x9879;, &#x591A;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x5B57;&#x6BB5;&#x7684;&#x7C7B;&#x578B;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x81F4;.(&#x7C7B;&#x4F3C;SQL&#x7684;Union All)</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT [t2].[Name]
    FROM (
        SELECT TOP(5) [t].[Name], [t].[Id], [t0].[Id] AS [Id0]
        FROM [CALC].[T_Author] AS [t]
        LEFT JOIN [CALC].[T_Blog] AS [t0] ON [t].[Id] = [t0].[AuthorId]
        WHERE ([t].[IsDeleted] &lt;&gt; CAST(1 AS bit)) AND ((
            SELECT COUNT(*)
            FROM [CALC].[T_Post] AS [t1]
            WHERE [t0].[Id] IS NOT NULL AND ([t0].[Id] = [t1].[BlogId])) &gt; 0)
    ) AS [t2]
    UNION ALL
    SELECT [t6].[Name]
    FROM (
        SELECT TOP(5) [t3].[Name], [t3].[Id], [t4].[Id] AS [Id0]
        FROM [CALC].[T_Author] AS [t3]
        LEFT JOIN [CALC].[T_Blog] AS [t4] ON [t3].[Id] = [t4].[AuthorId]
        WHERE ([t3].[IsDeleted] &lt;&gt; CAST(1 AS bit)) AND ((
            SELECT COUNT(*)
            FROM [CALC].[T_Post] AS [t5]
            WHERE [t4].[Id] IS NOT NULL AND ([t4].[Id] = [t5].[BlogId])) &gt; 0)
        ORDER BY [t3].[Name] DESC
    ) AS [t6]
*/
var resultList =
    await
    (
        EFDbContext.Authors
        .Include(a =&gt; a.Blog.Posts)
        .AsNoTrackingWithIdentityResolution()
        .Where(a =&gt; a.Blog.Posts.Count &gt; 0)
        .Take(5)
        .Select(a =&gt; a.Name)
        .Concat
        (
             EFDbContext.Authors
            .Include(a =&gt; a.Blog.Posts)
            .AsNoTrackingWithIdentityResolution()
            .Where(a =&gt; a.Blog.Posts.Count &gt; 0)
            .OrderByDescending(a =&gt; a.Name)
            .Take(5)
            .Select(a =&gt; a.Name)
        )
    ).ToListAsync();
</code></pre>
<h4 id="union-&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5373;&#x6C42;&#x5E76;&#x96C6;&#x7C7B;&#x4F3C;sql&#x7684;union"><a name="union-&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5373;&#x6C42;&#x5E76;&#x96C6;&#x7C7B;&#x4F3C;sql&#x7684;union" class="anchor-navigation-ex-anchor" href="#union-&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5373;&#x6C42;&#x5E76;&#x96C6;&#x7C7B;&#x4F3C;sql&#x7684;union"><i class="fa fa-link" aria-hidden="true"></i></a><code>Union</code>: &#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x76F8;&#x540C;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5373;&#x6C42;&#x5E76;&#x96C6;.(&#x7C7B;&#x4F3C;SQL&#x7684;Union)</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT [t0].[Id], [t0].[AddIP], [t0].[AddTime], [t0].[AddUserId], [t0].[Address], [t0].[BirthDate], [t0].[Code], [t0].[CompanyName], [t0].[Email], [t0].[Hometown], [t0].[IsDeleted], [t0].[LastUpdateIP], [t0].[LastUpdateTime], [t0].[LastUpdateUserId], [t0].[Name], [t0].[Tel], [t0].[Title], [t0].[Token]
    FROM (
        SELECT TOP(4) [t].[Id], [t].[AddIP], [t].[AddTime], [t].[AddUserId], [t].[Address], [t].[BirthDate], [t].[Code], [t].[CompanyName], [t].[Email], [t].[Hometown], [t].[IsDeleted], [t].[LastUpdateIP], [t].[LastUpdateTime], [t].[LastUpdateUserId], [t].[Name], [t].[Tel], [t].[Title], [t].[Token]
        FROM [CALC].[T_Author] AS [t]
        WHERE [t].[IsDeleted] &lt;&gt; CAST(1 AS bit)
        ORDER BY [t].[Name]
    ) AS [t0]
    UNION
    SELECT [t2].[Id], [t2].[AddIP], [t2].[AddTime], [t2].[AddUserId], [t2].[Address], [t2].[BirthDate], [t2].[Code], [t2].[CompanyName], [t2].[Email], [t2].[Hometown], [t2].[IsDeleted], [t2].[LastUpdateIP], [t2].[LastUpdateTime], [t2].[LastUpdateUserId], [t2].[Name], [t2].[Tel], [t2].[Title], [t2].[Token]
    FROM (
        SELECT TOP(3) [t1].[Id], [t1].[AddIP], [t1].[AddTime], [t1].[AddUserId], [t1].[Address], [t1].[BirthDate], [t1].[Code], [t1].[CompanyName], [t1].[Email], [t1].[Hometown], [t1].[IsDeleted], [t1].[LastUpdateIP], [t1].[LastUpdateTime], [t1].[LastUpdateUserId], [t1].[Name], [t1].[Tel], [t1].[Title], [t1].[Token]
        FROM [CALC].[T_Author] AS [t1]
        WHERE [t1].[IsDeleted] &lt;&gt; CAST(1 AS bit)
        ORDER BY [t1].[Name]
    ) AS [t2]
*/
var resultList =
    await (EFDbContext.Authors
            .AsNoTrackingWithIdentityResolution()
            .TagWith(&quot;First collection&quot;)
            .OrderBy(a =&gt; a.Name)
            .Take(4)
            .Union
            (
                 EFDbContext.Authors
                    .AsNoTrackingWithIdentityResolution()
                    .TagWith(&quot;Sec collection&quot;)
                    .OrderBy(a =&gt; a.Name)
                    .Take(3)
            ))
            .ToListAsync();
</code></pre>
<h4 id="intersect-&#x6C42;&#x591A;&#x4E2A;&#x51E0;&#x4E2A;&#x96C6;&#x5408;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x96C6;"><a name="intersect-&#x6C42;&#x591A;&#x4E2A;&#x51E0;&#x4E2A;&#x96C6;&#x5408;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x96C6;" class="anchor-navigation-ex-anchor" href="#intersect-&#x6C42;&#x591A;&#x4E2A;&#x51E0;&#x4E2A;&#x96C6;&#x5408;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x96C6;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Intersect</code>: &#x6C42;&#x591A;&#x4E2A;&#x51E0;&#x4E2A;&#x96C6;&#x5408;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x96C6;.</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT [t0].[Id], [t0].[AddIP], [t0].[AddTime], [t0].[AddUserId], [t0].[Address], [t0].[BirthDate], [t0].[Code], [t0].[CompanyName], [t0].[Email], [t0].[Hometown], [t0].[IsDeleted], [t0].[LastUpdateIP], [t0].[LastUpdateTime], [t0].[LastUpdateUserId], [t0].[Name], [t0].[Tel], [t0].[Title], [t0].[Token]
    FROM (
        SELECT TOP(2) [t].[Id], [t].[AddIP], [t].[AddTime], [t].[AddUserId], [t].[Address], [t].[BirthDate], [t].[Code], [t].[CompanyName], [t].[Email], [t].[Hometown], [t].[IsDeleted], [t].[LastUpdateIP], [t].[LastUpdateTime], [t].[LastUpdateUserId], [t].[Name], [t].[Tel], [t].[Title], [t].[Token]
        FROM [CALC].[T_Author] AS [t]
        WHERE [t].[IsDeleted] &lt;&gt; CAST(1 AS bit)
        ORDER BY [t].[Name]
    ) AS [t0]
    INTERSECT
    SELECT [t2].[Id], [t2].[AddIP], [t2].[AddTime], [t2].[AddUserId], [t2].[Address], [t2].[BirthDate], [t2].[Code], [t2].[CompanyName], [t2].[Email], [t2].[Hometown], [t2].[IsDeleted], [t2].[LastUpdateIP], [t2].[LastUpdateTime], [t2].[LastUpdateUserId], [t2].[Name], [t2].[Tel], [t2].[Title], [t2].[Token]
    FROM (
        SELECT TOP(4) [t1].[Id], [t1].[AddIP], [t1].[AddTime], [t1].[AddUserId], [t1].[Address], [t1].[BirthDate], [t1].[Code], [t1].[CompanyName], [t1].[Email], [t1].[Hometown], [t1].[IsDeleted], [t1].[LastUpdateIP], [t1].[LastUpdateTime], [t1].[LastUpdateUserId], [t1].[Name], [t1].[Tel], [t1].[Title], [t1].[Token]
        FROM [CALC].[T_Author] AS [t1]
        WHERE [t1].[IsDeleted] &lt;&gt; CAST(1 AS bit)
        ORDER BY [t1].[Name]
    ) AS [t2]
*/
var resultList =await EFDbContext.Authors
    .AsNoTrackingWithIdentityResolution()
    .TagWith(&quot;First collection&quot;)
    //.AsEnumerable()
    .OrderBy(a =&gt; a.Name)
    .Take(4)
    .Intersect
    (
         EFDbContext.Authors
            .AsNoTrackingWithIdentityResolution()
            .TagWith(&quot;Sec collection&quot;)
            //.AsEnumerable()
            .OrderBy(a =&gt; a.Name)
            .Take(3)
    )
    .ToListAsync();
</code></pre>
<h4 id="except-&#x6C42;&#x5DEE;&#x96C6;"><a name="except-&#x6C42;&#x5DEE;&#x96C6;" class="anchor-navigation-ex-anchor" href="#except-&#x6C42;&#x5DEE;&#x96C6;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Except</code>: &#x6C42;&#x5DEE;&#x96C6;.</h4>
<pre class="language-"><code class="lang-C#">/*
    SELECT [t0].[Id], [t0].[AddIP], [t0].[AddTime], [t0].[AddUserId], [t0].[Address], [t0].[BirthDate], [t0].[Code], [t0].[CompanyName], [t0].[Email], [t0].[Hometown], [t0].[IsDeleted], [t0].[LastUpdateIP], [t0].[LastUpdateTime], [t0].[LastUpdateUserId], [t0].[Name], [t0].[Tel], [t0].[Title], [t0].[Token]
    FROM (
        SELECT TOP(4) [t].[Id], [t].[AddIP], [t].[AddTime], [t].[AddUserId], [t].[Address], [t].[BirthDate], [t].[Code], [t].[CompanyName], [t].[Email], [t].[Hometown], [t].[IsDeleted], [t].[LastUpdateIP], [t].[LastUpdateTime], [t].[LastUpdateUserId], [t].[Name], [t].[Tel], [t].[Title], [t].[Token]
        FROM [CALC].[T_Author] AS [t]
        WHERE [t].[IsDeleted] &lt;&gt; CAST(1 AS bit)
        ORDER BY [t].[Name]
    ) AS [t0]
    EXCEPT
    SELECT [t2].[Id], [t2].[AddIP], [t2].[AddTime], [t2].[AddUserId], [t2].[Address], [t2].[BirthDate], [t2].[Code], [t2].[CompanyName], [t2].[Email], [t2].[Hometown], [t2].[IsDeleted], [t2].[LastUpdateIP], [t2].[LastUpdateTime], [t2].[LastUpdateUserId], [t2].[Name], [t2].[Tel], [t2].[Title], [t2].[Token]
    FROM (
        SELECT TOP(1) [t1].[Id], [t1].[AddIP], [t1].[AddTime], [t1].[AddUserId], [t1].[Address], [t1].[BirthDate], [t1].[Code], [t1].[CompanyName], [t1].[Email], [t1].[Hometown], [t1].[IsDeleted], [t1].[LastUpdateIP], [t1].[LastUpdateTime], [t1].[LastUpdateUserId], [t1].[Name], [t1].[Tel], [t1].[Title], [t1].[Token]
        FROM [CALC].[T_Author] AS [t1]
        WHERE [t1].[IsDeleted] &lt;&gt; CAST(1 AS bit)
        ORDER BY [t1].[Name]
    ) AS [t2]
*/
var resultList =await EFDbContext.Authors
    .AsNoTrackingWithIdentityResolution()
    .TagWith(&quot;First collection&quot;)
    //.AsEnumerable()
    .OrderBy(a =&gt; a.Name)
    .Take(4)
    .Except
    (
         EFDbContext.Authors
            .AsNoTrackingWithIdentityResolution()
            .TagWith(&quot;Sec collection&quot;)
            //.AsEnumerable()
            .OrderBy(a =&gt; a.Name)
            .Take(3)
    )
    .ToListAsync();
</code></pre>
<h4 id="toarray-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x4E3A;&#x6570;&#x7EC4;"><a name="toarray-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x4E3A;&#x6570;&#x7EC4;" class="anchor-navigation-ex-anchor" href="#toarray-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x4E3A;&#x6570;&#x7EC4;"><i class="fa fa-link" aria-hidden="true"></i></a><code>ToArray</code>: &#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x4E3A;&#x6570;&#x7EC4;</h4>
<h4 id="tolist-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x4E3A;&#x6CDB;&#x578B;list"><a name="tolist-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x4E3A;&#x6CDB;&#x578B;list" class="anchor-navigation-ex-anchor" href="#tolist-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x4E3A;&#x6CDB;&#x578B;list"><i class="fa fa-link" aria-hidden="true"></i></a><code>ToList</code>: &#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x4E3A;&#x6CDB;&#x578B;List</h4>
<h4 id="todictionary-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x5178;"><a name="todictionary-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x5178;" class="anchor-navigation-ex-anchor" href="#todictionary-&#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x5178;"><i class="fa fa-link" aria-hidden="true"></i></a><code>ToDictionary</code>: &#x5C06;&#x5E8F;&#x5217;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x5178;</h4>
<pre class="language-"><code class="lang-C#">var q = from c in db.Customers
        select c;
Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int,</span> <span class="token attr-name">Customers</span><span class="token punctuation">&gt;</span></span> cDict= q.ToDictionary(p=&gt;p.cId);
</code></pre>
<h4 id="oftype-&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x4E2D;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5143;&#x7D20;"><a name="oftype-&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x4E2D;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#oftype-&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x4E2D;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a><code>OfType</code>: &#x83B7;&#x53D6;&#x96C6;&#x5408;&#x4E2D;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5143;&#x7D20;</h4>
<pre class="language-"><code class="lang-C#"> object[] obj = { 1, 23, 4, 5, 555, &quot;aaa&quot;, &quot;bbb&quot; };
 int max = obj.OfType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>().Max();  //&#x7ED3;&#x679C;&#x662F;55, &#x83B7;&#x53D6;int&#x7C7B;&#x578B;&#x4E2D;&#x7684;&#x6700;&#x5927;&#x503C;
</code></pre>
<h4 id="selectmany-&#x76F8;&#x5F53;&#x4E8E;&#x4E8C;&#x6B21;&#x904D;&#x5386;&#x67E5;&#x627E;"><a name="selectmany-&#x76F8;&#x5F53;&#x4E8E;&#x4E8C;&#x6B21;&#x904D;&#x5386;&#x67E5;&#x627E;" class="anchor-navigation-ex-anchor" href="#selectmany-&#x76F8;&#x5F53;&#x4E8E;&#x4E8C;&#x6B21;&#x904D;&#x5386;&#x67E5;&#x627E;"><i class="fa fa-link" aria-hidden="true"></i></a><code>selectMany</code>: &#x76F8;&#x5F53;&#x4E8E;&#x4E8C;&#x6B21;&#x904D;&#x5386;&#x67E5;&#x627E;.</h4>
<pre class="language-"><code class="lang-C#">var resultList =
    await EFDbContext.Authors
    .Skip(10)
    .Take(3)
    .Include(a=&gt;a.Blog.Posts)
    .SelectMany(a =&gt; a.Blog.Posts)
    .ToListAsync();
</code></pre>
<h4 id="join-&#x5185;&#x8FDE;&#x63A5;"><a name="join-&#x5185;&#x8FDE;&#x63A5;" class="anchor-navigation-ex-anchor" href="#join-&#x5185;&#x8FDE;&#x63A5;"><i class="fa fa-link" aria-hidden="true"></i></a><code>join</code>: &#x5185;&#x8FDE;&#x63A5;.</h4>
<pre class="language-"><code class="lang-C#">var resultList =
    await EFDbContext.Authors
    .Join(EFDbContext.Blogs, a =&gt; a.Id, b =&gt; b.AuthorId, (a, b) =&gt; new { a, b })
    .AsNoTrackingWithIdentityResolution()
    .Take(3)
    .ToListAsync();

//&#x7B49;&#x4EF7;&#x4E8E;
var resultList =
    await
        (
            from a in EFDbContext.Authors
            join b in EFDbContext.Blogs on a.Id equals b.AuthorId
            select new { a, b }
        )
        .AsNoTrackingWithIdentityResolution()
        .Take(3)
        .ToListAsync();
</code></pre>
<h4 id="groupjoin-&#x5DE6;&#x5916;&#x8FDE;&#x63A5;&#x53F3;&#x5916;&#x8FDE;&#x63A5;"><a name="groupjoin-&#x5DE6;&#x5916;&#x8FDE;&#x63A5;&#x53F3;&#x5916;&#x8FDE;&#x63A5;" class="anchor-navigation-ex-anchor" href="#groupjoin-&#x5DE6;&#x5916;&#x8FDE;&#x63A5;&#x53F3;&#x5916;&#x8FDE;&#x63A5;"><i class="fa fa-link" aria-hidden="true"></i></a><code>GroupJoin</code>: &#x5DE6;&#x5916;&#x8FDE;&#x63A5;/&#x53F3;&#x5916;&#x8FDE;&#x63A5;</h4>
<pre class="language-"><code class="lang-C#">var queryable =
    from lc in _calcDbContext.Persons
    join o in _calcDbContext.Cars
         on lc.Id equals o.PersonId into og
    from ro in og.DefaultIfEmpty()
    orderby lc.Id descending, ro.Id ascending
    select new
    {
        PersonId = lc.Id,
        lc.Name,
        CarId = ro.Id,
        MSN = ro.MSN,
        ro.Price,
    };

//=&gt;&#x7B49;&#x4EF7;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x8BED;&#x53E5;
var queryable =
     _calcDbContext
        .Persons
        .GroupJoin
        (
            _calcDbContext.Cars,
            c =&gt; c.Id,
            o =&gt; o.PersonId,
            (c, os) =&gt; new { Person = c, Cars = os }
        )
        .SelectMany
        (
            combination =&gt; combination.Cars.DefaultIfEmpty(),
            (c, o) =&gt;
            new
            {
                CustomerId = c.Person.Id,
                c.Person.Name,
                CarId = o.Id,
                MSN = o.MSN,
                o.Price,
            }
        )
        .OrderByDescending(o =&gt; o.CustomerId).ThenBy(o =&gt; o.CarId)
        .TagWith(&quot;my sql&quot;);

var resultList = await queryable.TagWith(&quot;test sql&quot;).Take(3).ToListAsync();
</code></pre>
<h4 id="tolookup-&#x5F53;&#x540C;&#x4E00;&#x4E2A;key&#x8981;&#x6C42;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;value&#x60C5;&#x51B5;-tolookup&#x65B9;&#x6CD5;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;-tolookup&#x8FD4;&#x56DE;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7C7B;&#x4F3C;sql&#x7684;group-&#x53EF;&#x4EE5;&#x628A;&#x96C6;&#x5408;&#x5206;&#x7EC4;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7528;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;-lookup&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x662F;readonly&#x7684;"><a name="tolookup-&#x5F53;&#x540C;&#x4E00;&#x4E2A;key&#x8981;&#x6C42;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;value&#x60C5;&#x51B5;-tolookup&#x65B9;&#x6CD5;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;-tolookup&#x8FD4;&#x56DE;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7C7B;&#x4F3C;sql&#x7684;group-&#x53EF;&#x4EE5;&#x628A;&#x96C6;&#x5408;&#x5206;&#x7EC4;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7528;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;-lookup&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x662F;readonly&#x7684;" class="anchor-navigation-ex-anchor" href="#tolookup-&#x5F53;&#x540C;&#x4E00;&#x4E2A;key&#x8981;&#x6C42;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;value&#x60C5;&#x51B5;-tolookup&#x65B9;&#x6CD5;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;-tolookup&#x8FD4;&#x56DE;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7C7B;&#x4F3C;sql&#x7684;group-&#x53EF;&#x4EE5;&#x628A;&#x96C6;&#x5408;&#x5206;&#x7EC4;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7528;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;-lookup&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x662F;readonly&#x7684;"><i class="fa fa-link" aria-hidden="true"></i></a><code>ToLookup</code>: &#x5F53;&#x540C;&#x4E00;&#x4E2A;key&#x8981;&#x6C42;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;value&#x60C5;&#x51B5;, ToLookup&#x65B9;&#x6CD5;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;. ToLookup&#x8FD4;&#x56DE;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7C7B;&#x4F3C;sql&#x7684;group, &#x53EF;&#x4EE5;&#x628A;&#x96C6;&#x5408;&#x5206;&#x7EC4;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7528;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;. Lookup&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x662F;ReadOnly&#x7684;.</h4>
<p>*EF&#x65E0;&#x6CD5;&#x7FFB;&#x8BD1;.</p>
<pre class="language-"><code class="lang-C#">var resultList = EFDbContext.Posts
    .ToLookup(p =&gt; p.BlogId)
    .Select(g =&gt; new
    {
        Key = g.Key.ToString(),
        List = g.ToList()
    })
    .Take(3)
    .ToList();
</code></pre>
<h4 id="sequenceequal-&#x6BD4;&#x8F83;list&#x548C;list&#x4E4B;&#x95F4;-&#x6570;&#x7EC4;&#x548C;&#x6570;&#x7EC4;&#x4E4B;&#x95F4;&#x662F;&#x5426;&#x76F8;&#x7B49;"><a name="sequenceequal-&#x6BD4;&#x8F83;list&#x548C;list&#x4E4B;&#x95F4;-&#x6570;&#x7EC4;&#x548C;&#x6570;&#x7EC4;&#x4E4B;&#x95F4;&#x662F;&#x5426;&#x76F8;&#x7B49;" class="anchor-navigation-ex-anchor" href="#sequenceequal-&#x6BD4;&#x8F83;list&#x548C;list&#x4E4B;&#x95F4;-&#x6570;&#x7EC4;&#x548C;&#x6570;&#x7EC4;&#x4E4B;&#x95F4;&#x662F;&#x5426;&#x76F8;&#x7B49;"><i class="fa fa-link" aria-hidden="true"></i></a><code>SequenceEqual</code>: &#x6BD4;&#x8F83;list&#x548C;list&#x4E4B;&#x95F4;, &#x6570;&#x7EC4;&#x548C;&#x6570;&#x7EC4;&#x4E4B;&#x95F4;&#x662F;&#x5426;&#x76F8;&#x7B49;.</h4>
<pre class="language-"><code class="lang-C#">var isSequenceEqual = EFDbContext.Authors
    .AsNoTrackingWithIdentityResolution()
    .OrderBy(a =&gt; a.Name)
    .Take(3)
    .ToList()
    .SequenceEqual
    (
        await EFDbContext.Authors
            .AsNoTrackingWithIdentityResolution()
            .OrderBy(a =&gt; a.Name)
            .Take(3)
            .ToListAsync()
    );
</code></pre>
<h4 id="defaultifempty-&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5E8F;&#x5217;&#x7684;&#x5143;&#x7D20;-&#x5982;&#x679C;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;-&#x5219;&#x8FD4;&#x56DE;&#x5355;&#x4E00;&#x5B9E;&#x4F8B;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x7684;&#x9ED8;&#x8BA4;&#x503C;-&#x591A;&#x7528;&#x4E8E;&#x5916;&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;"><a name="defaultifempty-&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5E8F;&#x5217;&#x7684;&#x5143;&#x7D20;-&#x5982;&#x679C;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;-&#x5219;&#x8FD4;&#x56DE;&#x5355;&#x4E00;&#x5B9E;&#x4F8B;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x7684;&#x9ED8;&#x8BA4;&#x503C;-&#x591A;&#x7528;&#x4E8E;&#x5916;&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#defaultifempty-&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5E8F;&#x5217;&#x7684;&#x5143;&#x7D20;-&#x5982;&#x679C;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;-&#x5219;&#x8FD4;&#x56DE;&#x5355;&#x4E00;&#x5B9E;&#x4F8B;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x7684;&#x9ED8;&#x8BA4;&#x503C;-&#x591A;&#x7528;&#x4E8E;&#x5916;&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a><code>DefaultIfEmpty</code>: &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5E8F;&#x5217;&#x7684;&#x5143;&#x7D20;, &#x5982;&#x679C;&#x5E8F;&#x5217;&#x4E3A;&#x7A7A;, &#x5219;&#x8FD4;&#x56DE;&#x5355;&#x4E00;&#x5B9E;&#x4F8B;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x7684;&#x9ED8;&#x8BA4;&#x503C;, &#x591A;&#x7528;&#x4E8E;&#x5916;&#x8FDE;&#x63A5;&#x67E5;&#x8BE2;.</h4>
<pre class="language-"><code class="lang-C#">int[] arr1 = { 1, 2, 3, 4, 5, 6, 7, 8, 9 };//&#x6784;&#x9020;&#x5E26;&#x5143;&#x7D20;&#x7684;&#x6570;&#x7EC4;
int[] arr2 = { }; //&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x7A7A;&#x6570;&#x7EC4;
string[] str = { };
var d1 = arr1.DefaultIfEmpty().ToList();   //9&#x4E2A;&#x5143;&#x7D20;
var d2 = arr2.DefaultIfEmpty().ToList();   //1&#x4E2A;&#x5143;&#x7D20;,&#x4E14;&#x4E3A;0,&#x5373;int&#x7C7B;&#x578B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;
var d3 = arr2.DefaultIfEmpty(86).ToList(); //1&#x4E2A;&#x5143;&#x7D20;,&#x4E14;&#x4E3A;86,&#x5373;int&#x7C7B;&#x578B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;
var d4 = str.DefaultIfEmpty().ToList();    //1&#x4E2A;&#x5143;&#x7D20;,&#x4E14;&#x4E3A;null,&#x5373;string&#x7C7B;&#x578B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;
</code></pre>
<h4 id="empty-&#x5185;&#x90E8;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;t&#x6570;&#x7EC4;-&#x6570;&#x7EC4;&#x7684;&#x4E2A;&#x6570;&#x4E3A;0-&#x60F3;&#x8C61;&#x4E0D;&#x51FA;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x4EC0;&#x4E48;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0A;&#x256E;&#x256F;&#x25BD;&#x2570;&#x256D;"><a name="empty-&#x5185;&#x90E8;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;t&#x6570;&#x7EC4;-&#x6570;&#x7EC4;&#x7684;&#x4E2A;&#x6570;&#x4E3A;0-&#x60F3;&#x8C61;&#x4E0D;&#x51FA;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x4EC0;&#x4E48;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0A;&#x256E;&#x256F;&#x25BD;&#x2570;&#x256D;" class="anchor-navigation-ex-anchor" href="#empty-&#x5185;&#x90E8;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;t&#x6570;&#x7EC4;-&#x6570;&#x7EC4;&#x7684;&#x4E2A;&#x6570;&#x4E3A;0-&#x60F3;&#x8C61;&#x4E0D;&#x51FA;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x4EC0;&#x4E48;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0A;&#x256E;&#x256F;&#x25BD;&#x2570;&#x256D;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Empty</code>: &#x5185;&#x90E8;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;T[]&#x6570;&#x7EC4;, &#x6570;&#x7EC4;&#x7684;&#x4E2A;&#x6570;&#x4E3A;0. (&#x60F3;&#x8C61;&#x4E0D;&#x51FA;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x4EC0;&#x4E48;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0A;&#x256E;(&#x256F;&#x25BD;&#x2570;)&#x256D;)</h4>
<pre class="language-"><code class="lang-C#">var strArr = Enumerable.Empty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>().ToArray();
</code></pre>
<h4 id="range-&#x751F;&#x6210;&#x6307;&#x5B9A;&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x7684;&#x5E8F;&#x5217;"><a name="range-&#x751F;&#x6210;&#x6307;&#x5B9A;&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x7684;&#x5E8F;&#x5217;" class="anchor-navigation-ex-anchor" href="#range-&#x751F;&#x6210;&#x6307;&#x5B9A;&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x7684;&#x5E8F;&#x5217;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Range</code>: &#x751F;&#x6210;&#x6307;&#x5B9A;&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x7684;&#x5E8F;&#x5217;.</h4>
<pre class="language-"><code class="lang-C#">//&#x751F;&#x6210;0-9&#x7684;&#x6570;&#x7EC4;
var list = Enumerable.Range(0, 10);
</code></pre>
<h4 id="repeat-&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x91CD;&#x590D;&#x503C;&#x7684;&#x5E8F;&#x5217;"><a name="repeat-&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x91CD;&#x590D;&#x503C;&#x7684;&#x5E8F;&#x5217;" class="anchor-navigation-ex-anchor" href="#repeat-&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x91CD;&#x590D;&#x503C;&#x7684;&#x5E8F;&#x5217;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Repeat</code>: &#x751F;&#x6210;&#x4E00;&#x4E2A;&#x91CD;&#x590D;&#x503C;&#x7684;&#x5E8F;&#x5217;.</h4>
<pre class="language-"><code>//&#x751F;&#x6210;N&#x4E2A;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;
var list = Enumerable.Repeat(&quot;dylan&quot;, 10);
</code></pre><h4 id="aggregate-&#x7D2F;&#x8BA1;&#x8BA1;&#x7B97;"><a name="aggregate-&#x7D2F;&#x8BA1;&#x8BA1;&#x7B97;" class="anchor-navigation-ex-anchor" href="#aggregate-&#x7D2F;&#x8BA1;&#x8BA1;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Aggregate</code>: &#x7D2F;&#x8BA1;&#x8BA1;&#x7B97;.</h4>
<pre class="language-"><code class="lang-C#">var list = Enumerable.Repeat(&quot;dylan&quot;, 10);
var resultList = list.Aggregate(&quot;total:&quot;, (current, str) =&gt; $&quot;{current}{str},&quot;, str =&gt; string.IsNullOrEmpty(str) ? &quot;&quot; : str.Substring(0, str.Length - 1));

var resultList = list.Aggregate(&quot;total:&quot;, (current, str) =&gt;
{
    return $&quot;{current}{str},&quot;;
}, str =&gt;
{
    return string.IsNullOrEmpty(str) ? &quot;&quot; : str.Substring(0, str.Length - 1);
});
</code></pre>
<h4 id="asenumerable-&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;-&#x5B9E;&#x9645;&#x4E0A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;-&#x5F53;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#x624D;&#x6267;&#x884C;"><a name="asenumerable-&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;-&#x5B9E;&#x9645;&#x4E0A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;-&#x5F53;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#x624D;&#x6267;&#x884C;" class="anchor-navigation-ex-anchor" href="#asenumerable-&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;-&#x5B9E;&#x9645;&#x4E0A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;-&#x5F53;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#x624D;&#x6267;&#x884C;"><i class="fa fa-link" aria-hidden="true"></i></a><code>AsEnumerable</code>: &#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;, &#x5B9E;&#x9645;&#x4E0A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;, &#x5F53;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#x624D;&#x6267;&#x884C;.</h4>
<h4 id="asqueryable-&#x4E5F;&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;-&#x5C06;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5411;&#x4E0B;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A;iqueryable-&#x5B83;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x67E5;&#x8BE2;&#x7684;iqueryable&#x5305;&#x88C5;"><a name="asqueryable-&#x4E5F;&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;-&#x5C06;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5411;&#x4E0B;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A;iqueryable-&#x5B83;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x67E5;&#x8BE2;&#x7684;iqueryable&#x5305;&#x88C5;" class="anchor-navigation-ex-anchor" href="#asqueryable-&#x4E5F;&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;-&#x5C06;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5411;&#x4E0B;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A;iqueryable-&#x5B83;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x67E5;&#x8BE2;&#x7684;iqueryable&#x5305;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a><code>AsQueryable</code>: &#x4E5F;&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;, &#x5C06;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5411;&#x4E0B;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A;IQueryable, &#x5B83;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x67E5;&#x8BE2;&#x7684;IQueryable&#x5305;&#x88C5;.</h4>
<h4 id="cast-&#x5C06;-iqueryable-&#x7684;&#x5143;&#x7D20;&#x8F6C;&#x6362;&#x4E3A;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x578B;"><a name="cast-&#x5C06;-iqueryable-&#x7684;&#x5143;&#x7D20;&#x8F6C;&#x6362;&#x4E3A;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#cast-&#x5C06;-iqueryable-&#x7684;&#x5143;&#x7D20;&#x8F6C;&#x6362;&#x4E3A;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Cast</code>: &#x5C06; IQueryable &#x7684;&#x5143;&#x7D20;&#x8F6C;&#x6362;&#x4E3A;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x578B;.</h4>
<h3 id="7-13effunctions"><a name="7-13effunctions" class="anchor-navigation-ex-anchor" href="#7-13effunctions"><i class="fa fa-link" aria-hidden="true"></i></a>7-13&gt;EF.Functions</h3>
<h4 id="7-13-1&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;"><a name="7-13-1&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;" class="anchor-navigation-ex-anchor" href="#7-13-1&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;"><i class="fa fa-link" aria-hidden="true"></i></a>7-13-1&gt;&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;:</h4>
<h5 id="like-sql&#x7684;like"><a name="like-sql&#x7684;like" class="anchor-navigation-ex-anchor" href="#like-sql&#x7684;like"><i class="fa fa-link" aria-hidden="true"></i></a><code>Like</code>: SQL&#x7684;Like</h5>
<pre class="language-"><code class="lang-C#">var list = await EFDbContext.Authors
    .Where(a =&gt; EF.Functions.Like(a.Name, &quot;name_80%&quot;))
    .Take(2)
    .Select(a =&gt; new
    {
        Name = a.Name,
        Code = a.Code
    }).ToListAsync();
</code></pre>
<h5 id="collate-&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x67D0;&#x4E9B;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x95EE;&#x9898;-sqllatin1generalcp1cias&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;-sqllatin1generalcp1csas&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;"><a name="collate-&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x67D0;&#x4E9B;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x95EE;&#x9898;-sqllatin1generalcp1cias&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;-sqllatin1generalcp1csas&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;" class="anchor-navigation-ex-anchor" href="#collate-&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x67D0;&#x4E9B;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x95EE;&#x9898;-sqllatin1generalcp1cias&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;-sqllatin1generalcp1csas&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;"><i class="fa fa-link" aria-hidden="true"></i></a><code>Collate</code>: &#x53EF;&#x4EE5;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x67D0;&#x4E9B;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x95EE;&#x9898;. SQL_Latin1_General_CP1_CI_AS(&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;), SQL_Latin1_General_CP1_CS_AS(&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;).</h5>
<pre class="language-"><code class="lang-C#">/*
    SELECT TOP(@__p_1) [t].[Name], [t].[Code]
    FROM [CALC].[T_Author] AS [t]
    WHERE ([t].[IsDeleted] &lt;&gt; CAST(1 AS bit)) AND ([t].[Name] COLLATE SQL_Latin1_General_CP1_CS_AS LIKE N&apos;name_80%&apos;)
*/
var list = await EFDbContext.Authors
    .Where(a =&gt; EF.Functions.Like(EF.Functions.Collate(a.Name, &quot;SQL_Latin1_General_CP1_CS_AS&quot;), &quot;name_80%&quot;))
    .Take(2)
    .Select(a =&gt; new
    {
        Name = a.Name,
        Code = a.Code
    }).ToListAsync();
</code></pre>
<h5 id="datalength-&#x6C42;&#x5B57;&#x8282;&#x957F;&#x5EA6;1&#x4E2A;&#x4E2D;&#x6587;&#x5B57;&#x7B26;2&#x4F4D;-1&#x4E2A;&#x82F1;&#x6587;&#x5B57;&#x7B26;1&#x4F4D;-varchar&#x7528;&#x6765;&#x5B58;&#x5728;&#x53EA;&#x6709;&#x975E;&#x4E2D;&#x6587;&#x7684;&#x4E32;-nvarchar&#x7528;&#x6765;&#x5B58;&#x653E;&#x542B;&#x6709;&#x4E2D;&#x6587;&#x7684;&#x4E32;-&#x5EFA;&#x8BAE;&#x5168;&#x90E8;&#x521B;&#x5EFA;&#x6210;nvarchar&#x7C7B;&#x578B;"><a name="datalength-&#x6C42;&#x5B57;&#x8282;&#x957F;&#x5EA6;1&#x4E2A;&#x4E2D;&#x6587;&#x5B57;&#x7B26;2&#x4F4D;-1&#x4E2A;&#x82F1;&#x6587;&#x5B57;&#x7B26;1&#x4F4D;-varchar&#x7528;&#x6765;&#x5B58;&#x5728;&#x53EA;&#x6709;&#x975E;&#x4E2D;&#x6587;&#x7684;&#x4E32;-nvarchar&#x7528;&#x6765;&#x5B58;&#x653E;&#x542B;&#x6709;&#x4E2D;&#x6587;&#x7684;&#x4E32;-&#x5EFA;&#x8BAE;&#x5168;&#x90E8;&#x521B;&#x5EFA;&#x6210;nvarchar&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#datalength-&#x6C42;&#x5B57;&#x8282;&#x957F;&#x5EA6;1&#x4E2A;&#x4E2D;&#x6587;&#x5B57;&#x7B26;2&#x4F4D;-1&#x4E2A;&#x82F1;&#x6587;&#x5B57;&#x7B26;1&#x4F4D;-varchar&#x7528;&#x6765;&#x5B58;&#x5728;&#x53EA;&#x6709;&#x975E;&#x4E2D;&#x6587;&#x7684;&#x4E32;-nvarchar&#x7528;&#x6765;&#x5B58;&#x653E;&#x542B;&#x6709;&#x4E2D;&#x6587;&#x7684;&#x4E32;-&#x5EFA;&#x8BAE;&#x5168;&#x90E8;&#x521B;&#x5EFA;&#x6210;nvarchar&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a><code>DataLength</code>: &#x6C42;&#x5B57;&#x8282;&#x957F;&#x5EA6;(1&#x4E2A;&#x4E2D;&#x6587;&#x5B57;&#x7B26;2&#x4F4D;, 1&#x4E2A;&#x82F1;&#x6587;&#x5B57;&#x7B26;1&#x4F4D;), <strong>varchar&#x7528;&#x6765;&#x5B58;&#x5728;&#x53EA;&#x6709;&#x975E;&#x4E2D;&#x6587;&#x7684;&#x4E32;, nvarchar&#x7528;&#x6765;&#x5B58;&#x653E;&#x542B;&#x6709;&#x4E2D;&#x6587;&#x7684;&#x4E32;</strong>, &#x5EFA;&#x8BAE;&#x5168;&#x90E8;&#x521B;&#x5EFA;&#x6210;nvarchar&#x7C7B;&#x578B;.</h5>
<h5 id="datediffxxx-&#x5404;&#x79CD;&#x64CD;&#x4F5C;&#x65F6;&#x95F4;&#x7684;&#x65B9;&#x6CD5;-&#x6309;&#x7167;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x8C03;&#x7528;"><a name="datediffxxx-&#x5404;&#x79CD;&#x64CD;&#x4F5C;&#x65F6;&#x95F4;&#x7684;&#x65B9;&#x6CD5;-&#x6309;&#x7167;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x8C03;&#x7528;" class="anchor-navigation-ex-anchor" href="#datediffxxx-&#x5404;&#x79CD;&#x64CD;&#x4F5C;&#x65F6;&#x95F4;&#x7684;&#x65B9;&#x6CD5;-&#x6309;&#x7167;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x8C03;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a><code>DateDiffXXX</code>: &#x5404;&#x79CD;&#x64CD;&#x4F5C;&#x65F6;&#x95F4;&#x7684;&#x65B9;&#x6CD5;, &#x6309;&#x7167;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x8C03;&#x7528;.</h5>
<h4 id="7-13-2&#x62D3;&#x5C55;effunctions"><a name="7-13-2&#x62D3;&#x5C55;effunctions" class="anchor-navigation-ex-anchor" href="#7-13-2&#x62D3;&#x5C55;effunctions"><i class="fa fa-link" aria-hidden="true"></i></a>7-13-2&gt;&#x62D3;&#x5C55;EF.Functions</h4>
<p><a href="https://www.cnblogs.com/GuZhenYin/p/14657024.html" target="_blank">https://www.cnblogs.com/GuZhenYin/p/14657024.html</a></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/microsoft.entityframeworkcore.query.isqlexpressionfactory.function?view=efcore-5.0" target="_blank">https://docs.microsoft.com/zh-cn/dotnet/api/microsoft.entityframeworkcore.query.isqlexpressionfactory.function?view=efcore-5.0</a></p>
<p>&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;, &#x5982;&#x679C;&#x5B9E;&#x9645;&#x4E1A;&#x52A1;&#x4E2D;&#x9700;&#x8981;&#x7528;&#x5230;, &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x62D3;&#x5C55;EF.Functions &#x6765;&#x8FBE;&#x5230;&#x652F;&#x6301;&#x7684;&#x6548;&#x679C;, &#x4EE5;&#x4E0B;&#x62D3;&#x5C55; SQL Server&#x7684; STUFF</p>
<pre class="language-"><code class="lang-sql"><span class="token comment">--&#x6211;&#x7684;&#x8BFE;&#x7A0B;</span>
<span class="token keyword">SELECT</span> STUFF<span class="token punctuation">(</span><span class="token string">&apos;MySQL&#x8BFE;&#x7A0B;&apos;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&apos;&#x6211;&#x7684;&apos;</span><span class="token punctuation">)</span>
</code></pre>
<p>*&#x53EF;&#x4EE5;&#x53C2;&#x8003;demo&#x91CC;&#x7684;&#x5B9E;&#x73B0;</p>
<p>&#x6838;&#x5FC3;&#x62D3;&#x5C55;&#x7C7B;SQLServerFunctionsTranslateImpl.cs</p>
<pre class="language-"><code class="lang-C#">using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Diagnostics;
using Microsoft.EntityFrameworkCore.Query;
using Microsoft.EntityFrameworkCore.Query.SqlExpressions;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;

namespace Dylan.Repository.DbFunctionsExtension
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// SQL Server&#x7684;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x8F6C;&#x6362;&#x5668;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class SQLServerFunctionsTranslateImpl : IMethodCallTranslator
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x53CD;&#x5C04;SQLServerFunctionsExtensions.SQLServerStuff&#x83B7;&#x5F97;&#x7684;&#x65B9;&#x6CD5;&#x5BF9;&#x8C61;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        private static readonly MethodInfo _SQLServerStuffMethod =
            typeof(SQLServerFunctionsExtensions)
            .GetMethod
            (
                nameof(SQLServerFunctionsExtensions.SQLServerStuff),
                new[]
                {
                    typeof(DbFunctions), typeof(string), typeof(int), typeof(int),typeof(string),
                }
            );

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8868;&#x8FBE;&#x5F0F;&#x5DE5;&#x5382;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        private readonly ISqlExpressionFactory _expressionFactory;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x6784;&#x9020;&#x51FD;&#x6570;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expressionFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x8868;&#x8FBE;&#x5F0F;&#x5DE5;&#x5382;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        public SQLServerFunctionsTranslateImpl(ISqlExpressionFactory expressionFactory)
        {
            _expressionFactory = expressionFactory;
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x751F;&#x6210;SQL&#x8868;&#x8FBE;&#x5F0F;&#x5BF9;&#x8C61;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>instance<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>method<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>arguments<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public SqlExpression Translate(SqlExpression instance, MethodInfo method, IReadOnlyList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SqlExpression</span><span class="token punctuation">&gt;</span></span> arguments, IDiagnosticsLogger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbLoggerCategory.Query</span><span class="token punctuation">&gt;</span></span> logger)
        {
            //TODO &#x540E;&#x7EED;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x62D3;&#x5C55;&#x5176;&#x4ED6;&#x51FD;&#x6570;
            //&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x4E00;&#x81F4;
            if (method == _SQLServerStuffMethod)
            {
                var args = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SqlExpression</span><span class="token punctuation">&gt;</span></span> { arguments[1], arguments[2], arguments[3], arguments[4] };
                var argumentsPropagateNullabilitys = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bool</span><span class="token punctuation">&gt;</span></span> { true, false, false, true };
                return _expressionFactory.Function(&quot;STUFF&quot;, args, true, argumentsPropagateNullabilitys, typeof(string));
            }

            return null;
        }
    }
}
</code></pre>
<p>&#x6700;&#x540E;&#x8C03;&#x7528;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code class="lang-C#">/*
    SELECT TOP(@__p_0) STUFF([t].[Name], 1, 4, N&apos;dylan&apos;) AS [Name], [t].[Code]
    FROM [CALC].[T_Author] AS [t]
    WHERE [t].[IsDeleted] &lt;&gt; CAST(1 AS bit)
    ORDER BY [t].[Name]
*/
var resultList = await EFDbContext.Authors.OrderBy(a =&gt; a.Name).Take(2).Select(a =&gt; new
    {
        Name = EF.Functions.SQLServerStuff(a.Name, 1, 4, &quot;dylan&quot;),
        a.Code
    }).ToListAsync();
</code></pre>
<hr>
<h2 id="8&#x65B0;&#x589E;&#x4FEE;&#x6539;"><a name="8&#x65B0;&#x589E;&#x4FEE;&#x6539;" class="anchor-navigation-ex-anchor" href="#8&#x65B0;&#x589E;&#x4FEE;&#x6539;"><i class="fa fa-link" aria-hidden="true"></i></a>8&gt;&#x65B0;&#x589E;/&#x4FEE;&#x6539;</h2>
<p>*&#x6BCF;&#x4E2A;EF&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F8B;&#x90FD;&#x6709;&#x4E00;&#x4E2A; <code>ChangeTracker</code>(&#x66F4;&#x6539;&#x8DDF;&#x8E2A;&#x5668;), &#x5B83;&#x8D1F;&#x8D23;&#x8DDF;&#x8E2A;&#x9700;&#x8981;&#x5199;&#x5165;&#x6570;&#x636E;&#x5E93;&#x7684;&#x66F4;&#x6539;. &#x5F53;&#x66F4;&#x6539;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x65F6;(&#x4FEE;&#x6539;&#x5C5E;&#x6027;, &#x5220;&#x9664;&#x5B9E;&#x4F8B;, &#x65B0;&#x5EFA;&#x5B9E;&#x4F8B;&#x7B49;), &#x8FD9;&#x4E9B;&#x66F4;&#x6539;&#x4F1A;&#x8BB0;&#x5F55;&#x5728; <code>ChangeTracker</code> &#x4E2D;, &#x7136;&#x540E;&#x5728;&#x8C03;&#x7528; <code>SaveChanges</code> &#x65F6;&#x88AB;&#x5199;&#x5165;&#x6570;&#x636E;&#x5E93;. &#x6B64;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x8D1F;&#x8D23;&#x5C06;&#x66F4;&#x6539;, &#x8F6C;&#x6362;&#x4E3A;&#x7279;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#xFF08;&#x4F8B;&#x5982;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x7684; <code>INSERT</code>,<code>UPDATE</code> &#x548C; <code>DELETE</code> &#x547D;&#x4EE4;&#xFF09;.</p>
<pre class="language-"><code class="lang-C#">//&#x65B0;&#x589E;
var blog = new Blog { Url = &quot;http://sample.com&quot; };
context.Blogs.Add(blog);
context.SaveChanges();

//&#x4FEE;&#x6539;
var blog = context.Blogs.First();
blog.Url = &quot;http://sample.com/blog&quot;;
context.SaveChanges();
</code></pre>
<p>*&#x5355;&#x4E2A; SaveChanges &#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x64CD;&#x4F5C;</p>
<pre class="language-"><code class="lang-C#">//add
context.Blogs.Add(new Blog { Url = &quot;http://sample.com/blog_one&quot; });
context.Blogs.Add(new Blog { Url = &quot;http://sample.com/blog_two&quot; });

//update
var firstBlog = context.Blogs.First();
firstBlog.Url = &quot;&quot;;

//remove
var lastBlog = context.Blogs.Last();
context.Blogs.Remove(lastBlog);
context.SaveChanges();
</code></pre>
<p>*&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;, &#x5B9E;&#x4F53;&#x901A;&#x8FC7;A&#x4E0A;&#x4E0B;&#x6587;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x540E;, &#x9700;&#x8981;&#x5728;B&#x4E0A;&#x4E0B;&#x6587;&#x4FDD;&#x5B58;, &#x8FD9;&#x65F6;&#x5019;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x6267;&#x884C;context.Add/context.Update</p>
<pre class="language-"><code class="lang-C#">public static void Insert(DbContext context, object entity)
{
    context.Add(entity);
    context.SaveChanges();
}

public static void Update(DbContext context, object entity)
{
    context.Update(entity);
    context.SaveChanges();
}
</code></pre>
<p>*&#x5982;&#x679C;&#x5B9E;&#x4F53;&#x4E0D;&#x4F7F;&#x7528;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x952E;&#xFF0C;&#x5219;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x786E;&#x5B9A;&#x662F;&#x5E94;&#x63D2;&#x5165;&#x5B9E;&#x4F53;&#x8FD8;&#x662F;&#x5E94;&#x66F4;&#x65B0;&#x5B9E;&#x4F53;</p>
<pre class="language-"><code class="lang-C#">public static void InsertOrUpdate(BloggingContext context, Blog blog)
{
    var existingBlog = context.Blogs.Find(blog.BlogId);
    if (existingBlog == null)
    {
        context.Add(blog);
    }
    else
    {
       // SetValues &#x8C03;&#x7528;&#x5C06;&#x6839;&#x636E;&#x9700;&#x8981;&#xFF0C;&#x6807;&#x8BB0;&#x8981;&#x66F4;&#x65B0;&#x7684;&#x5B9E;&#x4F53;&#x5C5E;&#x6027;&#x3002;&#x539F;&#x7406;&#x662F;&#xFF1A;&#x8981;&#x66F4;&#x65B0;&#x7684;&#x5B9E;&#x4F53;&#x4E0E;&#x4E4B;&#x524D;&#x67E5;&#x8BE2;&#x7684;&#x5B9E;&#x4F53;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x53EA;&#x4F1A;&#x66F4;&#x65B0;&#x5B9E;&#x9645;&#x53D1;&#x751F;&#x66F4;&#x6539;&#x7684;&#x5217;
       context.Entry(existingBlog).CurrentValues.SetValues(blog);
    }
    context.SaveChanges();
}
</code></pre>
<p>*&#x5B9E;&#x4F53;&#x7EA7;&#x8054;&#x64CD;&#x4F5C;</p>
<p>*&#x7EA7;&#x8054;&#x6DFB;&#x52A0;</p>
<pre class="language-"><code class="lang-C#">var blog = new Blog
{
    Url = &quot;http://blogs.msdn.com/dotnet&quot;,
    Posts = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span>
    {
        new Post { Title = &quot;Intro to C#&quot; },
        new Post { Title = &quot;Intro to VB.NET&quot; },
        new Post { Title = &quot;Intro to F#&quot; }
    }
};

context.Blogs.Add(blog);
context.SaveChanges();
</code></pre>
<pre class="language-"><code class="lang-C#">var blog = context.Blogs.Include(b =&gt; b.Posts).First();
var post = new Post { Title = &quot;Intro to EF Core&quot; };
//&#x5F15;&#x7528;&#x65B0;&#x5B9E;&#x4F53;
blog.Posts.Add(post);

context.SaveChanges();
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x4E3B;&#x4F53;&#x5B9E;&#x4F53;
var blog = new Blog { Url = &quot;http://blogs.msdn.com/visualstudio&quot; };
var post = context.Posts.First();
//post&#x66F4;&#x65B0;&#x5173;&#x7CFB;
post.Blog = blog;

context.SaveChanges();
</code></pre>
<pre class="language-"><code class="lang-C#">var blog = context.Blogs.Include(b =&gt; b.Posts).First();
var post = blog.Posts.First();
//&#x5220;&#x9664;&#x4E00;&#x6761;post&#x4F9D;&#x8D56;&#x5B9E;&#x4F53;
blog.Posts.Remove(post);

context.SaveChanges();
</code></pre>
<hr>
<h2 id="9&#x5220;&#x9664;"><a name="9&#x5220;&#x9664;" class="anchor-navigation-ex-anchor" href="#9&#x5220;&#x9664;"><i class="fa fa-link" aria-hidden="true"></i></a>9&gt;&#x5220;&#x9664;</h2>
<pre class="language-"><code class="lang-C#">//&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;
var blog = context.Blogs.First();
context.Blogs.Remove(blog);
context.SaveChanges();

//&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;
Blog blog = new Blog() { Url = &quot;www.baidu.com&quot; };
//&#x6DFB;&#x52A0;&#x540E;&#x8BE5;&#x5B9E;&#x4F53;&#x4E3A;&#x5DF2;&#x6DFB;&#x52A0;&#xFF0C;&#x5C1A;&#x672A;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;
BloggingContext.Blogs.Add(blog);
//&#x5220;&#x9664;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;
BloggingContext.Blogs.Remove(blog);
//&#x4ECE;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x79FB;&#x9664;blog&#x5B9E;&#x4F53;
BloggingContext.SaveChanges();
</code></pre>
<p>*&#x7EA7;&#x8054;&#x5220;&#x9664;</p>
<pre class="language-"><code class="lang-C#">var blog = context.Blogs.Include(b =&gt; b.Posts).First();
var posts = blog.Posts.ToList();
context.Remove(blog);

context.SaveChanges();
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x6D4B;&#x8BD5;&#x4E0D;&#x9884;&#x52A0;&#x8F7D;, &#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x7EA7;&#x8054;&#x5220;&#x9664;(&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;:&#x53EF;&#x4EE5;)
var id = 1470214131637424132L;
var people = await EFDbContext.Peoples.TagWith(&quot;my statement&quot;)
    .AsTracking()
    .SingleOrDefaultAsync(p =&gt; p.Id == id);

EFDbContext.Peoples.Remove(people);

var affectRowCount = await EFDbContext.SaveChangesAsync(cancellationToken);
</code></pre>
<pre class="language-"><code class="lang-C#">var people = await EFDbContext.Peoples.Include(t =&gt; t.Cars).Where(t =&gt; t.Cars.Count &gt; 0).FirstOrDefaultAsync();
//&#x4F7F;&#x7528;clear(&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;: &#x5220;&#x9664;&#x4E86;people&#x7684;Cars)
people.Cars.Clear();
var affectRowCount = await EFDbContext.SaveChangesAsync(cancellationToken);
</code></pre>
<pre class="language-"><code class="lang-C#">var entry1 = EFDbContext.Entry(people);
_ = entry1.DebugView.LongView;
//&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;: &#x5220;&#x9664;&#x4E86;people&#x7684;Cars
EFDbContext.Cars.RemoveRange(people.Cars);
_ = entry1.DebugView.LongView;
var affectRowCount = await EFDbContext.SaveChangesAsync(cancellationToken);
</code></pre>
<hr>
<h2 id="10&#x4E8B;&#x52A1;"><a name="10&#x4E8B;&#x52A1;" class="anchor-navigation-ex-anchor" href="#10&#x4E8B;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>10&gt;&#x4E8B;&#x52A1;</h2>
<p>*dbcontext.SaveChanges &#x9ED8;&#x8BA4;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x652F;&#x6301;&#x4E8B;&#x52A1;, &#x5C31;&#x4F1A;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#x884C;&#x4E3A;(&#x9690;&#x5F0F;&#x4E8B;&#x52A1;)</p>
<h3 id="&#x663E;&#x5F0F;&#x63A7;&#x5236;&#x4E8B;&#x52A1;"><a name="&#x663E;&#x5F0F;&#x63A7;&#x5236;&#x4E8B;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x663E;&#x5F0F;&#x63A7;&#x5236;&#x4E8B;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x663E;&#x5F0F;&#x63A7;&#x5236;&#x4E8B;&#x52A1;</code></h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6D4B;&#x8BD5;&#x4E8B;&#x52A1;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> TestTransaction(CancellationToken cancellationToken)
{
    //1&gt;&#x663E;&#x793A;&#x4F7F;&#x7528;&#x4E8B;&#x52A1;
    using CALCDbContext dbContext = new(SystemConfigOption);
    using var transaction = dbContext.Database.BeginTransaction();

    try
    {
        var nameCharList = new char[]
        {
            &apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;,&apos;e&apos;,&apos;f&apos;,&apos;g&apos;,&apos;h&apos;,&apos;i&apos;,&apos;j&apos;,&apos;k&apos;,&apos;l&apos;,&apos;m&apos;,&apos;n&apos;,&apos;o&apos;,&apos;p&apos;,&apos;q&apos;,&apos;r&apos;,&apos;s&apos;,&apos;t&apos;,&apos;u&apos;,&apos;v&apos;,&apos;w&apos;,&apos;x&apos;,&apos;y&apos;,&apos;z&apos;,
            &apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;G&apos;,&apos;H&apos;,&apos;I&apos;,&apos;J&apos;,&apos;K&apos;,&apos;L&apos;,&apos;M&apos;,&apos;N&apos;,&apos;O&apos;,&apos;P&apos;,&apos;Q&apos;,&apos;R&apos;,&apos;S&apos;,&apos;T&apos;,&apos;U&apos;,&apos;V&apos;,&apos;W&apos;,&apos;X&apos;,&apos;Y&apos;,&apos;Z&apos;,
            &apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;
        };
        var charCount = nameCharList.Count();

        //&#x6784;&#x9020;people
        var nameLength = FramePublicFun.GetRandomByGuid(4, 11);
        var nameStr = &quot;&quot;;
        for (var j = 0; j &lt; nameLength; j++)
        {
            nameStr += nameCharList[FramePublicFun.GetRandomByGuid(0, charCount)];
        }

        //&#x6784;&#x9020;car
        List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span> carList = new();
        var carCount = FramePublicFun.GetRandomByGuid(1, 4);
        for (var ii = 0; ii &lt; carCount; ii++)
        {
            Car car = new()
            {
                MSN = FramePublicFun.GetRandomByGuid(1000, 9999).ToString(),
                Cost = FramePublicFun.GetRandomByGuid(100000, 999999),
            };
            carList.Add(car);
        }

        //&#x4FDD;&#x5B58;p1
        People p1 = new()
        {
            Name = nameStr,
            Cars = carList
        };
        await dbContext.Peoples.AddAsync(p1, cancellationToken);
        await dbContext.SaveChangesAsync(cancellationToken);

        //&#x82E5;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x6267;&#x884C;&#x5931;&#x8D25;, &#x5728;transaction&#x5BF9;&#x8C61;&#x91CA;&#x653E;&#x7684;&#x65F6;&#x5019;, &#x4F1A;&#x81EA;&#x52A8;&#x6267;&#x884C;&#x56DE;&#x6EDA;&#x64CD;&#x4F5C;
        transaction.Commit();

        return Json(new
        {
            Success = true
        });
    }
    catch (Exception ex)
    {
        var errorMsg = ex.GetInnerExceptionMsg();
        return Json(new
        {
            errorMsg
        });
    }
}
</code></pre>
<h3 id="&#x4FDD;&#x5B58;&#x70B9;"><a name="&#x4FDD;&#x5B58;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x5B58;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x4FDD;&#x5B58;&#x70B9;</code></h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6D4B;&#x8BD5;&#x4E8B;&#x52A1;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> TestTransaction(CancellationToken cancellationToken)
{
    //1&gt;&#x663E;&#x793A;&#x4F7F;&#x7528;&#x4E8B;&#x52A1;
    using CALCDbContext dbContext = new(SystemConfigOption);
    using var transaction = dbContext.Database.BeginTransaction();

    try
    {
        var nameCharList = new char[]
        {
            &apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;,&apos;e&apos;,&apos;f&apos;,&apos;g&apos;,&apos;h&apos;,&apos;i&apos;,&apos;j&apos;,&apos;k&apos;,&apos;l&apos;,&apos;m&apos;,&apos;n&apos;,&apos;o&apos;,&apos;p&apos;,&apos;q&apos;,&apos;r&apos;,&apos;s&apos;,&apos;t&apos;,&apos;u&apos;,&apos;v&apos;,&apos;w&apos;,&apos;x&apos;,&apos;y&apos;,&apos;z&apos;,
            &apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;G&apos;,&apos;H&apos;,&apos;I&apos;,&apos;J&apos;,&apos;K&apos;,&apos;L&apos;,&apos;M&apos;,&apos;N&apos;,&apos;O&apos;,&apos;P&apos;,&apos;Q&apos;,&apos;R&apos;,&apos;S&apos;,&apos;T&apos;,&apos;U&apos;,&apos;V&apos;,&apos;W&apos;,&apos;X&apos;,&apos;Y&apos;,&apos;Z&apos;,
            &apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;
        };
        var charCount = nameCharList.Count();

        //&#x6784;&#x9020;people
        var nameLength = FramePublicFun.GetRandomByGuid(4, 11);
        var nameStr = &quot;&quot;;
        for (var j = 0; j &lt; nameLength; j++)
        {
            nameStr += nameCharList[FramePublicFun.GetRandomByGuid(0, charCount)];
        }

        //&#x6784;&#x9020;car
        List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span> carList = new();
        var carCount = FramePublicFun.GetRandomByGuid(1, 4);
        for (var ii = 0; ii &lt; carCount; ii++)
        {
            Car car = new()
            {
                MSN = FramePublicFun.GetRandomByGuid(1000, 9999).ToString(),
                Cost = FramePublicFun.GetRandomByGuid(100000, 999999),
            };
            carList.Add(car);
        }

        //&#x4FDD;&#x5B58;p1
        People p1 = new()
        {
            Name = nameStr,
            Cars = carList
        };
        await dbContext.Peoples.AddAsync(p1, cancellationToken);
        await dbContext.SaveChangesAsync(cancellationToken);

        //&#x8BBE;&#x7F6E;&#x56DE;&#x6EDA;&#x7528;&#x7684;&#x4FDD;&#x5B58;&#x70B9;
        transaction.CreateSavepoint(&quot;BeforeSavePeople2&quot;);

        People p2 = new()
        {
            Name = nameStr,
            Cars = carList
        };
        await dbContext.Peoples.AddAsync(p2, cancellationToken);
        await dbContext.SaveChangesAsync(cancellationToken);

        //&#x82E5;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x6267;&#x884C;&#x5931;&#x8D25;, &#x5728;transaction&#x5BF9;&#x8C61;&#x91CA;&#x653E;&#x7684;&#x65F6;&#x5019;, &#x4F1A;&#x81EA;&#x52A8;&#x6267;&#x884C;&#x56DE;&#x6EDA;&#x64CD;&#x4F5C;
        transaction.Commit();

        return Json(new
        {
            Success = true
        });
    }
    catch (Exception ex)
    {
        //&#x5982;&#x679C;&#x53D1;&#x751F;&#x9519;&#x8BEF;, &#x53EF;&#x4EE5;&#x5C06;&#x4E8B;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x4FDD;&#x5B58;&#x70B9;, &#x5E76;&#x7EE7;&#x7EED;&#x5F53;&#x524D;&#x4E8B;&#x52A1;
        transaction.RollbackToSavepoint(&quot;BeforeSavePeople2&quot;);
        transaction.Commit();

        return Json(new
        {
            Success = true
        });
    }
}
</code></pre>
<h3 id="&#x8DE8;&#x591A;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E8B;&#x52A1;&#xFF08;&#x4EC5;&#x9650;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF09;"><a name="&#x8DE8;&#x591A;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E8B;&#x52A1;&#xFF08;&#x4EC5;&#x9650;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x8DE8;&#x591A;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E8B;&#x52A1;&#xFF08;&#x4EC5;&#x9650;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x8DE8;&#x591A;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E8B;&#x52A1;&#xFF08;&#x4EC5;&#x9650;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF09;</code></h3>
<p>DbContext&#x5FC5;&#x987B;&#x7528;&#x540C;&#x4E00;&#x4E2A;DbContextOptions&#x5B9E;&#x4F8B;&#x5316;, &#x5426;&#x5219;&#x4F1A;&#x62A5;&#x9519;.</p>
<pre class="language-"><code class="lang-C#">public class BloggingContext : DbContext
{
    private DbConnection _connection;

    public BloggingContext(DbConnection connection)
    {
      _connection = connection;
    }

    public DbSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Blog</span><span class="token punctuation">&gt;</span></span> Blogs { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlServer(_connection);
    }
}



using var connection = new SqlConnection(connectionString);
var options = new DbContextOptionsBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BloggingContext</span><span class="token punctuation">&gt;</span></span>()
    .UseSqlServer(connection)
    .Options;

using var context1 = new BloggingContext(options);
using var transaction = context1.Database.BeginTransaction();
try
{
    context1.Blogs.Add(new Blog { Url = &quot;http://blogs.msdn.com/dotnet&quot; });
    context1.SaveChanges();

    using (var context2 = new BloggingContext(options))
    {
        context2.Database.UseTransaction(transaction.GetDbTransaction());

        var blogs = context2.Blogs
            .OrderBy(b =&gt; b.Url)
            .ToList();
    }

    // Commit transaction if all commands succeed, transaction will auto-rollback
    // when disposed if either commands fails
    transaction.Commit();
}
catch (Exception)
{
    // TODO: Handle failure
}
</code></pre>
<h3 id="&#x591A;&#x79CD;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6280;&#x672F;&#x5171;&#x4EAB;&#x4E8B;&#x52A1;"><a name="&#x591A;&#x79CD;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6280;&#x672F;&#x5171;&#x4EAB;&#x4E8B;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x591A;&#x79CD;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6280;&#x672F;&#x5171;&#x4EAB;&#x4E8B;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x591A;&#x79CD;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6280;&#x672F;&#x5171;&#x4EAB;&#x4E8B;&#x52A1;</code></h3>
<pre class="language-"><code class="lang-C#">using var connection = new SqlConnection(connectionString);
connection.Open();

using var transaction = connection.BeginTransaction();
try
{
    // Run raw ADO.NET command in the transaction
    var command = connection.CreateCommand();
    command.Transaction = transaction;
    command.CommandText = &quot;DELETE FROM dbo.Blogs&quot;;
    command.ExecuteNonQuery();

    // Run an EF Core command in the transaction
    var options = new DbContextOptionsBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BloggingContext</span><span class="token punctuation">&gt;</span></span>()
        .UseSqlServer(connection)
        .Options;

    using (var context = new BloggingContext(options))
    {
        context.Database.UseTransaction(transaction);
        context.Blogs.Add(new Blog { Url = &quot;http://blogs.msdn.com/dotnet&quot; });
        context.SaveChanges();
    }

    // Commit transaction if all commands succeed, transaction will auto-rollback
    // when disposed if either commands fails
    transaction.Commit();
}
catch (Exception)
{
    // TODO: Handle failure
}
</code></pre>
<h3 id="&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"><a name="&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;</code></h3>
<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x8DE8;&#x5927;&#x4F5C;&#x7528;&#x57DF;&#x8FDB;&#x884C;&#x534F;&#x8C03;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF08;&#x8DE8;&#x5E93;&#x4E8B;&#x52A1;&#xFF09;TransactionScope&#xFF0C;&#x5B83;&#x53EF;&#x534F;&#x8C03;&#x8DE8;&#x591A;&#x4E2A;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x4E8B;&#x52A1;&#x3002;&#x5B58;&#x5728;&#x4E8E;ADO.NET &#x4E2D;&#x7684;System.Transactions&#x547D;&#x4EE4;&#x7A7A;&#x95F4;&#x3002;</p>
<pre class="language-"><code class="lang-C#">using (var scope = new TransactionScope(
    TransactionScopeOption.Required,
    new TransactionOptions { IsolationLevel = IsolationLevel.ReadCommitted }))
{
    using var connection = new SqlConnection(connectionString);
    connection.Open();

    try
    {
        // Run raw ADO.NET command in the transaction
        var command = connection.CreateCommand();
        command.CommandText = &quot;DELETE FROM dbo.Blogs&quot;;
        command.ExecuteNonQuery();

        // Run an EF Core command in the transaction
        var options = new DbContextOptionsBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BloggingContext</span><span class="token punctuation">&gt;</span></span>()
            .UseSqlServer(connection)
            .Options;

        using (var context = new BloggingContext(options))
        {
            context.Blogs.Add(new Blog { Url = &quot;http://blogs.msdn.com/dotnet&quot; });
            context.SaveChanges();
        }

        // Commit transaction if all commands succeed, transaction will auto-rollback
        // when disposed if either commands fails
        scope.Complete();
    }
    catch (Exception)
    {
        // TODO: Handle failure
    }
}
</code></pre>
<p>&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x663E;&#x793A;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;</p>
<pre class="language-"><code class="lang-C#">using (var transaction = new CommittableTransaction(
    new TransactionOptions { IsolationLevel = IsolationLevel.ReadCommitted }))
{
    var connection = new SqlConnection(connectionString);

    try
    {
        var options = new DbContextOptionsBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BloggingContext</span><span class="token punctuation">&gt;</span></span>()
            .UseSqlServer(connection)
            .Options;

        using (var context = new BloggingContext(options))
        {
            context.Database.OpenConnection();
            context.Database.EnlistTransaction(transaction);

            // Run raw ADO.NET command in the transaction
            var command = connection.CreateCommand();
            command.CommandText = &quot;DELETE FROM dbo.Blogs&quot;;
            command.ExecuteNonQuery();

            // Run an EF Core command in the transaction
            context.Blogs.Add(new Blog { Url = &quot;http://blogs.msdn.com/dotnet&quot; });
            context.SaveChanges();
            context.Database.CloseConnection();
        }

        // Commit transaction if all commands succeed, transaction will auto-rollback
        // when disposed if either commands fails
        transaction.Commit();
    }
    catch (Exception)
    {
        // TODO: Handle failure
    }
}
</code></pre>
<h3 id="&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;isolationlevel"><a name="&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;isolationlevel" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;isolationlevel"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;(IsolationLevel)</code></h3>
<p><a href="https://www.cnblogs.com/wms01/p/6183241.html" target="_blank">https://www.cnblogs.com/wms01/p/6183241.html</a></p>
<p>&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x4E0E;&#x5E76;&#x53D1;&#x6027;&#x662F;&#x4E92;&#x4E3A;&#x77DB;&#x76FE;&#x7684;&#xFF1A;&#x9694;&#x79BB;&#x7A0B;&#x5EA6;&#x8D8A;&#x9AD8;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5E76;&#x53D1;&#x6027;&#x8D8A;&#x5DEE;&#xFF1B;&#x9694;&#x79BB;&#x7A0B;&#x5EA6;&#x8D8A;&#x4F4E;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5E76;&#x53D1;&#x6027;&#x8D8A;&#x597D;.</p>
<p>1&#x3001;ReadUncommitted</p>
<p>&#x672A;&#x63D0;&#x4EA4;&#x8BFB;&#x3002;&#x5F53;&#x4E8B;&#x52A1;A&#x66F4;&#x65B0;&#x67D0;&#x6761;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x5BB9;&#x8BB8;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x6765;&#x66F4;&#x65B0;&#x8BE5;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;</p>
<p>2&#x3001;ReadCommitted</p>
<p>&#x63D0;&#x4EA4;&#x8BFB;&#x3002;&#x5F53;&#x4E8B;&#x52A1;A&#x66F4;&#x65B0;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4E0D;&#x5BB9;&#x8BB8;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x7684;&#x64CD;&#x4F5C;&#x5305;&#x62EC;&#x8BFB;&#x53D6;&#xFF0C;&#x4F46;&#x4E8B;&#x52A1;A&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x3001;&#x66F4;&#x65B0;</p>
<p>3&#x3001;RepeatableRead</p>
<p>&#x91CD;&#x590D;&#x8BFB;&#x3002;&#x5F53;&#x4E8B;&#x52A1;A&#x66F4;&#x65B0;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4E0D;&#x5BB9;&#x8BB8;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x4E8B;&#x52A1;A&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x53EA;&#x80FD;&#x8BFB;&#x53D6;&#xFF0C;&#x4E0D;&#x80FD;&#x66F4;&#x65B0;</p>
<p>4&#x3001;Serializable</p>
<p>&#x5E8F;&#x5217;&#x5316;&#x3002;&#x6700;&#x4E25;&#x683C;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x5F53;&#x7136;&#x5E76;&#x53D1;&#x6027;&#x4E5F;&#x662F;&#x6700;&#x5DEE;&#x7684;&#xFF0C;&#x4E8B;&#x52A1;&#x5FC5;&#x987B;&#x4F9D;&#x6B21;&#x8FDB;&#x884C;&#x3002;</p>
<hr>
<h2 id="11&#x8BBE;&#x7F6E;sql-server-identity&#x5217;&#x4E2D;&#x7684;&#x663E;&#x5F0F;&#x503C;"><a name="11&#x8BBE;&#x7F6E;sql-server-identity&#x5217;&#x4E2D;&#x7684;&#x663E;&#x5F0F;&#x503C;" class="anchor-navigation-ex-anchor" href="#11&#x8BBE;&#x7F6E;sql-server-identity&#x5217;&#x4E2D;&#x7684;&#x663E;&#x5F0F;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a>11&gt;&#x8BBE;&#x7F6E;SQL Server IDENTITY&#x5217;&#x4E2D;&#x7684;&#x663E;&#x5F0F;&#x503C;</h2>
<p>&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x662F;&#x7531;&#x6570;&#x636E;&#x5E93;&#x751F;&#x6210;&#x81EA;&#x589E;&#x957F;ID. &#x5982;&#x679C;&#x8981;&#x9700;&#x8981;&#x663E;&#x5F0F;&#x503C;&#x63D2;&#x5165;<code>IDENTITY</code>&#x5217;, &#x9700;&#x8981;&#x5728;&#x8C03;&#x7528;<code>SaveChanges()</code>&#x4E4B;&#x524D;, &#x624B;&#x52A8;&#x542F;&#x7528;<code>IDENTITY_INSERT</code>.</p>
<pre class="language-"><code class="lang-C#">using (var context = new EmployeeContext())
{
    context.Employees.Add(new Employee { EmployeeId = 100, Name = &quot;John Doe&quot; });
    context.Employees.Add(new Employee { EmployeeId = 101, Name = &quot;Jane Doe&quot; });

    context.Database.OpenConnection();
    try
    {
        context.Database.ExecuteSqlInterpolated(&quot;SET IDENTITY_INSERT dbo.Employees ON&quot;);
        context.SaveChanges();
        context.Database.ExecuteSqlInterpolated(&quot;SET IDENTITY_INSERT dbo.Employees OFF&quot;);
    }
    finally
    {
        context.Database.CloseConnection();
    }
}
</code></pre>
<hr>
<h2 id="12&#x96C6;&#x6210;dapper-&#x7528;&#x4E8E;&#x590D;&#x6742;&#x67E5;&#x8BE2;"><a name="12&#x96C6;&#x6210;dapper-&#x7528;&#x4E8E;&#x590D;&#x6742;&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#12&#x96C6;&#x6210;dapper-&#x7528;&#x4E8E;&#x590D;&#x6742;&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>12&gt;&#x96C6;&#x6210;Dapper, &#x7528;&#x4E8E;&#x590D;&#x6742;&#x67E5;&#x8BE2;</h2>
<p><a href="https://www.cnblogs.com/flywong/p/9666963.html" target="_blank">https://www.cnblogs.com/flywong/p/9666963.html</a></p>
<p><a href="https://www.cnblogs.com/zhangnever/p/11926045.html" target="_blank">https://www.cnblogs.com/zhangnever/p/11926045.html</a></p>
<p>&#x6DFB;&#x52A0;<code>Dapper</code>&#x5305;, <code>Dapper</code>&#x901A;&#x8FC7;&#x62D3;&#x5C55;<code>DbConnection</code>&#x5B9E;&#x73B0;<code>ADO</code>&#x64CD;&#x4F5C;, &#x5728;EF&#x4E2D;&#x6DF7;&#x5408;&#x4F7F;&#x7528;Dapper, &#x53EF;&#x4EE5;&#x4ECE;&#x4E0A;&#x4E0B;&#x6587;&#x83B7;&#x53D6;DbConnection, &#x4EE5;&#x53CA;&#x6839;&#x636E;&#x60C5;&#x51B5;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x4E8B;&#x52A1;.</p>
<pre class="language-"><code class="lang-C#">                //5&gt;&#x4F7F;&#x7528;dapper&#x5904;&#x7406;&#x590D;&#x6742;&#x8BED;&#x53E5;
                DbConnection dbConnection = EFDbContext.Database.GetDbConnection();
                DbTransaction dbTransaction = default;
                if (EFDbContext.Database.CurrentTransaction != default)
                {
                    dbTransaction = EFDbContext.Database.CurrentTransaction.GetDbTransaction();
                }

                var schema = EFDbContext.Schema;
                var dynamicParameters = new DynamicParameters();
                dynamicParameters.Add(&quot;@Extension&quot;, &quot;%_122&quot;);

                var resultList = await dbConnection.QueryAsync(string.Format(@&quot;select
T_Author.Id as AuthorId,
T_Author.Name as AuthorName,
T_Blog.Url as BlogUrl,
T_Blog.OpenDate as BlogOpenDate
from {0}.T_Author as T_Author
inner join {0}.T_Blog as T_Blog
on T_Blog.AuthorId = T_Author.Id
where T_Author.Name not like @Extension
and not exists
(
    select T_PostCollectCatgory.Id
    from {0}.T_PostCollectCatgory as T_PostCollectCatgory
    where T_PostCollectCatgory.AuthorId = T_Author.Id
)&quot;, schema), dynamicParameters, dbTransaction);
                //&#x5C06;dynamic&#x5217;&#x8868;&#x8F6C;&#x6210;IDictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,object</span><span class="token punctuation">&gt;</span></span>&#x5217;&#x8868;
                var dicList = resultList.Cast&lt;IDictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span>&gt;().ToList();

                return Json(dicList);
            }
            catch (Exception ex)
            {
                return Json(new
                {
                    ErrorMsg = ex.GetInnerExceptionMsg()
                });
            }
</code></pre>
<hr>
<h2 id="13&#x96EA;&#x82B1;id"><a name="13&#x96EA;&#x82B1;id" class="anchor-navigation-ex-anchor" href="#13&#x96EA;&#x82B1;id"><i class="fa fa-link" aria-hidden="true"></i></a>13&gt;&#x96EA;&#x82B1;ID</h2>
<p><a href="https://www.cnblogs.com/zxtceq/articles/15029054.html" target="_blank">https://www.cnblogs.com/zxtceq/articles/15029054.html</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/374667160" target="_blank">https://zhuanlan.zhihu.com/p/374667160</a></p>
<p><a href="https://www.cnblogs.com/dunitian/p/6130543.html" target="_blank">https://www.cnblogs.com/dunitian/p/6130543.html</a></p>
<p>&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5168;&#x5C40;&#x552F;&#x4E00;ID&#x7684;&#x573A;&#x666F;&#xFF0C;&#x8FD9;&#x79CD;&#x65F6;&#x5019;&#x4E3A;&#x4E86;&#x9632;&#x6B62;ID&#x51B2;&#x7A81;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;36&#x4F4D;&#x7684;UUID&#xFF0C;&#x4F46;&#x662F;UUID&#x6709;&#x4E00;&#x4E9B;&#x7F3A;&#x70B9;&#xFF0C;&#x9996;&#x5148;&#x4ED6;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x53E6;&#x5916;UUID&#x4E00;&#x822C;&#x662F;&#x65E0;&#x5E8F;&#x7684;&#x3002;&#x6709;&#x4E9B;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x80FD;&#x4F7F;&#x7528;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x4E00;&#x4E9B;&#x7684;ID&#xFF0C;&#x5E76;&#x4E14;&#x5E0C;&#x671B;ID&#x80FD;&#x591F;&#x6309;&#x7167;&#x65F6;&#x95F4;&#x6709;&#x5E8F;&#x751F;&#x6210;&#x3002;&#x800C;twitter&#x7684;snowflake&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x6700;&#x521D;Twitter&#x628A;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x4ECE;MySQL&#x8FC1;&#x79FB;&#x5230;Cassandra&#xFF0C;&#x56E0;&#x4E3A;Cassandra&#x6CA1;&#x6709;&#x987A;&#x5E8F;ID&#x751F;&#x6210;&#x673A;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x5F00;&#x53D1;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x5957;&#x5168;&#x5C40;&#x552F;&#x4E00;ID&#x751F;&#x6210;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x96EA;&#x82B1;&#x7B97;&#x6CD5;&#x7684;&#x539F;&#x59CB;&#x7248;&#x672C;&#x662F; <a href="https://github.com/twitter/snowflake/releases/tag/snowflake-2010" target="_blank">Scala </a>&#x7248;&#xFF0C;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x5206;&#x5E03;&#x5F0F;ID&#xFF08;&#x7EAF;&#x6570;&#x5B57;&#xFF0C;&#x65F6;&#x95F4;&#x987A;&#x5E8F;&#xFF09;,&#x8BA2;&#x5355;&#x7F16;&#x53F7;&#x7B49;&#x3002;</p>
<p><em>&#x81EA;&#x589E;ID&#xFF1A;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x654F;&#x611F;&#x573A;&#x666F;&#x4E0D;&#x5B9C;&#x4F7F;&#x7528;&#xFF0C;&#x4E14;&#x4E0D;&#x9002;&#x5408;&#x4E8E;&#x5206;&#x5E03;&#x5F0F;&#x573A;&#x666F;&#x3002;
</em>GUID&#xFF1A;&#x91C7;&#x7528;&#x65E0;&#x610F;&#x4E49;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6570;&#x636E;&#x91CF;&#x589E;&#x5927;&#x65F6;&#x9020;&#x6210;&#x8BBF;&#x95EE;&#x8FC7;&#x6162;&#xFF0C;&#x4E14;&#x4E0D;&#x5B9C;&#x6392;&#x5E8F;&#x3002;&#x5927;&#x90E8;&#x5206;&#x6570;&#x636E;&#x5E93;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x4E3B;&#x952E;&#x8BBE;&#x7F6E;&#x4E3A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF0C;&#x4E25;&#x91CD;&#x5F71;&#x54CD;CUD&#x64CD;&#x4F5C;, &#x9700;&#x8981;&#x5C06;GUID&#x7684;&#x4E3B;&#x952E;&#x8BBE;&#x7F6E;&#x4E3A;&#x975E;&#x805A;&#x96C6;&#x7D22;&#x5F15;.(MySQL5.x&#x4E3B;&#x952E;&#x65E0;&#x6CD5;&#x6539;&#x6210;&#x975E;&#x805A;&#x96C6;&#x7D22;&#x5F15;, &#x8FD9;&#x662F;&#x4E2A;&#x5927;&#x5751;).</p>
<p>*HILO: &#x9AD8;&#x4F4E;&#x4F4D;&#x7B97;&#x6CD5;, &#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B97;&#x6CD5;, &#x4E5F;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;.</p>
<p><img src="EF Core.assets/SnowFlake.jpg" alt="img"></p>
<h3 id="13-1&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;"><a name="13-1&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;" class="anchor-navigation-ex-anchor" href="#13-1&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;"><i class="fa fa-link" aria-hidden="true"></i></a>13-1&gt;&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;</h3>
<ul>
<li>&#x6700;&#x9AD8;&#x4F4D;&#x662F;&#x7B26;&#x53F7;&#x4F4D;&#xFF0C;&#x59CB;&#x7EC8;&#x4E3A;0&#xFF0C;&#x4E0D;&#x53EF;&#x7528;&#x3002;</li>
<li>41&#x4F4D;&#x7684;&#x65F6;&#x95F4;&#x5E8F;&#x5217;&#xFF0C;&#x7CBE;&#x786E;&#x5230;&#x6BEB;&#x79D2;&#x7EA7;&#xFF0C;41&#x4F4D;&#x7684;&#x957F;&#x5EA6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;69&#x5E74;&#x3002;&#x65F6;&#x95F4;&#x4F4D;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</li>
<li>10&#x4F4D;&#x7684;&#x673A;&#x5668;&#x6807;&#x8BC6;&#xFF0C;10&#x4F4D;&#x7684;&#x957F;&#x5EA6;&#x6700;&#x591A;&#x652F;&#x6301;&#x90E8;&#x7F72;1024&#x4E2A;&#x8282;&#x70B9;&#x3002;</li>
<li>12&#x4F4D;&#x7684;&#x8BA1;&#x6570;&#x5E8F;&#x5217;&#x53F7;&#xFF0C;&#x5E8F;&#x5217;&#x53F7;&#x5373;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x81EA;&#x589E;id&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x540C;&#x4E00;&#x8282;&#x70B9;&#x540C;&#x4E00;&#x6BEB;&#x79D2;&#x751F;&#x6210;&#x591A;&#x4E2A;ID&#x5E8F;&#x53F7;&#xFF0C;12&#x4F4D;&#x7684;&#x8BA1;&#x6570;&#x5E8F;&#x5217;&#x53F7;&#x652F;&#x6301;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x6BCF;&#x6BEB;&#x79D2;&#x4EA7;&#x751F;4096&#x4E2A;ID&#x5E8F;&#x53F7;&#x3002;</li>
</ul>
<h3 id="13-2net-core&#x4E2D;&#x4F7F;&#x7528;"><a name="13-2net-core&#x4E2D;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#13-2net-core&#x4E2D;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>13-2&gt;Net Core&#x4E2D;&#x4F7F;&#x7528;</h3>
<p>*&#x4E3B;&#x952E;&#x5B57;&#x6BB5;&#x8BBE;&#x7F6E;&#x4E3A;bigint/vachar(50)&#x7C7B;&#x578B;</p>
<p>PS: &#x505A;&#x8FC7;&#x6570;&#x91CF;&#x6279;&#x91CF;&#x63D2;&#x5165;&#x7684;&#x6D4B;&#x8BD5;, &#x8BBE;&#x7F6E;&#x4E3A;bigint&#x7C7B;&#x578B;, &#x6267;&#x884C;&#x901F;&#x5EA6;&#x4F1A;&#x6BD4;varchar(50)&#x5FEB;</p>
<pre class="language-"><code class="lang-C#">//BaseLogicEntity.cs
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x903B;&#x8F91;&#x57FA;&#x7C7B;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public abstract class BaseLogicEntity : BaseEntity
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// Id
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Key] //&#x4E3B;&#x952E; 
    [DatabaseGenerated(DatabaseGeneratedOption.None)]  //&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x751F;&#x6210;
    //[Column(TypeName = &quot;varchar(50)&quot;)]
    [Column(TypeName = &quot;bigint&quot;)]
    [Comment(&quot;Id&quot;)]
    [Required]
    //public virtual string Id { get; set; } = SnowflakeID.GetInstance().GetNextID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>();
    public virtual long Id { get; set; } = SnowflakeID.GetInstance().GetNextID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>long</span><span class="token punctuation">&gt;</span></span>();

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x521B;&#x5EFA;&#x65F6;&#x95F4;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Column(TypeName = &quot;datetimeoffset(7)&quot;)]
    [Comment(&quot;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&quot;)]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public virtual DateTimeOffset? AddTime { get; set; } = DateTimeOffset.UtcNow;

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x521B;&#x5EFA;&#x8005;Id
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Comment(&quot;&#x521B;&#x5EFA;&#x8005;Id&quot;)]
    [Column(TypeName = &quot;varchar(50)&quot;)]
    public virtual string AddUserId { get; set; }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x521B;&#x5EFA;&#x8005;IP
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Column(TypeName = &quot;varchar(130)&quot;)]
    [Comment(&quot;&#x521B;&#x5EFA;&#x8005;IP&quot;)]
    public virtual string AddIP { get; set; }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x4FEE;&#x6539;&#x65F6;&#x95F4;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Column(TypeName = &quot;datetimeoffset(7)&quot;)]
    [Comment(&quot;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&quot;)]
    //[DatabaseGenerated(DatabaseGeneratedOption.Computed)]
    public virtual DateTimeOffset? LastUpdateTime { get; set; } = DateTimeOffset.UtcNow;

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x4FEE;&#x6539;&#x8005;Id
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Column(TypeName = &quot;varchar(50)&quot;)]
    [Comment(&quot;&#x4FEE;&#x6539;&#x8005;Id&quot;)]
    public virtual string LastUpdateUserId { get; set; }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x4FEE;&#x6539;IP
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Column(TypeName = &quot;varchar(130)&quot;)]
    [Comment(&quot;&#x521B;&#x5EFA;&#x8005;IP&quot;)]
    public virtual string LastUpdateIP { get; set; }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x5E76;&#x53D1;&#x4EE4;&#x724C;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [Timestamp]
    [Comment(&quot;&#x5E76;&#x53D1;&#x4EE4;&#x724C;&quot;)]
    public virtual byte[] Token { get; set; }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x5B9E;&#x4F53;&#x7684;&#x54C8;&#x5E0C;&#x503C;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    public override int GetHashCode()
    {
        if (this == null)
        {
            return this.GetHashCode();
        }

        return this.Id.ToString().GetHashCode();
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x5B9E;&#x4F53;&#x662F;&#x5426;&#x4E00;&#x76F4;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>obj<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    public override bool Equals(object obj)
    {
        if (obj == null || this == null)
        {
            return false;
        }

        BaseLogicEntity baseLogicEntity = obj as BaseLogicEntity;
        if (baseLogicEntity == null)
        {
            return false;
        }

        return baseLogicEntity.Id.ToString() == this.Id.ToString();
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x683C;&#x5F0F;&#x5316;&#x5F53;&#x524D;&#x5B9E;&#x4F53;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span>&#x6267;&#x884C;&#x7ED3;&#x679C;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>

    public override string ToString()
    {
        return base.ToString();
    }
}

//SnowflakeID.cs
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x96EA;&#x82B1;ID&#x751F;&#x6210;&#x5668;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>
///  IdWorker&#x5E94;&#x8BE5;&#x4EE5;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x8FD0;&#x884C;, &#x5426;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x91CD;&#x590D;Id.
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>example</span><span class="token punctuation">&gt;</span></span>
/// https://www.cnblogs.com/zxtceq/articles/15029054.html
/// https://www.cnblogs.com/dunitian/p/6130543.html#top
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>example</span><span class="token punctuation">&gt;</span></span>
public class SnowflakeID
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x5B9E;&#x4F8B;&#x9501;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private static readonly object InstanceLocker = new();

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x79C1;&#x6709;&#x5B9E;&#x4F8B;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private static SnowflakeID _instance = null;

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x96EA;&#x82B1;ID&#x751F;&#x6210;&#x5668;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private IdWorker _idWorker = null;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// workerId
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private long _workerId =&gt; 1;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// datacenterId
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private long _datacenterId =&gt; 1;

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x79C1;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private SnowflakeID()
    {
        if (_idWorker == null)
        {
            _idWorker = new IdWorker(_workerId, _datacenterId);
        }
    }
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x9759;&#x6001;&#x6784;&#x9020;&#x51FD;&#x6570;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    static SnowflakeID()
    {

    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x83B7;&#x53D6;&#x5168;&#x5C40;&#x552F;&#x4E00;&#x5B9E;&#x4F8B;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    public static SnowflakeID GetInstance()
    {
        if (_instance == null)
        {
            lock (InstanceLocker)
            {
                if (_instance == null)
                {
                    _instance = new SnowflakeID();
                }
            }
        }

        return _instance;
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x96EA;&#x82B1;ID
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>&#x9ED8;&#x8BA4;&#x751F;&#x6210;&#x7684;Id&#x662F;long&#x7C7B;&#x578B;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>T<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>T<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    public T GetNextID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>() =&gt; FramePublicFun.ConvertType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(_idWorker.NextId());

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x5F02;&#x6B65;&#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x96EA;&#x82B1;ID
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>T<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>T<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    public Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> GetNextIDAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>()
    {
        return Task.Run(() =&gt;
        {
            return FramePublicFun.ConvertType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(_idWorker.NextId());
        });
    }
}
</code></pre>
<hr>
<h2 id="14&#x4E3B;&#x952E;&#x7684;&#x8BBE;&#x8BA1;"><a name="14&#x4E3B;&#x952E;&#x7684;&#x8BBE;&#x8BA1;" class="anchor-navigation-ex-anchor" href="#14&#x4E3B;&#x952E;&#x7684;&#x8BBE;&#x8BA1;"><i class="fa fa-link" aria-hidden="true"></i></a>14&gt;&#x4E3B;&#x952E;&#x7684;&#x8BBE;&#x8BA1;</h2>
<p>&#x8868;&#x7684;&#x4E3B;&#x952E;&#x9664;&#x4E86;&#x4F7F;&#x7528;<code>&#x81EA;&#x589E;ID</code>, <code>GUID</code>, <code>HILO</code>&#xFF0C;<code>&#x96EA;&#x82B1;ID</code>, &#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x4E3B;&#x952E;(&#x4E0D;&#x662F;&#x590D;&#x5408;&#x4E3B;&#x952E;). </p>
<p>&#x4E3B;&#x952E;&#x4F7F;&#x7528;&#x81EA;&#x589E;ID, &#x518D;&#x65B0;&#x589E;&#x4E00;&#x4E2A;GUID&#x5217;, &#x81EA;&#x589E;ID&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5145;&#x5F53;&#x805A;&#x96C6;&#x7D22;&#x5F15;, &#x52A0;&#x5FEB;&#x67E5;&#x8BE2;&#x901F;&#x5EA6;, &#x800C;GUID&#x624D;&#x662F;&#x5145;&#x5F53;&#x5B9E;&#x9645;&#x4E1A;&#x52A1;&#x4E0A;&#x7684;&#x5916;&#x952E;&#x4F7F;&#x7528;, &#x8FD9;&#x6837;&#x7684;&#x642D;&#x914D;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7684;&#x5229;&#x7528;&#x4E24;&#x79CD;ID&#x7684;&#x4F18;&#x70B9;.</p>
<p>&#x4E0D;&#x8FC7;&#x5728;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;, &#x96EA;&#x82B1;ID&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x5206;&#x5E03;&#x5F0F;&#x5E94;&#x7528;(&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;), &#x5176;&#x7D22;&#x5F15;&#x7684;&#x8FDE;&#x7EED;&#x6027;, &#x5728;&#x4F5C;&#x4E3A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x7D22;&#x5F15;&#x901F;&#x5EA6;&#x4E5F;&#x5F88;&#x5FEB;.</p>
<hr>
<h2 id="15&#x8BFB;&#x5199;&#x5206;&#x79BB;"><a name="15&#x8BFB;&#x5199;&#x5206;&#x79BB;" class="anchor-navigation-ex-anchor" href="#15&#x8BFB;&#x5199;&#x5206;&#x79BB;"><i class="fa fa-link" aria-hidden="true"></i></a>15&gt;&#x8BFB;&#x5199;&#x5206;&#x79BB;</h2>
<p><a href="https://blog.csdn.net/zhangyuchao618/article/details/85250882" target="_blank">&#x5982;&#x4F55;&#x5220;&#x9664;&#x5206;&#x53D1;&#x670D;&#x52A1;&#x5668;&#x811A;&#x672C;</a></p>
<p><a href="https://www.cnblogs.com/lhyqzx/p/5203066.html" target="_blank">SQLServer&#x590D;&#x5236;&#x9700;&#x8981;&#x6709;&#x5B9E;&#x9645;&#x7684;&#x670D;&#x52A1;&#x5668;&#x540D;&#x79F0;&#x624D;&#x80FD;&#x8FDE;&#x63A5;&#x5230;&#x670D;&#x52A1;&#x5668;,&#x8BF7;&#x6307;&#x5B9A;&#x5B9E;&#x9645;&#x7684;&#x670D;&#x52A1;&#x5668;&#x540D;</a></p>
<p><a href="https://www.cnblogs.com/jimsfriend/p/10436038.html" target="_blank">&#x6700;&#x7B80;&#x5355;&#x7684;SQLserver&#xFF0C;&#x53D1;&#x5E03;&#x8BA2;&#x9605;&#x6559;&#x7A0B;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E00;&#x6B21;&#x5C31;&#x6210;&#x529F;</a></p>
<p><a href="https://www.cnblogs.com/yf2011/p/5001326.html" target="_blank">&#x7531;&#x4E8E;&#x51FA;&#x73B0;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x9519;&#x8BEF; 3&#xFF0C;&#x8FDB;&#x7A0B;&#x65E0;&#x6CD5;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;D:\XXXX\X.pre (&#x6E90;: MSSQL_REPL&#xFF0C;&#x9519;&#x8BEF;&#x53F7;: MSSQL_REPL20024)</a></p>
<h3 id="15-1sql&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x4E3B;&#x4ECE;&#x590D;&#x5236;---&#x5B9E;&#x9645;&#x914D;&#x7684;&#x8FC7;&#x7A0B;-&#x4F7F;&#x7528;&#x4E86;2&#x53F0;&#x670D;&#x52A1;&#x5668;-1&#x53F0;&#x4F5C;&#x4E3A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5668;-2&#x53F0;&#x4F5C;&#x4E3A;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;-&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;&#x4E00;&#x76F4;&#x914D;&#x7F6E;&#x5931;&#x8D25;-&#x540E;&#x9762;&#x6539;&#x6210;&#x4E86;&#x53D1;&#x9001;&#x8BA2;&#x9605;-&#x5E76;&#x5173;&#x95ED;&#x4E86;&#x53D1;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9632;&#x706B;&#x5899;-&#x624D;&#x914D;&#x7F6E;&#x6210;&#x529F;-&#x53E6;-sql-server&#x7684;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;-&#x6700;&#x5C0F;&#x9891;&#x7387;&#x53EA;&#x80FD;&#x662F;10s-&#x56E0;&#x6B64;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x4E0D;&#x4F1A;&#x91C7;&#x7528;sql-server&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x5DE5;&#x5177;"><a name="15-1sql&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x4E3B;&#x4ECE;&#x590D;&#x5236;---&#x5B9E;&#x9645;&#x914D;&#x7684;&#x8FC7;&#x7A0B;-&#x4F7F;&#x7528;&#x4E86;2&#x53F0;&#x670D;&#x52A1;&#x5668;-1&#x53F0;&#x4F5C;&#x4E3A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5668;-2&#x53F0;&#x4F5C;&#x4E3A;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;-&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;&#x4E00;&#x76F4;&#x914D;&#x7F6E;&#x5931;&#x8D25;-&#x540E;&#x9762;&#x6539;&#x6210;&#x4E86;&#x53D1;&#x9001;&#x8BA2;&#x9605;-&#x5E76;&#x5173;&#x95ED;&#x4E86;&#x53D1;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9632;&#x706B;&#x5899;-&#x624D;&#x914D;&#x7F6E;&#x6210;&#x529F;-&#x53E6;-sql-server&#x7684;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;-&#x6700;&#x5C0F;&#x9891;&#x7387;&#x53EA;&#x80FD;&#x662F;10s-&#x56E0;&#x6B64;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x4E0D;&#x4F1A;&#x91C7;&#x7528;sql-server&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x5DE5;&#x5177;" class="anchor-navigation-ex-anchor" href="#15-1sql&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x4E3B;&#x4ECE;&#x590D;&#x5236;---&#x5B9E;&#x9645;&#x914D;&#x7684;&#x8FC7;&#x7A0B;-&#x4F7F;&#x7528;&#x4E86;2&#x53F0;&#x670D;&#x52A1;&#x5668;-1&#x53F0;&#x4F5C;&#x4E3A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5668;-2&#x53F0;&#x4F5C;&#x4E3A;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;-&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;&#x4E00;&#x76F4;&#x914D;&#x7F6E;&#x5931;&#x8D25;-&#x540E;&#x9762;&#x6539;&#x6210;&#x4E86;&#x53D1;&#x9001;&#x8BA2;&#x9605;-&#x5E76;&#x5173;&#x95ED;&#x4E86;&#x53D1;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9632;&#x706B;&#x5899;-&#x624D;&#x914D;&#x7F6E;&#x6210;&#x529F;-&#x53E6;-sql-server&#x7684;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;-&#x6700;&#x5C0F;&#x9891;&#x7387;&#x53EA;&#x80FD;&#x662F;10s-&#x56E0;&#x6B64;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x4E0D;&#x4F1A;&#x91C7;&#x7528;sql-server&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x5DE5;&#x5177;"><i class="fa fa-link" aria-hidden="true"></i></a>15-1&gt;SQL&#x8BFB;&#x5199;&#x5206;&#x79BB;(&#x4E3B;&#x4ECE;&#x590D;&#x5236;) - &#x5B9E;&#x9645;&#x914D;&#x7684;&#x8FC7;&#x7A0B;, &#x4F7F;&#x7528;&#x4E86;2&#x53F0;&#x670D;&#x52A1;&#x5668;, 1&#x53F0;&#x4F5C;&#x4E3A;&#x53D1;&#x9001;&#x670D;&#x52A1;&#x5668;, 2&#x53F0;&#x4F5C;&#x4E3A;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;, &#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;&#x4E00;&#x76F4;&#x914D;&#x7F6E;&#x5931;&#x8D25;, &#x540E;&#x9762;&#x6539;&#x6210;&#x4E86;&#x53D1;&#x9001;&#x8BA2;&#x9605;, &#x5E76;&#x5173;&#x95ED;&#x4E86;&#x53D1;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9632;&#x706B;&#x5899;, &#x624D;&#x914D;&#x7F6E;&#x6210;&#x529F;. &#x53E6;, SQL Server&#x7684;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;, &#x6700;&#x5C0F;&#x9891;&#x7387;&#x53EA;&#x80FD;&#x662F;10S, &#x56E0;&#x6B64;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x4E0D;&#x4F1A;&#x91C7;&#x7528;SQL Server&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x5DE5;&#x5177;.</h3>
<p>15-1-1&gt;&#x6821;&#x9A8C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x540D;&#x79F0;&#x548C;&#x5B9E;&#x9645;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x540D;&#x79F0;&#x662F;&#x5426;&#x4E00;&#x81F4;</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">use</span> master
go

<span class="token keyword">select</span> @<span class="token variable">@servername</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> serverproperty<span class="token punctuation">(</span><span class="token string">&apos;servername&apos;</span><span class="token punctuation">)</span>

<span class="token comment">--&#x82E5;&#x4E0D;&#x4E00;&#x81F4;,&#x5219;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x8BED;&#x53E5;, &#x518D;&#x91CD;&#x542F;SQL SERVER&#x670D;&#x52A1;</span>
<span class="token keyword">use</span> master
go
sp_dropserver <span class="token string">&apos;&#x65E7;&#x670D;&#x52A1;&#x5668;&#x540D;&#x79F0;&apos;</span> <span class="token comment">--@@servername&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x7684;&#x540D;&#x79F0;</span>
go
sp_addserver <span class="token string">&apos;&#x65B0;&#x670D;&#x52A1;&#x5668;&#x540D;&#x79F0;&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;local&apos;</span> <span class="token comment">--serverproperty(&apos;servername&apos;)&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#x7684;&#x540D;&#x79F0;</span>
go
</code></pre>
<p>15-1-2&gt;&#x4FEE;&#x6539;&#x672C;&#x673A;host&#x6587;&#x4EF6;, &#x6DFB;&#x52A0;&#x672C;&#x5730;&#x57DF;&#x540D;&#x6620;&#x5C04;(<code>&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x5668;</code>&#x548C;<code>&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;</code>&#x90FD;&#x9700;&#x8981;&#x914D;&#x7F6E;)</p>
<pre class="language-"><code class="lang-powershell">&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5730;&#x5740;: C:\Windows\System32\drivers\etc\hosts
<span class="token function">SC</span><span class="token operator">-</span>202110141618&#x662F;15-1-1&#x7684;&#x5B9E;&#x9645;&#x8BA1;&#x7B97;&#x673A;&#x540D;&#x79F0;
192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>60<span class="token punctuation">.</span>103 <span class="token function">SC</span><span class="token operator">-</span>202110141618
</code></pre>
<p>15-1-3&gt;&#x4F7F;&#x7528;sql&#x914D;&#x7F6E;&#x5DE5;&#x5177;, &#x6DFB;&#x52A0;&#x522B;&#x540D;</p>
<p><img src="EF Core.assets/image-20211207084623684.png" alt="image-20211207084623684"></p>
<p>15-1-4&gt;&#x4F7F;&#x7528;&#x522B;&#x540D;&#x767B;&#x5F55;SSMS, &#x5220;&#x9664;&#x53D1;&#x5E03;&#x548C;&#x8BA2;&#x9605;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">USE</span> master
go

<span class="token comment">--&#x67E5;&#x770B;&#x8BA2;&#x9605;&#x4FE1;&#x606F;</span>
<span class="token keyword">exec</span> sp_helpsubscriberinfo <span class="token punctuation">;</span>
go
<span class="token comment">--&#x5220;&#x9664;&#x8BA2;&#x9605;</span>
<span class="token keyword">exec</span> sp_dropsubscriber <span class="token string">&apos;SubscriberName&apos;</span><span class="token punctuation">;</span>
go

<span class="token keyword">use</span> master
go
<span class="token comment">--&#x67E5;&#x770B;&#x53D1;&#x5E03;&#x6570;&#x636E;&#x5E93;</span>
<span class="token keyword">exec</span> sp_helpdistpublisher<span class="token punctuation">;</span>
go
<span class="token comment">--&#x5220;&#x9664;&#x53D1;&#x5E03;&#x6570;&#x636E;&#x5E93;</span>
<span class="token keyword">exec</span> sp_dropdistributiondb <span class="token variable">@database</span> <span class="token operator">=</span> N<span class="token string">&apos;distribution&apos;</span>
go

<span class="token keyword">use</span> master<span class="token punctuation">;</span>
go
<span class="token comment">--&#x67E5;&#x770B;&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x5668;</span>
<span class="token keyword">exec</span> sp_helpdistributor
go
<span class="token comment">--&#x5220;&#x9664;&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x5668;</span>
<span class="token keyword">exec</span> sp_dropdistributor <span class="token variable">@no_checks</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@ignore_distributor</span> <span class="token operator">=</span> <span class="token number">1</span> 
go
</code></pre>
<p>15-1-5&gt;&#x521B;&#x5EFA;&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x5668;</p>
<p><img src="EF Core.assets/image-20211207085916463.png" alt="image-20211207085916463"></p>
<p><img src="EF Core.assets/image-20211207085949956.png" alt="image-20211207085949956"></p>
<p><img src="EF Core.assets/image-20211207090123879.png" alt="image-20211207090123879"></p>
<p><img src="EF Core.assets/image-20211207090129943.png" alt="image-20211207090129943"></p>
<p><img src="EF Core.assets/image-20211207090143901.png" alt="image-20211207090143901"></p>
<p><img src="EF Core.assets/image-20211207090154954.png" alt="image-20211207090154954"></p>
<p><img src="EF Core.assets/image-20211207090206232.png" alt="image-20211207090206232"></p>
<p><img src="EF Core.assets/image-20211207090309673.png" alt="image-20211207090309673"></p>
<p><img src="EF Core.assets/image-20211207090525411.png" alt="image-20211207090525411"></p>
<p><img src="EF Core.assets/image-20211207090546442.png" alt="image-20211207090546442"></p>
<p><img src="EF Core.assets/image-20211207090609592.png" alt="image-20211207090609592"></p>
<p><img src="EF Core.assets/image-20211207090808824.png" alt="image-20211207090808824"></p>
<p>15-1-6&gt;&#x5728;&#x53E6;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x521B;&#x5EFA;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;(&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x63A8;&#x9001;&#x8BA2;&#x9605;&#x6216;&#x8005;&#x8BF7;&#x6C42;&#x8BA2;&#x9605;, &#x538B;&#x529B;&#x5206;&#x522B;&#x5728;&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x5668;&#x6216;&#x8BA2;&#x9605;&#x670D;&#x52A1;&#x5668;&#x4E0A;.)</p>
<p><img src="EF Core.assets/image-20211207093517348.png" alt="image-20211207093517348"></p>
<p><img src="EF Core.assets/image-20211207093546482.png" alt="image-20211207093546482"></p>
<p><img src="EF Core.assets/image-20211207093558238.png" alt="image-20211207093558238"></p>
<p><img src="EF Core.assets/image-20211207093619541.png" alt="image-20211207093619541"></p>
<p><img src="EF Core.assets/image-20211207093651002.png" alt="image-20211207093651002"></p>
<p><img src="EF Core.assets/image-20211207093704822.png" alt="image-20211207093704822"></p>
<p><img src="EF Core.assets/image-20211207093714292.png" alt="image-20211207093714292"></p>
<p><img src="EF Core.assets/image-20211207093723443.png" alt="image-20211207093723443"></p>
<h3 id="15-2mysql&#x8BFB;&#x5199;&#x5206;&#x79BB;"><a name="15-2mysql&#x8BFB;&#x5199;&#x5206;&#x79BB;" class="anchor-navigation-ex-anchor" href="#15-2mysql&#x8BFB;&#x5199;&#x5206;&#x79BB;"><i class="fa fa-link" aria-hidden="true"></i></a>15-2&gt;MySQL&#x8BFB;&#x5199;&#x5206;&#x79BB;</h3>
<h3 id="15-3ef-core&#x5B9E;&#x73B0;"><a name="15-3ef-core&#x5B9E;&#x73B0;" class="anchor-navigation-ex-anchor" href="#15-3ef-core&#x5B9E;&#x73B0;"><i class="fa fa-link" aria-hidden="true"></i></a>15-3&gt;EF Core&#x5B9E;&#x73B0;</h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x4E3B;&#x4ECE;&#x62E6;&#x622A;&#x5668;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>&#x53EA;&#x652F;&#x6301;1&#x4E3B;N&#x4ECE;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
public class MasterSlaveInterceptor : DbCommandInterceptor
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#x5FEB;&#x7167;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    private readonly IOptionsSnapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SystemConfig</span><span class="token punctuation">&gt;</span></span> _systemConfigOption = null;

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x6784;&#x9020;&#x51FD;&#x6570;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>systemConfigOption<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#x5FEB;&#x7167;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    public MasterSlaveInterceptor(IOptionsSnapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SystemConfig</span><span class="token punctuation">&gt;</span></span> systemConfigOption)
    {
        _systemConfigOption = systemConfigOption;
    }

    #region &#x516C;&#x5171;&#x65B9;&#x6CD5;

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x662F;&#x5426;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E3B;&#x4ECE;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    private bool IsNeed2SetMasterSlave()
    {
        var systemConfig = _systemConfigOption?.Value;
        if (systemConfig == default)
        {
            return false;
        }

        var connectionStrings = systemConfig.DBConnectionStrings ?? new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DBConnectionString</span><span class="token punctuation">&gt;</span></span>();
        if (connectionStrings.Count &lt;= 0)
        {
            return false;
        }

        //&#x662F;&#x5426;&#x540C;&#x65F6;&#x542B;&#x6709;&#x4E3B;&#x4ECE;&#x5B57;&#x7B26;&#x4E32;
        var hasMaster = connectionStrings.Count(c =&gt; c.MasterSlaveRole == EnumMasterSlaveRole.Master) &gt;= 1;
        var hasSlave = connectionStrings.Count(c =&gt; c.MasterSlaveRole == EnumMasterSlaveRole.Slave) &gt;= 1;

        return hasMaster &amp;&amp; hasSlave;
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x8BBE;&#x7F6E;&#x4E3B;&#x4ECE;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>command<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x547D;&#x4EE4;&#x5BF9;&#x8C61;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isChange2Master<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x662F;&#x5426;&#x5207;&#x6362;&#x5230;Master&#x5E93;, &#x9ED8;&#x8BA4;false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    private void SetMasterSlave(DbCommand command, bool isChange2Master = false)
    {
        if (command == default)
        {
            return;
        }

        //&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E3B;&#x4ECE;
        if (!IsNeed2SetMasterSlave())
        {
            return;
        }

        var systemConfig = _systemConfigOption?.Value;
        if (systemConfig == default)
        {
            return;
        }

        var masterConnStr = systemConfig.DBConnectionStrings.FirstOrDefault(c =&gt; c.MasterSlaveRole == EnumMasterSlaveRole.Master)?.ConnectionString ?? &quot;&quot;;

        //&#x5207;&#x5230;&#x4E3B;&#x5E93;
        if (isChange2Master &amp;&amp; command.Connection.ConnectionString != masterConnStr)
        {
            if (command.Connection.State != System.Data.ConnectionState.Closed)
            {
                command.Connection.Close();
            }
            command.Connection.ConnectionString = masterConnStr.DeepClone();
            if (command.Connection.State != System.Data.ConnectionState.Open)
            {
                command.Connection.Open();
            }
            return;
        }

        //&#x5207;&#x5230;&#x4ECE;&#x5E93;
        var commandText = command.CommandText.DeepClone();
        //&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x63D2;&#x5165;&#x8BED;&#x53E5;(EF &#x63D2;&#x5165;&#x8BED;&#x53E5;&#x4F1A;&#x901A;&#x8FC7;Reader&#x6267;&#x884C;&#x5E76;&#x67E5;&#x8BE2;&#x4E3B;&#x952E;), &#x82E5;&#x662F;insert&#x8BED;&#x53E5;, &#x5219;&#x5C06;&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#x6539;&#x4E3A;&#x4E3B;&#x5E93;
        if (commandText.ToLower().StartsWith(&quot;insert&quot;, StringComparison.InvariantCultureIgnoreCase))
        {
            if (command.Connection.State != System.Data.ConnectionState.Closed)
            {
                command.Connection.Close();
            }
            command.Connection.ConnectionString = masterConnStr.DeepClone();
            if (command.Connection.State != System.Data.ConnectionState.Open)
            {
                command.Connection.Open();
            }
            return;
        }

        //&#x5224;&#x65AD;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x662F;&#x5426;&#x5904;&#x4E8E;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x4E2D;
        bool isDistributedTran = Transaction.Current != default &amp;&amp;
                                 Transaction.Current.TransactionInformation.Status !=
                                 TransactionStatus.Committed;
        //&#x5224;&#x65AD;&#x8BE5; dbcontext &#x662F;&#x5426;&#x5904;&#x4E8E;&#x666E;&#x901A;&#x6570;&#x636E;&#x5E93;&#x4E8B;&#x52A1;&#x4E2D;
        bool isDbTran = command.Transaction != default;
        if (isDistributedTran || isDbTran)
        {
            return;
        }

        var dbSlaveStrategy = systemConfig.DBSlaveStrategy;
        var slaveConnStrList =
            (
                from connectionString in
                (
                    systemConfig.DBConnectionStrings.Where(c =&gt; c.MasterSlaveRole == EnumMasterSlaveRole.Slave).ToList() ?? new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DBConnectionString</span><span class="token punctuation">&gt;</span></span>()
                )
                select connectionString.ConnectionString
            ).ToList();

        //TODO &#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7B56;&#x7565;, &#x83B7;&#x53D6;&#x4ECE;&#x5E93;&#x8FDE;&#x63A5;&#x4E32;
        var slaveConnStr = GetSlaveConnStr(slaveConnStrList, dbSlaveStrategy) ?? &quot;&quot;;
        if (!FramePublicFun.IsGlobalLogNull)
        {
            FramePublicFun.Logger?.LogInformation($&quot;slaveConnStr:{slaveConnStr}&quot;);
        }

        if (string.IsNullOrEmpty(slaveConnStr))
        {
            return;
        }

        //&#x5C06;&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#x5207;&#x6362;&#x5230;&#x4ECE;&#x5E93;
        if (command.Connection.State != System.Data.ConnectionState.Closed)
        {
            command.Connection.Close();
        }
        command.Connection.ConnectionString = slaveConnStr.DeepClone();
        if (command.Connection.State != System.Data.ConnectionState.Open)
        {
            command.Connection.Open();
        }
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x83B7;&#x53D6;&#x4ECE;&#x5E93;&#x8FDE;&#x63A5;&#x4E32;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slaveConnStrList<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x4ECE;&#x5E93;&#x8FDE;&#x63A5;&#x4E32;&#x94FE;&#x8868;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slaveStrategy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x4ECE;&#x5E93;&#x8FDE;&#x63A5;&#x4E32;&#x83B7;&#x53D6;&#x7B56;&#x7565;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
    private string GetSlaveConnStr(List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> slaveConnStrList, EnumDBSlaveStrategy slaveStrategy = EnumDBSlaveStrategy.Random)
    {
        slaveConnStrList ??= new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>();

        var slaveConnStr = &quot;&quot;;
        switch (slaveStrategy)
        {
            case EnumDBSlaveStrategy.Random:
            default:
                var startIndex = 0;
                var endIndex = slaveConnStrList.Count;
                slaveConnStr = slaveConnStrList[FramePublicFun.GetRandomByGuid(startIndex, endIndex)] ?? &quot;&quot;;
                break;

            case EnumDBSlaveStrategy.IP:
                throw new NotImplementedException(slaveStrategy.ToString());

            case EnumDBSlaveStrategy.Balance:
                throw new NotImplementedException(slaveStrategy.ToString());
        }

        return slaveConnStr;
    }

    #endregion

    //&#x5982;&#x679C;&#x662F;&#x5199;&#x5165;,&#x5219;&#x6B63;&#x5E38;&#x6267;&#x884C;
    public override InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> NonQueryExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> result)
    {
        SetMasterSlave(command, isChange2Master: true);
        return base.NonQueryExecuting(command, eventData, result);
    }
    public override ValueTask&lt;InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>&gt; NonQueryExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> result, CancellationToken cancellationToken = default)
    {
        SetMasterSlave(command, isChange2Master: true);
        return base.NonQueryExecutingAsync(command, eventData, result, cancellationToken);
    }

    public override InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> ReaderExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> result)
    {
        SetMasterSlave(command);
        return base.ReaderExecuting(command, eventData, result);
    }

    public override ValueTask&lt;InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span>&gt; ReaderExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> result, CancellationToken cancellationToken = default)
    {
        SetMasterSlave(command);
        return base.ReaderExecutingAsync(command, eventData, result, cancellationToken);
    }


    public override InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> ScalarExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> result)
    {
        SetMasterSlave(command);
        return base.ScalarExecuting(command, eventData, result);
    }

    public override ValueTask&lt;InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span>&gt; ScalarExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> result, CancellationToken cancellationToken = default)
    {
        SetMasterSlave(command);
        return base.ScalarExecutingAsync(command, eventData, result, cancellationToken);
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x6CE8;&#x518C;&#x62E6;&#x622A;&#x5668;
optionsBuilder.AddInterceptors(new MasterSlaveInterceptor(systemConfigOption: _systemConfigOption));
</code></pre>
<hr>
<h2 id="16ef&#x65E5;&#x5FD7;"><a name="16ef&#x65E5;&#x5FD7;" class="anchor-navigation-ex-anchor" href="#16ef&#x65E5;&#x5FD7;"><i class="fa fa-link" aria-hidden="true"></i></a>16&gt;EF&#x65E5;&#x5FD7;</h2>
<h3 id="16-1&#x4F7F;&#x7528;net-core&#x7684;&#x65E5;&#x5FD7;&#x6846;&#x67B6;&#x6CE8;&#x5165;log4net"><a name="16-1&#x4F7F;&#x7528;net-core&#x7684;&#x65E5;&#x5FD7;&#x6846;&#x67B6;&#x6CE8;&#x5165;log4net" class="anchor-navigation-ex-anchor" href="#16-1&#x4F7F;&#x7528;net-core&#x7684;&#x65E5;&#x5FD7;&#x6846;&#x67B6;&#x6CE8;&#x5165;log4net"><i class="fa fa-link" aria-hidden="true"></i></a>16-1&gt;&#x4F7F;&#x7528;net core&#x7684;&#x65E5;&#x5FD7;&#x6846;&#x67B6;(&#x6CE8;&#x5165;log4net)</h3>
<pre class="language-"><code class="lang-C#">public static IHostBuilder CreateHostBuilder(string[] args) =&gt;
    Host.CreateDefaultBuilder(args)
        .ConfigureHostConfiguration(configurationBuilder=&gt; 
        {
            //&#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x76EE;&#x5F55;
            configurationBuilder.SetBasePath(FramePublicFun.GetDllPath());

            //&#x6DFB;&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF;
            configurationBuilder.AddEnvironmentVariables(prefix: SysContant.Setting_Prefix);
            //&#x6DFB;&#x52A0;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;
            configurationBuilder.AddCommandLine((args ?? new string[] { }));
        })
        .ConfigureAppConfiguration((hostBuilderContext, configurationBuilder) =&gt;
        {
            //&#x6E05;&#x9664; CreateDefaultBuilder(String[]) &#x65B9;&#x6CD5;&#x4E2D;&#x9ED8;&#x8BA4;&#x6DFB;&#x52A0;&#x7684;&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x3002;
            configurationBuilder.Sources.Clear();
            //&#x8BBE;&#x7F6E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x76EE;&#x5F55;
            configurationBuilder.SetBasePath(FramePublicFun.GetDllPath());

            //&#x8BBE;&#x7F6E;&#x5185;&#x5B58;&#x4E2D;&#x7684; .NET &#x5BF9;&#x8C61;,&#x653E;&#x5728;&#x6700;&#x524D;&#x9762;
            configurationBuilder.AddInMemoryCollection(arrayDict);

            configurationBuilder.AddJsonFile(SysContant.Appsettings_FileName, optional: false, reloadOnChange: true);

            var appsettingsFileNameArr = SysContant.Appsettings_FileName.Split(new[] { &quot;.&quot; }, StringSplitOptions.RemoveEmptyEntries) ?? new string[] { };
            var appsettingsFileNamePrefix = appsettingsFileNameArr.Length != 2 ? &quot;appsettings&quot; : appsettingsFileNameArr[0];
            var appsettingsFileNameExtension = appsettingsFileNameArr.Length != 2 ? &quot;json&quot; : appsettingsFileNameArr[1];
            configurationBuilder.AddJsonFile
            (
                $&quot;{appsettingsFileNamePrefix}.{hostBuilderContext.HostingEnvironment.EnvironmentName}.{appsettingsFileNameExtension}&quot;,
                optional: true, 
                reloadOnChange: true
            );

            //&#x6DFB;&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF;
            configurationBuilder.AddEnvironmentVariables(prefix: SysContant.Setting_Prefix);
            //&#x6DFB;&#x52A0;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;
            configurationBuilder.AddCommandLine(args);
        })
        .ConfigureLogging((context, loggingBuilder) =&gt;
        {
            loggingBuilder.ClearProviders();

            loggingBuilder.SetMinimumLevel(LogLevel.Warning);
            loggingBuilder.AddFilter(&quot;System&quot;, LogLevel.Information);
            loggingBuilder.AddFilter(&quot;Microsoft&quot;, LogLevel.Information);

            //&#x6DFB;&#x52A0;&#x63A7;&#x5236;&#x53F0;&#x65E5;&#x5FD7;
            loggingBuilder.AddConsole();

            /*&#x7B2C;&#x4E8C;&#x79CD;&#xFF0C;&#x5728;ConfigureLogging&#x914D;&#x7F6E;log4net begin*/
            var cfgFilePath = Path.Combine(FramePublicFun.GetDllPath(), SysContant.Log4Net_CfgFileName);
            loggingBuilder.AddLog4Net(cfgFilePath);
            /*&#x7B2C;&#x4E8C;&#x79CD;&#xFF0C;&#x5728;ConfigureLogging&#x914D;&#x7F6E;log4net end*/
        })
        .ConfigureWebHostDefaults(webBuilder =&gt;
        {
            webBuilder.ConfigureKestrel((webHostBuilderContext, kestrelServerOptions) =&gt; 
            {
                //&#x7F6E;&#x4E3A;null&#x65F6;&#xFF0C;&#x6700;&#x5927;&#x8BF7;&#x6C42;&#x6B63;&#x6587;&#x5927;&#x5C0F;&#x4E0D;&#x53D7;&#x9650;&#x5236;&#x3002;
                kestrelServerOptions.Limits.MaxRequestBodySize = null;
            }).UseStartup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Startup</span><span class="token punctuation">&gt;</span></span>();//&#x5C06;ConfigureServices&#x548C;Configure&#x72EC;&#x7ACB;&#x5230;Startup&#x7C7B;&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;
        })
        .UseServiceProviderFactory(new AutofacServiceProviderFactory());//&#x4E3A;&#x4E86;&#x8BA9;&#x4E3B;&#x673A;&#x80FD;&#x5728;Startup&#x4E2D;&#x8C03;&#x7528;ConfigureContainer
</code></pre>
<pre class="language-"><code class="lang-xml">//log4net.config
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

<span class="token comment">&lt;!--&lt;configuration&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4net</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Appender.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Layout.PatternLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- Pattern to output the caller&apos;s file name and line number --&gt;</span>
      <span class="token comment">&lt;!--&lt;conversionPattern value=&quot;%date %5level %logger.%method [%line] - %property{scope} %property{test} MESSAGE: %message%newline %exception&quot; /&gt;--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionPattern</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%date %5level %logger.%method [%line] - MESSAGE: %message%newline %exception<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>RollingFile<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Appender.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--&#x6307;&#x5B9A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4FDD;&#x5B58;&#x7684;&#x76EE;&#x5F55;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log/<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--&#x8FFD;&#x52A0;&#x65E5;&#x5FD7;&#x5185;&#x5BB9;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appendToFile</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--&#x53EF;&#x4EE5;&#x4E3A;&#xFF1A;Once|Size|Date|Composite--&gt;</span>
    <span class="token comment">&lt;!--Compoosite&#x4E3A;Size&#x548C;Date&#x7684;&#x7EC4;&#x5408;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingStyle</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Composite<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x5F53;&#x524D;&#x6700;&#x65B0;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x540D;&#x6C38;&#x8FDC;&#x4E3A;file&#x5B57;&#x8282;&#x4E2D;&#x7684;&#x540D;&#x5B57;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>staticLogFileName</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--&#x5F53;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#x53CA;&#x540E;&#x7F00;&#x540D;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datePattern</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&apos;</span>sysLog&apos;_yyyyMMdd&apos;.log&apos;<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--&#x65E5;&#x5FD7;&#x6700;&#x5927;&#x4E2A;&#x6570;--&gt;</span>
    <span class="token comment">&lt;!--rollingStyle&#x8282;&#x70B9;&#x4E3A;Size&#x65F6;&#xFF0C;&#x53EA;&#x80FD;&#x6709;value&#x4E2A;&#x65E5;&#x5FD7;--&gt;</span>
    <span class="token comment">&lt;!--rollingStyle&#x8282;&#x70B9;&#x4E3A;Composie&#x65F6;&#xFF0C;&#x6BCF;&#x5929;&#x6709;value&#x4E2A;&#x65E5;&#x5FD7;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxSizeRollBackups</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--&#x53EF;&#x7528;&#x7684;&#x5355;&#x4F4D;&#xFF1A;KB|MB|GB--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maximumFileSize</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Filter.LevelRangeFilter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LevelMin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ALL<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LevelMax<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FATAL<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--&#x5E03;&#x5C40;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Layout.PatternLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionPattern</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%date %5level %logger.%method [%line] - MESSAGE: %message%newline %exception<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TraceAppender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Appender.TraceAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Layout.PatternLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!--&lt;conversionPattern value=&quot;%date %5level %logger.%method [%line] - %property{scope} %property{test} MESSAGE: %message%newline %exception&quot; /&gt;--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionPattern</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%date %5level %logger.%method [%line] - MESSAGE: %message%newline %exception<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ConsoleAppender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Appender.ManagedColoredConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ERROR<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreColor</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Red<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>WARN<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreColor</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Yellow<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreColor</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>White<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreColor</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Green<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log4net.Layout.PatternLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!--&lt;conversionPattern value=&quot;%date %5level %logger.%method [%line] - %property{scope} %property{test} MESSAGE: %message%newline %exception&quot; /&gt;--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionPattern</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%date %5level %logger.%method [%line] - MESSAGE: %message%newline %exception<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>RollingFile<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TraceAppender<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ConsoleAppender<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4net</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--&lt;/configuration&gt;--&gt;</span>
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x914D;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587; 
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>optionsBuilder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
    optionsBuilder
        .UseQueryTrackingBehavior(QueryTrackingBehavior.TrackAll) //&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x8DDF;&#x8E2A;&#x6240;&#x6709;&#x67E5;&#x8BE2;
        .EnableSensitiveDataLogging(sensitiveDataLoggingEnabled: _hostingEnvironment != null &amp;&amp; _hostingEnvironment.IsDevelopment()) //&#x542F;&#x7528;&#x654F;&#x611F;&#x6570;&#x636E;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;
        .UseLoggerFactory(LoggerFactory); //&#x8BBE;&#x7F6E;&#x65E5;&#x5FD7;&#x5DE5;&#x5382;
}
</code></pre>
<h3 id="16-2&#x4F7F;&#x7528;ef&#x81EA;&#x5E26;&#x7684;&#x7B80;&#x5355;&#x65E5;&#x5FD7;&#x6A21;&#x5F0F;"><a name="16-2&#x4F7F;&#x7528;ef&#x81EA;&#x5E26;&#x7684;&#x7B80;&#x5355;&#x65E5;&#x5FD7;&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#16-2&#x4F7F;&#x7528;ef&#x81EA;&#x5E26;&#x7684;&#x7B80;&#x5355;&#x65E5;&#x5FD7;&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>16-2&gt;&#x4F7F;&#x7528;EF&#x81EA;&#x5E26;&#x7684;&#x7B80;&#x5355;&#x65E5;&#x5FD7;&#x6A21;&#x5F0F;</h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x914D;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587; 
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>optionsBuilder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
    //&#x8BB0;&#x5F55;&#x65E5;&#x5FD7;&#xFF0C;&#x5305;&#x542B;&#x751F;&#x6210;&#x7684;sql          
    optionsBuilder
        .LogTo(msg =&gt;
        {
            //&#x8C03;&#x8BD5; - &#x7A97;&#x53E3;&#x6D88;&#x606F;
            System.Diagnostics.Debug.WriteLine(msg);
            //&#x8F93;&#x51FA; - &#x7A97;&#x53E3;&#x6D88;&#x606F;
            Console.WriteLine(msg);
        });
}
</code></pre>
<h3 id="16-3&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;sql&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;"><a name="16-3&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;sql&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;" class="anchor-navigation-ex-anchor" href="#16-3&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;sql&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>16-3&gt;<a href="https://www.cnblogs.com/GuZhenYin/p/14544714.html" target="_blank">&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;SQL&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</a></h3>
<pre class="language-"><code class="lang-C#">public class DBlogCommandInterceptor : DbCommandInterceptor
{
    //&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x8BB0;&#x5F55;SQL&#x6267;&#x884C;&#x65F6;&#x95F4;
    static readonly ConcurrentDictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbCommand,</span> <span class="token attr-name">DateTime</span><span class="token punctuation">&gt;</span></span> MStartTime = new ConcurrentDictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbCommand,</span> <span class="token attr-name">DateTime</span><span class="token punctuation">&gt;</span></span>();
    private ILogger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DBlogCommandInterceptor</span><span class="token punctuation">&gt;</span></span> _logger { get; set; }

    //&#x901A;&#x8FC7;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6CE8;&#x5165;&#x65E5;&#x5FD7;
    public DBlogCommandInterceptor(ILogger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DBlogCommandInterceptor</span><span class="token punctuation">&gt;</span></span> Logger)
    {
        _logger = Logger;
    }

    //&#x8BB0;&#x5F55;SQL&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4; 
    private void OnStart(DbCommand command)
    {
        MStartTime.TryAdd(command, DateTime.Now);
    }
&#x3000;&#x3000;&#x3000;&#x3000;//&#x901A;&#x8FC7;_logger&#x8F93;&#x51FA;&#x65E5;&#x5FD7;
    private void Log(DbCommand command)
    {

        DateTime startTime;
        TimeSpan duration;
        //&#x5F97;&#x5230;&#x6B64;command&#x7684;&#x5F00;&#x59CB;&#x65F6;&#x95F4;
        MStartTime.TryRemove(command, out startTime);
        if (startTime != default(DateTime))
        {
            duration = DateTime.Now - startTime;
        }
        else
        {
            duration = TimeSpan.Zero;
        }
        var parameters = new StringBuilder();
        //&#x5FAA;&#x73AF;&#x83B7;&#x53D6;&#x6267;&#x884C;&#x8BED;&#x53E5;&#x7684;&#x53C2;&#x6570;&#x503C;
        foreach (DbParameter param in command.Parameters)
        {
            parameters.AppendLine(param.ParameterName + &quot; &quot; + param.DbType + &quot; = &quot; + param.Value);
        }
        _logger.LogInformation(&quot;{starttime}&#x5F00;&#x59CB;&#x6267;&#x884C;SQL&#x8BED;&#x53E5;:{sql},&#x53C2;&#x6570;:{canshu},&#x6267;&#x884C;&#x65F6;&#x95F4;{readtime}&quot;,
           startTime.ToString(), command.CommandText, parameters.ToString(), duration.TotalSeconds);
    }

    public override InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> NonQueryExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> result)
    {
        OnStart(command);
        return base.NonQueryExecuting(command, eventData, result);
    }
    public override Task&lt;InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>&gt; NonQueryExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> result, CancellationToken cancellationToken = default)
    {
        OnStart(command);
        return base.NonQueryExecutingAsync(command, eventData, result, cancellationToken);
    }
    public override int NonQueryExecuted(DbCommand command, CommandExecutedEventData eventData, int result)
    {
        Log(command);
        return base.NonQueryExecuted(command, eventData, result);
    }
    public override Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> NonQueryExecutedAsync(DbCommand command, CommandExecutedEventData eventData, int result, CancellationToken cancellationToken = default)
    {
        Log(command);
        return base.NonQueryExecutedAsync(command, eventData, result, cancellationToken);
    }

    public override InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> ScalarExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> result)
    {
        OnStart(command);
        return base.ScalarExecuting(command, eventData, result);
    }
    public override Task&lt;InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span>&gt; ScalarExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> result, CancellationToken cancellationToken = default)
    {
        OnStart(command);
        return base.ScalarExecutingAsync(command, eventData, result, cancellationToken);
    }
    public override object ScalarExecuted(DbCommand command, CommandExecutedEventData eventData, object result)
    {
        Log(command);
        return base.ScalarExecuted(command, eventData, result);
    }
    public override Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span> ScalarExecutedAsync(DbCommand command, CommandExecutedEventData eventData, object result, CancellationToken cancellationToken = default)
    {
        Log(command);
        return base.ScalarExecutedAsync(command, eventData, result, cancellationToken);
    }


    public override InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> ReaderExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> result)
    {
        OnStart(command);
        return base.ReaderExecuting(command, eventData, result);
    }
    public override Task&lt;InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span>&gt; ReaderExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> result, CancellationToken cancellationToken = default)
    {
        OnStart(command);
        return base.ReaderExecutingAsync(command, eventData, result, cancellationToken);
    }

    public override Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbDataReader</span><span class="token punctuation">&gt;</span></span> ReaderExecutedAsync(DbCommand command, CommandExecutedEventData eventData, DbDataReader result, CancellationToken cancellationToken = default)
    {
        Log(command);
        return base.ReaderExecutedAsync(command, eventData, result, cancellationToken);
    }
    public override DbDataReader ReaderExecuted(DbCommand command, CommandExecutedEventData eventData, DbDataReader result)
    {
        Log(command);
        return base.ReaderExecuted(command, eventData, result);
    }
}
</code></pre>
<hr>
<h2 id="17&#x6279;&#x91CF;&#x5904;&#x7406;"><a name="17&#x6279;&#x91CF;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#17&#x6279;&#x91CF;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>17&gt;&#x6279;&#x91CF;&#x5904;&#x7406;</h2>
<p><code>EF Core&#x5B98;&#x65B9;&#x672A;&#x63D0;&#x4F9B;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x7684;&#x529F;&#x80FD;, &#x5305;&#x62EC;&#x6279;&#x91CF;&#x65B0;&#x589E;, &#x4FEE;&#x6539;, &#x5220;&#x9664;, &#x90FD;&#x662F;&#x62C6;&#x5206;&#x6210;&#x4E00;&#x6761;&#x6761;&#x7684;&#x8BB0;&#x5F55;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;, &#x6027;&#x80FD;&#x975E;&#x5E38;&#x4F4E;. &#x5B98;&#x65B9;&#x7684;&#x89E3;&#x91CA;&#x662F;&#x6267;&#x884C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x540E;&#x65E0;&#x6CD5;&#x8DDF;&#x8E2A;&#x5B9E;&#x4F53;&#x72B6;&#x6001;.</code></p>
<p><code>&#x4F7F;&#x7528;zack&#x7684;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x7EC4;&#x4EF6;, &#x8981;&#x6CE8;&#x610F;&#x4E0D;&#x8981;&#x5728;&#x6267;&#x884C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x524D;, &#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x5B9E;&#x4F53;&#x5230;dbcontext, &#x5982;&#x679C;&#x771F;&#x7684;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x9700;&#x6C42;, &#x5219;&#x9700;&#x8981;&#x5728;&#x6267;&#x884C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x540E;, &#x91CD;&#x65B0;reload&#x4E00;&#x6B21;dbcontext, &#x4FDD;&#x8BC1;dbcontext&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#x72B6;&#x6001;&#x662F;&#x6B63;&#x786E;&#x7684;.</code></p>
<h3 id="17-1&#x4F7F;&#x7528;zack-ef&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;"><a name="17-1&#x4F7F;&#x7528;zack-ef&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#17-1&#x4F7F;&#x7528;zack-ef&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>17-1&gt;&#x4F7F;&#x7528;Zack EF&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;</h3>
<p><a href="https://github.com/yangzhongke/Zack.EFCore.Batch/blob/main/README_CN.md" target="_blank">https://github.com/yangzhongke/Zack.EFCore.Batch/blob/main/README_CN.md</a></p>
<h3 id="17-2&#x4F7F;&#x7528;&#x6B65;&#x9AA4;"><a name="17-2&#x4F7F;&#x7528;&#x6B65;&#x9AA4;" class="anchor-navigation-ex-anchor" href="#17-2&#x4F7F;&#x7528;&#x6B65;&#x9AA4;"><i class="fa fa-link" aria-hidden="true"></i></a>17-2&gt;&#x4F7F;&#x7528;&#x6B65;&#x9AA4;</h3>
<p>*&#x5B89;&#x88C5;</p>
<pre class="language-"><code class="lang-C#">//&#x5BF9;&#x4E8E;.NET 5&#x7528;&#x6237;&#xFF1A;
Postgresql: Install-Package Zack.EFCore.Batch.Npgsql
SQLServer: Install-Package Zack.EFCore.Batch.MSSQL
MySQL: Install-Package Zack.EFCore.Batch.MySQL.Pomelo
Sqlite: Install-Package Zack.EFCore.Batch.Sqlite
Oracle&#xFF1A;Install-Package Zack.EFCore.Batch.Oracle

//&#x5BF9;&#x4E8E;.NET 6&#x7528;&#x6237;:
Postgresql: Install-Package Zack.EFCore.Batch.MSSQL_NET6
SQLServer&#xFF1A;Install-Package Zack.EFCore.Batch.MSSQL_NET6
MySQL: Install-Package Zack.EFCore.Batch.MySQL.Pomelo_NET6
Postgresql: Install-Package Zack.EFCore.Batch.Npgsql_NET6
Sqlite: Install-Package Zack.EFCore.Batch.Sqlite_NET6
Oracle&#xFF1A;&#x56E0;&#x4E3A;Oracle&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x5B98;&#x65B9;EF Core 6 Provider&#xFF0C;&#x6240;&#x4EE5;&#x6682;&#x672A;&#x652F;&#x6301;
</code></pre>
<p>*&#x6CE8;&#x518C;&#x5230;DbContextOptionsBuilder</p>
<pre class="language-"><code class="lang-C#">optionsBuilder.UseBatchEF_MSSQL();// MSSQL Server &#x7528;&#x6237;&#x7528;&#x8FD9;&#x4E2A;
optionsBuilder.UseBatchEF_Npgsql();//Postgresql &#x7528;&#x6237;&#x7528;&#x8FD9;&#x4E2A;
optionsBuilder.UseBatchEF_MySQLPomelo();//MySQL &#x7528;&#x6237;&#x7528;&#x8FD9;&#x4E2A;
optionsBuilder.UseBatchEF_Sqlite();//Sqlite &#x7528;&#x6237;&#x7528;&#x8FD9;&#x4E2A;
optionsBuilder.UseBatchEF_Oracle();//Oracle &#x7528;&#x6237;&#x7528;&#x8FD9;&#x4E2A;
</code></pre>
<h3 id="17-3&#x6279;&#x91CF;&#x65B0;&#x589E;"><a name="17-3&#x6279;&#x91CF;&#x65B0;&#x589E;" class="anchor-navigation-ex-anchor" href="#17-3&#x6279;&#x91CF;&#x65B0;&#x589E;"><i class="fa fa-link" aria-hidden="true"></i></a>17-3&gt;&#x6279;&#x91CF;&#x65B0;&#x589E;</h3>
<pre class="language-"><code class="lang-C#">//&#x6279;&#x91CF;&#x4FDD;&#x5B58;
var from = 0;
var to = 100000;
ConcurrentBag<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span> companies = new();
Parallel.For(from, to, i =&gt;
{
    companies.Add(new Company
    {
        Name = $&quot;Name_{i}&quot;,
        Address = $&quot;Address_{i}&quot;,
    });
});

Stopwatch stopWatch = new();
using (var autoWatch = new AutoWatch(stopWatch))
{
    //EF&#x65B9;&#x5F0F;, &#x6267;&#x884C;to&#x6B21;insert&#x64CD;&#x4F5C;()
    //await EFDbContext.Companies.AddRangeAsync(companies);
    //await EFDbContext.SaveChangesAsync();

    //&#x79D2;&#x901F;&#x63D2;&#x5165;
    await EFDbContext.BulkInsertAsync(companies, null, SqlBulkCopyOptions.Default, cancellationToken);
}

var useTimeStr = $&quot;&#x5171;&#x82B1;&#x8D39; {stopWatch.Elapsed.Hours}:{stopWatch.Elapsed.Minutes}:{stopWatch.Elapsed.Seconds}.{stopWatch.Elapsed.Milliseconds}&quot;;
</code></pre>
<h3 id="17-4&#x6279;&#x91CF;&#x66F4;&#x65B0;"><a name="17-4&#x6279;&#x91CF;&#x66F4;&#x65B0;" class="anchor-navigation-ex-anchor" href="#17-4&#x6279;&#x91CF;&#x66F4;&#x65B0;"><i class="fa fa-link" aria-hidden="true"></i></a>17-4&gt;&#x6279;&#x91CF;&#x66F4;&#x65B0;</h3>
<pre class="language-"><code class="lang-C#">////EF&#x65B9;&#x5F0F;
//var companies = await EFDbContext.Companies.Where(c =&gt; c.Id &gt; 1467738743896151189).ToListAsync();
//foreach (var c in companies)
//{
//    c.LastUpdateIP = c.AddIP = &quot;127.0.0.1&quot;;
//}

//Stopwatch stopWatch = new();
//using (var autoWatch = new AutoWatch(stopWatch))
//{
//    await EFDbContext.SaveChangesAsync();
//}
//var useTimeStr = $&quot;&#x5171;&#x82B1;&#x8D39; {stopWatch.Elapsed.Hours}:{stopWatch.Elapsed.Minutes}:{stopWatch.Elapsed.Seconds}.{stopWatch.Elapsed.Milliseconds}&quot;;

//Zack&#x6279;&#x91CF;&#x4FEE;&#x6539;
Stopwatch stopWatch = new();
using (var autoWatch = new AutoWatch(stopWatch))
{
    await EFDbContext.BatchUpdate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span>()
       .Set(c =&gt; c.AddIP, c =&gt; &quot;127.0.0.1&quot;)
       .Set(c =&gt; c.LastUpdateIP, c =&gt; &quot;127.0.0.1&quot;)
       .Where(c =&gt; c.Id &gt;= 1467738743782903808)
       .ExecuteAsync();
}
</code></pre>
<h3 id="17-5&#x6279;&#x91CF;&#x5220;&#x9664;"><a name="17-5&#x6279;&#x91CF;&#x5220;&#x9664;" class="anchor-navigation-ex-anchor" href="#17-5&#x6279;&#x91CF;&#x5220;&#x9664;"><i class="fa fa-link" aria-hidden="true"></i></a>17-5&gt;&#x6279;&#x91CF;&#x5220;&#x9664;</h3>
<pre class="language-"><code class="lang-c#">//&#x6279;&#x91CF;&#x5220;&#x9664;
//var companies = await EFDbContext.Companies.Where(c =&gt; c.Id &gt;= 1467745513242759168).ToListAsync();
//Stopwatch stopWatch = new();
//using (var autoWatch = new AutoWatch(stopWatch))
//{
//    EFDbContext.RemoveRange(companies);
//    await EFDbContext.SaveChangesAsync();
//}

//Zack&#x6279;&#x91CF;&#x5220;&#x9664;
Stopwatch stopWatch = new();
using (var autoWatch = new AutoWatch(stopWatch))
{
    await EFDbContext.DeleteRangeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span>(c =&gt; c.Id &gt;= 1467746850261045248, true, cancellationToken);
    //&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x4E5F;&#x53EF;&#x4EE5;
    //await EFDbContext.Companies.Where(c =&gt; c.Id &gt;= 1467746850261045248).DeleteRangeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span>(EFDbContext);
}

var useTimeStr = $&quot;&#x5171;&#x82B1;&#x8D39; {stopWatch.Elapsed.Hours}:{stopWatch.Elapsed.Minutes}:{stopWatch.Elapsed.Seconds}.{stopWatch.Elapsed.Milliseconds}&quot;;
</code></pre>
<hr>
<h2 id="18&#x8868;&#x8FBE;&#x5F0F;&#x6811;"><a name="18&#x8868;&#x8FBE;&#x5F0F;&#x6811;" class="anchor-navigation-ex-anchor" href="#18&#x8868;&#x8FBE;&#x5F0F;&#x6811;"><i class="fa fa-link" aria-hidden="true"></i></a>18&gt;&#x8868;&#x8FBE;&#x5F0F;&#x6811;</h2>
<p><a href="https://www.cnblogs.com/snailblog/p/11521043.html" target="_blank">https://www.cnblogs.com/snailblog/p/11521043.html</a></p>
<p><a href="https://www.cnblogs.com/cmliu/p/13246185.html" target="_blank">https://www.cnblogs.com/cmliu/p/13246185.html</a></p>
<p><a href="https://masuit.com/1741" target="_blank">https://masuit.com/1741</a></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/concepts/expression-trees/" target="_blank">https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/concepts/expression-trees/</a></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/expression-trees" target="_blank">https://docs.microsoft.com/zh-cn/dotnet/csharp/expression-trees</a></p>
<p><a href="https://www.zhihu.com/question/392350352/answer/1200192977" target="_blank">https://www.zhihu.com/question/392350352/answer/1200192977</a></p>
<h3 id="18-1&#x4F7F;&#x7528;&#x573A;&#x666F;"><a name="18-1&#x4F7F;&#x7528;&#x573A;&#x666F;" class="anchor-navigation-ex-anchor" href="#18-1&#x4F7F;&#x7528;&#x573A;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>18-1&gt;&#x4F7F;&#x7528;&#x573A;&#x666F;</h3>
<ul>
<li><p>&#x4EE3;&#x7406;&#x7C7B;&#x65B9;&#x6CD5;&#x7684;&#x6784;&#x9020;(&#x5982;AOP&#xFF0C;gRpc&#xFF0C;WebService&#x4E2D;)&#xFF0C;&#x901A;&#x8FC7;&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#xFF0C;&#x6784;&#x9020;&#x59D4;&#x6258;&#x6267;&#x884C;&#x8981;&#x4EE3;&#x7406;&#x7684;&#x65B9;&#x6CD5;</p>
</li>
<li><p>EF&#xFF0C;MongoDB&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;ORM&#x7B49;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x5C42;&#x8FC7;&#x6EE4;&#x4F7F;&#x7528;&#x7684;Expression&#xFF0C;&#x6700;&#x5178;&#x578B;&#x7684;&#x5C31;&#x662F;&#x9488;&#x5BF9;IQueryable&#x7C7B;&#x578B;&#x5206;&#x9875;&#xFF0C;&#x6392;&#x5E8F;&#x7684;&#x52A8;&#x6001;&#x6269;&#x5C55;</p>
</li>
<li><p>&#x5E38;&#x7528;&#x7684;Linq&#x4E2D;AND,OR&#x7B49;Predicate&#x52A0;&#x5F3A;&#x7684;&#x4E00;&#x4E9B;&#x6269;&#x5C55;</p>
</li>
<li><p>&#x6570;&#x5B66;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x4F2A;SQL&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x89E3;&#x6790;&#x5668;&#x7684;&#x6784;&#x9020;&#xFF08;&#x8FD9;&#x4E2A;&#x6BD4;&#x8F83;&#x5E95;&#x5C42;&#xFF09;</p>
</li>
</ul>
<h3 id="18-2vs&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x5B89;&#x88C5;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;vs2019-&#x5DE5;&#x5177;&#x7248;&#x672C;171150-&#x4E0D;&#x652F;&#x6301;net-core-31&#x4EE5;&#x4E0A;&#x6846;&#x67B6;"><a name="18-2vs&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x5B89;&#x88C5;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;vs2019-&#x5DE5;&#x5177;&#x7248;&#x672C;171150-&#x4E0D;&#x652F;&#x6301;net-core-31&#x4EE5;&#x4E0A;&#x6846;&#x67B6;" class="anchor-navigation-ex-anchor" href="#18-2vs&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x5B89;&#x88C5;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;vs2019-&#x5DE5;&#x5177;&#x7248;&#x672C;171150-&#x4E0D;&#x652F;&#x6301;net-core-31&#x4EE5;&#x4E0A;&#x6846;&#x67B6;"><i class="fa fa-link" aria-hidden="true"></i></a>18-2&gt;VS&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x5B89;&#x88C5;(&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;vs2019, &#x5DE5;&#x5177;&#x7248;&#x672C;:1.7.115.0, &#x4E0D;&#x652F;&#x6301;Net Core 3.1&#x4EE5;&#x4E0A;&#x6846;&#x67B6;)</h3>
<p>*<a href="https://github.com/zspitz/ExpressionTreeVisualizer" target="_blank">ExpressionTreeVisualizer</a></p>
<p>*<a href="https://www.cnblogs.com/cdaniu/p/15418615.html" target="_blank">ExpressionTreeVisualizer&#x5B89;&#x88C5;&#x65B9;&#x6CD5;</a></p>
<h3 id="18-3&#x64CD;&#x4F5C;&#x8FD0;&#x7B97;&#x7B26;"><a name="18-3&#x64CD;&#x4F5C;&#x8FD0;&#x7B97;&#x7B26;" class="anchor-navigation-ex-anchor" href="#18-3&#x64CD;&#x4F5C;&#x8FD0;&#x7B97;&#x7B26;"><i class="fa fa-link" aria-hidden="true"></i></a>18-3&gt;&#x64CD;&#x4F5C;&#x8FD0;&#x7B97;&#x7B26;</h3>
<p><code>Add</code>
&#x52A0;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; a + b, &#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>AddAssign</code>
&#x52A0;&#x6CD5;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a += b), &#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>AddAssignChecked</code>
&#x52A0;&#x6CD5;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a += b), &#xFF0C;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>AddChecked</code>
&#x52A0;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a + b), &#xFF0C;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>And</code>
&#x6309;&#x4F4D;&#x6216;&#x903B;&#x8F91; AND &#x64CD;&#x4F5C;&#xFF0C;&#x5982; (a &amp; b)</p>
<p><code>AndAlso</code>
&#x5728;&#x6761;&#x4EF6; AND &#x4EC5;&#x5F53;&#x7B2C;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x6570;&#x7684;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x4E3A;&#x624D;&#x8BA1;&#x7B97;&#x7B2C;&#x4E8C;&#x4E2A;&#x64CD;&#x4F5C;&#x6570;&#x7684;&#x64CD;&#x4F5C; true&#x3002; &#x5B83;&#x5BF9;&#x5E94;&#x4E8E; (a &amp;&amp; b)</p>
<p><code>AndAssign</code>
&#x6309;&#x4F4D;&#x6216;&#x903B;&#x8F91; AND &#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a &amp;= b)</p>
<p><code>ArrayIndex</code>
&#x7D22;&#x5F15;&#x64CD;&#x4F5C;&#x5728;&#x4E00;&#x7EF4;&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x5982; array[index]</p>
<p><code>ArrayLength</code>
&#x83B7;&#x53D6;&#x4E00;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x5982;&#x64CD;&#x4F5C; array.Length&#x3002;</p>
<p><code>Assign</code>
&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a = b)&#x3002;</p>
<p><code>Block</code>
&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5757;, &#x5C0F;&#x62EC;&#x53F7; (&#x82E5;&#x9700;&#x8981;&#x6267;&#x884C;&#x591A;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;, &#x53EF;&#x4EE5;&#x4F7F;&#x7528;block&#x5305;&#x8D77;&#x6765;)</p>
<p><code>Call</code>
&#x67D0;&#x4E2A;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#xFF0C;&#x5982;&#x5728; obj.sampleMethod() &#x8868;&#x8FBE;&#x5F0F;&#x3002;</p>
<p><code>Coalesce</code>
&#x4E00;&#x4E2A;&#x8868;&#x793A;&#x7A7A;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x8282;&#x70B9; (a ?? b) </p>
<p><code>Conditional</code>
&#x6761;&#x4EF6;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; a &gt; b ? a : b &#x5728; C#</p>
<p><code>Constant</code>
&#x5E38;&#x91CF;&#x7684;&#x503C;&#x3002;</p>
<p><code>Convert</code>
&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x6216;&#x8F6C;&#x6362;&#x64CD;&#x4F5C;&#x4E2D;&#xFF0C;&#x5982; (SampleType)obj C# &#x4E2D;</p>
<p><code>ConvertChecked</code>
&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x6216;&#x8F6C;&#x6362;&#x64CD;&#x4F5C;&#x4E2D;&#xFF0C;&#x5982; (SampleType)obj C# &#x4E2D;</p>
<p><code>DebugInfo</code>
&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#x3002;</p>
<p><code>Decrement</code>
&#x4E00;&#x5143;&#x9012;&#x51CF;&#x64CD;&#x4F5C;&#xFF0C;&#x5982; (a - 1) C# &#x548C; Visual Basic &#x4E2D;&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x4E0D;&#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>Default</code>
&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p>
<p><code>Divide</code>
&#x9664;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a / b), &#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>DivideAssign</code>
&#x9664;&#x7684;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a /= b), &#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>Dynamic</code>
&#x52A8;&#x6001;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>Equal</code>
&#x4E00;&#x4E2A;&#x8868;&#x793A;&#x76F8;&#x7B49;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x8282;&#x70B9; (a == b)</p>
<p><code>ExclusiveOr</code>
&#x6309;&#x4F4D;&#x6216;&#x903B;&#x8F91; XOR &#x64CD;&#x4F5C;&#xFF0C;&#x5982; (a ^ b)</p>
<p><code>ExclusiveOrAssign</code>
&#x6309;&#x4F4D;&#x6216;&#x903B;&#x8F91; XOR &#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a ^= b)</p>
<p><code>Extension</code>
&#x6269;&#x5C55;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</p>
<p><code>Goto</code>
&#x4E00;&#x4E2A;&quot;&#x8F6C;&#x5230;&quot;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5982; goto Label</p>
<p><code>GreaterThan</code>
&quot;&#x5927;&#x4E8E;&quot;&#x6BD4;&#x8F83;&#xFF0C;&#x5982; (a &gt; b)&#x3002;</p>
<p><code>GreaterThanOrEquals</code>
&quot;&#x5927;&#x4E8E;&#x6216;&#x7B49;&#x4E8E;&quot;&#x6BD4;&#x8F83;&#xFF0C;&#x5982; (a &gt;= b)&#x3002;</p>
<p><code>Increment</code>
&#x4E00;&#x5143;&#x9012;&#x589E;&#x64CD;&#x4F5C;&#xFF0C;&#x5982; (a + 1)</p>
<p><code>Index</code>
&#x7D22;&#x5F15;&#x64CD;&#x4F5C;&#x6216;&#x8BBF;&#x95EE;&#x4E0D;&#x91C7;&#x7528;&#x53C2;&#x6570;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>Invoke</code>
&#x64CD;&#x4F5C;&#x8C03;&#x7528;&#x7684;&#x59D4;&#x6258;&#x6216; lambda &#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5982; sampleDelegate.Invoke()&#x3002;</p>
<p><code>IsFalse</code>
&#x4E00;&#x4E2A; false &#x6761;&#x4EF6;&#x503C;&#x3002;</p>
<p><code>IsTrue</code>
&#x4E00;&#x4E2A; true &#x6761;&#x4EF6;&#x503C;&#x3002;</p>
<p><code>Label</code>
&#x6807;&#x7B7E;&#x3002;</p>
<p><code>Lambda</code>
Lambda &#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5982; a =&gt; a + a</p>
<p><code>LeftShift</code>
&#x6309;&#x4F4D;&#x5DE6;&#x79FB;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a &lt;&lt; b)&#x3002;</p>
<p><code>LeftShiftAssign</code>
&#x6309;&#x4F4D;&#x5DE6;&#x79FB;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a &lt;&lt;= b)&#x3002;</p>
<p><code>LessThan</code>
&quot;&#x5C0F;&#x4E8E;&quot;&#x6BD4;&#x8F83;&#xFF0C;&#x5982; (a &lt; b)&#x3002;</p>
<p><code>LessThanOrEqual</code>
&quot;&#x5C0F;&#x4E8E;&#x6216;&#x7B49;&#x4E8E;&quot;&#x6BD4;&#x8F83;&#xFF0C;&#x5982; (a &lt;= b)&#x3002;</p>
<p><code>ListInit</code>
&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x64CD;&#x4F5C;&#x7684; IEnumerable &#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4ECE;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982; new List<sampletype>(){ a, b, c }</sampletype></p>
<p><code>Loop</code>
&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#xFF0C;&#x5982; for &#x6216; while&#x3002;</p>
<p><code>MemberAccess</code>
&#x4ECE;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x6216;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C; obj.SampleProperty&#x3002;</p>
<p><code>MemberInit</code>
&#x8FD0;&#x7B97;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x5E76;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6210;&#x5458;&#xFF0C;&#x5982; new Point { X = 1, Y = 2 }</p>
<p><code>Modulo</code>
&#x7B97;&#x672F;&#x4F59;&#x6570;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a % b)</p>
<p><code>ModuloAssign</code>
&#x7B97;&#x672F;&#x4F59;&#x6570;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a %= b) C# &#x4E2D;&#x3002;</p>
<p><code>Multiply</code>
&#x4E58;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a * b), &#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>MultiplyAssign</code>
&#x4E58;&#x6CD5;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a *= b), &#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>MultiplyAssignChecked</code>
&#x4E58;&#x6CD5;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a *= b), &#xFF0C;&#xFF0C;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>MultiplyChecked</code>
&#x4E58;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a * b), &#xFF0C;&#xFF0C;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>Negate</code>
&#x7B97;&#x672F;&#x6C42;&#x53CD;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (-a)&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x4E0D;&#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>NegateChecked</code>
&#x7B97;&#x672F;&#x6C42;&#x53CD;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (-a), &#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x4E0D;&#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>New</code>
&#x8C03;&#x7528;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4EE5;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x64CD;&#x4F5C; new SampleType()&#x3002;</p>
<p><code>NewArrayBounds</code>
&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E2A;&#x7EF4;&#x5EA6;&#x7684;&#x4E0B;&#x9650;&#x6307;&#x5B9A;&#xFF0C;&#x5982;&#x64CD;&#x4F5C; new SampleType[dim1, dim2]</p>
<p><code>NewArrayInit</code>
&#x64CD;&#x4F5C;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E00;&#x7EF4;&#x6570;&#x7EC4;&#x5E76;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4ECE;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982; new SampleType[]{a, b, c}</p>
<p><code>Not</code>
&#x6309;&#x4F4D;&#x6C42;&#x8865;&#x6216;&#x903B;&#x8F91;&#x6C42;&#x53CD;&#x8FD0;&#x7B97;&#x3002; &#x5728; C# &#x4E2D;&#xFF0C;&#x5219;&#x7B49;&#x540C;&#x4E8E; (~a) &#x6574;&#x578B;&#x548C; (!a) &#x5E03;&#x5C14;&#x503C;&#x3002;</p>
<p><code>NotEqual</code>
&#x4E0D;&#x76F8;&#x7B49;&#x6BD4;&#x8F83;&#xFF0C;&#x5982; (a != b) &#x5728; C#</p>
<p><code>OnesComplement</code>
&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x53CD;&#x7801;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (~a) C# &#x4E2D;&#x3002;</p>
<p><code>Or</code>
&#x6309;&#x4F4D;&#x6216;&#x903B;&#x8F91; OR &#x64CD;&#x4F5C;&#xFF0C;&#x5982; (a | b)</p>
<p><code>OrAssign</code>
&#x6309;&#x4F4D;&#x6216;&#x903B;&#x8F91; OR &#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a |= b) C# &#x4E2D;&#x3002;</p>
<p><code>OrElse</code>
&#x77ED;&#x8DEF;&#x6761;&#x4EF6; OR &#x64CD;&#x4F5C;&#xFF0C;&#x5982; (a || b)</p>
<p><code>Parameter</code>
&#x5BF9;&#x53C2;&#x6570;&#x6216;&#x53D8;&#x91CF;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5F15;&#x7528;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;ParameterExpression&#x3002;</p>
<p><code>PostDecrementAssign</code>
&#x4E00;&#x5143;&#x540E;&#x7F00;&#x9012;&#x51CF;&#xFF0C;&#x5982; (a--)&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>PostIncrementAssign</code>
&#x4E00;&#x5143;&#x540E;&#x7F00;&#x9012;&#x589E;&#xFF0C;&#x5982; (a++)&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>Power</code>
&#x5982;&#x5F15;&#x53D1;&#x6570;&#x5B57;&#x8FDB;&#x884C;&#x5E42;&#x8FD0;&#x7B97;&#x7684;&#x6570;&#x5B66;&#x8FD0;&#x7B97; (a ^ b) &#x5728; Visual Basic &#x4E2D;&#x3002;</p>
<p><code>PowerAssign</code>
&#x5982;&#x5F15;&#x53D1;&#x6570;&#x5B57;&#x8FDB;&#x884C;&#x5E42;&#x8FD0;&#x7B97;&#x7684;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97; (a ^= b) &#x5728; Visual Basic &#x4E2D;&#x3002;</p>
<p><code>PreDecrementAssign</code>
&#x4E00;&#x5143;&#x524D;&#x7F00;&#x9012;&#x51CF;&#xFF0C;&#x5982; (--a)&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>PreIncrementAssign</code>
&#x4E00;&#x5143;&#x524D;&#x7F00;&#x9012;&#x589E;&#xFF0C;&#x5982; (++a)&#x3002; &#x8BE5;&#x5BF9;&#x8C61; a &#x5E94;&#x5C31;&#x5730;&#x4FEE;&#x6539;&#x3002;</p>
<p><code>Quote</code>
&#x5177;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x5E38;&#x91CF;&#x503C;&#x7684;&#x8868;&#x8FBE;&#x5F0F; Expression&#x3002; &#x4E00;&#x4E2A; Quote &#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5BF9;&#x5B83;&#x6240;&#x4EE3;&#x8868;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x53C2;&#x6570;&#x7684;&#x5F15;&#x7528;&#x3002;</p>
<p><code>RightShift</code>
&#x6309;&#x4F4D;&#x53F3;&#x79FB;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a &gt;&gt; b)&#x3002;</p>
<p><code>RightShiftAssign</code>
&#x6309;&#x4F4D;&#x53F3;&#x79FB;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a &gt;&gt;= b)&#x3002;</p>
<p><code>RuntimeVariables</code>
&#x8FD0;&#x884C;&#x65F6;&#x53D8;&#x91CF;&#x7684;&#x5217;&#x8868;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;RuntimeVariablesExpression&#x3002;</p>
<p><code>Subtract</code>
&#x51CF;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a - b), &#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>SubtractAssign</code>
&#x51CF;&#x6CD5;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a -= b), &#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>SubtractAssignChecked</code>
&#x51CF;&#x6CD5;&#x590D;&#x5408;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a -= b), &#xFF0C;&#xFF0C;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>SubtractChecked</code>
&#x7B97;&#x672F;&#x51CF;&#x6CD5;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (a - b), &#xFF0C;&#xFF0C;&#x8FDB;&#x884C;&#x6EA2;&#x51FA;&#x68C0;&#x67E5;&#xFF0C;&#x9488;&#x5BF9;&#x6570;&#x503C;&#x64CD;&#x4F5C;&#x6570;&#x3002;</p>
<p><code>Switch</code>
&#x4E00;&#x4E2A;&#x5207;&#x6362;&#x64CD;&#x4F5C;&#xFF0C;&#x5982; switch</p>
<p><code>Throw</code>
&#x5F15;&#x53D1;&#x5F02;&#x5E38;&#xFF0C;&#x5982;&#x64CD;&#x4F5C; throw new Exception()&#x3002;</p>
<p><code>Try</code>
&#x4E00;&#x4E2A; try-catch &#x8868;&#x8FBE;&#x5F0F;&#x3002;</p>
<p><code>TypeAs</code>
&#x663E;&#x5F0F;&#x5F15;&#x7528;&#x6216;&#x88C5;&#x7BB1;&#x8F6C;&#x6362;&#x5728;&#x5176;&#x4E2D; null &#x5982;&#x679C;&#x8F6C;&#x6362;&#x5931;&#x8D25;&#xFF0C;&#x5982;&#x63D0;&#x4F9B; (obj as SampleType) &#x5728; C# &#x6216; TryCast(obj, SampleType) &#x5728; Visual Basic &#x4E2D;&#x3002;</p>
<p><code>TypeEqual</code>
&#x786E;&#x5207;&#x7C7B;&#x578B;&#x6D4B;&#x8BD5;&#x3002;</p>
<p><code>TypeIs</code>
&#x4E00;&#x79CD;&#x7C7B;&#x578B;&#x6D4B;&#x8BD5;&#xFF0C;&#x5982; obj is SampleType &#x5728; C# &#x6216; TypeOf obj is SampleType &#x5728; Visual Basic &#x4E2D;&#x3002;</p>
<p><code>UnaryPlus</code>
&#x4E00;&#x5143;&#x6B63;&#x8FD0;&#x7B97;&#xFF0C;&#x5982; (+a)&#x3002; &#x9884;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x5143;&#x6B63;&#x8FD0;&#x7B97;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x64CD;&#x4F5C;&#x6570;&#x7684;&#x503C;&#xFF0C;&#x4F46;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x6709;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<p><code>Unbox</code>
&#x53D6;&#x6D88;&#x88C5;&#x7BB1;&#x503C;&#x7C7B;&#x578B;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5982; unbox &#x548C; unbox.any MSIL &#x4E2D;&#x7684;&#x8BF4;&#x660E;&#x3002;</p>
<h3 id="18-4&#x8303;&#x4F8B;"><a name="18-4&#x8303;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#18-4&#x8303;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>18-4&gt;&#x8303;&#x4F8B;</h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// (a,b,c) =&gt; (b*b+4*a*c)&#xB2;-b
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
private static double TestExpression2(double a, double b, double c)
{
    var paramA = Expression.Parameter(typeof(double), &quot;a&quot;);
    var paramB = Expression.Parameter(typeof(double), &quot;b&quot;);
    var paramC = Expression.Parameter(typeof(double), &quot;c&quot;);
    var const4 = Expression.Constant(4D, typeof(double));
    var pow = typeof(Math).GetMethod(nameof(Math.Pow), new[] { typeof(double), typeof(double) });

    var multiplBB = Expression.Multiply(paramB, paramB);
    var multipl4A = Expression.Multiply(const4, paramA);
    var multipl4AC = Expression.Multiply(multipl4A, paramC);
    var addBB4AC = Expression.Add(multiplBB, multipl4AC);
    var blockLeft = Expression.Block
    (
        addBB4AC
    );
    var sqrExp = Expression.Call(pow, new Expression[] { blockLeft, Expression.Constant(2D, typeof(double)) });
    var subB = Expression.Subtract(sqrExp, paramB);
    var lamdaExp = Expression.Lambda&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>double,</span> <span class="token attr-name">double,</span> <span class="token attr-name">double,</span> <span class="token attr-name">double</span><span class="token punctuation">&gt;</span></span>&gt;(subB, new[] { paramA, paramB, paramC });

    var func = lamdaExp.Compile();
    var result = func(a, b, c);
    return result;
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6784;&#x9020;&#x5FAA;&#x73AF;&#x8868;&#x8FBE;&#x5F0F;&#x6811;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private static int TestLoopAndReturn(int count)
{
    /*
    Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int,</span> <span class="token attr-name">int</span><span class="token punctuation">&gt;</span></span> exp = count =&gt;
    {
        var i = 0;
        while (i &lt; count)
        {
            Console.WriteLine(++i);
        }

        return i;
    };
    return exp(count);
    */

    //&#x7528;API&#x6784;&#x9020;&#x4E0A;&#x8FF0;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x6811;
    var paramCount = Expression.Parameter(typeof(int), &quot;count&quot;);
    var paramCurIndex = Expression.Parameter(typeof(int), &quot;i&quot;);
    var breakLabel = Expression.Label(typeof(int));
    var continueLabel = Expression.Label(typeof(void));
    var writeLine = typeof(Console).GetMethod(nameof(Console.WriteLine), new[] { typeof(int) });

    var loopExp = Expression.Loop
    (
        Expression.IfThenElse
        (
            Expression.LessThan(paramCurIndex, paramCount),
            Expression.Block
            (
                Expression.PreIncrementAssign(paramCurIndex),
                Expression.Call(writeLine, new Expression[] { paramCurIndex }),
                Expression.Continue(continueLabel, typeof(void))
            ),
            Expression.Break(breakLabel, paramCurIndex)
        ), breakLabel, continueLabel);

    var blockExp = Expression.Block
    (
        paramCurIndex,
        Expression.Assign(paramCurIndex, Expression.Constant(0, typeof(int))),
        loopExp
    );

    var lamdaExp = Expression.Lambda&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int,</span> <span class="token attr-name">int</span><span class="token punctuation">&gt;</span></span>&gt;
    (
        Expression.Block
        (
            new ParameterExpression[] { paramCurIndex }, //&#x5F15;&#x5165;&#x53D8;&#x91CF;
            new Expression[]
            {
                Expression.Assign(paramCurIndex, Expression.Constant(0, typeof(int))), //i=0
                loopExp //&#x8FDB;&#x5165;&#x5FAA;&#x73AF;&#x64CD;&#x4F5C;
            }
        ),
        new[] { paramCount }
    );
    var func = lamdaExp.Compile();
    var result = func(count);

    return result;
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6784;&#x9020;try catch&#x8868;&#x8FBE;&#x5F0F;&#x6811;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
private static void TestTryCatch() 
{
    var exParam = Expression.Parameter(typeof(Exception), &quot;ex&quot;);
    var writeLine = typeof(Console).GetMethod(nameof(Console.WriteLine), new[] { typeof(string) });
    var const1 = Expression.Constant(1, typeof(int));
    var const0 = Expression.Constant(0, typeof(int));
    var stringConcat = typeof(string).GetMethod(nameof(string.Concat), new[] { typeof(string), typeof(string) });

    //PS: try&#x548C;catch&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4E3B;&#x4F53;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x7684;&#x5185;&#x5BB9;&#x8981;&#x4E00;&#x81F4;, &#x4E0D;&#x7136;&#x4F1A;&#x62A5;&#x9519;. &#x6BD4;&#x5982;&#x4F7F;&#x7528;Expression.Constant(null)
    var tryCatchFinallyExp = Expression.TryCatchFinally
    (
        Expression.Block
        (
            Expression.Divide
            (
                const1, const0
            ),
            Expression.Constant(null)
        ),
        Expression.Block
        (
            Expression.Call(writeLine, new Expression[] { Expression.Constant(&quot;&#x6267;&#x884C; finally &#x64CD;&#x4F5C;.&quot;, typeof(string)) })
        ),
        Expression.Catch
        (
            exParam,
            Expression.Block
            (
                Expression.Call(writeLine, new Expression[] 
                { 
                    Expression.Call(stringConcat,new Expression[]
                    {
                        Expression.Constant(&quot;error msg: &quot;,typeof(string)),
                        Expression.Property(exParam, &quot;Message&quot;)
                    })
                }),
                Expression.Constant(null)
            )
        )
    );

    var lamdaExp = Expression.Lambda<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Action</span><span class="token punctuation">&gt;</span></span>(tryCatchFinallyExp);
    lamdaExp.Compile()();
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// student =&gt; 
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private static StudentCopy CopyInstance()
{
    var inType = typeof(Student);

    var outType = typeof(StudentCopy);
    var outPropertyInfos = outType.GetProperties();

    //&#x521B;&#x5EFA; student =&gt; ... &#x4E2D;&#x7684;student&#x53C2;&#x6570;
    var stuParam = Expression.Parameter(typeof(Student), &quot;student&quot;);

    //&#x521B;&#x5EFA;new StudentCopy&#x8868;&#x8FBE;&#x5F0F;&#x6811;
    var createOutExp = Expression.New(outType);

    //&#x521B;&#x5EFA;&#x6210;&#x5458;&#x8D4B;&#x503C;&#x8868;&#x8FBE;&#x5F0F;&#x6811;
    var memberBindings = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MemberBinding</span><span class="token punctuation">&gt;</span></span>();
    outPropertyInfos.ToList().ForEach(outPropertyInfo =&gt;
    {
        //&#x6784;&#x9020;student.pro
        var outPropertyExp = Expression.Property(stuParam, inType.GetProperty(outPropertyInfo.Name));
        //&#x6784;&#x9020;studentCopy.pro = student.pro
        MemberBinding memberBinding = Expression.Bind(outPropertyInfo, outPropertyExp);
        memberBindings.Add(memberBinding);
    });

    //&#x4F7F;&#x7528;&#x6210;&#x5458;&#x8D4B;&#x503C;&#x8868;&#x8FBE;&#x5F0F;&#x5217;&#x8868;&#x5B9E;&#x4F8B;&#x5316;&#x5BF9;&#x8C61;
    var memberInitExpression = Expression.MemberInit(createOutExp, memberBindings);

    var lambdaExp = Expression.Lambda&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Student,</span> <span class="token attr-name">StudentCopy</span><span class="token punctuation">&gt;</span></span>&gt;(memberInitExpression, new[] { stuParam });

    var func = lambdaExp.Compile();

    var student = new Student()
    {
        Id = 1,
        UserName = &quot;dylanxu&quot;,
        Active = true
    };
    var studentCopy = func(student);
    return studentCopy;
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6D4B;&#x8BD5;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private static List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Student</span><span class="token punctuation">&gt;</span></span> TestFilter()
{
    //&#x6784;&#x9020;&#x6E90;&#x6570;&#x636E;
    var students = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Student</span><span class="token punctuation">&gt;</span></span>
    {
        new Student
        {
            Id = 1,
            UserName = &quot;dylanxu&quot;,
            Active = true,
        },
        new Student
        {
            Id = 2,
            UserName = &quot;alancheng&quot;,
            Active = true,
        },
        new Student
        {
            Id = 3,
            UserName = &quot;aoniruan&quot;,
            Active = true,
        },
        new Student
        {
            Id = 4,
            UserName = &quot;expectwua&quot;,
            Active = true,
        },
        new Student
        {
            Id = 5,
            UserName = &quot;jasonlin&quot;,
            Active = true,
        },
        new Student
        {
            Id = 6,
            UserName = &quot;dd&quot;,
            Active = true,
        },
        new Student
        {
            Id = 7,
            UserName = &quot;dd&quot;,
            Active = false,
        },
    };

    //&#x6784;&#x9020;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;
    var condictionJArray = new JArray
    {
        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;UserName&quot; },
        //    { SysContant.Condition_Type,&quot;string&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;and&quot; },
        //    { SysContant.Condition_Value,&quot;a&quot; },
        //    { SysContant.Condition_Comparison,&quot;like&quot; },
        //},
        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;Id&quot; },
        //    { SysContant.Condition_Type,&quot;int&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;and&quot; },
        //    { SysContant.Condition_Value,&quot;1&quot; },
        //    { SysContant.Condition_Comparison,&quot;&gt;&quot; },
        //},
        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;Id&quot; },
        //    { SysContant.Condition_Type,&quot;int&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;and&quot; },
        //    { SysContant.Condition_Value,&quot;5,3&quot; },
        //    { SysContant.Condition_Comparison,&quot;between&quot; },
        //},

        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;Id&quot; },
        //    { SysContant.Condition_Type,&quot;int&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;and&quot; },
        //    { SysContant.Condition_Value,&quot;3,4,5&quot; },
        //    { SysContant.Condition_Comparison,&quot;in&quot; },
        //},

        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;Id&quot; },
        //    { SysContant.Condition_Type,&quot;int&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;and&quot; },
        //    { SysContant.Condition_Value,&quot;5&quot; },
        //    { SysContant.Condition_Comparison,&quot;not in&quot; },
        //},

        new JObject
        {
            { SysContant.Condition_Field,&quot;Id&quot; },
            { SysContant.Condition_Type,&quot;int&quot; },
            { SysContant.Condition_Format,&quot;&quot; },
            { SysContant.Condition_Relation,&quot;and&quot; },
            { SysContant.Condition_Value,&quot;1&quot; },
            { SysContant.Condition_Comparison,&quot;&gt;&quot; },
        },

        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;Active&quot; },
        //    { SysContant.Condition_Type,&quot;bool&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;and&quot; },
        //    { SysContant.Condition_Value,&quot;true&quot; },
        //    { SysContant.Condition_Comparison,&quot;=&quot; },
        //},

        //new JObject
        //{
        //    { SysContant.Condition_Field,&quot;Active&quot; },
        //    { SysContant.Condition_Type,&quot;bool&quot; },
        //    { SysContant.Condition_Format,&quot;&quot; },
        //    { SysContant.Condition_Relation,&quot;or&quot; },
        //    { SysContant.Condition_Value,&quot;false&quot; },
        //    { SysContant.Condition_Comparison,&quot;=&quot; },
        //},
    };

    var queryable = students.AsQueryable().Where(t =&gt; t.Id &gt; 1);
    var queryableNew = CreateFilter(queryable, condictionJArray);

    //&#x6392;&#x5E8F;
    var sortJArray = new JArray
    {
        new JObject
        {
            { SysContant.Condition_Field, &quot;UserName&quot; },
            { SysContant.Sort_Direction, SysContant.Sort_Direction_asc },
        },
        new JObject
        {

            { SysContant.Condition_Field, &quot;Active&quot; },
            { SysContant.Sort_Direction, SysContant.Sort_Direction_desc },
        }
    };
    queryableNew = CreateSort(queryableNew, sortJArray);

    var resultList = queryableNew.ToList();
    return resultList;
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6784;&#x9020;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>T<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5B9E;&#x4F53;&#x7C7B;&#x578B;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryable<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>queryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>condictionJArray<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
///[
///  {
///    &quot;Field&quot;: &quot;UserName&quot;,
///    &quot;Type&quot;: &quot;string&quot;,
///    &quot;Format&quot;: &quot;&quot;,
///    &quot;Relation&quot;: &quot;and&quot;,
///    &quot;Value&quot;: &quot;an&quot;,
///    &quot;Comparison&quot;: &quot;like&quot;
///  }
///]
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// &#x4E0D;&#x652F;&#x6301;&#x6E90;&#x5B57;&#x6BB5;&#x662F;&#x5B50;&#x67E5;&#x8BE2;/&#x590D;&#x6742;&#x67E5;&#x8BE2;&#x7684;&#x60C5;&#x51B5;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private static IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> CreateFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> queryable, JArray condictionJArray)
{
    if (queryable == default)
    {
        return queryable;
    }

    condictionJArray ??= new JArray();
    if (condictionJArray.Count &lt;= 0)
    {
        return queryable;
    }

    var instType = typeof(T);
    var tParam = Expression.Parameter(instType, &quot;t&quot;);

    #region CreateFilterInner

    //&#x6784;&#x9020;&#x5355;&#x4E2A;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;
    Expression CreateFilterInner<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(JObject jObject, Expression finalExpression)
    {
        Expression expression = default;
        jObject ??= new JObject();
        if (jObject.Count &lt;= 0)
        {
            return finalExpression;
        }

        var field = jObject.GetVal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(SysContant.Condition_Field).TrimAll() ?? &quot;&quot;;
        var relation = jObject.GetVal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(SysContant.Condition_Relation).TrimAll().ToLower() ?? &quot;&quot;;
        if (string.IsNullOrEmpty(relation))
        {
            relation = &quot;and&quot;;
        }
        var comparison = jObject.GetVal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(SysContant.Condition_Comparison).TrimAll().ToLower() ?? &quot;&quot;;

        var propertyInfo = instType.GetProperty(field);
        if (propertyInfo == default)
        {
            throw new ArgumentNullException(nameof(propertyInfo));
        }

        //&#x83B7;&#x53D6;&#x5E95;&#x5C42;&#x7C7B;&#x578B;
        var propertyUnderType = propertyInfo.PropertyType.GetUnderType();

        //&#x6784;&#x9020;&#x8868;&#x8FBE;&#x5F0F;
        Expression proExp = proExp = Expression.Property(tParam, propertyInfo);
        //&#x83B7;&#x53D6;&#x5C5E;&#x6027;&#x503C;
        object value = jObject.GetVal(&quot;Value&quot;);
        //&#x503C;&#x4E0D;&#x80FD;&#x4E3A;&#x7A7A;
        if (value == default)
        {
            throw new ArgumentNullException(nameof(value));
        }
        Expression valParam = null;
        if (comparison != &quot;between&quot; &amp;&amp; comparison != &quot;in&quot; &amp;&amp; comparison != &quot;not in&quot;)
        {
            //&#x5F3A;&#x5236;&#x7C7B;&#x578B;&#x8F6C;&#x6362;
            value = FramePublicFun.ConvertType(value, propertyUnderType);
            valParam = Expression.Constant(value, propertyUnderType);
        }

        //&#x82E5;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x4E00;&#x81F4;, &#x5219;&#x8BF4;&#x660E;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x578B;&#x62E5;&#x6709;&#x5E95;&#x5C42;&#x7C7B;&#x578B;
        //&#x62E5;&#x6709;&#x5E95;&#x5C42;&#x7C7B;&#x578B;&#x7684;&#x5C5E;&#x6027;, &#x9700;&#x8981;&#x901A;&#x8FC7;GetValueOrDefault&#x6765;&#x83B7;&#x53D6;&#x5B9E;&#x9645;&#x503C;
        if (propertyUnderType != propertyInfo.PropertyType)
        {
            //&#x8C03;&#x7528;&#x9759;&#x6001;&#x65B9;&#x6CD5;
            var getValueOrDefaultMethod = propertyInfo.PropertyType.GetMethod(&quot;GetValueOrDefault&quot;, new Type[] { });
            proExp = Expression.Call(proExp, getValueOrDefaultMethod, new Expression[] { });
        }

        //&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x79CD;&#x8868;&#x793A;
        //&#x82E5;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x5B57;&#x6BB5;, &#x5219;&#x63D0;&#x524D;&#x6784;&#x9020;Contains&#x65B9;&#x6CD5;
        //MethodInfo containsMethod = null;
        //Expression stringComparisonConst = null;
        //if (propertyUnderType == typeof(string))
        //{
        //    containsMethod = propertyUnderType.GetMethod(&quot;Contains&quot;, new[] { typeof(string), typeof(StringComparison) });
        //    stringComparisonConst = Expression.Constant(StringComparison.OrdinalIgnoreCase, typeof(StringComparison));
        //}

        //&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x79CD;&#x8868;&#x793A;
        MethodInfo containsMethod = typeof(string).GetMethod(&quot;Contains&quot;, new[] { typeof(string), typeof(StringComparison) });
        Expression stringComparisonConst = Expression.Constant(StringComparison.OrdinalIgnoreCase, typeof(StringComparison));

        switch (comparison)
        {
            case &quot;=&quot;:
            case &quot;==&quot;:
            case &quot;equal&quot;:
                expression = Expression.Equal(proExp, valParam);
                break;

            case &quot;&lt;&gt;&quot;:
            case &quot;!=&quot;:
            case &quot;not equal&quot;:
                expression = Expression.NotEqual(proExp, valParam);
                break;

            case &quot;&gt;&quot;:
            case &quot;gt&quot;:
                expression = Expression.GreaterThan(proExp, valParam);
                break;

            case &quot;&gt;=&quot;:
            case &quot;ge&quot;:
                expression = Expression.GreaterThanOrEqual(proExp, valParam);
                break;

            case &quot;&lt;&quot;:
            case &quot;lt&quot;:
                expression = Expression.LessThan(proExp, valParam);
                break;

            case &quot;&lt;=&quot;:
            case &quot;le&quot;:
                expression = Expression.LessThanOrEqual(proExp, valParam);
                break;

            case &quot;like&quot;:
            case &quot;contain&quot;:
                expression = Expression.Call(proExp, containsMethod, new Expression[] { valParam, stringComparisonConst });
                break;

            case &quot;not like&quot;:
            case &quot;not contain&quot;:
                expression =
                    Expression.Not
                    (
                        Expression.Call(proExp, containsMethod, new Expression[] { valParam, stringComparisonConst })
                    );
                break;

            case &quot;between&quot;:
                {
                    //&#x91CD;&#x65B0;&#x89E3;&#x6790;value, &#x5F62;&#x5F0F;&#x5FC5;&#x987B;&#x4E3A;val1, val2
                    var valueArr = value.ToString().Split(new[] { &quot;,&quot; }, StringSplitOptions.RemoveEmptyEntries);
                    if (valueArr.Length != 2)
                    {
                        throw new Exception($&quot;{SysContant.Condition_Comparison} need 2 params!&quot;);
                    }

                    //&#x503C;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5E8F;
                    object val1 = null;
                    object val2 = null;
                    if (propertyUnderType == typeof(DateTime))
                    {
                        var dateTimeValArr = valueArr.Select(val =&gt; DateTime.Parse(val)).ToArray();
                        Array.Sort<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DateTime</span><span class="token punctuation">&gt;</span></span>(dateTimeValArr);
                        val1 = dateTimeValArr[0];
                        val2 = dateTimeValArr[1];
                    }
                    else
                    {
                        var decimalValArr = valueArr.Select(val =&gt; decimal.Parse(val)).ToArray();
                        Array.Sort<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decimal</span><span class="token punctuation">&gt;</span></span>(decimalValArr);
                        //&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x5BF9;&#x7C7B;&#x578B;&#x975E;&#x5E38;&#x654F;&#x611F;, &#x6E90;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#x662F;&#x4EC0;&#x4E48;, &#x5F85;&#x6BD4;&#x8F83;&#x7684;&#x503C;&#x5C31;&#x9700;&#x8981;&#x5F3A;&#x5236;&#x8F6C;&#x6210;&#x8BE5;&#x7C7B;&#x578B;
                        var realValArr = decimalValArr.Select(val =&gt; FramePublicFun.ConvertType(val.ToString(), propertyUnderType)).ToArray();

                        val1 = realValArr[0];
                        val2 = realValArr[1];
                    }

                    expression = Expression.AndAlso
                            (
                                Expression.GreaterThanOrEqual(proExp, Expression.Constant(val1, propertyUnderType)),
                                Expression.LessThanOrEqual(proExp, Expression.Constant(val2, propertyUnderType))
                            );
                }
                break;

            case &quot;in&quot;:
                {
                    value.ToString().Split(new[] { &quot;,&quot; }, StringSplitOptions.RemoveEmptyEntries)
                        .Select(val =&gt; FramePublicFun.ConvertType(val, propertyUnderType))
                        .ToList()
                        .ForEach(valObj =&gt;
                        {
                            if (expression == null)
                            {
                                expression =
                                    Expression.Equal
                                    (
                                        proExp,
                                        Expression.Constant(valObj, propertyUnderType)
                                    );
                            }
                            else
                            {
                                expression = Expression.OrElse
                                (
                                    expression,
                                    Expression.Equal
                                    (
                                        proExp,
                                        Expression.Constant(valObj, propertyUnderType)
                                    )
                                );
                            }
                        });

                    //&#x7528;&#x62EC;&#x53F7;&#x5305;&#x8D77;&#x6765;(&#x7ECF;&#x6D4B;&#x8BD5;, &#x7528;&#x4E0D;&#x7528;Block, &#x7ED3;&#x679C;&#x90FD;&#x6B63;&#x786E;)
                    expression = Expression.Block(expression);
                }
                break;

            case &quot;not in&quot;:
                {
                    value.ToString().Split(new[] { &quot;,&quot; }, StringSplitOptions.RemoveEmptyEntries)
                        .Select(val =&gt; FramePublicFun.ConvertType(val, propertyUnderType))
                        .ToList()
                        .ForEach(valObj =&gt;
                        {
                            if (expression == null)
                            {
                                expression =
                                    Expression.NotEqual
                                    (
                                        proExp,
                                        Expression.Constant(valObj, propertyUnderType)
                                    );
                            }
                            else
                            {
                                expression = Expression.AndAlso
                                (
                                    expression,
                                    Expression.NotEqual
                                    (
                                        proExp,
                                        Expression.Constant(valObj, propertyUnderType)
                                    )
                                );
                            }
                        });

                    //&#x7528;&#x62EC;&#x53F7;&#x5305;&#x8D77;&#x6765;(&#x7ECF;&#x6D4B;&#x8BD5;, &#x7528;&#x4E0D;&#x7528;Block, &#x7ED3;&#x679C;&#x90FD;&#x6B63;&#x786E;)
                    expression = Expression.Block(expression);
                }
                break;

            default:
                throw new ArgumentOutOfRangeException(nameof(comparison));
        }

        //&#x5408;&#x5E76;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;
        if (finalExpression == default)
        {
            finalExpression = expression;
        }
        else
        {
            if (relation == &quot;and&quot;)
            {
                finalExpression = Expression.AndAlso(finalExpression, expression);
            }
            else if (relation == &quot;or&quot;)
            {
                finalExpression = Expression.OrElse(finalExpression, expression);
            }
            else
            {
                throw new ArgumentOutOfRangeException(nameof(relation));
            }
        }

        return finalExpression;
    }

    #endregion

    //&#x5FAA;&#x73AF;&#x6784;&#x9020;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;
    Expression finalExpression = default;
    condictionJArray.Cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JObject</span><span class="token punctuation">&gt;</span></span>().ToList().ForEach(jObject =&gt;
    {
        finalExpression = CreateFilterInner<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(jObject, finalExpression);
    });

    var lambdaExp = Expression.Lambda&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt;(finalExpression, new[] { tParam });

    //&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4F1A;&#x8986;&#x76D6;&#x539F;&#x6765;queryable&#x7684;where, &#x4E0D;&#x5EFA;&#x8BAE;&#x7528;
    //&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;queryable.Where&#x62FC;&#x63A5;&#x6784;&#x9020;&#x597D;&#x7684;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;, &#x751F;&#x6210;&#x65B0;&#x7684;Queryable
    //var returnQueryable = queryable.Where(lambdaExp);


    //&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;, &#x4F1A;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#x4E0A;&#x518D;&#x52A0;&#x4E0A;&#x65B0;&#x7684;where&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;
    //CreateQuery&#x9700;&#x8981;&#x4F7F;&#x7528;Queryable.Where,Queryable.Select,Queryable.OrderBy&#x7B49;&#x8BF8;&#x5982;&#x6B64;&#x7C7B;&#x7684;&#x8868;&#x8FBE;&#x6811;&#x5BF9;&#x8C61;, &#x5426;&#x5219;&#x4F1A;&#x62A5;&#x9519;

    var whereExp = Expression.Call
    (
        typeof(Queryable),
        nameof(Queryable.Where),
        new[] { instType },
        new Expression[]
        {
            queryable.Expression,
            lambdaExp
            //lambdaExp&#x5199;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5199;, &#x4E0D;&#x77E5;&#x9053;Expression.Quote&#x6709;&#x4EC0;&#x4E48;&#x7528;
            //Expression.Quote(lambdaExp)
        }
    );
    var returnQueryable = queryable.Provider.CreateQuery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(whereExp);

    return returnQueryable;
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6784;&#x9020;Order By
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>T<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5B9E;&#x4F53;&#x7C7B;&#x578B;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryable<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>queryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orderbyJArry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
///[
///  {
///    &quot;Field&quot;: &quot;UserName&quot;,
///    &quot;Direction&quot;: &quot;asc/desc&quot;
///  }
///]
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// &#x652F;&#x6301;&#x591A;&#x5B57;&#x6BB5;&#x540C;&#x65F6;&#x6392;&#x5E8F;, &#x6309;&#x7167;orderbyJArry&#x987A;&#x5E8F;, &#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x6267;&#x884C;Queryable.OrderBy/Queryable.OrderByDescending, &#x540E;&#x7EED;&#x5B57;&#x6BB5;&#x6267;&#x884C;Queryable.ThenBy/Queryable.ThenByDescending.
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private static IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> CreateSort<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> queryable, JArray orderbyJArry)
{
    if (queryable == default)
    {
        return queryable;
    }

    orderbyJArry ??= new JArray();
    if (orderbyJArry.Count &lt;= 0)
    {
        return queryable;
    }

    #region CreateOrderByInner

    //&#x6784;&#x9020;&#x5355;&#x4E2A;sort
    IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> CreateSortInner(IQueryable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> queryable, JObject jObject, bool isFirst = false)
    {
        if (queryable == default)
        {
            return queryable;
        }

        jObject ??= new JObject();
        if (jObject.Count &lt;= 0)
        {
            return queryable;
        }

        var field = (jObject.GetVal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(SysContant.Condition_Field) ?? &quot;&quot;).TrimAll();
        if (string.IsNullOrEmpty(field))
        {
            throw new ArgumentNullException(nameof(field));
        }

        var direction = jObject.GetVal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(SysContant.Sort_Direction) ?? &quot;&quot;;
        direction = (string.IsNullOrEmpty(direction) ? &quot;asc&quot; : direction).TrimAll().ToLower();

        var instType = typeof(T);
        var tParam = Expression.Parameter(instType, &quot;t&quot;);

        //&#x6784;&#x9020;&#x53C2;&#x6570; t=&gt;t.Name
        var propertyInfo = instType.GetProperty(field);
        if (propertyInfo == default)
        {
            throw new ArgumentNullException(&quot;propertyInfo&quot;);
        }

        var proertyType = propertyInfo.PropertyType;

        //&#x83B7;&#x53D6;&#x5E95;&#x5C42;&#x7C7B;&#x578B;
        var propertyUnderType = proertyType.GetUnderType();

        //&#x6784;&#x9020;t.pro
        Expression proExp = Expression.Property(tParam, propertyInfo);

        //&#x82E5;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x578B;&#x4E0E;&#x5E95;&#x5C42;&#x7C7B;&#x578B;&#x4E0D;&#x4E00;&#x81F4;, &#x5219;&#x8BF4;&#x660E;&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#x4E3A;Nullable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>
        if (proertyType != propertyUnderType)
        {
            var getValueOrDefaultMethod = proertyType.GetMethod(&quot;GetValueOrDefault&quot;, new Type[] { });
            proExp = Expression.Call(proExp, getValueOrDefaultMethod, new Expression[] { });
        }

        //&#x6784;&#x9020;lamda&#x8868;&#x8FBE;&#x5F0F;
        var lambdaExp = Expression.Lambda(proExp, new[] { tParam });
        var methodName = &quot;&quot;;
        if (isFirst)
        {
            if (direction == SysContant.Sort_Direction_asc)
            {
                methodName = &quot;OrderBy&quot;;
            }
            else
            {
                methodName = &quot;OrderByDescending&quot;;
            }
        }
        else
        {
            if (direction == SysContant.Sort_Direction_asc)
            {
                methodName = &quot;ThenBy&quot;;
            }
            else
            {
                methodName = &quot;ThenByDescending&quot;;
            }
        }

        var orderbyExp = Expression.Call
            (
                typeof(Queryable),
                methodName,
                new Type[] { typeof(T), propertyUnderType },
                new Expression[]
                {
                    queryable.Expression,
                    lambdaExp
                }
            );

        var returnQueryable = queryable.Provider.CreateQuery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(orderbyExp);
        return returnQueryable;
    }

    #endregion

    var jObjectList = orderbyJArry.Cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JObject</span><span class="token punctuation">&gt;</span></span>().ToList();
    for (var i = 0; i &lt; jObjectList.Count; i++)
    {
        queryable = CreateSortInner(queryable, jObjectList[i], i == 0);
    }

    return queryable;
}
</code></pre>
<h3 id="18-5&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x62D3;&#x5C55;&#x65B9;&#x6CD5;"><a name="18-5&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x62D3;&#x5C55;&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#18-5&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x62D3;&#x5C55;&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>18-5&gt;&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x62D3;&#x5C55;&#x65B9;&#x6CD5;</h3>
<h4 id="18-5-1-&#x62D3;&#x5C55;&#x591A;&#x8868;&#x8FBE;&#x5F0F;&#x5408;&#x5E76;-todo-&#x8FD8;&#x6CA1;&#x770B;&#x61C2;"><a name="18-5-1-&#x62D3;&#x5C55;&#x591A;&#x8868;&#x8FBE;&#x5F0F;&#x5408;&#x5E76;-todo-&#x8FD8;&#x6CA1;&#x770B;&#x61C2;" class="anchor-navigation-ex-anchor" href="#18-5-1-&#x62D3;&#x5C55;&#x591A;&#x8868;&#x8FBE;&#x5F0F;&#x5408;&#x5E76;-todo-&#x8FD8;&#x6CA1;&#x770B;&#x61C2;"><i class="fa fa-link" aria-hidden="true"></i></a>18-5-1&gt; &#x62D3;&#x5C55;&#x591A;&#x8868;&#x8FBE;&#x5F0F;&#x5408;&#x5E76; (TODO &#x8FD8;&#x6CA1;&#x770B;&#x61C2;)</h4>
<pre class="language-"><code class="lang-C#">public static class LambdaExtension
{
    public static Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; True<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>() { return param =&gt; true; }
    public static Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; False<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>() { return param =&gt; false; }
    public static Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; And<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(this Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; first, Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; second)
    {
        return first.Compose(second, Expression.AndAlso);
    }
    public static Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; Or<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(this Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; first, Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; second)
    {
        return first.Compose(second, Expression.OrElse);
    }
    private static Expression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> Compose<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(this Expression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> first, Expression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> second, Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Expression,</span> <span class="token attr-name">Expression,</span> <span class="token attr-name">Expression</span><span class="token punctuation">&gt;</span></span> merge)
    {
        var map = first.Parameters
            .Select((f, i) =&gt; new { f, s = second.Parameters[i] })
            .ToDictionary(p =&gt; p.s, p =&gt; p.f);
        var secondBody = PFTParameterExtension.ReplaceParameters(map, second.Body);
        return Expression.Lambda<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(merge(first.Body, secondBody), first.Parameters);
    }

    private class PFTParameterExtension : ExpressionVisitor
    {
        private readonly Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ParameterExpression,</span> <span class="token attr-name">ParameterExpression</span><span class="token punctuation">&gt;</span></span> map;

        public PFTParameterExtension()
        {

        }

        public PFTParameterExtension(Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ParameterExpression,</span> <span class="token attr-name">ParameterExpression</span><span class="token punctuation">&gt;</span></span> map)
        {
            this.map = map ?? new Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ParameterExpression,</span> <span class="token attr-name">ParameterExpression</span><span class="token punctuation">&gt;</span></span>();
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x66FF;&#x6362;&#x53C2;&#x6570;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>The map.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>The exp.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span>Expression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public static Expression ReplaceParameters(Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ParameterExpression,</span> <span class="token attr-name">ParameterExpression</span><span class="token punctuation">&gt;</span></span> map, Expression exp)
        {
            return new PFTParameterExtension(map).Visit(exp);
        }

        protected override Expression VisitParameter(ParameterExpression p)
        {
            ParameterExpression replacement;
            if (map != null &amp;&amp; map.Count &gt; 0 &amp;&amp; map.TryGetValue(p, out replacement))
            {
                p = replacement;
            }
            return base.VisitParameter(p);
        }

    }

}
</code></pre>
<h4 id="18-5-2&#x901A;&#x8FC7;expression&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#xFF0C;&#x4E3A;ef-core&#x627E;&#x56DE;addorupdate&#x65B9;&#x6CD5;"><a name="18-5-2&#x901A;&#x8FC7;expression&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#xFF0C;&#x4E3A;ef-core&#x627E;&#x56DE;addorupdate&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#18-5-2&#x901A;&#x8FC7;expression&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#xFF0C;&#x4E3A;ef-core&#x627E;&#x56DE;addorupdate&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>18-5-2&gt;<a href="https://masuit.com/1741" target="_blank">&#x901A;&#x8FC7;Expression&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#xFF0C;&#x4E3A;EF Core&#x627E;&#x56DE;AddOrUpdate&#x65B9;&#x6CD5;</a></h4>
<hr>
<h2 id="19mapster"><a name="19mapster" class="anchor-navigation-ex-anchor" href="#19mapster"><i class="fa fa-link" aria-hidden="true"></i></a>19&gt;Mapster</h2>
<p><a href="https://github.com/rivenfx/Mapster-docs" target="_blank">Mapster-docs (github&#x6587;&#x6863;)</a></p>
<p><a href="https://www.cnblogs.com/fanfan-90/p/12164927.html" target="_blank">Mapster (C# &#x5BF9;&#x8C61;&#x6620;&#x5C04;&#x5668;) </a></p>
<h3 id="19-1&#x62D3;&#x5C55;&#x63D2;&#x4EF6;"><a name="19-1&#x62D3;&#x5C55;&#x63D2;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#19-1&#x62D3;&#x5C55;&#x63D2;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>19-1&gt;&#x62D3;&#x5C55;&#x63D2;&#x4EF6;</h3>
<p><a href="https://github.com/rivenfx/Mapster-docs/blob/master/cn/Async.md" target="_blank">Mapster.Async</a>: &#x5F02;&#x6B65;&#x652F;&#x6301;</p>
<p><a href="https://github.com/rivenfx/Mapster-docs/blob/master/cn/EF-6-&amp;-EF-Core.md" target="_blank">Mapster.EFCore</a>: EF Core&#x652F;&#x6301;</p>
<p><a href="https://github.com/rivenfx/Mapster-docs/blob/master/cn/Dependency-Injection.md" target="_blank">Mapster.DependencyInjection</a>: &#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x652F;&#x6301;</p>
<h3 id="19-2&#x57FA;&#x672C;&#x7528;&#x6CD5;"><a name="19-2&#x57FA;&#x672C;&#x7528;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#19-2&#x57FA;&#x672C;&#x7528;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>19-2&gt;&#x57FA;&#x672C;&#x7528;&#x6CD5;</h3>
<pre class="language-"><code class="lang-C#">//1&gt;&#x76F4;&#x63A5;&#x6620;&#x5C04;, &#x4F7F;&#x7528;&#x7684;&#x5168;&#x5C40;&#x914D;&#x7F6E;TypeAdapterConfig.GlobalSettings
//&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x65E0;&#x9700;&#x4EFB;&#x4F55;&#x914D;&#x7F6E;&#xFF0C;Mapster&#x4F1A;&#x6839;&#x636E;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;&#x5B57;&#x6BB5;&#x540D;&#x79F0;&#x76F8;&#x540C;&#x8FDB;&#x884C;&#x5339;&#x914D;&#x3002;
var userDTO = user.Adapt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserDTO</span><span class="token punctuation">&gt;</span></span>();

//2&gt;&#x901A;&#x8FC7;&#x5DF2;&#x5B58;&#x5728;&#x7684;dto&#x5BF9;&#x8C61;&#x6620;&#x5C04;
UserDTO userDTO = new() { UserSex = &quot;Male&quot; };
userDTO = user.Adapt(userDTO);
</code></pre>
<h3 id="19-3&#x914D;&#x7F6E;"><a name="19-3&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#19-3&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>19-3&gt;&#x914D;&#x7F6E;</h3>
<h4 id="19-3-1&#x5168;&#x90E8;&#x914D;&#x7F6E;-typeadapterconfigglobalsettings-&#x4F5C;&#x7528;&#x4E8E;adapt&#x65B9;&#x6CD5;-&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#x4EE5;&#x53CA;&#x516C;&#x5171;&#x7684;&#x5C5E;&#x6027;&#x6620;&#x5C04;"><a name="19-3-1&#x5168;&#x90E8;&#x914D;&#x7F6E;-typeadapterconfigglobalsettings-&#x4F5C;&#x7528;&#x4E8E;adapt&#x65B9;&#x6CD5;-&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#x4EE5;&#x53CA;&#x516C;&#x5171;&#x7684;&#x5C5E;&#x6027;&#x6620;&#x5C04;" class="anchor-navigation-ex-anchor" href="#19-3-1&#x5168;&#x90E8;&#x914D;&#x7F6E;-typeadapterconfigglobalsettings-&#x4F5C;&#x7528;&#x4E8E;adapt&#x65B9;&#x6CD5;-&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#x4EE5;&#x53CA;&#x516C;&#x5171;&#x7684;&#x5C5E;&#x6027;&#x6620;&#x5C04;"><i class="fa fa-link" aria-hidden="true"></i></a>19-3-1&gt;<code>&#x5168;&#x90E8;&#x914D;&#x7F6E;-TypeAdapterConfig.GlobalSettings, &#x4F5C;&#x7528;&#x4E8E;Adapt&#x65B9;&#x6CD5;, &#x4E00;&#x822C;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#x4EE5;&#x53CA;&#x516C;&#x5171;&#x7684;&#x5C5E;&#x6027;&#x6620;&#x5C04;.</code></h4>
<p><code>NewConfig</code>: &#x5C06;&#x4F1A;&#x8986;&#x76D6;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x7C7B;&#x578B;&#x6620;&#x5C04;&#x914D;&#x7F6E;</p>
<p><code>ForType</code>: &#x5982;&#x679C;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x5B83;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x5DF2;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x4F1A;&#x6269;&#x5C55;&#x5DF2;&#x6709;&#x7684;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5220;&#x9664;&#x6216;&#x66FF;&#x6362;&#x5DF2;&#x6709;&#x7684;&#x6620;&#x5C04;&#x914D;&#x7F6E;</p>
<pre class="language-"><code class="lang-C#">TypeAdapterConfig.GlobalSettings
    .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User,</span> <span class="token attr-name">UserDTO</span><span class="token punctuation">&gt;</span></span>()
    //.NewConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User,</span> <span class="token attr-name">UserDTO</span><span class="token punctuation">&gt;</span></span>()
    .NameMatchingStrategy(NameMatchingStrategy.IgnoreCase) //&#x5FFD;&#x7565;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x7684;&#x5927;&#x5C0F;&#x5199;
    .IgnoreNullValues(true) //&#x5982;&#x679C;&#x662F;&#x5C5E;&#x6027;&#x662F;&#x7A7A;&#x503C;&#x5C31;&#x6392;&#x9664;&#x5C5E;&#x6027;&#x6620;&#x5C04;
    .Map(t =&gt; t.UserAge, t =&gt; t.Age, t =&gt; t.Age &lt; 50) //Age&lt;50&#x624D;&#x6620;&#x5C04;
    .Map(t =&gt; t.UserSex, t =&gt; t.Sex) //&#x5C5E;&#x6027;&#x6620;&#x5C04;
    .Ignore(t=&gt;t.UserAge, t=&gt;t.like) //&#x5FFD;&#x7565;&#x5C5E;&#x6027;
                                     //.IgnoreIf((src, desc) =&gt; src.Age == 18, desc =&gt; desc.Age)//&#x5982;&#x679C;&#x5E74;&#x9F84;&#x7B49;&#x4E8E;18&#x5C81;&#x5C31;&#x6392;&#x9664;Age&#x5C5E;&#x6027;&#x6620;&#x5C04;
                                     //.IgnoreIf((src, desc) =&gt; src.Age == 18, &quot;Name&quot;, &quot;Age&quot;);//&#x5982;&#x679C;&#x5E74;&#x9F84;&#x7B49;&#x4E8E;18&#x5C81;&#x5C31;&#x6392;&#x9664;Name&#x3001;Age&#x5C5E;&#x6027;&#x6620;&#x5C04;
                                     //.IgnoreAttribute(typeof(ExcludeAttribute));//&#x6392;&#x9664;&#x6807;&#x8BB0;&#x4E86;ExcludeAttribute&#x7684;&#x5C5E;&#x6027;&#x6620;&#x5C04;
                                     //.IgnoreNonMapped(true);//&#x53EA;&#x6620;&#x5C04;Map&#x6307;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x90FD;&#x6392;&#x9664;
    .BeforeMapping(async (source, dest) =&gt;
    {
        await Console.Out.WriteLineAsync(&quot;BeforeMapping&quot;);
        await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(source));
        await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(dest));
    }) //&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;
    .AfterMapping(async (source, dest) =&gt;
    {
        await Console.Out.WriteLineAsync(&quot;AfterMapping&quot;);
        await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(source));
        await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(dest));
    }); //&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;

var userDTO = user.Adapt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserDTO</span><span class="token punctuation">&gt;</span></span>();
</code></pre>
<h4 id="19-3-2&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x7EE7;&#x627F;"><a name="19-3-2&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x7EE7;&#x627F;" class="anchor-navigation-ex-anchor" href="#19-3-2&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x7EE7;&#x627F;"><i class="fa fa-link" aria-hidden="true"></i></a>19-3-2&gt;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x7EE7;&#x627F;</h4>
<pre class="language-"><code class="lang-C#">TypeAdapterConfig.GlobalSettings.AllowImplicitSourceInheritance = false; //Mapster &#x9ED8;&#x8BA4;&#x4F1A;&#x628A; &#x6E90;&#x7C7B;&#x578B;&#x7684; &#x6620;&#x5C04;&#x914D;&#x7F6E; &#x5E94;&#x7528;&#x5230; &#x6E90;&#x7C7B;&#x578B;&#x7684;&#x5B50;&#x7C7B;&#x3002;
TypeAdapterConfig.GlobalSettings.AllowImplicitDestinationInheritance = true; //Mapster &#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x628A; &#x76EE;&#x6807;&#x7C7B;&#x578B;&#x7684; &#x6620;&#x5C04;&#x914D;&#x7F6E; &#x5E94;&#x7528;&#x5230; &#x76EE;&#x6807;&#x7C7B;&#x578B;&#x7684;&#x5B50;&#x7C7B;&#x3002;

//&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x663E;&#x793A;&#x7EE7;&#x627F;
//&#x5B50;&#x7C7B;&#x7EE7;&#x627F;&#x7236;&#x7C7B;&#x914D;&#x7F6E;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DerivedPoco,</span> <span class="token attr-name">DerivedDto</span><span class="token punctuation">&gt;</span></span>
    .NewConfig()
    .Inherits<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SimplePoco,</span> <span class="token attr-name">SimpleDto</span><span class="token punctuation">&gt;</span></span>();

//&#x7236;&#x7C7B;&#x4E0B;&#x53D1;&#x914D;&#x7F6E;&#x5230;&#x5B50;&#x7C7B;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Vehicle,</span> <span class="token attr-name">VehicleDto</span><span class="token punctuation">&gt;</span></span>
    .NewConfig()
    .Include<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car,</span> <span class="token attr-name">CarDto</span><span class="token punctuation">&gt;</span></span>();
</code></pre>
<h4 id="19-3-3&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;"><a name="19-3-3&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#19-3-3&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>19-3-3&gt;&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;</h4>
<pre class="language-"><code class="lang-C#">//1&gt;&#x76F4;&#x63A5;new&#x4E00;&#x4E2A;TypeAdapterConfig&#x5B9E;&#x4F8B;
var typeAdapterConfig = new TypeAdapterConfig();
typeAdapterConfig.Default
   .NameMatchingStrategy(NameMatchingStrategy.IgnoreCase) //&#x5FFD;&#x7565;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x7684;&#x5927;&#x5C0F;&#x5199;
   .IgnoreNullValues(true) //&#x5982;&#x679C;&#x662F;&#x5C5E;&#x6027;&#x662F;&#x7A7A;&#x503C;&#x5C31;&#x6392;&#x9664;&#x5C5E;&#x6027;&#x6620;&#x5C04;
   .EnumMappingStrategy(EnumMappingStrategy.ByValue) //&#x679A;&#x4E3E;&#x5C5E;&#x6027;&#x6620;&#x5C04;&#x7B56;&#x7565;
   .PreserveReference(true);

//2&gt;&#x4ECE;&#x5168;&#x5C40;TypeAdapterConfig&#x6DF1;&#x5EA6;&#x8D4B;&#x503C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;
var typeAdapterConfig = TypeAdapterConfig.GlobalSettings.Clone();
typeAdapterConfig
    .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User,</span> <span class="token attr-name">UserDTO</span><span class="token punctuation">&gt;</span></span>()
    .Map(t =&gt; t.UserSex, t =&gt; t.Sex)
    .Map(t =&gt; t.UserAge, t =&gt; t.Age);

//3&gt;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x7B49;&#x540C;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;
var typeAdapterConfig =
    TypeAdapterConfig.GlobalSettings.Fork(config =&gt;
    {
        config
            .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User,</span> <span class="token attr-name">UserDTO</span><span class="token punctuation">&gt;</span></span>()
            .Map(t =&gt; t.UserSex, t =&gt; t.Sex)
            .Map(t =&gt; t.UserAge, t =&gt; t.Age);
    });

//&#x975E;&#x5E38;&#x91CD;&#x8981;: 2&gt;&#x548C;3&gt;&#x90FD;&#x662F;&#x6DF1;&#x5EA6;&#x590D;&#x5236;, &#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x539F;&#x6709;&#x7684;&#x914D;&#x7F6E;, &#x53EA;&#x5BF9;&#x5F53;&#x524D;&#x4F5C;&#x7528;&#x57DF;&#x6709;&#x6548;
</code></pre>
<h3 id="19-4&#x6620;&#x5C04;&#x5668;mapper"><a name="19-4&#x6620;&#x5C04;&#x5668;mapper" class="anchor-navigation-ex-anchor" href="#19-4&#x6620;&#x5C04;&#x5668;mapper"><i class="fa fa-link" aria-hidden="true"></i></a>19-4&gt;&#x6620;&#x5C04;&#x5668;(Mapper)</h3>
<pre class="language-"><code class="lang-C#">IMapper mapper = new Mapper();
var result = mapper.Map<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TDestination</span><span class="token punctuation">&gt;</span></span>(source); //&#x5F88;&#x591A;&#x91CD;&#x6784;, &#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x9700;&#x8981;&#x7684;
</code></pre>
<h3 id="19-5&#x6784;&#x5EFA;&#x5668;builder---&#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;"><a name="19-5&#x6784;&#x5EFA;&#x5668;builder---&#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;" class="anchor-navigation-ex-anchor" href="#19-5&#x6784;&#x5EFA;&#x5668;builder---&#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;"><i class="fa fa-link" aria-hidden="true"></i></a>19-5&gt;&#x6784;&#x5EFA;&#x5668;(Builder) - &#x57FA;&#x672C;&#x7528;&#x4E0D;&#x5230;</h3>
<pre class="language-"><code class="lang-C#">var dto = poco.BuildAdapter()
              .AddParameters(&quot;user&quot;, this.User.Identity.Name)
              .AdaptToType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SimpleDto</span><span class="token punctuation">&gt;</span></span>();

var dto = mapper.From(poco)
                .AddParameters(&quot;user&quot;, this.User.Identity.Name)
                .AdaptToType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SimpleDto</span><span class="token punctuation">&gt;</span></span>();
</code></pre>
<h3 id="19-6scan-apply"><a name="19-6scan-apply" class="anchor-navigation-ex-anchor" href="#19-6scan-apply"><i class="fa fa-link" aria-hidden="true"></i></a>19-6&gt;Scan, Apply</h3>
<p><code>&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x5E94;&#x8BE5;&#x53EA;&#x521D;&#x59CB;&#x5316;&#x5E76;&#x4E14;&#x53EA;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x914D;&#x7F6E;, &#x6240;&#x4EE5;, &#x5728;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x65F6;&#x5E94;&#x8BE5;&#x5C06;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x548C;&#x6620;&#x5C04;&#x8C03;&#x7528;&#x5206;&#x5F00;, &#x5C06;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x653E;&#x5230;&#x7A0B;&#x5E8F;&#x7684;&#x5165;&#x53E3;(Main, StartUp).</code></p>
<pre class="language-"><code class="lang-C#">public class MyRegister : IRegister
{
    public void Register(TypeAdapterConfig config)
    {
        config.NewConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>();

        //OR to create or enhance an existing configuration
        config.ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>();
    }
}

//1&gt;&#x81EA;&#x52A8;&#x626B;&#x63CF;&#x7A0B;&#x5E8F;&#x96C6;&#x4E2D;&#x7EE7;&#x627F;&#x4E86;IRegister&#x63A5;&#x53E3;&#x7684;&#x7C7B;, &#x5E76;&#x5C06;&#x6CE8;&#x5165;&#x7C7B;&#x4E2D;&#x7684;&#x914D;&#x7F6E;
TypeAdapterConfig.GlobalSettings.Scan(assembly1, assembly2, assemblyN)
</code></pre>
<pre class="language-"><code class="lang-C#">2&gt;&#x5C06;&#x83B7;&#x53D6;&#x5230;&#x7684;IRegister&#x5BF9;&#x8C61;&#x6CE8;&#x5165;&#x5230;&#x914D;&#x7F6E;
var registers = container.GetExports<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IRegister</span><span class="token punctuation">&gt;</span></span>();
config.Apply(registers);
</code></pre>
<h3 id="19-7compile&#x914D;&#x7F6E;&#x7F16;&#x8BD1;"><a name="19-7compile&#x914D;&#x7F6E;&#x7F16;&#x8BD1;" class="anchor-navigation-ex-anchor" href="#19-7compile&#x914D;&#x7F6E;&#x7F16;&#x8BD1;"><i class="fa fa-link" aria-hidden="true"></i></a>19-7&gt;Compile(&#x914D;&#x7F6E;&#x7F16;&#x8BD1;)</h3>
<p><code>Mapster&#x5C06;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x6620;&#x5C04;&#x65F6;&#x81EA;&#x52A8;&#x7F16;&#x8BD1;TypeAdapterConfig, &#x63A8;&#x8350;&#x5728;&#x7A0B;&#x5E8F;&#x6DFB;&#x52A0;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x540E;&#x8C03;&#x7528;&#x4E00;&#x6B21; Compile&#x65B9;&#x6CD5;, &#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x9A8C;&#x8BC1;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x9519;&#x8BEF;.</code></p>
<p><code>&#x8C03;&#x7528; Compile &#x65B9;&#x6CD5;&#x524D;&#x5E94;&#x8BE5;&#x5B8C;&#x6210;&#x6240;&#x6709;&#x7684;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#xFF0C;&#x8C03;&#x7528; Compile &#x65B9;&#x6CD5;&#x4E4B;&#x540E;&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;&#x5C31;&#x4E0D;&#x5141;&#x8BB8;&#x6DFB;&#x52A0;/&#x4FEE;&#x6539;&#x5176;&#x5B83;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#xFF01;</code></p>
<h3 id="19-8&#x5C5E;&#x6027;&#x6210;&#x5458;&#x6620;&#x5C04;&#x4F8B;&#x5B50;"><a name="19-8&#x5C5E;&#x6027;&#x6210;&#x5458;&#x6620;&#x5C04;&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#19-8&#x5C5E;&#x6027;&#x6210;&#x5458;&#x6620;&#x5C04;&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>19-8&gt;&#x5C5E;&#x6027;&#x6210;&#x5458;&#x6620;&#x5C04;&#x4F8B;&#x5B50;</h3>
<pre class="language-"><code class="lang-C#">TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>
    .NewConfig()
    .Map(dest =&gt; dest.FullName,
        src =&gt; string.Format(&quot;{0} {1}&quot;, src.FirstName, src.LastName));

TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>
    .NewConfig()
    .Map(dest =&gt; dest.Gender,      // dest.Gender&#xFF1A; Genders.Male &#x6216; Genders.Female &#x679A;&#x4E3E;&#x7C7B;&#x578B;
        src =&gt; src.GenderString); // src.GenderString&#xFF1A; &quot;Male&quot; &#x6216; &quot;Female&quot; &#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;

TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>
    .NewConfig()
    .Map(dest =&gt; dest.FullName, src =&gt; &quot;Sig. &quot; + src.FullName, srcCond =&gt; srcCond.Country == &quot;Italy&quot;)
    .Map(dest =&gt; dest.FullName, src =&gt; &quot;Sr. &quot; + src.FullName, srcCond =&gt; srcCond.Country == &quot;Spain&quot;)
    .Map(dest =&gt; dest.FullName, src =&gt; &quot;Mr. &quot; + src.FullName);

//&#x975E;&#x5E38;&#x91CD;&#x8981;: &#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x914D;&#x7F6E;, &#x8FD9;&#x91CC;&#x4F1A;&#x53D7;&#x5230;TwoWays&#x7684;&#x5F71;&#x54CD;, &#x5BFC;&#x81F4;&#x903B;&#x8F91;&#x6267;&#x884C;2&#x6B21;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>.NewConfig()
        .AddDestinationTransform((string x) =&gt; x.Trim());

//&#x6620;&#x5C04;&#x79C1;&#x6709;&#x6210;&#x5458;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TSource,</span> <span class="token attr-name">TDestination</span><span class="token punctuation">&gt;</span></span>
    .NewConfig()
    .Map(&quot;PrivateDestName&quot;, &quot;PrivateSrcName&quot;);

//&#x76EE;&#x6807;&#x591A;&#x7EA7;&#x5C5E;&#x6027;&#x6620;&#x5C04;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Poco,</span> <span class="token attr-name">Dto</span><span class="token punctuation">&gt;</span></span>.NewConfig()
    .Map(dest =&gt; dest.Child.Name, src =&gt; src.Name);

//&#x6620;&#x5C04;&#x4E24;&#x4E2A;&#x7C7B;&#x578B;&#x5230;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>(Dto1,</span> <span class="token attr-name">Dto2),</span> <span class="token attr-name">Poco</span><span class="token punctuation">&gt;</span></span>.NewConfig()
    .Map(dest =&gt; dest, src =&gt; src.Item1)
    .Map(dest =&gt; dest, src =&gt; src.Item2);

//&#x6620;&#x5C04;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x5230;&#x4E24;&#x4E2A;&#x7C7B;&#x578B;
//https://github.com/rivenfx/Mapster-docs/blob/master/cn/Custom-mapping.md
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dto,</span> <span class="token attr-name">Poco</span><span class="token punctuation">&gt;</span></span>.NewConfig()
    .Map(poco =&gt; poco, dto =&gt; dto.SubDto);
</code></pre>
<h3 id="19-9&#x5C5E;&#x6027;&#x547D;&#x540D;&#x7EA6;&#x5B9A;"><a name="19-9&#x5C5E;&#x6027;&#x547D;&#x540D;&#x7EA6;&#x5B9A;" class="anchor-navigation-ex-anchor" href="#19-9&#x5C5E;&#x6027;&#x547D;&#x540D;&#x7EA6;&#x5B9A;"><i class="fa fa-link" aria-hidden="true"></i></a>19-9&gt;&#x5C5E;&#x6027;&#x547D;&#x540D;&#x7EA6;&#x5B9A;</h3>
<pre class="language-"><code class="lang-C#">//1&gt;&#x8BBE;&#x7F6E;&#x6E90;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Poco,</span> <span class="token attr-name">Dto</span><span class="token punctuation">&gt;</span></span>.NewConfig()
   .NameMatchingStrategy(NameMatchingStrategy.ConvertSourceMemberName(name =&gt; &quot;m_&quot; + name));
//2&gt;&#x8BBE;&#x7F6E;&#x76EE;&#x6807;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;
TypeAdapterConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Poco,</span> <span class="token attr-name">Dto</span><span class="token punctuation">&gt;</span></span>.NewConfig()
   .NameMatchingStrategy(NameMatchingStrategy.ConvertDestinationMemberName(name =&gt; name.Replace(&quot;m_&quot;, &quot;&quot;)));
</code></pre>
<h3 id="19-10&#x6620;&#x5C04;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;"><a name="19-10&#x6620;&#x5C04;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;" class="anchor-navigation-ex-anchor" href="#19-10&#x6620;&#x5C04;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;"><i class="fa fa-link" aria-hidden="true"></i></a>19-10&gt;&#x6620;&#x5C04;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;</h3>
<p>&#x5982;&#x679C;&#x9700;&#x8981; &#x6E90;&#x5230;&#x76EE;&#x6807; &#x548C; &#x76EE;&#x6807;&#x5230;&#x6E90; &#x53EA;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x914D;&#x7F6E;, &#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>ToWays</code> &#x65B9;&#x6CD5;&#x3002;</p>
<p><code>TwoWays</code>&#x65B9;&#x6CD5;&#x5FC5;&#x987B;&#x5728;&#x914D;&#x7F6E;&#x6620;&#x5C04;&#x4E4B;&#x524D;&#x8FDB;&#x884C;&#x8C03;&#x7528;, &#x5426;&#x5219;&#x5728;&#x8C03;&#x7528;<code>TwoWays</code>&#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#x7684;&#x914D;&#x7F6E;&#x4E3A;&#x5355;&#x5411;&#x6620;&#x5C04;&#x914D;&#x7F6E;, &#x4E4B;&#x540E;&#x7684;&#x914D;&#x7F6E;&#x4E3A;&#x53CC;&#x5411;&#x6620;&#x5C04;&#x914D;&#x7F6E;.</p>
<h3 id="19-11&#x6784;&#x9020;&#x51FD;&#x6570;&#x6620;&#x5C04;"><a name="19-11&#x6784;&#x9020;&#x51FD;&#x6570;&#x6620;&#x5C04;" class="anchor-navigation-ex-anchor" href="#19-11&#x6784;&#x9020;&#x51FD;&#x6570;&#x6620;&#x5C04;"><i class="fa fa-link" aria-hidden="true"></i></a>19-11&gt;<a href="https://github.com/dylan880507/Mapster-docs/blob/patch-1/cn/Constructor-mapping.md" target="_blank">&#x6784;&#x9020;&#x51FD;&#x6570;&#x6620;&#x5C04;</a></h3>
<h3 id="19-12&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;"><a name="19-12&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#19-12&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>19-12&gt;&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;&amp;&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;</h3>
<pre class="language-"><code class="lang-C#">.BeforeMapping(async (source, dest) =&gt;
{
    await Console.Out.WriteLineAsync(&quot;BeforeMapping&quot;);
    await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(source));
    await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(dest));
}) //&#x6620;&#x5C04;&#x524D;&#x5904;&#x7406;
.AfterMapping(async (source, dest) =&gt;
{
    await Console.Out.WriteLineAsync(&quot;AfterMapping&quot;);
    await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(source));
    await Console.Out.WriteLineAsync(FrameWork.Json.NewtonsoftSerializer.SerializeObject(dest));
}) //&#x6620;&#x5C04;&#x540E;&#x5904;&#x7406;
.PreserveReference(true); //&#x5141;&#x8BB8;&#x6620;&#x5C04;&#x5FAA;&#x73AF;&#x5F15;&#x7528;
</code></pre>
<h3 id="19-13&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;"><a name="19-13&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;" class="anchor-navigation-ex-anchor" href="#19-13&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;"><i class="fa fa-link" aria-hidden="true"></i></a>19-13&gt;<a href="https://github.com/dylan880507/Mapster-docs/blob/patch-1/cn/Custom-conversion-logic.md" target="_blank">&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;</a></h3>
<pre class="language-"><code class="lang-C#">var typeAdapterConfig =
    TypeAdapterConfig.GlobalSettings.Fork(config =&gt;
    {
        config
            .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User,</span> <span class="token attr-name">UserDTO</span><span class="token punctuation">&gt;</span></span>()
            .TwoWays()
            .Map(t =&gt; t.UserSex, t =&gt; t.Sex)
            .Map(t =&gt; t.UserAge, t =&gt; t.Age);

        config
            .ForType&lt;Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span>, JObject&gt;()
            .MapWith(dic =&gt; dic.Dic2JObject(), applySettings: true);
    });
</code></pre>
<h3 id="19-14&#x5F02;&#x6B65;&#x652F;&#x6301;"><a name="19-14&#x5F02;&#x6B65;&#x652F;&#x6301;" class="anchor-navigation-ex-anchor" href="#19-14&#x5F02;&#x6B65;&#x652F;&#x6301;"><i class="fa fa-link" aria-hidden="true"></i></a>19-14&gt;&#x5F02;&#x6B65;&#x652F;&#x6301;</h3>
<pre class="language-"><code class="lang-C#">//Mapster.Async
config.NewConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Poco,</span> <span class="token attr-name">Dto</span><span class="token punctuation">&gt;</span></span>()
    .AfterMappingAsync(async (poco, dto) =&gt;
    {
        var userManager = MapContext.Current.GetService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserManager</span><span class="token punctuation">&gt;</span></span>();
        var user = await userManager.FindByIdAsync(poco.UserId);
        dto.UserName = user.Name;
    });

var dto = await poco.BuildAdapter()
    .AdaptToTypeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dto</span><span class="token punctuation">&gt;</span></span>();

var dto = await _mapper.From(poco)
    .AdaptToTypeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dto</span><span class="token punctuation">&gt;</span></span>();
</code></pre>
<h3 id="19-15&#x4E0E;ef-core&#x96C6;&#x6210;"><a name="19-15&#x4E0E;ef-core&#x96C6;&#x6210;" class="anchor-navigation-ex-anchor" href="#19-15&#x4E0E;ef-core&#x96C6;&#x6210;"><i class="fa fa-link" aria-hidden="true"></i></a>19-15&gt;&#x4E0E;EF Core&#x96C6;&#x6210;</h3>
<pre class="language-"><code class="lang-C#">//Mapster.EFCore
var destinations = context.Sources.ProjectToType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Destination</span><span class="token punctuation">&gt;</span></span>().ToList();

var query = myDbContext.Customers.Where(...);
_mapper.From(query)
    .ProjectToType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dto</span><span class="token punctuation">&gt;</span></span>();
</code></pre>
<h3 id="19-16&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a name="19-16&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="anchor-navigation-ex-anchor" href="#19-16&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>19-16&gt;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h3>
<p>*<code>Mapster&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x63A5;&#x53E3;, &#x62BD;&#x8C61;&#x7C7B;!</code></p>
<h3 id="19-17&#x5C01;&#x88C5;"><a name="19-17&#x5C01;&#x88C5;" class="anchor-navigation-ex-anchor" href="#19-17&#x5C01;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>19-17&gt;&#x5C01;&#x88C5;</h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x914D;&#x7F6E; POCO<span class="token cdata">&lt;![CDATA[&lt;=&gt;]]&gt;</span>DTO
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>&#x4F7F;&#x7528;Mapster&#x5B9E;&#x73B0;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>serviceCollection<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x670D;&#x52A1;&#x96C6;&#x5408;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public static IServiceCollection AddTypeAdapterConfig(this IServiceCollection serviceCollection) 
{
    if (serviceCollection == default)
    {
        throw new ArgumentNullException(nameof(serviceCollection));
    }

    //1&gt;&#x8BBE;&#x7F6E;&#x5168;&#x5C40;&#x914D;&#x7F6E;
    TypeAdapterConfig.GlobalSettings.AllowImplicitSourceInheritance = true; //&#x5141;&#x8BB8;&#x539F;&#x7C7B;&#x578B;&#x5B50;&#x7C7B;&#x4F7F;&#x7528;&#x7236;&#x7C7B;&#x6620;&#x5C04;&#x914D;&#x7F6E;
    TypeAdapterConfig.GlobalSettings.AllowImplicitDestinationInheritance = true; //&#x5141;&#x8BB8;&#x76EE;&#x6807;&#x7C7B;&#x578B;&#x5B50;&#x7C7B;&#x4F7F;&#x7528;&#x7236;&#x7C7B;&#x6620;&#x5C04;&#x914D;&#x7F6E;

    //&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x6620;&#x5C04;
    TypeAdapterConfig.GlobalSettings
        .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BaseLogicEntity,BaseLogicEntityDTO</span><span class="token punctuation">&gt;</span></span>()
        .TwoWays()
        .NameMatchingStrategy(NameMatchingStrategy.IgnoreCase) //&#x5FFD;&#x7565;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x7684;&#x5927;&#x5C0F;&#x5199;
        .IgnoreNullValues(true) //&#x5982;&#x679C;&#x662F;&#x5C5E;&#x6027;&#x662F;&#x7A7A;&#x503C;&#x5C31;&#x6392;&#x9664;&#x5C5E;&#x6027;&#x6620;&#x5C04;
        .EnumMappingStrategy(EnumMappingStrategy.ByValue) //&#x679A;&#x4E3E;&#x5C5E;&#x6027;&#x6620;&#x5C04;&#x7B56;&#x7565;
        .AddDestinationTransform(DestinationTransform.EmptyCollectionIfNull) //&#x82E5;&#x96C6;&#x5408;&#x4E3A;null&#x5219;&#x8FD4;&#x56DE;&#x7A7A;&#x96C6;&#x5408;
        .PreserveReference(true); //&#x5141;&#x8BB8;&#x6620;&#x5C04;&#x5FAA;&#x73AF;&#x5F15;&#x7528;

    //2&gt;&#x914D;&#x7F6E;&#x5E38;&#x7528;&#x7684;&#x989D;&#x5916;&#x7C7B;&#x578B;
    TypeAdapterConfig.GlobalSettings
        .ForType&lt;Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span>, JObject&gt;()
        .MapWith(dic =&gt; dic.Dic2JObject());

    TypeAdapterConfig.GlobalSettings
        .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JObject,</span> <span class="token attr-name">Dictionary&lt;string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span>&gt;()
        .MapWith(jObject =&gt; jObject.JObject2Dic());

    //TODO &#x540E;&#x7EED;&#x6709;&#x522B;&#x7684;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x6620;&#x5C04;&#x5728;&#x8FD9;&#x91CC;&#x6DFB;&#x52A0;

    //3&gt;&#x626B;&#x63CF;&#x7A0B;&#x5E8F;&#x96C6;&#x5E76;&#x6CE8;&#x5165;&#x914D;&#x7F6E;(&#x5B9A;&#x4F4D;&#x7A0B;&#x5E8F;&#x96C6;&#x4E2D;&#x7EE7;&#x627F;&#x4E86;IRegister&#x7684;&#x914D;&#x7F6E;)
    TypeAdapterConfig.GlobalSettings.Scan(FramePublicFun.GetAssemblies(EnumDllType.Project).ToArray());

    //4&gt;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x76F4;&#x63A5;&#x7F16;&#x8BD1;&#x914D;&#x7F6E;, &#x7F16;&#x8BD1;&#x540E;, &#x5168;&#x5C40;&#x914D;&#x7F6E;&#x5C06;&#x65E0;&#x6CD5;&#x518D;&#x4FEE;&#x6539;&#x914D;&#x7F6E;
    TypeAdapterConfig.GlobalSettings.Compile();

    return serviceCollection;
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// Register
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>config<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
public void Register(TypeAdapterConfig config)
{
    config
        .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car,</span> <span class="token attr-name">CarDetailDTO</span><span class="token punctuation">&gt;</span></span>()
        .TwoWays()
        .Map(t =&gt; t.money, t =&gt; t.Price);
}
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x82E5;&#x6709;&#x65B0;&#x7684;&#x914D;&#x7F6E;, &#x53EF;&#x4EE5;&#x4F7F;&#x7528;fork
var typeAdapterConfig = TypeAdapterConfig.GlobalSettings.Fork(config =&gt;
{
    config
    .ForType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CarDetailDTO,</span> <span class="token attr-name">Car</span><span class="token punctuation">&gt;</span></span>()
    //.Map(t =&gt; t.Price, t =&gt; t.money / 100)
    .Map(t =&gt; t.MSN, t =&gt; t.msn + &quot;_dylanxu&quot;)
    .AfterMapping((source, dest) =&gt;
    {
        dest.Price = dest.Price / 10000;
    });
});
var carEntity = entity.Adapt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span>(typeAdapterConfig);
</code></pre>
<hr>
<h2 id="20&#x4ED3;&#x50A8;&#x5C01;&#x88C5;"><a name="20&#x4ED3;&#x50A8;&#x5C01;&#x88C5;" class="anchor-navigation-ex-anchor" href="#20&#x4ED3;&#x50A8;&#x5C01;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>20&gt;&#x4ED3;&#x50A8;&#x5C01;&#x88C5;</h2>
<p><a href="https://github.com/a34546/Wei.Repository" target="_blank">Wei.Repository</a>:<code>&#x57FA;&#x4E8E;EFCore3.0+Dapper &#x5C01;&#x88C5;Repository, &#x5B9E;&#x73B0;UnitOfWork, &#x63D0;&#x4F9B;&#x57FA;&#x672C;&#x7684;CURD&#x64CD;&#x4F5C;, &#x53EF;&#x76F4;&#x63A5;&#x6CE8;&#x5165;&#x6CDB;&#x578B;Repository, &#x4E5F;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;Repository, &#x91CD;&#x5199;CURD&#x64CD;&#x4F5C;</code></p>
<p><code>&#x5C01;&#x88C5;&#x540E;&#x7684;&#x7EC4;&#x4EF6;:</code></p>
<p><code>Dylan.DatabaseAccessor</code>: &#x96C6;&#x6210;ShardingCore(&#x5206;&#x7247;), Dapper(&#x5904;&#x7406;&#x590D;&#x6742;&#x903B;&#x8F91;), Zack.EFCore.Batch.MSSQL(MSSQL&#x7684;&#x6279;&#x5904;&#x7406;), TSQL.Parser(&#x89E3;&#x6790;TSQL), &#x540E;&#x671F;&#x8FD8;&#x9700;&#x8981;&#x96C6;&#x6210; Zack.EFCore.Batch.MySQL</p>
<p><code>Dylan.DataBaseMigration</code>: &#x7528;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x8FC1;&#x79FB;&#x52A8;&#x4F5C;</p>
<p><code>Dylan.BussinessLogicServices</code>: &#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5C42;&#x5C01;&#x88C5;, &#x96C6;&#x6210;&#x4E86;Mapster(Entity&#x548C;DTO&#x76F8;&#x4E92;&#x8F6C;&#x6362;)</p>
<hr>
<h2 id="21&#x5206;&#x8868;&#x5206;&#x5E93;&#x7EC4;&#x4EF6;---shardingcore"><a name="21&#x5206;&#x8868;&#x5206;&#x5E93;&#x7EC4;&#x4EF6;---shardingcore" class="anchor-navigation-ex-anchor" href="#21&#x5206;&#x8868;&#x5206;&#x5E93;&#x7EC4;&#x4EF6;---shardingcore"><i class="fa fa-link" aria-hidden="true"></i></a>21&gt;&#x5206;&#x8868;&#x5206;&#x5E93;&#x7EC4;&#x4EF6; - ShardingCore</h2>
<p><a href="https://xuejmnet.github.io/sharding-core-doc/" target="_blank">ShardingCore&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
<p><a href="https://www.cnblogs.com/xuejiaming/tag/shardingcore/" target="_blank">sharding-core &#x535A;&#x5BA2;&#x56ED;&#x6587;&#x7AE0;&#x5217;&#x8868;</a></p>
<p><a href="https://github.com/xuejmnet/sharding-core" target="_blank">sharding-core (github)</a></p>
<p><img src="EF Core.assets/query-process.png" alt="query-process"></p>
<h3 id="21-1&#x5206;&#x8868;"><a name="21-1&#x5206;&#x8868;" class="anchor-navigation-ex-anchor" href="#21-1&#x5206;&#x8868;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1&gt;&#x5206;&#x8868;</h3>
<p>&#x5206;&#x8868;&#x6D41;&#x7A0B;(code first&#x6A21;&#x5F0F;)</p>
<h4 id="21-1-1&#x521B;&#x5EFA;&#x4E1A;&#x52A1;&#x5B9E;&#x4F53;"><a name="21-1-1&#x521B;&#x5EFA;&#x4E1A;&#x52A1;&#x5B9E;&#x4F53;" class="anchor-navigation-ex-anchor" href="#21-1-1&#x521B;&#x5EFA;&#x4E1A;&#x52A1;&#x5B9E;&#x4F53;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-1&gt;&#x521B;&#x5EFA;&#x4E1A;&#x52A1;&#x5B9E;&#x4F53;</h4>
<pre class="language-"><code class="lang-C#">namespace Dylan.ShardingTableTest.Entity
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x8BA2;&#x5355;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class Order : BaseEntity
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BA2;&#x5355;&#x7F16;&#x53F7;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public virtual string Code { get; set; } = &quot;&quot;;
        ///// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        ///// &#x4ED8;&#x6B3E;&#x7528;&#x6237;&#x540D;&#x79F0;
        ///// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        //public virtual string Payer { get; set; }
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BA2;&#x5355;&#x91D1;&#x989D;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public virtual decimal Money { get; set; }
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BA2;&#x5355;&#x72B6;&#x6001;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public virtual OrderStatusEnum OrderStatus { get; set; } = OrderStatusEnum.NoPay;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x662F;&#x5426;&#x5DF2;&#x5220;&#x9664;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public virtual bool IsDelete { get; set; } = false;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x987E;&#x5BA2;Id
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public virtual long CustomerId { get; set; }
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x5BA2;&#x6237;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        //public virtual Customer Customer { get; set; }
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x8BA2;&#x5355;&#x72B6;&#x6001;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public enum OrderStatusEnum
    {
        NoPay = 1,
        Paying = 2,
        Payed = 3,
        PayFail = 4
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">namespace Dylan.ShardingTableTest.Entity
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x987E;&#x5BA2;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class Customer : BaseEntity
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x540D;&#x79F0;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public string Name { get; set; }
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x533A;&#x57DF;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public string Area { get; set; }
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x662F;&#x5426;&#x5DF2;&#x5220;&#x9664;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public virtual bool IsDelete { get; set; } = false;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BA2;&#x5355;&#x5217;&#x8868;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        //public virtual List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span> Orders { get; set; } = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span> { };
    }
}
</code></pre>
<h4 id="21-1-2&#x521B;&#x5EFA;&#x5B9E;&#x4F53;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;"><a name="21-1-2&#x521B;&#x5EFA;&#x5B9E;&#x4F53;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;" class="anchor-navigation-ex-anchor" href="#21-1-2&#x521B;&#x5EFA;&#x5B9E;&#x4F53;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-2&gt;&#x521B;&#x5EFA;&#x5B9E;&#x4F53;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;</h4>
<pre class="language-"><code class="lang-C#">namespace Dylan.ShardingTableTest.EntityConfiguration
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// OrderConfig
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class OrderConfig : IEntityTypeConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span>
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// Configure
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>builder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span> builder)
        {
            //builder.ToTable(&quot;T_Order&quot;);//.HasComment(&quot;&#x8BA2;&#x5355;&#x8868;&quot;);
            builder.ToTable($&quot;{SysContant.DB_Table_Prefix}{nameof(Order)}&quot;);
            builder.HasIndex(t =&gt; t.Code).IsUnique(unique: true);
            builder.HasQueryFilter(t =&gt; !t.IsDelete);

            builder.Property(t =&gt; t.Code).HasColumnType(&quot;nvarchar(80)&quot;).IsRequired(required: true);//.HasComment(&quot;&#x7F16;&#x53F7;&quot;);
            builder.Property(t =&gt; t.Money).HasColumnType(&quot;decimal(19,4)&quot;).IsRequired(required: true);//.HasComment(&quot;&#x91D1;&#x989D;&quot;);
            builder.Property(t =&gt; t.OrderStatus).HasColumnType(&quot;int&quot;).IsRequired(required: true);//.HasComment(&quot;&#x72B6;&#x6001;&quot;);
            //builder.Property(t =&gt; t.Payer).HasColumnType(&quot;nvarchar(50)&quot;).IsRequired(required: true);//.HasComment(&quot;&#x5BA2;&#x6237;&#x540D;&#x79F0;&quot;);
            builder.Property(t =&gt; t.IsDelete).HasColumnType(&quot;bit&quot;).IsRequired(required: true);//.HasComment(&quot;&#x662F;&#x5426;&#x5DF2;&#x5220;&#x9664;&quot;);
            builder.Property(t =&gt; t.CustomerId).HasColumnType(&quot;bigint&quot;).IsRequired(required: true);//.HasComment(&quot;&#x987E;&#x5BA2;Id&quot;);

            //builder
            //    .HasOne(t =&gt; t.Customer)
            //    .WithMany(t =&gt; t.Orders)
            //    .HasForeignKey(t =&gt; t.CustomerId)
            //    .OnDelete(DeleteBehavior.Cascade);
        }
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">namespace Dylan.ShardingTableTest.EntityConfiguration
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// CustomerConfig
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class CustomerConfig : IEntityTypeConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span>
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// Configure
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>builder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span> builder)
        {
            //builder.ToTable(&quot;T_Customer&quot;);//.HasComment(&quot;&#x987E;&#x5BA2;&#x8868;&quot;);
            builder.ToTable($&quot;{SysContant.DB_Table_Prefix}{nameof(Customer)}&quot;);
            builder.HasIndex(t =&gt; t.Name).IsUnique(unique: true);
            builder.HasQueryFilter(t =&gt; !t.IsDelete);

            builder.Property(t =&gt; t.Name).HasColumnType(&quot;nvarchar(50)&quot;).IsRequired(required: true);//.HasComment(&quot;&#x540D;&#x79F0;&quot;);
            builder.Property(t =&gt; t.Area).HasColumnType(&quot;nvarchar(50)&quot;).IsRequired(required: true);//.HasComment(&quot;&#x533A;&#x57DF;&quot;);
            builder.Property(t =&gt; t.IsDelete).HasColumnType(&quot;bit&quot;).IsRequired(required: true);//.HasComment(&quot;&#x662F;&#x5426;&#x5DF2;&#x5220;&#x9664;&quot;);
        }
    }
}
</code></pre>
<h4 id="21-1-3&#x521B;&#x5EFA;&#x5206;&#x8868;&#x7684;&#x865A;&#x62DF;&#x8DEF;&#x7531;"><a name="21-1-3&#x521B;&#x5EFA;&#x5206;&#x8868;&#x7684;&#x865A;&#x62DF;&#x8DEF;&#x7531;" class="anchor-navigation-ex-anchor" href="#21-1-3&#x521B;&#x5EFA;&#x5206;&#x8868;&#x7684;&#x865A;&#x62DF;&#x8DEF;&#x7531;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-3&gt;&#x521B;&#x5EFA;&#x5206;&#x8868;&#x7684;&#x865A;&#x62DF;&#x8DEF;&#x7531;</h4>
<p>*<code>&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x7684;&#x9ED8;&#x8BA4;&#x8DEF;&#x7531;&#x6CA1;&#x6709;int64&#x7C7B;&#x578B;&#x7684;&#x4E3B;&#x952E;&#x53D6;&#x6A21;&#x8DEF;&#x7531;, &#x56E0;&#x6B64;&#x53C2;&#x8003;int32&#x7C7B;&#x578B;&#x7684;&#x4E3B;&#x952E;&#x53D6;&#x6A21;, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;int64&#x7C7B;&#x578B;&#x7684;&#x865A;&#x62DF;&#x8DEF;&#x7531;</code></p>
<pre class="language-"><code class="lang-C#">using ShardingCore.Core.EntityMetadatas;
using ShardingCore.Core.VirtualRoutes;
using ShardingCore.Core.VirtualRoutes.TableRoutes.Abstractions;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;

namespace Dylan.ShardingTableTest.TableRoute
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x5206;&#x8868;&#x5B57;&#x6BB5;&#x4E3A;long&#x7684;&#x53D6;&#x6A21;&#x5206;&#x8868;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span>
    public abstract class AbstractSimpleShardingModKeyLongVirtualTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEntity</span><span class="token punctuation">&gt;</span></span> : AbstractShardingOperatorVirtualTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEntity,</span> <span class="token attr-name">long</span><span class="token punctuation">&gt;</span></span> where TEntity : class
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x53D6;&#x6A21;&#x7684;&#x503C;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        protected readonly int Mod;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x5C3E;&#x7F00;&#x957F;&#x5EA6;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        protected readonly int TailLength;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x586B;&#x5145;&#x7684;&#x5B57;&#x7B26;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        protected readonly char PaddingChar;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x6784;&#x9020;&#x51FD;&#x6570;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tailLength<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5C3E;&#x7F00;&#x957F;&#x5EA6;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x53D6;&#x6A21;&#x7684;&#x503C;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paddingChar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x586B;&#x5145;&#x7684;&#x5B57;&#x7B26;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span> <span class="token attr-name">cref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ArgumentException<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception</span><span class="token punctuation">&gt;</span></span>
        protected AbstractSimpleShardingModKeyLongVirtualTableRoute(int tailLength, int mod, char paddingChar = &apos;0&apos;)
        {
            if (tailLength &lt; 1)
                throw new ArgumentException($&quot;{nameof(tailLength)} less than 1 &quot;);
            if (mod &lt; 1)
                throw new ArgumentException($&quot;{nameof(mod)} less than 1 &quot;);
            if (string.IsNullOrWhiteSpace(paddingChar.ToString()))
                throw new ArgumentException($&quot;{nameof(paddingChar)} cant empty &quot;);

            this.TailLength = tailLength;
            this.Mod = mod;
            this.PaddingChar = paddingChar;
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x83B7;&#x53D6;key&#x503C;&#x5BF9;&#x5E94;&#x7684;&#x5C3E;&#x7F00;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shardingKey<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override string ShardingKeyToTail(object shardingKey)
        {
            var shardingKeyLong = Convert.ToInt64(shardingKey);
            return Math.Abs(shardingKeyLong % Mod).ToString().PadLeft(TailLength, PaddingChar);
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x83B7;&#x53D6;&#x6240;&#x6709;&#x5C3E;&#x7F00;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> GetAllTails()
        {
            return Enumerable.Range(0, Mod).Select(o =&gt; o.ToString().PadLeft(TailLength, PaddingChar)).ToList();
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x6839;&#x636E;key&#x503C;&#x83B7;&#x53D6;&#x5C3E;&#x7F00;&#x540E;, &#x518D;&#x6784;&#x9020;&#x8868;&#x8FBE;&#x5F0F;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shardingKey<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>key&#x503C;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shardingOperator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x6BD4;&#x8F83;&#x7B26;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; GetRouteToFilter(long shardingKey, ShardingOperatorEnum shardingOperator)
        {

            var t = ShardingKeyToTail(shardingKey);
            switch (shardingOperator)
            {
                case ShardingOperatorEnum.Equal: return tail =&gt; tail == t;
                default:
                    {
#if DEBUG
                        Console.WriteLine($&quot;shardingOperator is not equal scan all table tail&quot;);
#endif
                        return tail =&gt; true;
                    }
            }
        }
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">using Dylan.ShardingTableTest.Entity;
using ShardingCore.Core.EntityMetadatas;
using ShardingCore.VirtualRoutes.Days;
using ShardingCore.VirtualRoutes.Mods;
using ShardingCore.VirtualRoutes.Months;
using System;

namespace Dylan.ShardingTableTest.TableRoute
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x8BA2;&#x5355;&#x865A;&#x62DF;&#x8868;&#x8DEF;&#x7531;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class OrderVirtualTableRoute : AbstractSimpleShardingDayKeyDateTimeVirtualTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span>
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x662F;&#x5426;&#x6309;&#x7167;&#x65F6;&#x95F4;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x5206;&#x8868;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override bool AutoCreateTableByTime()
        {
            return true;
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x83B7;&#x53D6;&#x5206;&#x8868;&#x5F00;&#x59CB;&#x65E5;&#x671F;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span> <span class="token attr-name">cref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NotImplementedException<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception</span><span class="token punctuation">&gt;</span></span>
        public override DateTime GetBeginTime()
        {
            return new DateTime(2021, 12, 28);
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x914D;&#x7F6E;&#x5206;&#x8868;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>builder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span> <span class="token attr-name">cref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NotImplementedException<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception</span><span class="token punctuation">&gt;</span></span>
        public override void Configure(EntityMetadataTableBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span> builder)
        {
            builder
                .ShardingProperty(t =&gt; t.AddTime) //&#x5206;&#x8868;&#x5B57;&#x6BB5;
                .AutoCreateTable(autoCreate: false) //&#x542F;&#x52A8;&#x540E;&#x662F;&#x5426;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x8868;, &#x9ED8;&#x8BA4;false
                .TableSeparator(&quot;_&quot;); //&#x5C3E;&#x7F00;&#x5206;&#x9694;&#x7B26;
        }
    }

    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x987E;&#x5BA2;&#x865A;&#x62DF;&#x8DEF;&#x7531;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class CustomerVirtualTableRoute : AbstractSimpleShardingModKeyLongVirtualTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span>
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x6784;&#x9020;&#x51FD;&#x6570;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public CustomerVirtualTableRoute() : base(2, 3)
        {

        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// Configure
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>builder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>builder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span> <span class="token attr-name">cref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NotImplementedException<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception</span><span class="token punctuation">&gt;</span></span>
        public override void Configure(EntityMetadataTableBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span> builder)
        {
            builder
                .ShardingProperty(t =&gt; t.Id) //&#x5206;&#x8868;&#x5B57;&#x6BB5;
                .AutoCreateTable(autoCreate: false) //&#x542F;&#x52A8;&#x540E;&#x662F;&#x5426;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x8868;, &#x9ED8;&#x8BA4;false
                .TableSeparator(&quot;_&quot;); //&#x5C3E;&#x7F00;&#x5206;&#x9694;&#x7B26;
        }
    }
}
</code></pre>
<h4 id="21-1-4&#x521B;&#x5EFA;dbcontext"><a name="21-1-4&#x521B;&#x5EFA;dbcontext" class="anchor-navigation-ex-anchor" href="#21-1-4&#x521B;&#x5EFA;dbcontext"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-4&gt;&#x521B;&#x5EFA;DbContext</h4>
<pre class="language-"><code class="lang-C#">using Dylan.FrameWork.SysAttribute;
using Dylan.FrameWork.Utility;
using Dylan.ShardingCoreTest.Entity;
using Dylan.ShardingTableTest.Entity;
using Microsoft.AspNetCore.Http;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.ChangeTracking;
using ShardingCore.Core.VirtualRoutes.TableRoutes.RouteTails.Abstractions;
using ShardingCore.Extensions;
using ShardingCore.Sharding;
using ShardingCore.Sharding.Abstractions;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.NetworkInformation;
using System.Net.Sockets;
using System.Threading;
using System.Threading.Tasks;

namespace Dylan.ShardingTableTest.Repository
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// SysDbContext
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    [DbInfo(schema:SysContant.DB_Schema_DBO)]
    public class CalcDbContext : AbstractShardingDbContext, IShardingTableDbContext
    {
        #region &#x5C5E;&#x6027;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BF7;&#x6C42;&#x4E0A;&#x4E0B;&#x6587;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        private readonly IHttpContextAccessor _httpContextAccessor = null;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// RouteTail
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public IRouteTail RouteTail
        {
            get;
            set;
        }

        public virtual DbSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span> Orders { get; set; }
        public virtual DbSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span> Customers { get; set; }

        public virtual DbSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span> Persons { get; set; }
        public virtual DbSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span> Cars { get; set; }

        #endregion

        #region &#x6784;&#x9020;&#x51FD;&#x6570;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x6784;&#x9020;&#x51FD;&#x6570;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>options<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        public CalcDbContext(DbContextOptions options) : base(options)
        {
        }

        #endregion

        #region OnConfiguring

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x914D;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>optionsBuilder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) 
        {
            base.OnConfiguring(optionsBuilder);

            //&#x6CE8;&#x518C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x7EC4;&#x4EF6;(&#x4E00;&#x5B9A;&#x8981;&#x5728;&#x8FD9;&#x91CC;&#x6CE8;&#x518C;&#xFF0C;&#x4E0D;&#x7136;zack&#x7EC4;&#x4EF6;&#x629B;&#x5F02;&#x5E38;)
            optionsBuilder.UseBatchEF_MSSQL();
        }

        #endregion

        #region OnModelCreating

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// OnModelCreating
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            modelBuilder.ApplyConfigurationsFromAssembly(typeof(BaseEntity).Assembly);
        }

        #endregion

        #region &#x91CD;&#x5199;&#x57FA;&#x7C7B;&#x65B9;&#x6CD5;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// Saves all changes made in this context to the database.
        /// This method will automatically call Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges
        /// to discover any changes to entity instances before saving to the underlying database.
        /// This can be disabled via Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.AutoDetectChangesEnabled.
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span>The number of state entries written to the database.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override int SaveChanges()
        {
            //&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
            SetBaseEntityFields(base.ChangeTracker);
            return base.SaveChanges();
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// Saves all changes made in this context to the database.
        /// This method will automatically call Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges
        /// to discover any changes to entity instances before saving to the underlying database.
        /// This can be disabled via Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.AutoDetectChangesEnabled.
        /// Multiple active operations on the same context instance are not supported. Use
        /// &apos;await&apos; to ensure that any asynchronous operations have completed before calling
        /// another method on this context.
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A System.Threading.CancellationToken to observe while waiting for the task to complete.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span>A task that represents the asynchronous save operation. The task result contains the number of state entries written to the database.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> SaveChangesAsync(CancellationToken cancellationToken = default)
        {
            //&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
            SetBaseEntityFields();
            //SetBaseEntityFields(base.ChangeTracker);
            return base.SaveChangesAsync(cancellationToken);
        }

        #endregion

        #region &#x65B9;&#x6CD5;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        private void SetBaseEntityFields()
        {
            if (this.ShardingDbContextExecutor == default)
            {
                return;
            }

            //&#x5206;&#x5E93;dic
            var dataSourceDbContextDic = this.ShardingDbContextExecutor.GetCurrentDbContexts();
            if (dataSourceDbContextDic == default)
            {
                return;
            }

            dataSourceDbContextDic.ToList().ForEach(kvPair =&gt;
            {
                //&#x5206;&#x8868;dic
                var dbContextDic = kvPair.Value.GetCurrentContexts();
                if (dbContextDic == default)
                {
                    return;
                }

                dbContextDic.ToList().ForEach(seperateTableContextKV =&gt;
                {
                    SetBaseEntityFields(seperateTableContextKV.Value.ChangeTracker);
                });
            });
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entityState<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5B9E;&#x4F53;&#x72B6;&#x6001;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>propertyValues<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        private void SetBaseEntityFields(ChangeTracker changeTracker)
        {
            var baseEntity = typeof(BaseEntity);
            foreach (var entry in changeTracker.Entries())
            {
                //&#x82E5;entry&#x7684;&#x57FA;&#x7C7B;&#x4E0D;&#x662F;BaseLogicEntity, &#x5219;pass
                if (!baseEntity.IsAssignableFrom(entry.Entity.GetType()))
                {
                    continue;
                }

                SetBaseEntityFields(entry);
            }
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entityState<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5B9E;&#x4F53;&#x72B6;&#x6001;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>propertyValues<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        private void SetBaseEntityFields(EntityEntry entityEntry)
        {
            var now = DateTime.Now;
            var userId = 1470214131637424134L;
            var ip = GetIP();

            var entityState = entityEntry.State;
            var propertyValues = entityEntry.CurrentValues;

            if (propertyValues == default)
            {
                return;
            }

            //&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x503C;
            void SetPropertyValues(PropertyValues propertyValues, Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span> dic)
            {
                dic.ToList().ForEach(kvPair =&gt;
                {
                    propertyValues[kvPair.Key] = kvPair.Value;
                });
            }

            Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span> dic = new()
            {
                { SysContant.Entity_Property_LastUpdateTime, now },
                { SysContant.Entity_Property_LastUpdateUserId, userId },
                { SysContant.Entity_Property_LastUpdateIP, ip },
            };
            if (entityState == EntityState.Added)
            {
                dic.Add(SysContant.Entity_Property_AddTime, now);
                dic.Add(SysContant.Entity_Property_AddUserId, userId);
                dic.Add(SysContant.Entity_Property_AddIP, ip);

                SetPropertyValues(propertyValues, dic);
            }
            else if (entityState == EntityState.Modified)
            {
                SetPropertyValues(propertyValues, dic);
            }
            else
            {
                //&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0D;&#x5904;&#x7406;
                return;
            }
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x83B7;&#x53D6;IP&#x5730;&#x5740;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        private string GetIP()
        {
            //&#x83B7;&#x53D6;&#x672C;&#x5730;IP
            string GetLocalIP()
            {
                return NetworkInterface
                    .GetAllNetworkInterfaces()
                    .Where(netWork =&gt; netWork.OperationalStatus == OperationalStatus.Up)
                    .Select(netWork =&gt; netWork.GetIPProperties())
                    .OrderByDescending(pro =&gt; pro.GatewayAddresses.Count)
                    .SelectMany(pro =&gt; pro.UnicastAddresses)
                    .FirstOrDefault(ip =&gt; !IPAddress.IsLoopback(ip.Address) &amp;&amp; (ip.Address.AddressFamily == AddressFamily.InterNetwork || ip.Address.AddressFamily == AddressFamily.InterNetworkV6))
                    ?.Address.ToString() ?? &quot;&quot;;
            }

            //&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;IP
            string GetRemoteIP()
            {
                return _httpContextAccessor.HttpContext.Connection.RemoteIpAddress?.ToString() ??
                    _httpContextAccessor.HttpContext.Request.Headers[&quot;X-Real-IP&quot;].FirstOrDefault() ?? &quot;&quot;;
            }

            var needHandleIPs = new[] { &quot;::1&quot; };
            var ip = &quot;&quot;;
            bool isGetLocalIP;
            if (_httpContextAccessor == default)
            {
                ip = GetLocalIP();
                isGetLocalIP = true;
            }
            else
            {
                ip = GetRemoteIP();
                isGetLocalIP = false;
            }

            //&#x83B7;&#x53D6;&#x7684;IP&#x662F;&#x5426;&#x9700;&#x8981;&#x4E8C;&#x6B21;&#x5904;&#x7406;
            if (needHandleIPs.Contains(ip))
            {
                ip = isGetLocalIP ? GetRemoteIP() : GetLocalIP();
            }

            return ip;
        }

        #endregion
    }

}
</code></pre>
<h4 id="21-1-5&#x6CE8;&#x518C;&#x548C;&#x5F00;&#x542F;&#x5206;&#x8868;&#x670D;&#x52A1;&#x7684;&#x7C7B;"><a name="21-1-5&#x6CE8;&#x518C;&#x548C;&#x5F00;&#x542F;&#x5206;&#x8868;&#x670D;&#x52A1;&#x7684;&#x7C7B;" class="anchor-navigation-ex-anchor" href="#21-1-5&#x6CE8;&#x518C;&#x548C;&#x5F00;&#x542F;&#x5206;&#x8868;&#x670D;&#x52A1;&#x7684;&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-5&gt;&#x6CE8;&#x518C;&#x548C;&#x5F00;&#x542F;&#x5206;&#x8868;&#x670D;&#x52A1;&#x7684;&#x7C7B;</h4>
<pre class="language-"><code class="lang-C#">using Castle.Core.Logging;
using Dylan.FrameWork.Entity.SysConfig;
using Dylan.FrameWork.SysAttribute;
using Dylan.FrameWork.Utility;
using Dylan.ShardingTableTest.TableRoute;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Diagnostics;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using ShardingCore;
using ShardingCore.Sharding;
using ShardingCore.Sharding.Abstractions;
using System;
using System.Reflection;
using Dylan.FrameWork.Extension;
using System.Linq;
using System.Collections.Generic;
using ShardingCore.Sharding.ReadWriteConfigurations;
using Microsoft.AspNetCore.Builder;
using ShardingCore.Bootstrapers;
using ShardingCore.TableExists;

namespace Dylan.ShardingTableTest.Repository
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x62D3;&#x5C55;&#x5206;&#x7247;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public static class ShardingCoreExtesion
    {
        #region &#x79C1;&#x6709;&#x65B9;&#x6CD5;

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x83B7;&#x53D6;ConnectionString
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>services<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span> <span class="token attr-name">cref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ArgumentNullException<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception</span><span class="token punctuation">&gt;</span></span>
        private static DBConnectionString GetConnStr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TDbContext</span><span class="token punctuation">&gt;</span></span>(IServiceCollection services) where TDbContext : DbContext, IShardingDbContext
        {
            if (services == default)
            {
                throw new ArgumentNullException(&quot;services&quot;);
            }

            var serviceProvider = services.BuildServiceProvider();
            var systemConfigOption = serviceProvider.GetService&lt;IOptionsSnapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SystemConfig</span><span class="token punctuation">&gt;</span></span>&gt;() ?? throw new ArgumentNullException(&quot;IOptionsSnapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SystemConfig</span><span class="token punctuation">&gt;</span></span>&quot;);
            var systemConfig = systemConfigOption.Value ?? throw new ArgumentNullException(&quot;systemConfigOption.Value&quot;);

            var dbInfo = typeof(TDbContext).GetCustomAttribute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DbInfoAttribute</span><span class="token punctuation">&gt;</span></span>();
            var schema = (dbInfo == default ? SysContant.DB_Schema_DBO : dbInfo.Schema).TrimAll().ToLower();
            var dbConnStr = systemConfig.DBConnectionStrings.FirstOrDefault(conn =&gt; conn.Schema.TrimAll().ToLower() == schema)
                ?? throw new Exception($&quot;Fail to find {schema} from {SysContant.Appsettings_FileName}.&quot;);

            return dbConnStr;
        }

        #endregion

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x6CE8;&#x518C;&#x5206;&#x7247;&#x670D;&#x52A1;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>services<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x670D;&#x52A1;&#x96C6;&#x5408;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public static IServiceCollection AddShardingCore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TDbContext</span><span class="token punctuation">&gt;</span></span>
        (
            this IServiceCollection services
        ) where TDbContext: DbContext, IShardingDbContext
        {
            //&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x914D;&#x7F6E;
            var dbConnStr = GetConnStr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TDbContext</span><span class="token punctuation">&gt;</span></span>(services);
            var dbName = dbConnStr.Name ?? &quot;DB0&quot;;
            var connectionString = dbConnStr.ConnectionString ?? throw new ArgumentNullException(&quot;dbConnStr.ConnectionString&quot;);
            var readDBs = dbConnStr.ReadDBs ?? new HashSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>();

            var builder = services.AddShardingDbContext<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TDbContext</span><span class="token punctuation">&gt;</span></span>
                (
                    (conn, optionsBuilder) =&gt;
                        optionsBuilder.UseSqlServer(conn, optionsBuilder =&gt;
                        {
                            optionsBuilder
                            .UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery)
                            .MigrationsHistoryTable(tableName: $&quot;__{SysContant.DB_Table_Prefix}DBMigrationsHistory&quot;);
                        })
                        .UseQueryTrackingBehavior(QueryTrackingBehavior.TrackAll)
                        .UseLoggerFactory(FramePublicFun.LoggerFactory)
                        //.LogTo(msg =&gt;
                        //{
                        //    //&#x8C03;&#x8BD5; - &#x7A97;&#x53E3;&#x6D88;&#x606F;
                        //    System.Diagnostics.Debug.WriteLine(msg);
                        //    //&#x8F93;&#x51FA; - &#x7A97;&#x53E3;&#x6D88;&#x606F;
                        //    Console.WriteLine(msg);
                        //}, LogLevel.Information, DbContextLoggerOptions.DefaultWithLocalTime)
                        .ReplaceService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IMigrationsSqlGenerator,</span> <span class="token attr-name">ShardingSqlServerMigrationsSqlGenerator&lt;TDbContext</span><span class="token punctuation">&gt;</span></span>&gt;()
                        .ReplaceService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IMigrationsModelDiffer,</span> <span class="token attr-name">RemoveForeignKeyMigrationsModelDiffer</span><span class="token punctuation">&gt;</span></span>()

                        //&#x9700;&#x8981;&#x5C06;zack&#x7EC4;&#x4EF6;&#x6CE8;&#x518C;&#x5230;OnConfiguring&#x91CC;, &#x539F;&#x56E0;&#x4E0D;&#x660E;
                        //&#x6CE8;&#x518C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x7EC4;&#x4EF6;
                        //.UseBatchEF_MSSQL()
                )
                .Begin(shardingCoreBeginOptions =&gt;
                {
                    //&#x662F;&#x5426;&#x9700;&#x8981;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x521B;&#x5EFA;&#x5206;&#x8868;&#x4E86;&#x7684;&#x8868;, &#x5982;&#x679C;&#x7528;code first, &#x53EF;&#x662F;&#x5C06;&#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;false
                    shardingCoreBeginOptions.CreateShardingTableOnStart = true;
                    //&#x662F;&#x5426;&#x9700;&#x8981;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x521B;&#x5EFA;&#x666E;&#x901A;&#x8868;(&#x975E;&#x5206;&#x8868;&#x7684;&#x53EF;&#x4EE5;&#x662F;&#x5206;&#x5E93;&#x7684;&#x8868;&#x4F46;&#x4E0D;&#x80FD;&#x662F;&#x5206;&#x8868;&#x7684;&#x8868;), &#x53EA;&#x6709;&#x5F53;&#x6570;&#x636E;&#x5E93;&#x662F;&#x7A7A;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x548C;&#x666E;&#x901A;&#x8868;, &#x5982;&#x679C;&#x7528;code first, &#x53EF;&#x662F;&#x5C06;&#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;false
                    shardingCoreBeginOptions.EnsureCreatedWithOutShardingTable = false;
                    //&#x662F;&#x5426;&#x81EA;&#x52A8;&#x8DDF;&#x8E2A;&#x5B9E;&#x4F53;, &#x7ED3;&#x5408;UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery)&#x4E00;&#x8D77;&#x7528;
                    //shardingCoreBeginOptions.AutoTrackEntity = true;
                    //&#x5355;&#x6B21;&#x67E5;&#x8BE2;sharding-core&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x7684;dbconnection&#x6570;, &#x9ED8;&#x8BA4;&#x4F1A;&#x52A0;&#x4E0A;1, &#x9ED8;&#x8BA4;&#x662F;cpu&#x7EBF;&#x7A0B;&#x6570;
                    shardingCoreBeginOptions.MaxQueryConnectionsLimit = Environment.ProcessorCount;
                })
                .AddShardingTransaction
                (
                    (connection, builder) =&gt;
                        builder
                            .UseSqlServer(connection)
                            .UseLoggerFactory(FramePublicFun.LoggerFactory)
                            .UseQueryTrackingBehavior(QueryTrackingBehavior.TrackAll)
                )
                .AddDefaultDataSource
                (
                    dbName, connectionString
                )
                .AddShardingTableRoute(shardingTableOptions =&gt;
                {
                    shardingTableOptions.AddShardingTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OrderVirtualTableRoute</span><span class="token punctuation">&gt;</span></span>();
                    shardingTableOptions.AddShardingTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CustomerVirtualTableRoute</span><span class="token punctuation">&gt;</span></span>();
                })
                .AddTableEnsureManager(sp =&gt; new SqlServerTableEnsureManager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TDbContext</span><span class="token punctuation">&gt;</span></span>());

            //&#x82E5;&#x8BFB;&#x5E93;&#x4E0D;&#x4E3A;&#x7A7A;, &#x5219;&#x914D;&#x7F6E;&#x8BFB;&#x5199;&#x5206;&#x79BB;
            if (readDBs.Count &lt;= 0)
            {
                builder.End();
            }
            else
            {
                builder.AddReadWriteSeparation(serviceProvider =&gt; new Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">IEnumerable&lt;string</span><span class="token punctuation">&gt;</span></span>&gt;
                {
                    { dbName, readDBs }
                },
                ReadStrategyEnum.Loop,
                defaultEnable: true,
                defaultPriority: 10,
                ReadConnStringGetStrategyEnum.LatestFirstTime).End();
            }

            return services;
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x542F;&#x52A8;&#x5206;&#x7247;&#x670D;&#x52A1;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>applicationBuilder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>applicationBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public static IApplicationBuilder UseShardingCore(this IApplicationBuilder applicationBuilder) 
        {
            if (applicationBuilder == default)
            {
                throw new ArgumentNullException(&quot;applicationBuilder&quot;);
            }

            applicationBuilder.ApplicationServices.GetRequiredService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IShardingBootstrapper</span><span class="token punctuation">&gt;</span></span>().Start();

            return applicationBuilder;
        }
    }
}
</code></pre>
<h4 id="21-1-6&#x5206;&#x8868;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x53CA;&#x542F;&#x52A8;"><a name="21-1-6&#x5206;&#x8868;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x53CA;&#x542F;&#x52A8;" class="anchor-navigation-ex-anchor" href="#21-1-6&#x5206;&#x8868;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x53CA;&#x542F;&#x52A8;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-6&gt;&#x5206;&#x8868;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x53CA;&#x542F;&#x52A8;</h4>
<pre class="language-"><code class="lang-C#">public void ConfigureServices(IServiceCollection services)
{
    //...
    //&#x6CE8;&#x518C;&#x5206;&#x7247;&#x670D;&#x52A1;(&#x5982;&#x679C;ef tools&#x7684;migration&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x9879;&#x76EE;&#x6765;&#x8FC1;&#x79FB;&#x7684;&#x8BDD;,&#x6267;&#x884C;&#x8FC1;&#x79FB;&#x7684;&#x65F6;&#x5019;, &#x9700;&#x8981;&#x6CE8;&#x91CA;&#x6389;services.AddShardingCore&#x548C;app.UseShardingCore(), &#x8FC1;&#x79FB;&#x5B8C;&#x6210;&#x540E;&#x518D;&#x653E;&#x5F00;. &#x5EFA;&#x8BAE;&#x53E6;&#x5916;&#x5EFA;&#x4E00;&#x4E2A;&#x63A7;&#x5236;&#x53F0;&#x7A0B;&#x5E8F;&#x4E13;&#x95E8;&#x7528;&#x4E8E;migration&#x64CD;&#x4F5C;.)
    services.AddShardingCore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext</span><span class="token punctuation">&gt;</span></span>();
}

public void Configure
(
    IApplicationBuilder app,
    IWebHostEnvironment env,
    ILoggerFactory loggerFactory,
    IHostApplicationLifetime appLifetime
)
{
    //...
    app
        .UseShardingCore() //&#x542F;&#x52A8;&#x5206;&#x7247;&#x670D;&#x52A1;
}
</code></pre>
<h4 id="21-1-7code-first&#x7684;&#x5176;&#x4ED6;&#x7C7B;"><a name="21-1-7code-first&#x7684;&#x5176;&#x4ED6;&#x7C7B;" class="anchor-navigation-ex-anchor" href="#21-1-7code-first&#x7684;&#x5176;&#x4ED6;&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-7&gt;Code First&#x7684;&#x5176;&#x4ED6;&#x7C7B;</h4>
<pre class="language-"><code class="lang-C#">using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Metadata;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Migrations.Operations;
using ShardingCore.Helpers;
using ShardingCore.Sharding.Abstractions;
using System.Linq;

namespace Dylan.ShardingTableTest.Repository
{
    public class ShardingSqlServerMigrationsSqlGenerator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TShardingDbContext</span><span class="token punctuation">&gt;</span></span> : SqlServerMigrationsSqlGenerator where TShardingDbContext : DbContext, IShardingDbContext
    {
        public ShardingSqlServerMigrationsSqlGenerator(MigrationsSqlGeneratorDependencies dependencies, IRelationalAnnotationProvider migrationsAnnotations) : base(dependencies, migrationsAnnotations)
        {
        }
        protected override void Generate(
            MigrationOperation operation,
            IModel model,
            MigrationCommandListBuilder builder)
        {
            var oldCmds = builder.GetCommandList().ToList();
            base.Generate(operation, model, builder);
            var newCmds = builder.GetCommandList().ToList();
            var addCmds = newCmds.Where(x =&gt; !oldCmds.Contains(x)).ToList();

            MigrationHelper.Generate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TShardingDbContext</span><span class="token punctuation">&gt;</span></span>(operation, builder, Dependencies.SqlGenerationHelper, addCmds);
        }
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Diagnostics.CodeAnalysis;
using System.Linq;
using Dylan.FrameWork.Utility;
using Microsoft.EntityFrameworkCore.ChangeTracking.Internal;
using Microsoft.EntityFrameworkCore.Metadata;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Migrations.Internal;
using Microsoft.EntityFrameworkCore.Migrations.Operations;
using Microsoft.EntityFrameworkCore.Storage;
using Microsoft.EntityFrameworkCore.Update;
using Microsoft.EntityFrameworkCore.Update.Internal;
using ShardingCore;
using ShardingCore.Core.VirtualDatabase.VirtualTables;
using ShardingCore.Core.VirtualRoutes.TableRoutes;

namespace Dylan.ShardingTableTest.Repository
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x5904;&#x7406;&#x751F;&#x6210;&#x811A;&#x672C;&#x7684;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x9519;&#x8BEF;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class RemoveForeignKeyMigrationsModelDiffer : MigrationsModelDiffer
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// 
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>typeMappingSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>migrationsAnnotations<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeDetector<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateAdapterFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commandBatchPreparerDependencies<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        public RemoveForeignKeyMigrationsModelDiffer
            (
                IRelationalTypeMappingSource typeMappingSource,
                IMigrationsAnnotationProvider migrationsAnnotations,
                IChangeDetector changeDetector,
                IUpdateAdapterFactory updateAdapterFactory,
                CommandBatchPreparerDependencies commandBatchPreparerDependencies
            ) : base(typeMappingSource, migrationsAnnotations, changeDetector, updateAdapterFactory, commandBatchPreparerDependencies)
        {

        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x79FB;&#x9664;&#x865A;&#x62DF;&#x8868;&#x7684;&#x5916;&#x952E;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>source<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        public override IReadOnlyList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MigrationOperation</span><span class="token punctuation">&gt;</span></span> GetDifferences(IRelationalModel source, IRelationalModel target)
        {
            var sourceOperations = base.GetDifferences(source, target).ToList();

            //sourceOperations.RemoveAll(x =&gt; x is AddForeignKeyOperation || x is DropForeignKeyOperation);

            var virtualTables = GetVirtualTablesViaDI();//GetVirtualTables();
            //&#x79FB;&#x9664;&#x8D70;&#x865A;&#x62DF;&#x8DEF;&#x7531;&#x7684;&#x8868;&#x7684;&#x5916;&#x952E;&#x76F8;&#x5173;&#x64CD;&#x4F5C;
            sourceOperations.RemoveAll(t =&gt;
            {
                var isForeignKeyOperation = t is AddForeignKeyOperation || t is DropForeignKeyOperation;
                if (!isForeignKeyOperation)
                {
                    return false;
                }

                var op = t as ITableMigrationOperation;
                if (op == default)
                {
                    return false;
                }

                return virtualTables.Contains(op.Table);
            });


            //&#x79FB;&#x9664; &#x521B;&#x5EFA;&#x8868;&#x64CD;&#x4F5C;&#x4E2D;&#x7684; &#x8D70;&#x865A;&#x62DF;&#x8868;&#x8DEF;&#x7531;&#x7684;&#x8868;&#x7684; &#x5916;&#x952E;
            foreach (var operation in sourceOperations.OfType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CreateTableOperation</span><span class="token punctuation">&gt;</span></span>())
            {
                if (virtualTables.Contains(operation.Name))
                {
                    Console.WriteLine(operation.Name);
                    operation.ForeignKeys?.Clear();
                }
            }
            return sourceOperations;
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x83B7;&#x53D6;&#x865A;&#x62DF;&#x8868;&#x540D;&#x79F0;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        private List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> GetVirtualTables()
        {
            List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> virtualTableNames = new();

            var assembly = this.GetType().Assembly;
            if (assembly == default)
            {
                return virtualTableNames;
            }

            var allTypeArr = assembly.GetTypes() ?? new Type[] { };
            if (allTypeArr.Length &lt;= 0)
            {
                return virtualTableNames;
            }

            var virtualTableEntityTypes =
                    allTypeArr
                        .Where(t =&gt;
                        {
                            var result = typeof(IVirtualTableRoute).IsAssignableFrom(t);
                            if (!result)
                            {
                                return result;
                            }

                            var baseType = t.BaseType;
                            if (!baseType.IsGenericType)
                            {
                                return false;
                            }

                            var argArr = baseType.GetGenericArguments() ?? new Type[] { };
                            if (argArr == default || argArr.Length &lt;= 0)
                            {
                                return false;
                            }

                            return true;
                        })
                        .ToList();

            virtualTableNames =
                virtualTableEntityTypes
                    .Select(t =&gt; $&quot;{SysContant.DB_Table_Prefix}{t.BaseType.GetGenericArguments()[0].Name}&quot;)
                    .ToList() ?? new();

            return virtualTableNames;
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x901A;&#x8FC7;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x83B7;&#x53D6;&#x865A;&#x62DF;&#x8868;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        private List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> GetVirtualTablesViaDI()
        {
            List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> virtualTableNames = new();

            try
            {
                //&#x83B7;&#x53D6;&#x5206;&#x8868;&#x7BA1;&#x7406;&#x5668;
                var virtualTableManager = ShardingContainer.GetService&lt;IVirtualTableManager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext</span><span class="token punctuation">&gt;</span></span>&gt;();
                if (virtualTableManager == default)
                {
                    return virtualTableNames;
                }

                var virtualTables = virtualTableManager.GetAllVirtualTables();
                if (virtualTableManager == default || virtualTables.Count &lt;= 0)
                {
                    return virtualTableNames;
                }

                virtualTableNames = virtualTables.Select(vt =&gt; vt.GetVirtualTableName()).ToList();
                return virtualTableNames;
            }
            catch
            {
                return virtualTableNames;
            }
        }
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">using Dylan.FrameWork.Utility;
using Dylan.ShardingTableTest.TableRoute;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Design;
using Microsoft.EntityFrameworkCore.Diagnostics;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using ShardingCore;
using ShardingCore.Bootstrapers;
using System;
using System.IO;
using Dylan.FrameWork.Extension;
using ShardingCore.TableExists;

namespace Dylan.ShardingTableTest.Repository
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// &#x6B64;&#x7C7B;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x7ED9;EF Core Tools&#x505A;migration&#x4F7F;&#x7528;
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    public class ShardingDesignTimeDbContextFactory: IDesignTimeDbContextFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext</span><span class="token punctuation">&gt;</span></span>
    {
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// LoggerFactory
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        public static readonly ILoggerFactory loggerFactory = LoggerFactory.Create(builder =&gt;
        {
            builder.AddFilter((category, level) =&gt; category == DbLoggerCategory.Database.Command.Name &amp;&amp; level == LogLevel.Information).AddConsole();
        });

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// &#x9759;&#x6001;&#x6784;&#x9020;&#x51FD;&#x6570;
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        static ShardingDesignTimeDbContextFactory()
        {
            var dbName = &quot;DB_MALL&quot;;
            var connectionString = &quot;Data Source=192.168.60.103,1433;Initial Catalog=Mall;Persist Security Info=True;User ID=sa;Password=sa,./0sa;MultipleActiveResultSets=true;&quot;;

            var services = new ServiceCollection();

            services.AddShardingDbContext<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext</span><span class="token punctuation">&gt;</span></span>
                (
                    (conn, optionsBuilder) =&gt;
                        optionsBuilder.UseSqlServer(conn, optionsBuilder =&gt;
                        {
                            optionsBuilder
                            .UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery)
                            .MigrationsHistoryTable(tableName: $&quot;__{SysContant.DB_Table_Prefix}DBMigrationsHistory&quot;);
                        })
                        .UseQueryTrackingBehavior(QueryTrackingBehavior.TrackAll)
                        .UseLoggerFactory(loggerFactory)
                        .LogTo(msg =&gt;
                        {
                            //&#x8C03;&#x8BD5; - &#x7A97;&#x53E3;&#x6D88;&#x606F;
                            System.Diagnostics.Debug.WriteLine(msg);
                            //&#x8F93;&#x51FA; - &#x7A97;&#x53E3;&#x6D88;&#x606F;
                            Console.WriteLine(msg);
                        }, LogLevel.Information, DbContextLoggerOptions.DefaultWithLocalTime)
                        .ReplaceService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IMigrationsSqlGenerator,</span> <span class="token attr-name">ShardingSqlServerMigrationsSqlGenerator&lt;CalcDbContext</span><span class="token punctuation">&gt;</span></span>&gt;()
                        .ReplaceService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IMigrationsModelDiffer,</span> <span class="token attr-name">RemoveForeignKeyMigrationsModelDiffer</span><span class="token punctuation">&gt;</span></span>()
                //&#x9700;&#x8981;&#x5C06;zack&#x7EC4;&#x4EF6;&#x6CE8;&#x518C;&#x5230;OnConfiguring&#x91CC;, &#x539F;&#x56E0;&#x4E0D;&#x660E;
                //&#x6CE8;&#x518C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x7EC4;&#x4EF6;
                //.UseBatchEF_MSSQL()
                )
                .Begin(shardingCoreBeginOptions =&gt;
                {
                    //&#x662F;&#x5426;&#x9700;&#x8981;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x521B;&#x5EFA;&#x5206;&#x8868;&#x4E86;&#x7684;&#x8868;, &#x5982;&#x679C;&#x7528;code first, &#x53EF;&#x5C06;&#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;false
                    shardingCoreBeginOptions.CreateShardingTableOnStart = false;
                    //&#x662F;&#x5426;&#x9700;&#x8981;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x521B;&#x5EFA;&#x666E;&#x901A;&#x8868;(&#x975E;&#x5206;&#x8868;&#x7684;&#x53EF;&#x4EE5;&#x662F;&#x5206;&#x5E93;&#x7684;&#x8868;&#x4F46;&#x4E0D;&#x80FD;&#x662F;&#x5206;&#x8868;&#x7684;&#x8868;), &#x53EA;&#x6709;&#x5F53;&#x6570;&#x636E;&#x5E93;&#x662F;&#x7A7A;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x548C;&#x666E;&#x901A;&#x8868;, &#x5982;&#x679C;&#x7528;code first, &#x53EF;&#x662F;&#x5C06;&#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;false
                    shardingCoreBeginOptions.EnsureCreatedWithOutShardingTable = false;
                    //&#x662F;&#x5426;&#x81EA;&#x52A8;&#x8DDF;&#x8E2A;&#x5B9E;&#x4F53;, &#x7ED3;&#x5408;UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery)&#x4E00;&#x8D77;&#x7528;
                    //shardingCoreBeginOptions.AutoTrackEntity = true;
                    //&#x5355;&#x6B21;&#x67E5;&#x8BE2;sharding-core&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x7684;dbconnection&#x6570;, &#x9ED8;&#x8BA4;&#x4F1A;&#x52A0;&#x4E0A;1, &#x9ED8;&#x8BA4;&#x662F;cpu&#x7EBF;&#x7A0B;&#x6570;
                    shardingCoreBeginOptions.MaxQueryConnectionsLimit = Environment.ProcessorCount;
                })
                .AddShardingTransaction
                (
                    (connection, builder) =&gt;
                        builder
                            .UseSqlServer(connection)
                            .UseLoggerFactory(loggerFactory)
                            .UseQueryTrackingBehavior(QueryTrackingBehavior.TrackAll)
                )
                .AddDefaultDataSource
                (
                    dbName, connectionString
                )
                .AddShardingTableRoute(shardingTableOptions =&gt;
                {
                    shardingTableOptions.AddShardingTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OrderVirtualTableRoute</span><span class="token punctuation">&gt;</span></span>();
                    shardingTableOptions.AddShardingTableRoute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CustomerVirtualTableRoute</span><span class="token punctuation">&gt;</span></span>();
                })
                .AddTableEnsureManager(sp =&gt; new SqlServerTableEnsureManager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext</span><span class="token punctuation">&gt;</span></span>())
                .End();

            var cfgFilePath = Path.Combine(FramePublicFun.GetDllPath(), SysContant.Log4Net_CfgFileName);
            services.AddLogging(c =&gt; c.AddLog4Net(cfgFilePath, watch: true));

            var buildServiceProvider = services.BuildServiceProvider();
            ShardingContainer.SetServices(buildServiceProvider);
            buildServiceProvider.RegisterGlobalServiceProvider();
            ShardingContainer.GetService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IShardingBootstrapper</span><span class="token punctuation">&gt;</span></span>().Start();
        }

        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// CreateDbContext
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>args<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
        /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span> <span class="token attr-name">cref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NotImplementedException<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception</span><span class="token punctuation">&gt;</span></span>
        public CalcDbContext CreateDbContext(string[] args)
        {
            return ShardingContainer.GetService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext</span><span class="token punctuation">&gt;</span></span>();
        }
    }
}
</code></pre>
<h4 id="21-1-8&#x5176;&#x4ED6;&#x6CE8;&#x610F;&#x70B9;"><a name="21-1-8&#x5176;&#x4ED6;&#x6CE8;&#x610F;&#x70B9;" class="anchor-navigation-ex-anchor" href="#21-1-8&#x5176;&#x4ED6;&#x6CE8;&#x610F;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-8&gt;&#x5176;&#x4ED6;&#x6CE8;&#x610F;&#x70B9;</h4>
<p>*<code>ShardingCore&#x652F;&#x6301;&#x5206;&#x7247;&#x52A8;&#x4F5C;(&#x5206;&#x8868;[&#x5355;&#x5B57;&#x6BB5;&#x5206;&#x8868;&#x53CA;&#x591A;&#x5B57;&#x6BB5;&#x5206;&#x8868;], &#x5206;&#x5E93;)&#x53CA;&#x8BFB;&#x5199;&#x5206;&#x79BB;</code></p>
<p>*<code>&#x65B0;&#x7684;&#x5206;&#x8868;&#x8DEF;&#x7531;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x9ED8;&#x8BA4;&#x865A;&#x62DF;&#x8DEF;&#x7531;&#x6765;&#x4FEE;&#x6539;&#xFF0C;&#x5982;&#x5206;&#x8868;&#x5B57;&#x6BB5;Id(long)&#x7684;&#x865A;&#x62DF;&#x8DEF;&#x7531;</code></p>
<p>*<code>&#x5206;&#x8868;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x5C5E;&#x6027;&#x5BFC;&#x822A;/&#x5217;&#x8868;&#x5BFC;&#x822A;(&#x67E5;&#x8BE2;&#x5C31;&#x4E0D;&#x7528;include), &#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5916;&#x952E;&#x5C5E;&#x6027;, &#x5728;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;, &#x81EA;&#x5DF1;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x5206;&#x8868;(inner join/left join)</code></p>
<p>*<code>ShardingCore&#x652F;&#x6301;&#x6240;&#x6709;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x6279;&#x5904;&#x7406;&#x7EC4;&#x4EF6;, &#x53EF;&#x662F;&#x6267;&#x884C;&#x975E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x5019;, &#x9700;&#x8981;&#x901A;&#x8FC7; dbcontext.BulkShardingTableEnumerable / dbcontext.BulkShardingTableExpression &#x6765;&#x83B7;&#x53D6;&#x5B9E;&#x9645;&#x7684;dbcontext, &#x518D;&#x6267;&#x884C;&#x6279;&#x5904;&#x7406;&#x52A8;&#x4F5C;</code></p>
<p>*<code>ShardingCore&#x6267;&#x884C;&#x666E;&#x901A;&#x8868;&#x7684;&#x64CD;&#x4F5C;, &#x4F1A;&#x4F7F;&#x7528;ef core&#x539F;&#x751F;&#x65B9;&#x6CD5;, &#x5BF9;&#x4E8E;&#x5206;&#x7247;&#x8868;, &#x4F1A;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x89E3;&#x6790;&#x5668;</code> </p>
<p>*<code>ShardingCore&#x7684;Code first&#x6A21;&#x5F0F;, &#x9488;&#x5BF9;&#x4E8E;web&#x9879;&#x76EE;, &#x5EFA;&#x8BAE;&#x72EC;&#x7ACB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;console&#x9879;&#x76EE;, &#x4E13;&#x95E8;&#x7528;&#x4E8E;&#x6267;&#x884C;migration&#x547D;&#x4EE4;</code></p>
<p>*<code>ShardingCore&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x7684;&#x4FDD;&#x5B58;&#x70B9;, &#x4EE5;&#x540E;&#x4F1A;&#x652F;&#x6301;, &#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x7279;&#x6027;&#x53EF;&#x4EE5;&#x652F;&#x6301;</code></p>
<p>*<code>&#x82E5;&#x662F;&#x6267;&#x884C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;, &#x4E0D;&#x7BA1;&#x662F;&#x4E0D;&#x662F;&#x5206;&#x7247;&#x7684;&#x8868;, &#x90FD;&#x9700;&#x8981;&#x5148;&#x83B7;&#x53D6;&#x5B9E;&#x9645;&#x7684;dbcontext, &#x518D;&#x6267;&#x884C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;</code></p>
<h4 id="21-1-9&#x4F8B;&#x5B50;"><a name="21-1-9&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#21-1-9&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>21-1-9&gt;&#x4F8B;&#x5B50;</h4>
<pre class="language-"><code class="lang-C#">[HttpGet(&quot;CreateCustomerOrders/{count}&quot;)]
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> CreateCustomerOrders([FromRoute] int count, CancellationToken cancellationToken)
{
    try
    {
        if (count &lt;= 0)
        {
            count = 3000;
        }

        //1&gt;&#x5148;&#x5220;&#x9664;&#x6570;&#x636E;
        if (await _calcDbContext.Orders.AnyAsync())
        {
            var orderCount = await _calcDbContext.Orders.CountAsync(cancellationToken);
            var allOrders = await _calcDbContext.Orders.ToListAsync(cancellationToken);

            //&#x83B7;&#x53D6;&#x5B9E;&#x9645;dbcontext
            Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; func = t =&gt; true;
            var dbContexts = _calcDbContext.BulkShardingTableExpression(func);
            if (dbContexts.Any())
            {
                dbContexts.ToList().ForEach(async dbContext =&gt;
                {
                    await dbContext.DeleteRangeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span>(t =&gt; true, false, cancellationToken);
                    //await dbContext.DeleteRangeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span>();
                });
            }
        }
        if (await _calcDbContext.Customers.AnyAsync())
        {
            var customerCount = await _calcDbContext.Customers.CountAsync(cancellationToken);
            var allCustomers = await _calcDbContext.Customers.ToListAsync(cancellationToken);

            //&#x83B7;&#x53D6;&#x5B9E;&#x9645;dbcontext
            Expression&lt;Func<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer,</span> <span class="token attr-name">bool</span><span class="token punctuation">&gt;</span></span>&gt; func = t =&gt; true;
            var dbContexts = _calcDbContext.BulkShardingTableExpression(func);
            if (dbContexts.Any())
            {
                dbContexts.ToList().ForEach(async dbContext =&gt;
                {
                    await dbContext.DeleteRangeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span>(t =&gt; true, false, cancellationToken);
                    //await dbContext.DeleteRangeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span>();
                });
            }
        }

        //2&gt;&#x6279;&#x91CF;&#x521B;&#x5EFA;
        ConcurrentBag<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span> customers = new();
        ConcurrentBag<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span> orders = new();
        Parallel.For(0, count, i =&gt;
        {
            var tuple = CreateCustomerOrder(FramePublicFun.GetRandomByGuid(1, 5));
            customers.Add(tuple.Item1);
            tuple.Item2.ToList().ForEach(orders.Add);
        });

        //&#x4EC5;&#x5206;&#x8868;
        //&#x6279;&#x91CF;&#x63D2;&#x5165;customers
        var dbContextCustomerDic = _calcDbContext.BulkShardingTableEnumerable(customers);
        foreach (var kvPair in dbContextCustomerDic)
        {
            await kvPair.Key.BulkInsertAsync(kvPair.Value.ToList(), null, SqlBulkCopyOptions.Default, cancellationToken);
        }

        //&#x6279;&#x91CF;&#x63D2;&#x5165;orders
        var dbContextOrderDic = _calcDbContext.BulkShardingTableEnumerable(orders);
        foreach (var kvPair in dbContextOrderDic)
        {
            await kvPair.Key.BulkInsertAsync(kvPair.Value.ToList(), null, SqlBulkCopyOptions.Default, cancellationToken);
        }

        return Ok(new
        {
            Result = true
        });
    }
    catch (Exception ex) 
    {
        var errorMsg = ex.GetInnerExceptionMsg();
        return Ok(new
        {
            errorMsg
        });
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6279;&#x91CF;&#x4FEE;&#x6539;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
[HttpGet(&quot;BatchUpdate&quot;)]
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> BatchUpdate(CancellationToken cancellationToken)
{
    try
    {
        //1&gt;&#x6279;&#x91CF;&#x4FEE;&#x6539;&#x5206;&#x7247;&#x8868;
        //1-1&gt;Order
        var dbContexts = _calcDbContext.BulkShardingTableExpression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext,</span> <span class="token attr-name">Order</span><span class="token punctuation">&gt;</span></span>(t =&gt; string.IsNullOrEmpty(t.AddIP));
        dbContexts.ToList().ForEach(async dbContext =&gt;
        {
            await dbContext
                .BatchUpdate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Order</span><span class="token punctuation">&gt;</span></span>()
                .Set(t =&gt; t.AddIP, &quot;192.168.60.103&quot;)
                .Set(t =&gt; t.LastUpdateIP, &quot;192.168.60.103&quot;)
                .Where(t =&gt; string.IsNullOrEmpty(t.AddIP))
                .ExecuteAsync(ignoreQueryFilters: false, cancellationToken: cancellationToken);
        });

        //1-2&gt;Customer
        dbContexts = _calcDbContext.BulkShardingTableExpression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext,</span> <span class="token attr-name">Customer</span><span class="token punctuation">&gt;</span></span>(t =&gt; string.IsNullOrEmpty(t.AddIP));
        dbContexts.ToList().ForEach(async dbContext =&gt;
        {
            await dbContext
                .BatchUpdate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Customer</span><span class="token punctuation">&gt;</span></span>()
                .Set(t =&gt; t.AddIP, &quot;192.168.60.103&quot;)
                .Set(t =&gt; t.LastUpdateIP, &quot;192.168.60.103&quot;)
                .Where(t =&gt; string.IsNullOrEmpty(t.AddIP))
                .ExecuteAsync(ignoreQueryFilters: false, cancellationToken: cancellationToken);
        });


        //2&gt;&#x6279;&#x91CF;&#x4FEE;&#x6539;&#x975E;&#x5206;&#x7247;&#x8868;
        //Person
        dbContexts = _calcDbContext.BulkShardingTableExpression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext,</span> <span class="token attr-name">Person</span><span class="token punctuation">&gt;</span></span>(t =&gt; string.IsNullOrEmpty(t.AddIP));
        dbContexts.ToList().ForEach(async dbContext =&gt;
        {
            await dbContext
                .BatchUpdate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span>()
                .Set(t =&gt; t.AddIP, &quot;192.168.60.103&quot;)
                .Set(t =&gt; t.LastUpdateIP, &quot;192.168.60.103&quot;)
                .Where(t =&gt; string.IsNullOrEmpty(t.AddIP))
                .ExecuteAsync(ignoreQueryFilters: false, cancellationToken: cancellationToken);
        });

        //Car
        dbContexts = _calcDbContext.BulkShardingTableExpression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CalcDbContext,</span> <span class="token attr-name">Car</span><span class="token punctuation">&gt;</span></span>(t =&gt; string.IsNullOrEmpty(t.AddIP));
        dbContexts.ToList().ForEach(async dbContext =&gt;
        {
            await dbContext
                .BatchUpdate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Car</span><span class="token punctuation">&gt;</span></span>()
                .Set(t =&gt; t.AddIP, &quot;192.168.60.103&quot;)
                .Set(t =&gt; t.LastUpdateIP, &quot;192.168.60.103&quot;)
                .Where(t =&gt; string.IsNullOrEmpty(t.AddIP))
                .ExecuteAsync(ignoreQueryFilters: false, cancellationToken: cancellationToken);
        });

        await Console.Out.WriteLineAsync(&quot;done&quot;);

        return Ok(new
        {
            Success = true
        });
    }
    catch (Exception ex)
    {
        var errorMsg = ex.GetInnerExceptionMsg();
        return Ok(new
        {
            errorMsg
        });
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5904;&#x7406;&#x975E;&#x6279;&#x91CF;&#x64CD;&#x4F5C;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
[HttpGet(&quot;HandleNonBatchOperation&quot;)]
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> HandleNonBatchOperation(CancellationToken cancellationToken)
{
    try
    {
        //1&gt;&#x5206;&#x7247;&#x5BF9;&#x8C61;
        var customerOrder = CreateCustomerOrder(FramePublicFun.GetRandomByGuid(1, 10));
        await _calcDbContext.AddAsync(customerOrder.Item1, cancellationToken);
        await _calcDbContext.AddRangeAsync(customerOrder.Item2, cancellationToken);

        //2&gt;&#x975E;&#x5206;&#x7247;&#x5BF9;&#x8C61;
        var personCar = CreatePersonCar(FramePublicFun.GetRandomByGuid(1, 4));
        await _calcDbContext.AddAsync(personCar.Item1, cancellationToken);
        await _calcDbContext.AddRangeAsync(personCar.Item2, cancellationToken);

        var affectCount = await _calcDbContext.SaveChangesAsync(cancellationToken);

        return Ok(new
        {
            affectCount
        });
    }
    catch (Exception ex)
    {
        var errorMsg = ex.GetInnerExceptionMsg();
        return Ok(new
        {
            errorMsg
        });
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5206;&#x7247;&#x67E5;&#x8BE2;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>cancellationToken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
[HttpGet(&quot;ShardingQuery&quot;)]
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> ShardingQuery(CancellationToken cancellationToken)
{
    try
    {
        var cusId = 1476442124126917054L;

        ////1&gt;&#x4E24;&#x4E2A;&#x5206;&#x8868;inner join
        //var queryable =
        //    _calcDbContext.Customers.AsNoTracking().TagWith(&quot;test sql c&quot;)
        //    .Where(c =&gt; c.Id &gt;= cusId)
        //    .Join
        //    (
        //        _calcDbContext.Orders.AsNoTracking().TagWith(&quot;test sql o&quot;),
        //        c =&gt; c.Id,
        //        o =&gt; o.CustomerId,
        //        (c, o) =&gt; new
        //        {
        //            CustomerId = c.Id,
        //            c.Name,
        //            c.Area,
        //            OrderId = o.Id,
        //            o.Code,
        //            o.Money
        //        }
        //    );

        //var resultlist = await queryable.Take(30).ToListAsync();


        //2&gt;&#x4E24;&#x4E2A;&#x5206;&#x8868;left join
        //var queryable =
        //     _calcDbContext
        //        .Customers
        //        .GroupJoin
        //        (
        //            _calcDbContext.Orders,
        //            c =&gt; c.Id,
        //            o =&gt; o.CustomerId,
        //            (c, os) =&gt; new { Customer = c, Orders = os }
        //        )
        //        .SelectMany
        //        (
        //            combination =&gt; combination.Orders.DefaultIfEmpty(),
        //            (c, o) =&gt;
        //            new
        //            {
        //                CustomerId = c.Customer.Id,
        //                c.Customer.Name,
        //                c.Customer.Area,
        //                OrderId = o.Id,
        //                o.Code,
        //                o.Money
        //            }
        //        )
        //        .TagWith(&quot;my sql&quot;);

        //var resultlist = await queryable.OrderByDescending(obj =&gt; obj.CustomerId).Take(3).ToListAsync();


        //var queryable =
        //        from lc in _calcDbContext.Customers
        //        join o in _calcDbContext.Orders
        //             on lc.Id equals o.CustomerId into og
        //        from ro in og.DefaultIfEmpty()
        //        orderby lc.Id descending, ro.Id ascending
        //        select new
        //        {
        //            CustomerId = lc.Id,
        //            lc.Name,
        //            lc.Area,
        //            OrderId = ro.Id,
        //            ro.Code,
        //            ro.Money
        //        };

        //var queryable =
        //        from lc in _calcDbContext.Persons
        //        join o in _calcDbContext.Cars
        //             on lc.Id equals o.PersonId into og
        //        from ro in og.DefaultIfEmpty()
        //        orderby lc.Id descending, ro.Id ascending
        //        select new
        //        {
        //            PersonId = lc.Id,
        //            lc.Name,
        //            CarId = ro.Id,
        //            MSN = ro.MSN,
        //            ro.Price,
        //        };


        var queryable =
             _calcDbContext
                .Persons
                .GroupJoin
                (
                    _calcDbContext.Cars,
                    c =&gt; c.Id,
                    o =&gt; o.PersonId,
                    (c, os) =&gt; new { Person = c, Cars = os }
                )
                .SelectMany
                (
                    combination =&gt; combination.Cars.DefaultIfEmpty(),
                    (c, o) =&gt;
                    new
                    {
                        CustomerId = c.Person.Id,
                        c.Person.Name,
                        CarId = o.Id,
                        MSN = o.MSN,
                        o.Price,
                    }
                )
                .OrderByDescending(o =&gt; o.CustomerId).ThenBy(o =&gt; o.CarId)
                .TagWith(&quot;my sql&quot;);

        var resultList = await queryable.TagWith(&quot;test sql&quot;).Take(3).ToListAsync();

        return Ok(resultList);
    }
    catch (Exception ex) 
    {
        var errorMsg = ex.GetInnerExceptionMsg();
        return Ok(new
        {
            errorMsg
        });
    }
}
</code></pre>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x4E8B;&#x52A1;&#x64CD;&#x4F5C;(&#x5206;&#x8868;)
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
[HttpPost(&quot;TransactionOperationShardingTable&quot;)]
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IActionResult</span><span class="token punctuation">&gt;</span></span> TransactionOperationShardingTable(CancellationToken cancellationToken)
{
    using var transaction = _calcDbContext.Database.BeginTransaction();
    try
    {
        //1&gt;&#x521B;&#x5EFA;&#x5B9E;&#x4F53;
        var customerOrder = CreateCustomerOrder(1);
        var customer = customerOrder.Item1;
        await _calcDbContext.AddAsync(customer, cancellationToken);
        var affectCount = await _calcDbContext.SaveChangesAsync(cancellationToken);

        //&#x8BBE;&#x7F6E;&#x56DE;&#x6EDA;&#x7528;&#x7684;&#x4FDD;&#x5B58;&#x70B9;
        //await transaction.CreateSavepointAsync(&quot;SaveCustomer&quot;, cancellationToken);
        //transaction.CreateSavepoint(&quot;SaveCustomer&quot;);

        //&#x6E05;&#x7A7A;code, &#x786E;&#x4FDD;order&#x4FDD;&#x5B58;&#x5931;&#x8D25;
        var orders = customerOrder.Item2;
        foreach (var order in orders)
        {
            order.Code = null;
        }
        await _calcDbContext.AddRangeAsync(orders, cancellationToken);
        affectCount = await _calcDbContext.SaveChangesAsync(cancellationToken);

        transaction.Commit();

        return Ok(new
        {
            affectCount
        });
    }
    catch (Exception ex)
    {
        //await transaction.RollbackToSavepointAsync(&quot;SaveCustomer&quot;,cancellationToken);
        //transaction.Commit();

        var errorMsg = ex.GetInnerExceptionMsg();
        return Ok(new
        {
            errorMsg
        });
    }
}
</code></pre>
<h3 id="21-2&#x5206;&#x5E93;"><a name="21-2&#x5206;&#x5E93;" class="anchor-navigation-ex-anchor" href="#21-2&#x5206;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>21-2&gt;&#x5206;&#x5E93;</h3>
<h3 id="21-3&#x5206;&#x8868;&#x5206;&#x5E93;"><a name="21-3&#x5206;&#x8868;&#x5206;&#x5E93;" class="anchor-navigation-ex-anchor" href="#21-3&#x5206;&#x8868;&#x5206;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>21-3&gt;&#x5206;&#x8868;&#x5206;&#x5E93;</h3>
<h3 id="21-4&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x53C2;&#x8003;21-1"><a name="21-4&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x53C2;&#x8003;21-1" class="anchor-navigation-ex-anchor" href="#21-4&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x53C2;&#x8003;21-1"><i class="fa fa-link" aria-hidden="true"></i></a>21-4&gt;&#x8BFB;&#x5199;&#x5206;&#x79BB;(&#x53C2;&#x8003;21-1&gt;)</h3>
<hr>
<h2 id="22ef&#x76D1;&#x542C;&#x5668;"><a name="22ef&#x76D1;&#x542C;&#x5668;" class="anchor-navigation-ex-anchor" href="#22ef&#x76D1;&#x542C;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>22&gt;<a href="https://docs.microsoft.com/zh-cn/ef/core/logging-events-diagnostics/interceptors" target="_blank">EF&#x76D1;&#x542C;&#x5668;</a></h2>
<hr>
<h2 id="23&#x6027;&#x80FD;&#x4E13;&#x9898;"><a name="23&#x6027;&#x80FD;&#x4E13;&#x9898;" class="anchor-navigation-ex-anchor" href="#23&#x6027;&#x80FD;&#x4E13;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>23&gt;&#x6027;&#x80FD;&#x4E13;&#x9898;</h2>
<h3 id="23-1&#x6027;&#x80FD;&#x8BCA;&#x65AD;"><a name="23-1&#x6027;&#x80FD;&#x8BCA;&#x65AD;" class="anchor-navigation-ex-anchor" href="#23-1&#x6027;&#x80FD;&#x8BCA;&#x65AD;"><i class="fa fa-link" aria-hidden="true"></i></a>23-1&gt;&#x6027;&#x80FD;&#x8BCA;&#x65AD;</h3>
<p>I&gt;&#x901A;&#x8FC7;&#x65E5;&#x5FD7;&#x67E5;&#x770B;sql&#x6267;&#x884C;&#x65F6;&#x95F4;</p>
<pre class="language-"><code>Executed DbCommand (158ms) [Parameters=[@p1=&apos;?&apos; (DbType = Int64), @p0=&apos;?&apos; (Size = 30), @p2=&apos;?&apos; (Size = 8) (DbType = Binary)], CommandType=&apos;Text&apos;, CommandTimeout=&apos;30&apos;]
SET NOCOUNT ON;
UPDATE [CALC].[T_People] SET [Name] = @p0
WHERE [Id] = @p1 AND [Token] = @p2;
SELECT [Token]
FROM [CALC].[T_People]
WHERE @@ROWCOUNT = 1 AND [Id] = @p1;
</code></pre><p>II&gt;&#x5C06;I&gt;&#x67E5;&#x8BE2;&#x6162;&#x7684;&#x8BED;&#x53E5;, &#x62FF;&#x5230;&#x5177;&#x4F53;&#x6570;&#x636E;&#x5E93;&#x7684;MSSM&#x5DE5;&#x5177;&#x91CC;, &#x7528;&#x67E5;&#x8BE2;&#x5206;&#x6790;&#x5668;&#x67E5;&#x770B;&#x6267;&#x884C;&#x8BA1;&#x5212;, &#x5B9E;&#x9645;&#x95EE;&#x9898;&#x5B9E;&#x9645;&#x5904;&#x7406;, &#x5982;&#x52A0;(&#x590D;&#x5408;)&#x7D22;&#x5F15;&#x7B49;</p>
<p>III&gt;&#x901A;&#x8FC7;<a href="https://docs.microsoft.com/zh-cn/ef/core/logging-events-diagnostics/event-counters?tabs=windows" target="_blank">&#x4E8B;&#x4EF6;&#x8BA1;&#x6570;&#x5668;</a>&#x67E5;&#x770B;EF&#x7684;&#x76F8;&#x5173;&#x6570;&#x636E;</p>
<h3 id="23-2&#x9AD8;&#x6548;&#x67E5;&#x8BE2;"><a name="23-2&#x9AD8;&#x6548;&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#23-2&#x9AD8;&#x6548;&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>23-2&gt;&#x9AD8;&#x6548;&#x67E5;&#x8BE2;</h3>
<p>I&gt;&#x5408;&#x7406;&#x4F7F;&#x7528;&#x7D22;&#x5F15;: &#x82E5;&#x51FA;&#x73B0;&#x4E86;&#x6162;&#x901F;&#x67E5;&#x8BE2;, &#x5148;&#x7528;&#x67E5;&#x8BE2;&#x5206;&#x6790;&#x5668;&#x67E5;&#x770B;&#x6267;&#x884C;&#x8BA1;&#x5212;, &#x82E5;&#x4F7F;&#x7528;&#x4E86;&#x5168;&#x8868;&#x626B;&#x63CF;, &#x5219;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x89E3;&#x51B3;.</p>
<p>II&gt;&#x53EA;&#x6295;&#x5F71;&#x9700;&#x8981;&#x7684;&#x5C5E;&#x6027;: &#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x5C3D;&#x53EF;&#x80FD;select&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x5217;.</p>
<p>III&gt;&#x9650;&#x5236;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x7684;&#x6570;&#x91CF;: &#x5404;&#x79CD;&#x67E5;&#x8BE2;&#x6761;&#x4EF6; + &#x5206;&#x9875;.</p>
<p>IV&gt;&#x5C3D;&#x53EF;&#x80FD;&#x9884;&#x5148;&#x52A0;&#x8F7D;&#x76F8;&#x5173;&#x5B9E;&#x4F53;&#xFF1A;</p>
<pre class="language-"><code class="lang-C#">//&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x67E5;&#x8BE2;, &#x5728;&#x6BCF;&#x6B21;&#x5FAA;&#x73AF;blog.Posts, &#x90FD;&#x4F1A;&#x6267;&#x884C;sql&#x67E5;&#x8BE2;post&#x6570;&#x636E;, &#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x9884;&#x52A0;&#x8F7D;
foreach (var blog in context.Blogs.ToList())
{
    foreach (var post in blog.Posts)
    {
        Console.WriteLine($&quot;Blog {blog.Url}, Post: {post.Title}&quot;);
    }
}

foreach (var blog in context.Blogs.Select(b =&gt; new { b.Url, b.Posts }).ToList())
{
    foreach (var post in blog.Posts)
    {
        Console.WriteLine($&quot;Blog {blog.Url}, Post: {post.Title}&quot;);
    }
}
</code></pre>
<p>V&gt;&#x5BF9;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x8DDF;&#x8E2A;&#x7684;&#x5B9E;&#x4F53;&#x7684;&#x67E5;&#x8BE2;, &#x4F7F;&#x7528;AsNoTracking/AsNoTrackingWithIdentityResolution.</p>
<p>VI&gt;&#x5BF9;&#x4E8E;&#x975E;&#x5E38;&#x590D;&#x6742;/&#x5F71;&#x54CD;&#x6027;&#x80FD;&#x7684;&#x67E5;&#x8BE2;, &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x539F;&#x751F;SQL&#x67E5;&#x8BE2;.</p>
<p>VII&gt;&#x80FD;&#x4F7F;&#x7528;EF&#x7684;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;, &#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;, &#x63D0;&#x4F9B;&#x5E94;&#x7528;&#x5E76;&#x53D1;&#x6027;.</p>
<h3 id="23-3&#x9AD8;&#x6548;&#x66F4;&#x65B0;"><a name="23-3&#x9AD8;&#x6548;&#x66F4;&#x65B0;" class="anchor-navigation-ex-anchor" href="#23-3&#x9AD8;&#x6548;&#x66F4;&#x65B0;"><i class="fa fa-link" aria-hidden="true"></i></a>23-3&gt;&#x9AD8;&#x6548;&#x66F4;&#x65B0;</h3>
<p>&#x8BF7;&#x53C2;&#x8003;17&gt;&#x6279;&#x5904;&#x7406;</p>
<hr>
<h2 id="24&#x5176;&#x4ED6;&#x77E5;&#x8BC6;&#x6CE8;&#x610F;&#x70B9;"><a name="24&#x5176;&#x4ED6;&#x77E5;&#x8BC6;&#x6CE8;&#x610F;&#x70B9;" class="anchor-navigation-ex-anchor" href="#24&#x5176;&#x4ED6;&#x77E5;&#x8BC6;&#x6CE8;&#x610F;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>24&gt;&#x5176;&#x4ED6;&#x77E5;&#x8BC6;/&#x6CE8;&#x610F;&#x70B9;</h2>
<h3 id="sql-server&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;-&#x8D85;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;"><a name="sql-server&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;-&#x8D85;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;" class="anchor-navigation-ex-anchor" href="#sql-server&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;-&#x8D85;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a>*<a href="https://blog.csdn.net/qq_44034384/article/details/105960782" target="_blank">SQL Server&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570; (&#x8D85;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;)</a></h3>
<h3 id="guid&#x4E3B;&#x952E;&#x6CE8;&#x610F;&#x70B9;"><a name="guid&#x4E3B;&#x952E;&#x6CE8;&#x610F;&#x70B9;" class="anchor-navigation-ex-anchor" href="#guid&#x4E3B;&#x952E;&#x6CE8;&#x610F;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>GUID&#x4E3B;&#x952E;&#x6CE8;&#x610F;&#x70B9;</code></h3>
<p><img src="EF Core.assets/image-20211203090341344.png" alt="image-20211203090341344"></p>
<h3 id="&#x5982;&#x4F55;&#x9009;&#x62E9;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x548C;&#x5355;&#x5411;&#x5BFC;&#x822A;"><a name="&#x5982;&#x4F55;&#x9009;&#x62E9;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x548C;&#x5355;&#x5411;&#x5BFC;&#x822A;" class="anchor-navigation-ex-anchor" href="#&#x5982;&#x4F55;&#x9009;&#x62E9;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x548C;&#x5355;&#x5411;&#x5BFC;&#x822A;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x5982;&#x4F55;&#x9009;&#x62E9;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x548C;&#x5355;&#x5411;&#x5BFC;&#x822A;</code></h3>
<p>&#x5982;&#x679C;&#x4E00;&#x5F20;&#x57FA;&#x7840;&#x8868;(&#x5982;T_User)&#x88AB;&#x591A;&#x6B21;&#x5F15;&#x7528;, &#x5219;&#x53EF;&#x4EE5;&#x53EA;&#x5728;&#x591A;&#x7AEF;&#x914D;&#x7F6E;&#x5F15;&#x7528;&#x5BFC;&#x822A;, &#x5728;&#x4E00;&#x7AEF;&#x4E0D;&#x7528;&#x914D;&#x7F6E;&#x5217;&#x8868;&#x5BFC;&#x822A;, &#x5426;&#x5219;&#x4E00;&#x7AEF;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x7684;&#x5217;&#x8868;&#x5BFC;&#x822A;.</p>
<p>&#x5176;&#x4ED6;&#x5F62;&#x5982;&#x8BA2;&#x5355;&#x4E3B;&#x8868;, &#x8BA2;&#x5355;&#x4ECE;&#x8868;&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;, &#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x53CC;&#x5411;&#x5BFC;&#x822A;.</p>
<h3 id="&#x914D;&#x7F6E;1n&#x7684;&#x5957;&#x8DEF;"><a name="&#x914D;&#x7F6E;1n&#x7684;&#x5957;&#x8DEF;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;1n&#x7684;&#x5957;&#x8DEF;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x914D;&#x7F6E;1:N&#x7684;&#x5957;&#x8DEF;</code></h3>
<p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x540E;&#x7EED;&#x5C06;&#x53CC;&#x5411;&#x5BFC;&#x822A;&#x6539;&#x6210;&#x5355;&#x5411;&#x5BFC;&#x822A;, &#x8BF7;&#x5728;&#x5728;&#x591A;&#x7AEF;&#x914D;&#x7F6E; <code>HasOne().WithMany()</code>.</p>
<h3 id="iqueryable&#x77E5;&#x8BC6;&#x70B9;"><a name="iqueryable&#x77E5;&#x8BC6;&#x70B9;" class="anchor-navigation-ex-anchor" href="#iqueryable&#x77E5;&#x8BC6;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>IQueryable&#x77E5;&#x8BC6;&#x70B9;</code></h3>
<p><img src="EF Core.assets/image-20211203091257818.png" alt="image-20211203091257818"></p>
<h3 id="&#x53EF;&#x4EE5;&#x901A;&#x8FC7;iqueryabletoquerystring&#x83B7;&#x53D6;sql"><a name="&#x53EF;&#x4EE5;&#x901A;&#x8FC7;iqueryabletoquerystring&#x83B7;&#x53D6;sql" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x4EE5;&#x901A;&#x8FC7;iqueryabletoquerystring&#x83B7;&#x53D6;sql"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;IQueryable.ToQueryString()&#x83B7;&#x53D6;SQL</code></h3>
<pre class="language-"><code class="lang-C#">var query = EFDbContext.Authors.OrderBy(a =&gt; a.Name).Take(2).Select(a =&gt; new
    {
        Name = EF.Functions.SQLServerStuff(a.Name, 1, 4, &quot;dylan&quot;),
        a.Code
    });
var sql = query.ToQueryString();
var resultList = await query.ToListAsync();
</code></pre>
<h3 id="&#x4E0D;&#x8981;&#x5728;onmodelcreating&#x914D;&#x7F6E;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;-&#x5C06;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;"><a name="&#x4E0D;&#x8981;&#x5728;onmodelcreating&#x914D;&#x7F6E;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;-&#x5C06;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#&#x4E0D;&#x8981;&#x5728;onmodelcreating&#x914D;&#x7F6E;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;-&#x5C06;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x4E0D;&#x8981;&#x5728;OnModelCreating&#x914D;&#x7F6E;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;, &#x5C06;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x72EC;&#x7ACB;&#x6210;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</code></h3>
<pre class="language-"><code class="lang-C#">//&#x72EC;&#x7ACB;&#x5B9E;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// AuthorConfig
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class AuthorConfig : IEntityTypeConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Author</span><span class="token punctuation">&gt;</span></span>
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// Configure
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilderEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Author</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
    {
        modelBuilderEntity.ToTable(&quot;T_Author&quot;).HasComment(&quot;&#x535A;&#x4E3B;&#x8868;&quot;);//.HasKey(t =&gt; t.Id);
        modelBuilderEntity.HasIndex(t =&gt; t.Name).IsUnique(unique: true);
        modelBuilderEntity.HasIndex(t =&gt; t.Email);

        modelBuilderEntity.Property(t =&gt; t.Name).HasColumnType(&quot;nvarchar(80)&quot;).HasComment(&quot;&#x535A;&#x4E3B;&#x6635;&#x79F0;&quot;).IsRequired(required: true);
        modelBuilderEntity.Property(t =&gt; t.Code).HasColumnType(&quot;bigint&quot;).HasMaxLength(80).HasComment(&quot;&#x535A;&#x4E3B;&#x4EE3;&#x53F7;&quot;).IsRequired(required: true);
        modelBuilderEntity.Property(t =&gt; t.BirthDate).HasColumnType(&quot;datetimeoffset(7)&quot;).HasComment(&quot;&#x51FA;&#x751F;&#x65E5;&#x671F;&quot;);
        modelBuilderEntity.Property(t =&gt; t.Email).HasColumnType(&quot;varchar(100)&quot;).HasComment(&quot;&#x90AE;&#x7BB1;&#x5730;&#x5740;&quot;);
        modelBuilderEntity.Property(t =&gt; t.Tel).HasColumnType(&quot;varchar(50)&quot;).HasComment(&quot;&#x624B;&#x673A;&#x53F7;&quot;);
        modelBuilderEntity.Property(t =&gt; t.CompanyName).HasColumnType(&quot;nvarchar(80)&quot;).HasComment(&quot;&#x516C;&#x53F8;&quot;);
        modelBuilderEntity.Property(t =&gt; t.Title).HasColumnType(&quot;nvarchar(50)&quot;).HasComment(&quot;&#x804C;&#x4F4D;&quot;);

        modelBuilderEntity.Property(t =&gt; t.Hometown).HasColumnType(&quot;nvarchar(200)&quot;).HasComment(&quot;&#x5BB6;&#x4E61;&quot;);
        modelBuilderEntity.Property(t =&gt; t.Address).HasColumnType(&quot;nvarchar(200)&quot;).HasComment(&quot;&#x5BB6;&#x5EAD;&#x4F4F;&#x5740;&quot;);

        modelBuilderEntity.Property(t =&gt; t.IsDeleted).HasColumnType(&quot;bit&quot;).HasComment(&quot;&#x662F;&#x5426;&#x88AB;&#x5220;&#x9664;&quot;).HasDefaultValue(false).IsRequired(required: true);
        modelBuilderEntity.HasQueryFilter(t =&gt; !t.IsDeleted); //&#x914D;&#x7F6E;&#x5047;&#x5220;&#x9664;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;
    }
}

//dbcontext&#x7684;OnModelCreating&#x914D;&#x7F6E;&#x5982;&#x4E0B;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5B9E;&#x4F53;&#x914D;&#x7F6E;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    base.OnModelCreating(modelBuilder);

    //&#x8BBE;&#x7F6E;&#x4E0A;&#x9650;&#x6587;&#x9ED8;&#x8BA4;&#x67B6;&#x6784;
    if (!string.IsNullOrEmpty(Schema))
    {
        modelBuilder.HasDefaultSchema(Schema);
    }

    //&#x4ECE;&#x7A0B;&#x5E8F;&#x96C6;&#x4E2D;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;
    modelBuilder.ApplyConfigurationsFromAssembly(typeof(BaseLogicEntity).Assembly);
}
</code></pre>
<h3 id="nn&#x7684;&#x4E24;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;"><a name="nn&#x7684;&#x4E24;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#nn&#x7684;&#x4E24;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>N:N&#x7684;&#x4E24;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;</code></h3>
<p>I&gt;&#x4F7F;&#x7528;&#x4E2D;&#x95F4;&#x5B9E;&#x4F53;&#x5173;&#x8054;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;</p>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5E16;&#x5B50;&#x8868;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class Post : BaseLogicEntity
{
    public Post() 
    {

    }

    public virtual string Title { get; set; }
    public virtual string Content { get; set; }
    public virtual DateTimeOffset? ReleaseTime { get; set; }
    public virtual EnumPostStatus PostStatus { get; set; } = EnumPostStatus.Draft;
    public virtual bool? IsDelete { get; set; } = false;
    public virtual Guid BlogId { get; set; }
    public virtual Blog Blog { get; set; }
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5E16;&#x5B50;&#x6807;&#x7B7E;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class Tag: BaseLogicEntity
{
    public Tag() 
    {

    }

    public virtual Guid AuthorId { get; set; }
    public virtual Author Author { get; set; }
    public virtual string Name { get; set; }
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5E16;&#x5B50;&#x6807;&#x7B7E;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class PostTags : BaseLogicEntity
{
    public PostTags()
    {

    }

    public virtual Guid PostId { get; set; }
    public virtual Guid TagId { get; set; }
    public virtual Post Post { get; set; }
    public virtual Tag Tag { get; set; }
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// Configure
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilderEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
{
    modelBuilderEntity.ToTable(&quot;T_Post&quot;).HasComment(&quot;&#x5E16;&#x5B50;&#x8868;&quot;);
    modelBuilderEntity.HasIndex(t =&gt; new { t.Title, t.ReleaseTime });

    modelBuilderEntity.Property(t =&gt; t.Title).HasColumnType(&quot;nvarchar(100)&quot;).HasComment(&quot;&#x6807;&#x9898;&quot;).IsRequired(required: true);
    modelBuilderEntity.Property(t =&gt; t.Content).HasColumnType(&quot;nvarchar(max)&quot;).HasComment(&quot;&#x5185;&#x5BB9;&quot;);
    modelBuilderEntity.Property(t =&gt; t.ReleaseTime).HasColumnType(&quot;datetimeoffset(7)&quot;).HasComment(&quot;&#x53D1;&#x5E03;&#x65F6;&#x95F4;&quot;);
    modelBuilderEntity.Property(t =&gt; t.PostStatus).HasColumnType(&quot;int&quot;).HasMaxLength(5).HasComment(&quot;&#x5E16;&#x5B50;&#x72B6;&#x6001;&quot;).IsRequired(required: true);
    modelBuilderEntity.Property(t =&gt; t.IsDelete).HasColumnType(&quot;bit&quot;).HasComment(&quot;&#x662F;&#x5426;&#x5220;&#x9664;(&#x7F6E;&#x4E8E;&#x56DE;&#x6536;&#x7AD9;)&quot;).IsRequired(required: true);

    modelBuilderEntity.Property(t =&gt; t.BlogId).HasComment(&quot;&#x535A;&#x5BA2;Id&quot;);

    modelBuilderEntity.HasQueryFilter(t =&gt; !t.Blog.Author.IsDeleted);

    //&#x914D;&#x7F6E;Blog:Post(1:N)
    modelBuilderEntity
        .HasOne(t =&gt; t.Blog)
        .WithMany(t =&gt; t.Posts)
        .HasForeignKey(t =&gt; t.BlogId).IsRequired()
        .OnDelete(DeleteBehavior.Cascade);
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// Configure
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilderEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Tag</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
{
    modelBuilderEntity.ToTable(&quot;T_Tag&quot;).HasComment(&quot;&#x5E16;&#x5B50;&#x6807;&#x7B7E;&quot;);
    modelBuilderEntity.HasIndex(t =&gt; new { t.Name, t.AuthorId }).IsUnique(unique: true);

    modelBuilderEntity.Property(t =&gt; t.Name).HasColumnType(&quot;nvarchar(80)&quot;).HasComment(&quot;&#x540D;&#x79F0;&quot;).IsRequired(required: true);
    modelBuilderEntity.Property(t =&gt; t.AuthorId).HasComment(&quot;&#x535A;&#x4E3B;Id&quot;);

    modelBuilderEntity.HasQueryFilter(t =&gt; !t.Author.IsDeleted);

    modelBuilderEntity
        .HasOne(t =&gt; t.Author)
        .WithMany()
        .HasForeignKey(t =&gt; t.AuthorId).IsRequired()
        .OnDelete(DeleteBehavior.NoAction);
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// Configure
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>builder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PostTags</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
{
    modelBuilderEntity.ToTable(&quot;T_PostTags&quot;).HasComment(&quot;&#x5E16;&#x5B50;&#x6807;&#x7B7E;&quot;).Ignore(t =&gt; t.Token);
    modelBuilderEntity.HasIndex(t =&gt; new { t.PostId, t.TagId }).IsUnique(unique: true);

    modelBuilderEntity.Property(t =&gt; t.PostId).HasComment(&quot;&#x5E16;&#x5B50;Id&quot;);
    modelBuilderEntity.Property(t =&gt; t.TagId).HasComment(&quot;&#x6807;&#x7B7E;Id&quot;);

    modelBuilderEntity.HasQueryFilter(t =&gt; !t.Post.Blog.Author.IsDeleted);
    modelBuilderEntity.HasQueryFilter(t =&gt; !t.Tag.Author.IsDeleted);

    modelBuilderEntity
        .HasOne(t =&gt; t.Post)
        .WithMany()
        .HasForeignKey(t =&gt; t.PostId).IsRequired(required: true)
        .OnDelete(DeleteBehavior.Cascade);

    modelBuilderEntity
        .HasOne(t =&gt; t.Tag)
        .WithMany()
        .HasForeignKey(t =&gt; t.TagId).IsRequired(required: true)
        .OnDelete(DeleteBehavior.Cascade);
}
</code></pre>
<p>II&gt;&#x4E24;&#x4E2A;&#x4E3B;&#x8868;&#x5B9E;&#x4F53;&#x6DFB;&#x52A0;&#x5BF9;&#x65B9;&#x7684;List&#x5C5E;&#x6027;, &#x7136;&#x540E;&#x5173;&#x7CFB;&#x914D;&#x7F6E;&#x5728;&#x4EFB;&#x4F55;&#x4E00;&#x7AEF;&#x90FD;&#x53EF;&#x4EE5;</p>
<pre class="language-"><code class="lang-C#">public class Company : BaseLogicEntity
{
    public Company()
    {

    }

    public virtual string Name { get; set; }
    public virtual string Address { get; set; }
    public virtual List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span> Employees { get; set; } = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span>();
}

public class Employee : BaseLogicEntity
{
    public Employee()
    {

    }

    public virtual string FullName { get; set; }

    public virtual string FamilyName { get; set; }

    public virtual string GivenName { get; set; }
    public virtual string Code { get; set; }

    public virtual List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span> Companies { get; set; } = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span>();
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// CompanyConfig
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class CompanyConfig : IEntityTypeConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span>
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// Configure
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilderEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
    {
        modelBuilderEntity.ToTable(&quot;T_Company&quot;).HasComment(&quot;&#x516C;&#x53F8;&#x8868;&quot;);
        modelBuilderEntity.HasIndex(t =&gt; t.Name).IsUnique(unique: true);

        modelBuilderEntity.Property(t =&gt; t.Name).HasColumnType(&quot;nvarchar(100)&quot;).HasComment(&quot;&#x540D;&#x79F0;&quot;).IsRequired(required: true);
        modelBuilderEntity.Property(t =&gt; t.Address).HasColumnType(&quot;nvarchar(200)&quot;).HasComment(&quot;&#x5730;&#x5740;&quot;).IsRequired(required: false);
    }
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// EmployeeConfig
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class EmployeeConfig : IEntityTypeConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span>
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// Configure
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilderEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
    {
        modelBuilderEntity.ToTable(&quot;T_Employee&quot;).HasComment(&quot;&#x5458;&#x5DE5;&#x8868;&quot;);
        modelBuilderEntity.HasIndex(t =&gt; t.Code).IsUnique(unique: true);

        modelBuilderEntity.Property(t =&gt; t.FamilyName).HasColumnType(&quot;nvarchar(50)&quot;).HasComment(&quot;&#x59D3;&quot;).IsRequired(required: true);
        modelBuilderEntity.Property(t =&gt; t.GivenName).HasColumnType(&quot;nvarchar(50)&quot;).HasComment(&quot;&#x540D;&quot;).IsRequired(required: true);
        modelBuilderEntity.Property(t =&gt; t.FullName).HasComputedColumnSql(&quot;[FamilyName] + &apos; &apos; + [GivenName]&quot;, stored: false);
        modelBuilderEntity.Property(t =&gt; t.Code).HasColumnType(&quot;nvarchar(30)&quot;).HasComment(&quot;&#x7F16;&#x53F7;&quot;).IsRequired(required: true);

        modelBuilderEntity.HasMany(t =&gt; t.Companies).WithMany(t =&gt; t.Employees).UsingEntity(j =&gt; j.ToTable(&quot;T_CompanyEmployees&quot;));
    }
}
</code></pre>
<h3 id="&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;1n"><a name="&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;1n" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;1n"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;(1:N)</code></h3>
<pre class="language-"><code class="lang-C#">public class Company : BaseLogicEntity
{
    public Company()
    {

    }

    public virtual string Name { get; set; }
    public virtual string Address { get; set; }

    #region //&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;

    //public virtual string ParentId{get;set;}
    public virtual long? ParentId { get; set; }
    public virtual Company Parent { get; set; }
    public virtual List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span> Children { get; set; } 

    #endregion

    public virtual List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span> Employees { get; set; } = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span>();
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// CompanyConfig
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
public class CompanyConfig : IEntityTypeConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span>
{
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// Configure
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    /// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modelBuilderEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
    public void Configure(EntityTypeBuilder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Company</span><span class="token punctuation">&gt;</span></span> modelBuilderEntity)
    {
        modelBuilderEntity.ToTable(&quot;T_Company&quot;).HasComment(&quot;&#x516C;&#x53F8;&#x8868;&quot;);
        modelBuilderEntity.HasIndex(t =&gt; t.Name).IsUnique(unique: true);

        modelBuilderEntity.Property(t =&gt; t.Name).HasColumnType(&quot;nvarchar(100)&quot;).HasComment(&quot;&#x540D;&#x79F0;&quot;).IsRequired(required: true);
        modelBuilderEntity.Property(t =&gt; t.Address).HasColumnType(&quot;nvarchar(200)&quot;).HasComment(&quot;&#x5730;&#x5740;&quot;).IsRequired(required: false);


        #region &#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;

        //modelBuilderEntity.Property(t =&gt; t.ParentId).HasColumnType(&quot;varchar(50)&quot;).IsRequired(required: false);
        modelBuilderEntity.Property(t =&gt; t.ParentId).HasColumnType(&quot;bigint&quot;).IsRequired(required: false);
        modelBuilderEntity.HasOne(t =&gt; t.Parent).WithMany(t =&gt; t.Children).HasForeignKey(t =&gt; t.ParentId).OnDelete(DeleteBehavior.NoAction);

        #endregion
    }
}
</code></pre>
<h3 id="11-1n&#x81EA;&#x5F15;&#x7528;-nn-&#x7684;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;-&#x6700;&#x7A33;&#x59A5;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F53;&#x90FD;&#x52A0;&#x5230;dbcontextxxxadd-&#x4E0D;&#x8FC7;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7AEF;-&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5173;&#x8054;&#x5230;&#x4E00;&#x8D77;&#x540E;-&#x518D;add&#x5230;&#x4E00;&#x7AEF;-ef&#x4E5F;&#x4F1A;&#x5C06;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5176;&#x4ED6;&#x5B9E;&#x4F53;&#x4E00;&#x8D77;insert&#x5230;data-base"><a name="11-1n&#x81EA;&#x5F15;&#x7528;-nn-&#x7684;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;-&#x6700;&#x7A33;&#x59A5;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F53;&#x90FD;&#x52A0;&#x5230;dbcontextxxxadd-&#x4E0D;&#x8FC7;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7AEF;-&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5173;&#x8054;&#x5230;&#x4E00;&#x8D77;&#x540E;-&#x518D;add&#x5230;&#x4E00;&#x7AEF;-ef&#x4E5F;&#x4F1A;&#x5C06;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5176;&#x4ED6;&#x5B9E;&#x4F53;&#x4E00;&#x8D77;insert&#x5230;data-base" class="anchor-navigation-ex-anchor" href="#11-1n&#x81EA;&#x5F15;&#x7528;-nn-&#x7684;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;-&#x6700;&#x7A33;&#x59A5;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F53;&#x90FD;&#x52A0;&#x5230;dbcontextxxxadd-&#x4E0D;&#x8FC7;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7AEF;-&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5173;&#x8054;&#x5230;&#x4E00;&#x8D77;&#x540E;-&#x518D;add&#x5230;&#x4E00;&#x7AEF;-ef&#x4E5F;&#x4F1A;&#x5C06;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5176;&#x4ED6;&#x5B9E;&#x4F53;&#x4E00;&#x8D77;insert&#x5230;data-base"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>1:1, 1:N(&#x81EA;&#x5F15;&#x7528;), N:N &#x7684;&#x4FDD;&#x5B58;&#x52A8;&#x4F5C;, &#x6700;&#x7A33;&#x59A5;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F53;&#x90FD;&#x52A0;&#x5230;DbContext.XXX.Add(), &#x4E0D;&#x8FC7;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7AEF;, &#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5173;&#x8054;&#x5230;&#x4E00;&#x8D77;&#x540E;, &#x518D;Add&#x5230;&#x4E00;&#x7AEF;, EF&#x4E5F;&#x4F1A;&#x5C06;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5176;&#x4ED6;&#x5B9E;&#x4F53;&#x4E00;&#x8D77;insert&#x5230;data base.</code></h3>
<pre class="language-"><code class="lang-C#">var node1 = await EFDbContext.Companies.FirstOrDefaultAsync(c =&gt; c.Name == &quot;&#x4E2D;&#x673A;&#x79DF;&#x6295;&#x8D44;&#x54A8;&#x8BE2;&#x6709;&#x9650;&#x516C;&#x53F8;&quot;);
if (node1 == null)
{
    node1 ??= new Company
    {
        Name = &quot;&#x4E2D;&#x673A;&#x79DF;&#x6295;&#x8D44;&#x54A8;&#x8BE2;&#x6709;&#x9650;&#x516C;&#x53F8;&quot;,
        Address = &quot;&#x6DF1;&#x5733;&quot;
    };
}

var rootNode = new Company
{
    Name = &quot;&#x4E2D;&#x56FD;&#x98DE;&#x673A;&#x79DF;&#x8D41;&quot;,
    Address = &quot;&#x9999;&#x6E2F;&quot;,
};

var node2 = new Company
{
    Name = &quot;ARI&quot;,
    Address = &quot;&#x5929;&#x6D25;&quot;,
};

var node3 = new Company
{
    Name = &quot;&#x4E2D;&#x9F99;&#x98DE;&#x673A;&#x62C6;&#x89E3;&quot;,
    Address = &quot;&#x54C8;&#x5C14;&#x6EE8;&quot;,
    Employees = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span>
    {
        new Employee
        {
            FamilyName = &quot;Martin&quot;,
            GivenName = &quot;Qin&quot;,
            Code = &quot;5&quot;
        },
        new Employee
        {
            FamilyName = &quot;Amy&quot;,
            GivenName = &quot;Song&quot;,
            Code = &quot;6&quot;
        },
    }
};

//&#x53EA;&#x4FDD;&#x5B58;&#x6839;&#x8282;&#x70B9;, EF&#x4F1A;&#x81EA;&#x52A8;&#x89E3;&#x6790;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x5B9E;&#x4F53;
rootNode.Children.AddRange(new Company[] { node1, node2, node3 });
await EFDbContext.Companies.AddAsync(rootNode, cancellationToken);
var result = await EFDbContext.SaveChangesAsync(cancellationToken);
</code></pre>
<h3 id="&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;"><a name="&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;" class="anchor-navigation-ex-anchor" href="#&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;</code></h3>
<p><code>Detached(&#x5DF2;&#x5206;&#x79BB;)</code>: DbContext&#x672A;&#x8DDF;&#x8E2A;&#x8BE5;&#x5B9E;&#x4F53;.</p>
<p><code>Added(&#x5DF2;&#x6DFB;&#x52A0;)</code>: DbContext&#x6B63;&#x5728;&#x8FFD;&#x8E2A;&#x6B64;&#x5B9E;&#x4F53;, &#x4F46;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5C1A;&#x672A;&#x5B58;&#x5728;&#x8BE5;&#x5B9E;&#x4F53;.</p>
<p><code>Unchanged(&#x672A;&#x6539;&#x53D8;):</code> DbContext&#x6B63;&#x5728;&#x8DDF;&#x8E2A;&#x8BE5;&#x5B9E;&#x4F53;, &#x8BE5;&#x5B9E;&#x4F53;&#x5B58;&#x5728;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x4E2D;, &#x5176;&#x5C5E;&#x6027;&#x503C;&#x548C;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8BFB;&#x53D6;&#x5230;&#x7684;&#x503C;&#x4E00;&#x81F4;, &#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;.</p>
<p><code>Modified(&#x5DF2;&#x4FEE;&#x6539;)</code>: DbContext&#x6B63;&#x5728;&#x8DDF;&#x8E2A;&#x8BE5;&#x5B9E;&#x4F53;, &#x8BE5;&#x5B9E;&#x4F53;&#x5B58;&#x5728;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x4E2D;, &#x5E76;&#x4E14;&#x5176;&#x90E8;&#x5206;&#x6216;&#x5168;&#x90E8;&#x5C5E;&#x6027;&#x503C;&#x5DF2;&#x4FEE;&#x6539;.</p>
<p><code>Deleted(&#x5DF2;&#x5220;&#x9664;)</code>: DbContext&#x6B63;&#x5728;&#x8DDF;&#x8E2A;&#x8BE5;&#x5B9E;&#x4F53;, &#x8BE5;&#x5B9E;&#x4F53;&#x5B58;&#x5728;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x4E2D;,, &#x4F46;&#x5728;&#x4E0B;&#x6B21;&#x8C03;&#x7528;SaveChanges&#x65F6;&#x8981;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x6570;&#x636E;.</p>
<pre class="language-"><code class="lang-C#">var company = new Company
{
    Name = &quot;&#x4E2D;&#x673A;&#x79DF;&#x6295;&#x8D44;&#x54A8;&#x8BE2;&#x6709;&#x9650;&#x516C;&#x53F8;&quot;,
    Address = &quot;&#x6DF1;&#x5733;&quot;,
};

var employees = new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span><span class="token punctuation">&gt;</span></span>
{
    new Employee
    {
        FamilyName = &quot;&#x8BB8;&quot;,
        GivenName = &quot;&#x5C11;&#x5CF0;&quot;,
        Code = &quot;1&quot;
    },
    new Employee
    {
        FamilyName = &quot;&#x5434;&quot;,
        GivenName = &quot;&#x5F6A;&quot;,
        Code = &quot;2&quot;
    },
    new Employee
    {
        FamilyName = &quot;&#x6210;&quot;,
        GivenName = &quot;&#x5E9A;&#x80FD;&quot;,
        Code = &quot;3&quot;
    },
    new Employee
    {
        FamilyName = &quot;&#x962E;&quot;,
        GivenName = &quot;&#x6BC5;&#x6587;&quot;,
        Code = &quot;4&quot;
    },
};

company.Employees = employees;

//add&#x5230;&#x4E0A;&#x4E0B;&#x6587;&#x524D;&#x67E5;&#x770B;&#x72B6;&#x6001; - detached
var entry = EFDbContext.Entry(company);
var state = entry.State;
var longView = entry.DebugView.LongView;

EFDbContext.Companies.Add(company);

//add&#x5230;&#x4E0A;&#x4E0B;&#x6587;&#x540E;&#x67E5;&#x770B;&#x72B6;&#x6001; - added
state = entry.State;
longView = entry.DebugView.LongView;

var result = await EFDbContext.SaveChangesAsync(cancellationToken);

//save&#x5230;database&#x540E;&#x67E5;&#x770B;&#x72B6;&#x6001; - unchanged
state = entry.State;
longView = entry.DebugView.LongView;
</code></pre>
<h3 id="&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x67E5;&#x8BE2;-&#x76F4;&#x63A5;&#x5220;&#x9664;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x6CD5;"><a name="&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x67E5;&#x8BE2;-&#x76F4;&#x63A5;&#x5220;&#x9664;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x67E5;&#x8BE2;-&#x76F4;&#x63A5;&#x5220;&#x9664;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x67E5;&#x8BE2;, &#x76F4;&#x63A5;&#x5220;&#x9664;/&#x4FEE;&#x6539;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x6CD5;</code></h3>
<p>EF&#x5E38;&#x89C4;&#x7684;&#x66F4;&#x65B0;/&#x5220;&#x9664;&#x64CD;&#x4F5C;, &#x90FD;&#x9700;&#x8981;&#x5148;&#x67E5;&#x8BE2;&#x5B9E;&#x4F53;&#x540E;, &#x518D;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x52A8;&#x4F5C;, &#x4E0B;&#x9762;&#x6F14;&#x793A;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;&#x67E5;&#x8BE2;&#x7684;&#x65B9;&#x6CD5;(&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x5982;&#x975E;&#x5FC5;&#x8981;, &#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;, &#x4E0D;&#x7136;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F53;&#x72B6;&#x6001;&#x8DDF;&#x8E2A;&#x7D0A;&#x4E71;).</p>
<p>PS: &#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x5E76;&#x53D1;&#x4EE4;&#x724C;, &#x5219;&#x8FD9;&#x4E2A;&#x65B9;&#x5F0F;&#x5C31;&#x66F4;&#x4E0D;&#x9002;&#x7528;&#x4E86;.</p>
<pre class="language-"><code class="lang-C#">/*
//&#x5E38;&#x89C4;&#x4FEE;&#x6539;&#x65B9;&#x5F0F;
//var rootCompany = await EFDbContext.Companies.Include(c =&gt; c.Children).FirstOrDefaultAsync(c =&gt; c.Parent == null);
//rootCompany.Name += &quot;&#x96C6;&#x56E2;&quot;;

//var result = await EFDbContext.SaveChangesAsync(cancellationToken);
*/

//&#x53E6;&#x7C7B;&#x4FEE;&#x6539;&#x65B9;&#x5F0F; (&#x56E0;&#x4E3A;&#x5B9E;&#x4F53;&#x4F7F;&#x7528;&#x4E86;&#x5E76;&#x53D1;&#x4EE4;&#x724C;, &#x6240;&#x4EE5;&#x624B;&#x52A8;&#x8D4B;&#x503C;Token, &#x6B63;&#x5E38;&#x9700;&#x6C42;&#x4E0D;&#x4F1A;&#x8FD9;&#x4E48;&#x641E;&#x7684;)
var rootNode = new Company
{
    Id = 1467677806254231552,
    Name = &quot;&#x4E2D;&#x56FD;&#x98DE;&#x673A;&#x79DF;&#x8D41; ltd&quot;,
    Address = &quot;HK&quot;,
    Token = new byte[8] { 0, 0, 0, 0, 0, 1, 195, 199 }
};

//&#x66F4;&#x65B0;&#x6240;&#x6709;&#x5B57;&#x6BB5;(&#x9664;&#x4E86;&#x5BFC;&#x822A;&#x5C5E;&#x6027;, &#x5E76;&#x53D1;&#x4EE4;&#x724C;&#x7B49;)
var entry = EFDbContext.Entry(rootNode);
entry.State = EntityState.Modified;
_ = entry.DebugView.LongView;

//&#x67E5;&#x770B;&#x751F;&#x6210;&#x7684;SQL&#x4F1A;&#x53D1;&#x73B0;, EF Core&#x53EA;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x6761;update&#x7684;SQL&#x8BED;&#x53E5;
var result = await EFDbContext.SaveChangesAsync();

//&#x8FD8;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4FEE;&#x6539;&#x7684;&#x5217;
var entry = EFDbContext.Entry(rootNode);
entry.Property(&quot;Name&quot;).IsModified = true;
entry.Property(&quot;Address&quot;).IsModified = true;
var result = await EFDbContext.SaveChangesAsync();
</code></pre>
<pre class="language-"><code class="lang-C#">/*
//&#x5E38;&#x89C4;&#x5220;&#x9664;&#x65B9;&#x5F0F;
var node = await EFDbContext.Companies
    .Include(c =&gt; c.Parent)
    .Include(c =&gt; c.Children)
    .FirstOrDefaultAsync(c =&gt; c.Name == &quot;&#x4E2D;&#x9F99;&#x98DE;&#x673A;&#x62C6;&#x89E3;&quot;);
EFDbContext.Companies.Remove(node);
var result = await EFDbContext.SaveChangesAsync(cancellationToken);
*/

//&#x53E6;&#x7C7B;&#x5220;&#x9664;&#x65B9;&#x5F0F;
var rootNode = new Company
{
    Id = 1467677806254231552,
    Name = &quot;&#x4E2D;&#x56FD;&#x98DE;&#x673A;&#x79DF;&#x8D41; ltd&quot;,
    Address = &quot;HK&quot;,
    Token = new byte[8] { 0, 0, 0, 0, 0, 1, 195, 200 }
};

//&#x53EA;&#x751F;&#x6210;Delete&#x8BED;&#x53E5;
var entry = EFDbContext.Entry(rootNode);
entry.State = EntityState.Deleted;
_ = entry.DebugView.LongView;

var result = await EFDbContext.SaveChangesAsync();
</code></pre>
<h3 id="iqueryable&#x53EF;&#x4EE5;&#x53E0;&#x52A0;&#x590D;&#x7528;"><a name="iqueryable&#x53EF;&#x4EE5;&#x53E0;&#x52A0;&#x590D;&#x7528;" class="anchor-navigation-ex-anchor" href="#iqueryable&#x53EF;&#x4EE5;&#x53E0;&#x52A0;&#x590D;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>IQueryable&#x53EF;&#x4EE5;&#x53E0;&#x52A0;&#x590D;&#x7528;</code></h3>
<p>&#x8FD9;&#x4E2A;&#x7279;&#x70B9;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8BBE;&#x7F6E;&#x6839;&#x67E5;&#x8BE2;&#x540E;, &#x6839;&#x636E;&#x5916;&#x90E8;&#x4F20;&#x5165;&#x7684;&#x4E0D;&#x540C;&#x53C2;&#x6570;, &#x53EF;&#x4EE5;&#x6784;&#x9020;&#x4E0D;&#x540C;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;.</p>
<pre class="language-"><code class="lang-C#">var query = EFDbContext.Companies.Where(c =&gt; !string.IsNullOrEmpty(c.Name));
var query2 = query.Where(c =&gt; c.Id &gt; 1467750884044838340);
var list = await query2.ToListAsync(cancellationToken);
</code></pre>
<h3 id="iqueryable&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;datareader&#x8BFB;&#x53D6;&#x6570;&#x636E;"><a name="iqueryable&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;datareader&#x8BFB;&#x53D6;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#iqueryable&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;datareader&#x8BFB;&#x53D6;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>IQueryable&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;DataReader&#x8BFB;&#x53D6;&#x6570;&#x636E;</code></h3>
<p>&#x4F18;&#x70B9;: &#x8282;&#x7701;&#x5BA2;&#x6237;&#x7AEF;&#x5185;&#x5B58;.</p>
<p>&#x7F3A;&#x70B9;: &#x5982;&#x679C;&#x6BCF;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x6BD4;&#x8F83;&#x957F;, &#x4F1A;&#x957F;&#x65F6;&#x95F4;&#x5360;&#x7528;&#x94FE;&#x63A5;.</p>
<p>*<code>IQueryable&#x7684;ToArray(), ToList()&#x7B49; &#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;.</code></p>
<h3 id="&#x4F55;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;"><a name="&#x4F55;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;" class="anchor-navigation-ex-anchor" href="#&#x4F55;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x4F55;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;</code></h3>
<ul>
<li><p>&#x904D;&#x5386;IQueryable&#x5E76;&#x4E14;&#x6BCF;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x6BD4;&#x8F83;&#x957F;;</p>
</li>
<li><p>&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x6267;&#x884C;&#x7ED3;&#x679C;, &#x5E76;&#x4E14;&#x5728;&#x65B9;&#x6CD5;&#x91CC;&#x9500;&#x6BC1;&#x4E86;dbcontext, &#x9700;&#x8981;&#x4E00;&#x6B21;&#x6027;&#x52A0;&#x8F7D;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;;</p>
</li>
<li><p>&#x591A;&#x4E2A;IQueryable&#x7684;&#x5D4C;&#x5957;&#x4F7F;&#x7528;, &#x5B9E;&#x8D28;&#x662F;&#x591A;&#x4E2A;DataReader&#x540C;&#x65F6;&#x6267;&#x884C;, &#x5F88;&#x591A;&#x6570;&#x636E;&#x5E93;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;, &#x53EA;&#x6709;SQL&#x652F;&#x6301;(&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#x52A0;&#x5165; MultipleActiveResultSets=true);</p>
</li>
</ul>
<h3 id="&#x52A8;&#x6001;&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;add&#x6216;&#x8005;update"><a name="&#x52A8;&#x6001;&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;add&#x6216;&#x8005;update" class="anchor-navigation-ex-anchor" href="#&#x52A8;&#x6001;&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;add&#x6216;&#x8005;update"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x52A8;&#x6001;&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;Add&#x6216;&#x8005;Update</code></h3>
<pre class="language-"><code class="lang-C#">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5224;&#x65AD;&#x5F53;&#x524D;&#x5B9E;&#x4F53;&#x6267;&#x884C;add&#x6216;&#x8005;update
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// &#x60C5;&#x666F;1: &#x7531;&#x4E00;&#x4E2A;dbcontext&#x67E5;&#x8BE2;&#x7684;&#x5B9E;&#x4F53;, &#x5728;&#x53E6;&#x4E00;&#x4E2A;dbcontext&#x91CC;&#x6267;&#x884C;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;, &#x5C31;&#x9700;&#x8981;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x5224;&#x65AD;, &#x4E0A;&#x4E0B;&#x6587;&#x65E0;&#x6CD5;&#x8DDF;&#x8E2A;
/// &#x60C5;&#x666F;2: &#x6CA1;&#x6709;&#x7528;dbcontext&#x67E5;&#x8BE2;&#x5B9E;&#x4F53;, &#x81EA;&#x5DF1;new&#x51FA;&#x6765;&#x7684;, &#x4E5F;&#x9700;&#x8981;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x5224;&#x65AD;.
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>T<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dbContext<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>obj<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public async Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EntityEntry</span><span class="token punctuation">&gt;</span></span> AddOrUpdateAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span>(T entity, CALCDbContext dbContext, CancellationToken cancellationToken = default)
{
    if (entity == null)
    {
        throw new ArgumentNullException(&quot;entity&quot;);
    }
    if (dbContext == default)
    {
        throw new ArgumentNullException(&quot;dbContext&quot;);
    }

    var entityType = typeof(T);
    var id = FramePublicFun.GetPropertyValue(entity, SysContant.Entity_Property_Id);
    var dbEntity = dbContext.Find(entityType, new object[] { id });
    var isExistInDB = dbEntity != null;

    EntityEntry entityEntry = null;
    if (isExistInDB)
    {
        entityEntry = dbContext.Entry(dbEntity);
        entityEntry.CurrentValues.SetValues(entity);
    }
    else
    {
        entityEntry = await dbContext.AddAsync(entity, cancellationToken);
    }

    return entityEntry;
}
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x5904;&#x7406;&#x4E3B;&#x4ECE;&#x8BB0;&#x5F55;(&#x786C;&#x7F16;&#x7801;)
public static void InsertOrUpdateGraph(BloggingContext context, Blog blog)
{
    var existingBlog = context.Blogs
        .Include(b =&gt; b.Posts)
        .FirstOrDefault(b =&gt; b.BlogId == blog.BlogId);

    if (existingBlog == null)
    {
        context.Add(blog);
    }
    else
    {
        context.Entry(existingBlog).CurrentValues.SetValues(blog);
        foreach (var post in blog.Posts)
        {
            var existingPost = existingBlog.Posts
                .FirstOrDefault(p =&gt; p.PostId == post.PostId);

            if (existingPost == null)
            {
                existingBlog.Posts.Add(post);
            }
            else
            {
                context.Entry(existingPost).CurrentValues.SetValues(post);
            }
        }
    }

    context.SaveChanges();
}
</code></pre>
<pre class="language-"><code class="lang-C#">//&#x975E;&#x786C;&#x7F16;&#x7801;, &#x53EF;&#x662F;&#x529F;&#x80FD;&#x6709;bug
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x6267;&#x884C;add&#x6216;&#x8005;update, &#x7EA7;&#x8054;&#x64CD;&#x4F5C;&#x5217;&#x8868;&#x5BFC;&#x822A;&#x5C5E;&#x6027;. &#x7EA6;&#x5B9A;&#x5B9E;&#x4F53;&#x7EE7;&#x627F;&#x4E8E;BaseLogicEntity, &#x5B9E;&#x4F53;&#x7684;&#x4E3B;&#x952E;&#x7EDF;&#x4E00;&#x4E3A;Id, &#x5217;&#x8868;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#x4E3A;List&lt;&gt;
/// (&#x6B64;&#x529F;&#x80FD;&#x6709;bug, &#x4EE5;&#x540E;&#x518D;&#x4FEE;&#x590D;)
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// &#x60C5;&#x666F;1: &#x7531;&#x4E00;&#x4E2A;dbcontext&#x67E5;&#x8BE2;&#x7684;&#x5B9E;&#x4F53;, &#x5728;&#x53E6;&#x4E00;&#x4E2A;dbcontext&#x91CC;&#x6267;&#x884C;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;, &#x5C31;&#x9700;&#x8981;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x5224;&#x65AD;, &#x4E0A;&#x4E0B;&#x6587;&#x65E0;&#x6CD5;&#x8DDF;&#x8E2A;
/// &#x60C5;&#x666F;2: &#x6CA1;&#x6709;&#x7528;dbcontext&#x67E5;&#x8BE2;&#x5B9E;&#x4F53;, &#x81EA;&#x5DF1;new&#x51FA;&#x6765;&#x7684;, &#x4E5F;&#x9700;&#x8981;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x5224;&#x65AD;.
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remarks</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5F85;&#x4FDD;&#x5B58;&#x7684;(&#x4E3B;&#x8868;)&#x5B9E;&#x4F53;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entityType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>(&#x4E3B;&#x8868;)&#x5B9E;&#x4F53;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dbContext<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>db&#x4E0A;&#x4E0B;&#x6587;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>cancellationToken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isExecuteSaveChanges<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x662F;&#x5426;&#x81EA;&#x52A8;&#x6267;&#x884C;SaveChangesAsync, &#x9ED8;&#x8BA4;true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public async Task AddOrUpdateAsync
(
    object entity, Type entityType, 
    CALCDbContext dbContext, CancellationToken cancellationToken = default,
    bool isExecuteSaveChanges = true
)
{
    if (entity == null)
    {
        throw new ArgumentNullException(&quot;entity&quot;);
    }
    if (dbContext == default)
    {
        throw new ArgumentNullException(&quot;dbContext&quot;);
    }

    //&#x5224;&#x65AD;DB&#x662F;&#x5426;&#x5B58;&#x5728;&#x5F53;&#x524D;&#x5B9E;&#x4F53;
    var id = FramePublicFun.GetPropertyValue(entity, SysContant.Entity_Property_Id);
    var dbEntity = dbContext.Find(entityType, new object[] { id });
    var isExistInDB = dbEntity != null;

    EntityEntry entityEntry = null;
    if (isExistInDB)
    {
        //&#x82E5;&#x5B58;&#x5728;, &#x5219;&#x7528;
        entityEntry = dbContext.Entry(dbEntity);
        entityEntry.CurrentValues.SetValues(entity);
    }
    else
    {
        //&#x82E5;&#x662F;&#x65B0;&#x589E;, &#x5373;&#x4F7F;&#x6709;&#x5217;&#x8868;&#x5BFC;&#x822A;&#x5C5E;&#x6027;&#x4E5F;&#x4E0D;&#x7528;&#x5904;&#x7406;
        entityEntry = await dbContext.AddAsync(entity, cancellationToken);
        //return;
    }

    //&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x5B9E;&#x4F53;&#x6240;&#x6709;&#x5217;&#x8868;&#x5BFC;&#x822A;&#x5C5E;&#x6027;
    //&#x6CDB;&#x578B;, &#x57FA;&#x7C7B;&#x578B;&#x7EE7;&#x627F;&#x4E8E;IEnumerable&lt;&gt;
    //T&#x7C7B;&#x578B;&#x53EA;&#x6709;1&#x4E2A;, &#x4E14;&#x7EE7;&#x627F;&#x4E8E;BaseLogicEntity
    var pType = typeof(IEnumerable&lt;&gt;);
    var baseType = typeof(BaseLogicEntity);
    var navigateProList = (entityType.GetProperties() ?? new PropertyInfo[] { }).Where(p =&gt;
    {
        var proType = p.PropertyType;
        var result = pType.IsAssignableFromGeneric(proType);
        if (!result)
        {
            return false;
        }

        var genericArguments = proType.GetGenericArguments() ?? new Type[] { };
        if (genericArguments.Length != 1)
        {
            return false;
        }

        var tType = genericArguments.Single();
        return baseType.IsAssignableFrom(tType);
    }).ToList() ?? new List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyInfo</span><span class="token punctuation">&gt;</span></span>();

    if (navigateProList.Count &lt;= 0)
    {
        return;
    }

    //&#x5FAA;&#x73AF;&#x5904;&#x7406;&#x5217;&#x8868;&#x5BFC;&#x822A;&#x5C5E;&#x6027;
    foreach (var pro in navigateProList)
    {
        //&#x663E;&#x793A;&#x52A0;&#x8F7D;&#x5BFC;&#x822A;&#x5C5E;&#x6027;
        entityEntry.Collection(pro.Name).Load();
        var subEntitiesInDB = pro.GetValue(entityEntry.Entity, null) as IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamic</span><span class="token punctuation">&gt;</span></span>;
        var subEntitiesInFront = pro.GetValue(entity, null) as IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamic</span><span class="token punctuation">&gt;</span></span>;
        var subEntities = CombineEntities(subEntitiesInFront, subEntitiesInDB);
        foreach (var subEntity in subEntities)
        {
            var subEntityType = subEntity.GetType();
            await AddOrUpdateAsync(subEntity, subEntityType, dbContext, cancellationToken, isExecuteSaveChanges);
        }
    }

    if (isExecuteSaveChanges)
    {
        await dbContext.SaveChangesAsync(cancellationToken);
        //&#x91CD;&#x65B0;&#x8F7D;&#x5165;&#x5F53;&#x524D;&#x5B9E;&#x4F53;&#x7684;db&#x503C;
        await entityEntry.ReloadAsync(cancellationToken);
        //EFDbContext.ChangeTracker.DetectChanges();
    }
}


/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x5408;&#x5E76;&#x524D;&#x540E;&#x7AEF;&#x5B9E;&#x4F53;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>frontEntities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x524D;&#x7AEF;&#x5B9E;&#x4F53;&#x96C6;&#x5408;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dbEntities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>DB&#x5B9E;&#x4F53;&#x96C6;&#x5408;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamic</span><span class="token punctuation">&gt;</span></span> CombineEntities(IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamic</span><span class="token punctuation">&gt;</span></span> frontEntities, IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamic</span><span class="token punctuation">&gt;</span></span> dbEntities)
{
    IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamic</span><span class="token punctuation">&gt;</span></span> entities = null;
    if (frontEntities == default &amp;&amp; dbEntities == default)
    {
        return entities;
    }

    if (frontEntities == default)
    {
        entities = dbEntities;
    }
    else if (dbEntities == default)
    {
        entities = frontEntities;
    }
    else
    {
        //&#x6839;&#x636E;Id&#x5224;&#x65AD;&#x5B9E;&#x4F53;&#x662F;&#x5426;&#x76F8;&#x540C;
        //front&#x6709;, db&#x6CA1;&#x6709;
        var onlyFrontEntities = frontEntities.Where(frontE =&gt; dbEntities.All(dbE =&gt; !dbE.Equals(frontE))).AsEnumerable();
        //db&#x6709;, front&#x6CA1;&#x6709;
        var onlyDbEntities = dbEntities.Where(dbE =&gt; frontEntities.All(frontE =&gt; !frontE.Equals(dbE))).AsEnumerable();
        //front&#x6709;, db&#x4E5F;&#x6709;
        var bothEntities = frontEntities.Where(frontE =&gt; dbEntities.Any(dbE =&gt; dbE.Equals(frontE))).AsEnumerable();

        //&#x5408;&#x5E76;&#x96C6;&#x5408;
        entities = onlyFrontEntities.Union(onlyDbEntities).Union(bothEntities).AsEnumerable();
    }

    return entities;
}
</code></pre>
<h3 id="&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x503C;"><a name="&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x503C;" class="anchor-navigation-ex-anchor" href="#&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a>*<code>&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x503C;</code></h3>
<p>&#x5B9E;&#x73B0;&#x903B;&#x8F91;: &#x5728;&#x7EE7;&#x627F;&#x4E86;DbContext&#x7684;&#x7C7B;&#x4E2D;, &#x91CD;&#x5199;SaveChanges, SaveChangesAsync.</p>
<pre class="language-"><code class="lang-C#">#region &#x91CD;&#x5199;&#x57FA;&#x7C7B;&#x65B9;&#x6CD5;

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// Saves all changes made in this context to the database.
/// This method will automatically call Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges
/// to discover any changes to entity instances before saving to the underlying database.
/// This can be disabled via Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.AutoDetectChangesEnabled.
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span>The number of state entries written to the database.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public override int SaveChanges()
{
    //&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
    SetBaseEntityFields(base.ChangeTracker);
    return base.SaveChanges();
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// Saves all changes made in this context to the database.
/// This method will automatically call Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.DetectChanges
/// to discover any changes to entity instances before saving to the underlying database.
/// This can be disabled via Microsoft.EntityFrameworkCore.ChangeTracking.ChangeTracker.AutoDetectChangesEnabled.
/// Multiple active operations on the same context instance are not supported. Use
/// &apos;await&apos; to ensure that any asynchronous operations have completed before calling
/// another method on this context.
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancellationToken<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A System.Threading.CancellationToken to observe while waiting for the task to complete.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span>A task that represents the asynchronous save operation. The task result contains the number of state entries written to the database.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
public override Task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span> SaveChangesAsync(CancellationToken cancellationToken = default)
{
    //&#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
    SetBaseEntityFields(base.ChangeTracker);
    return base.SaveChangesAsync(cancellationToken);
}

#endregion

#region &#x65B9;&#x6CD5;

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entityState<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5B9E;&#x4F53;&#x72B6;&#x6001;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>propertyValues<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
private void SetBaseEntityFields(ChangeTracker changeTracker)
{
    var baseLogicEntityType = typeof(BaseLogicEntity);
    foreach (var entry in changeTracker.Entries())
    {
        //&#x82E5;entry&#x7684;&#x57FA;&#x7C7B;&#x4E0D;&#x662F;BaseLogicEntity, &#x5219;pass
        if (!baseLogicEntityType.IsAssignableFrom(entry.Entity.GetType()))
        {
            continue;
        }

        SetBaseEntityFields(entry);
    }
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x8BBE;&#x7F6E;&#x57FA;&#x7C7B;&#x901A;&#x7528;&#x5B57;&#x6BB5;&#x503C;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entityState<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x5B9E;&#x4F53;&#x72B6;&#x6001;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>propertyValues<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span>
private void SetBaseEntityFields(EntityEntry entityEntry)
{
    var now = DateTimeOffset.UtcNow;
    var userId = 1470214131637424134L;
    var ip = GetIP();

    var entityState = entityEntry.State;
    var propertyValues = entityEntry.CurrentValues;

    if (propertyValues == default)
    {
        return;
    }

    //&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x503C;
    void SetPropertyValues(PropertyValues propertyValues, Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span> dic)
    {
        dic.ToList().ForEach(kvPair =&gt;
        {
            propertyValues[kvPair.Key] = kvPair.Value;
        });
    }

    Dictionary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string,</span> <span class="token attr-name">object</span><span class="token punctuation">&gt;</span></span> dic = new()
    {
        { SysContant.Entity_Property_LastUpdateTime, now },
        { SysContant.Entity_Property_LastUpdateUserId, userId },
        { SysContant.Entity_Property_LastUpdateIP, ip },
    };
    if (entityState == EntityState.Added)
    {
        dic.Add(SysContant.Entity_Property_AddTime, now);
        dic.Add(SysContant.Entity_Property_AddUserId, userId);
        dic.Add(SysContant.Entity_Property_AddIP, ip);

        SetPropertyValues(propertyValues, dic);
    }
    else if (entityState == EntityState.Modified)
    {
        SetPropertyValues(propertyValues, dic);
    }
    else
    {
        //&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0D;&#x5904;&#x7406;
        return;
    }
}

/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>
/// &#x83B7;&#x53D6;IP&#x5730;&#x5740;
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span>
private string GetIP()
{
    //&#x83B7;&#x53D6;&#x672C;&#x5730;IP
    string GetLocalIP()
    {
        return NetworkInterface
            .GetAllNetworkInterfaces()
            .Where(netWork =&gt; netWork.OperationalStatus == OperationalStatus.Up)
            .Select(netWork =&gt; netWork.GetIPProperties())
            .OrderByDescending(pro =&gt; pro.GatewayAddresses.Count)
            .SelectMany(pro =&gt; pro.UnicastAddresses)
            .FirstOrDefault(ip =&gt; !IPAddress.IsLoopback(ip.Address) &amp;&amp; (ip.Address.AddressFamily == AddressFamily.InterNetwork || ip.Address.AddressFamily == AddressFamily.InterNetworkV6))
            ?.Address.ToString() ?? &quot;&quot;;
    }

    //&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;IP
    string GetRemoteIP() 
    {
        return _httpContextAccessor.HttpContext.Connection.RemoteIpAddress?.ToString() ??
            _httpContextAccessor.HttpContext.Request.Headers[&quot;X-Real-IP&quot;].FirstOrDefault() ?? &quot;&quot;;
    }

    var needHandleIPs = new[] { &quot;::1&quot; };
    var ip = &quot;&quot;;
    bool isGetLocalIP;
    if (_httpContextAccessor == default)
    {
        ip = GetLocalIP();
        isGetLocalIP = true;
    }
    else
    {
        ip = GetRemoteIP();
        isGetLocalIP = false;
    }

    //&#x83B7;&#x53D6;&#x7684;IP&#x662F;&#x5426;&#x9700;&#x8981;&#x4E8C;&#x6B21;&#x5904;&#x7406;
    if (needHandleIPs.Contains(ip))
    {
        ip = isGetLocalIP ? GetRemoteIP() : GetLocalIP();
    }

    return ip;
}

#endregion
</code></pre>
<p>&#x53E6;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x903B;&#x8F91;: &#x53EF;&#x4EE5;&#x6CE8;&#x518C;DbContext.SavingChanges&#x4E8B;&#x4EF6;, &#x5B9E;&#x73B0;&#x516C;&#x5171;&#x5B57;&#x6BB5;&#x7684;&#x4FEE;&#x6539;</p>
<pre class="language-"><code class="lang-C#">public interface IHasTimestamps
{
    DateTime? Added { get; set; }
    DateTime? Deleted { get; set; }
    DateTime? Modified { get; set; }
}

private static void UpdateTimestamps(object sender, EntityEntryEventArgs e)
{
    if (e.Entry.Entity is IHasTimestamps entityWithTimestamps)
    {
        switch (e.Entry.State)
        {
            case EntityState.Deleted:
                entityWithTimestamps.Deleted = DateTime.UtcNow;
                Console.WriteLine($&quot;Stamped for delete: {e.Entry.Entity}&quot;);
                break;
            case EntityState.Modified:
                entityWithTimestamps.Modified = DateTime.UtcNow;
                Console.WriteLine($&quot;Stamped for update: {e.Entry.Entity}&quot;);
                break;
            case EntityState.Added:
                entityWithTimestamps.Added = DateTime.UtcNow;
                Console.WriteLine($&quot;Stamped for insert: {e.Entry.Entity}&quot;);
                break;
        }
    }
}

public BlogsContext()
{
    ChangeTracker.StateChanged += UpdateTimestamps;
    ChangeTracker.Tracked += UpdateTimestamps;
}
</code></pre>
<h3 id=""> </h3>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; Dylan all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">Latest revision time: 
2022-08-17 14:26:15
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="c_sharp.html" class="navigation navigation-prev " aria-label="Previous page: c_sharp">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Identify_Server_4.html" class="navigation navigation-next " aria-label="Next page: Identify_Server_4">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"EF_Core","level":"1.2.4","depth":2,"next":{"title":"Identify_Server_4","level":"1.2.5","depth":2,"path":"NetCore/Identify_Server_4.md","ref":"NetCore/Identify_Server_4.md","articles":[]},"previous":{"title":"c_sharp","level":"1.2.3","depth":2,"path":"NetCore/c_sharp.md","ref":"NetCore/c_sharp.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","anchor-navigation-ex","back-to-top-button","expandable-chapters","code","github","tbfed-pagefooter","prism","-highlight","-sharing","sharing-plus","splitter","hide-element","page-toc-button","theme-comscore"],"ignores":["_book","node_modules"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Dylan","modify_label":"Latest revision time: ","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"github":{"url":"https://dylan880507.github.io/study-note-hub/"},"splitter":{},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link",".page-footer .copyright"]},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"showLevel":false,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":false,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"back-to-top-button":{},"sharing":{"qq":true,"all":false,"douban":false,"facebook":false,"weibo":true,"instapaper":false,"whatsapp":true,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"Dylan","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"sortedBy":"-","disableTitleFormatting":true,"variables":{},"title":"Study Note","catalog":"all","gitbook":"*","unchanged":[],"outputfile":"SUMMARY.md"},"file":{"path":"NetCore/EF_Core.md","mtime":"2022-08-17T06:26:15.439Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-06-27T11:55:58.948Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

